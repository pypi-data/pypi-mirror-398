(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[807],{791:(e,t,n)=>{"use strict";n.d(t,{E:()=>o});var a=n(8629);n(5329);var s=n(9310),r=n(7463),l=n(1573);let i=(0,r.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:n,asChild:r=!1,...o}=e,d=r?s.DX:"span";return(0,a.jsx)(d,{"data-slot":"badge",className:(0,l.cn)(i({variant:n}),t),...o})}},3603:e=>{e.exports={cardContainer:"KBCard_cardContainer___Sfow",basicInfoContainer:"KBCard_basicInfoContainer__PdiYT",basicInfoNameContainer:"KBCard_basicInfoNameContainer__zsmtE",basicInfoNameText:"KBCard_basicInfoNameText__uSeOC",basicInfoDescriptionText:"KBCard_basicInfoDescriptionText__i6mh7",basicInfoLastUpdatedTimeContainer:"KBCard_basicInfoLastUpdatedTimeContainer__RdKoh",basicInfoUpdateTimeIcon:"KBCard_basicInfoUpdateTimeIcon__Ri4QX",basicInfoUpdateTimeText:"KBCard_basicInfoUpdateTimeText__P95Nc",operationContainer:"KBCard_operationContainer__qOX0i",operationDefaultBadge:"KBCard_operationDefaultBadge__PMsKP",operationDefaultBadgeIcon:"KBCard_operationDefaultBadgeIcon__p0rrD",operationDefaultBadgeText:"KBCard_operationDefaultBadgeText__CS1OK",bigText:"KBCard_bigText__tFw00",debugButtonIcon:"KBCard_debugButtonIcon__k0pCf"}},4879:(e,t,n)=>{Promise.resolve().then(n.bind(n,7199))},6267:(e,t,n)=>{"use strict";n.d(t,{SQ:()=>o,_2:()=>d,lp:()=>c,rI:()=>l,ty:()=>i});var a=n(8629);n(5329);var s=n(1872),r=n(1573);function l(e){let{...t}=e;return(0,a.jsx)(s.bL,{"data-slot":"dropdown-menu",...t})}function i(e){let{...t}=e;return(0,a.jsx)(s.l9,{"data-slot":"dropdown-menu-trigger",...t})}function o(e){let{className:t,sideOffset:n=4,...l}=e;return(0,a.jsx)(s.ZL,{children:(0,a.jsx)(s.UC,{"data-slot":"dropdown-menu-content",sideOffset:n,className:(0,r.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...l})})}function d(e){let{className:t,inset:n,variant:l="default",...i}=e;return(0,a.jsx)(s.q7,{"data-slot":"dropdown-menu-item","data-inset":n,"data-variant":l,className:(0,r.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i})}function c(e){let{className:t,inset:n,...l}=e;return(0,a.jsx)(s.JU,{"data-slot":"dropdown-menu-label","data-inset":n,className:(0,r.cn)("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",t),...l})}},7166:(e,t,n)=>{"use strict";n.d(t,{A0:()=>l,BF:()=>i,Hj:()=>o,XI:()=>r,nA:()=>c,nd:()=>d});var a=n(8629);n(5329);var s=n(1573);function r(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,s.cn)("w-full caption-bottom text-sm",t),...n})})}function l(e){let{className:t,...n}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,s.cn)("[&_tr]:border-b",t),...n})}function i(e){let{className:t,...n}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,s.cn)("[&_tr:last-child]:border-0",t),...n})}function o(e){let{className:t,...n}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,s.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...n})}function d(e){let{className:t,...n}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,s.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})}function c(e){let{className:t,...n}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,s.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})}},7199:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>$});var a=n(8629),s=n(4187),r=n(9247),l=n.n(r),i=n(8396),o=n(5329);class d{constructor(e){this.id=e.id,this.name=e.name,this.description=e.description,this.embeddingModelUUID=e.embeddingModelUUID,this.top_k=e.top_k,this.lastUpdatedTimeAgo=e.lastUpdatedTimeAgo}}class c{constructor({id:e,name:t,description:n,retrieverName:a,retrieverConfig:s,lastUpdatedTimeAgo:r,pluginAuthor:l,pluginName:i}){this.id=e,this.name=t,this.description=n,this.retrieverName=a,this.retrieverConfig=s,this.lastUpdatedTimeAgo=r,this.pluginAuthor=l,this.pluginName=i}}var u=n(3603),m=n.n(u);function x(e){let{kbCardVO:t}=e,{t:n}=(0,i.Bd)();return(0,a.jsx)("div",{className:"".concat(m().cardContainer),children:(0,a.jsxs)("div",{className:"".concat(m().basicInfoContainer),children:[(0,a.jsxs)("div",{className:"".concat(m().basicInfoNameContainer),children:[(0,a.jsx)("div",{className:"".concat(m().basicInfoNameText,"  ").concat(m().bigText),children:t.name}),(0,a.jsx)("div",{className:"".concat(m().basicInfoDescriptionText),children:t.description})]}),(0,a.jsxs)("div",{className:"".concat(m().basicInfoLastUpdatedTimeContainer),children:[(0,a.jsx)("svg",{className:"".concat(m().basicInfoUpdateTimeIcon),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z"})}),(0,a.jsxs)("div",{className:"".concat(m().basicInfoUpdateTimeText),children:[n("knowledge.updateTime"),t.lastUpdatedTimeAgo]})]})]})})}var g=n(2959);function h(e){let{kbCardVO:t}=e,{t:n}=(0,i.Bd)();return(0,a.jsx)("div",{className:"".concat(m().cardContainer),children:(0,a.jsxs)("div",{className:"w-full h-full flex flex-row items-start gap-3",children:[(0,a.jsx)("img",{src:g.ok.getPluginIconURL(t.pluginAuthor,t.pluginName),alt:"plugin icon",className:"w-16 h-16 mt-1 rounded-[8%] flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col flex-1 min-w-0 h-full",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,a.jsxs)("div",{className:"".concat(m().basicInfoNameContainer),children:[(0,a.jsx)("div",{className:"".concat(m().basicInfoNameText," ").concat(m().bigText),children:t.name}),(0,a.jsx)("div",{className:"".concat(m().basicInfoDescriptionText),children:t.description})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center mt-1",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M7 5C7 2.79086 8.79086 1 11 1C13.2091 1 15 2.79086 15 5H18C18.5523 5 19 5.44772 19 6V9C21.2091 9 23 10.7909 23 13C23 15.2091 21.2091 17 19 17V20C19 20.5523 18.5523 21 18 21H4C3.44772 21 3 20.5523 3 20V6C3 5.44772 3.44772 5 4 5H7ZM11 3C9.89543 3 9 3.89543 9 5C9 5.23554 9.0403 5.45952 9.11355 5.66675C9.22172 5.97282 9.17461 6.31235 8.98718 6.57739C8.79974 6.84243 8.49532 7 8.17071 7H5V19H17V15.8293C17 15.5047 17.1576 15.2003 17.4226 15.0128C17.6877 14.8254 18.0272 14.7783 18.3332 14.8865C18.5405 14.9597 18.7645 15 19 15C20.1046 15 21 14.1046 21 13C21 11.8954 20.1046 11 19 11C18.7645 11 18.5405 11.0403 18.3332 11.1135C18.0272 11.2217 17.6877 11.1746 17.4226 10.9872C17.1576 10.7997 17 10.4953 17 10.1707V7H13.8293C13.5047 7 13.2003 6.84243 13.0128 6.57739C12.8254 6.31235 12.7783 5.97282 12.8865 5.66675C12.9597 5.45952 13 5.23555 13 5C13 3.89543 12.1046 3 11 3Z"})}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:[t.pluginAuthor," / ",t.pluginName]})]})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center mt-auto",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z"})}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:[n("knowledge.updateTime"),t.lastUpdatedTimeAgo]})]})]})]})})}var p=n(8642),f=n(2672),j=n(5702),v=n(8893),b=n(3850),w=n(2985),k=n(9854),C=n(4996),N=n(4586),_=n(4001),y=n(2499);function B(e){let{initKbId:t,onNewKbCreated:n,onKbUpdated:s}=e,{t:r}=(0,i.Bd)(),l=w.Ik({name:w.Yj().min(1,{message:r("knowledge.kbNameRequired")}),description:w.Yj().min(1,{message:r("knowledge.kbDescriptionRequired")}),embeddingModelUUID:w.Yj().min(1,{message:r("knowledge.embeddingModelUUIDRequired")}),top_k:w.ai().min(1,{message:r("knowledge.topKRequired")}).max(30,{message:r("knowledge.topKMax")})}),d=(0,v.mN)({resolver:(0,b.u)(l),defaultValues:{name:"",description:r("knowledge.defaultDescription"),embeddingModelUUID:"",top_k:5}}),[c,u]=(0,o.useState)([]);(0,o.useEffect)(()=>{x().then(()=>{t&&m(t).then(e=>{d.setValue("name",e.name),d.setValue("description",e.description),d.setValue("embeddingModelUUID",e.embeddingModelUUID),d.setValue("top_k",e.top_k||5)})})},[]);let m=async e=>new Promise(t=>{g.ok.getKnowledgeBase(e).then(e=>{t({name:e.base.name,description:e.base.description,embeddingModelUUID:e.base.embedding_model_uuid,top_k:e.base.top_k||5})})}),x=async()=>{u((await g.ok.getProviderEmbeddingModels()).models)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(C.lV,{...d,children:(0,a.jsx)("form",{onSubmit:d.handleSubmit(e=>{if(t){let n={name:e.name,description:e.description,embedding_model_uuid:e.embeddingModelUUID,top_k:e.top_k};g.ok.updateKnowledgeBase(t,n).then(e=>{s(e.uuid),_.oR.success(r("knowledge.updateKnowledgeBaseSuccess"))}).catch(e=>{console.error("update knowledge base failed",e),_.oR.error(r("knowledge.updateKnowledgeBaseFailed"))})}else{let t={name:e.name,description:e.description,embedding_model_uuid:e.embeddingModelUUID,top_k:e.top_k};g.ok.createKnowledgeBase(t).then(e=>{n(e.uuid)}).catch(e=>{console.error("create knowledge base failed",e)})}}),id:"kb-form",className:"space-y-8",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(C.zB,{control:d.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(C.eI,{children:[(0,a.jsxs)(C.lR,{children:[r("knowledge.kbName"),(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(C.MJ,{children:(0,a.jsx)(k.p,{...t})}),(0,a.jsx)(C.C5,{})]})}}),(0,a.jsx)(C.zB,{control:d.control,name:"description",render:e=>{let{field:t}=e;return(0,a.jsxs)(C.eI,{children:[(0,a.jsxs)(C.lR,{children:[r("knowledge.kbDescription"),(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(C.MJ,{children:(0,a.jsx)(k.p,{...t})}),(0,a.jsx)(C.C5,{})]})}}),(0,a.jsx)(C.zB,{control:d.control,name:"embeddingModelUUID",render:e=>{let{field:n}=e;return(0,a.jsxs)(C.eI,{children:[(0,a.jsxs)(C.lR,{children:[r("knowledge.embeddingModelUUID"),(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(C.MJ,{children:(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)(N.l6,{disabled:!!t,onValueChange:e=>{n.onChange(e)},value:n.value,children:[(0,a.jsx)(N.bq,{className:"w-[180px] bg-[#ffffff] dark:bg-[#2a2a2e]",children:(0,a.jsx)(N.yv,{placeholder:r("knowledge.selectEmbeddingModel")})}),(0,a.jsx)(N.gC,{className:"fixed z-[1000]",children:(0,a.jsx)(N.s3,{children:c.map(e=>(0,a.jsxs)(y.jc,{openDelay:0,closeDelay:0,children:[(0,a.jsx)(y.d0,{asChild:!0,children:(0,a.jsx)(N.eb,{value:e.uuid,children:e.name})}),(0,a.jsx)(y.Et,{className:"w-80 data-[state=open]:animate-none data-[state=closed]:animate-none",align:"end",side:"right",sideOffset:10,children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("img",{src:g.ok.getProviderRequesterIconURL(e.requester),alt:"icon",className:"w-8 h-8 rounded-[8%]"}),(0,a.jsx)("h4",{className:"font-medium",children:e.name})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),e.requester_config&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M13.0607 8.11097L14.4749 9.52518C17.2086 12.2589 17.2086 16.691 14.4749 19.4247L14.1214 19.7782C11.3877 22.5119 6.95555 22.5119 4.22188 19.7782C1.48821 17.0446 1.48821 12.6124 4.22188 9.87874L5.6361 11.293C3.68348 13.2456 3.68348 16.4114 5.6361 18.364C7.58872 20.3166 10.7545 20.3166 12.7072 18.364L13.0607 18.0105C15.0133 16.0578 15.0133 12.892 13.0607 10.9394L11.6465 9.52518L13.0607 8.11097ZM19.7782 14.1214L18.364 12.7072C20.3166 10.7545 20.3166 7.58872 18.364 5.6361C16.4114 3.68348 13.2456 3.68348 11.293 5.6361L10.9394 5.98965C8.98678 7.94227 8.98678 11.1081 10.9394 13.0607L12.3536 14.4749L10.9394 15.8891L9.52518 14.4749C6.79151 11.7413 6.79151 7.30911 9.52518 4.57544L9.87874 4.22188C12.6124 1.48821 17.0446 1.48821 19.7782 4.22188C22.5119 6.95555 22.5119 11.3877 19.7782 14.1214Z"})}),(0,a.jsx)("span",{className:"font-semibold",children:"Base URL："}),e.requester_config.base_url]}),e.extra_args&&Object.keys(e.extra_args).length>0&&(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsx)("div",{className:"font-semibold mb-1",children:r("models.extraParameters")}),(0,a.jsx)("div",{className:"space-y-1",children:Object.entries(e.extra_args).map(e=>{let[t,n]=e;return(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)("span",{className:"text-gray-500",children:[t,"："]}),(0,a.jsx)("span",{className:"break-all",children:JSON.stringify(n)})]},t)})})]})]})})]},e.uuid))})})]})})}),(0,a.jsx)(C.Rr,{children:t?r("knowledge.cannotChangeEmbeddingModel"):r("knowledge.embeddingModelDescription")}),(0,a.jsx)(C.C5,{})]})}}),(0,a.jsx)(C.zB,{control:d.control,name:"top_k",render:e=>{let{field:t}=e;return(0,a.jsxs)(C.eI,{children:[(0,a.jsxs)(C.lR,{children:[r("knowledge.topK"),(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(C.MJ,{children:(0,a.jsx)(k.p,{type:"number",...t,onChange:e=>t.onChange(Number(e.target.value)),className:"w-[180px] h-10 text-base appearance-none"})}),(0,a.jsx)(C.Rr,{children:r("knowledge.topKdescription")}),(0,a.jsx)(C.C5,{})]})}})]})})})})}var I=n(3887),K=n(6267),T=n(791),V=n(4284),D=n(6343),U=n(7166);function M(e){var t;let{columns:n,data:s}=e,{t:r}=(0,i.Bd)(),l=(0,V.N4)({data:s,columns:n,getCoreRowModel:(0,D.HT)()});return(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(U.XI,{children:[(0,a.jsx)(U.A0,{children:l.getHeaderGroups().map(e=>(0,a.jsx)(U.Hj,{children:e.headers.map(e=>(0,a.jsx)(U.nd,{children:e.isPlaceholder?null:(0,V.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,a.jsx)(U.BF,{children:(null==(t=l.getRowModel().rows)?void 0:t.length)?l.getRowModel().rows.map(e=>(0,a.jsx)(U.Hj,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(e=>(0,a.jsx)(U.nA,{children:(0,V.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,a.jsx)(U.Hj,{children:(0,a.jsx)(U.nA,{colSpan:n.length,className:"h-24 text-center",children:r("knowledge.documentsTab.noResults")})})})]})})}var R=n(6076);function S(e){let{kbId:t,onUploadSuccess:n,onUploadError:s}=e,{t:r}=(0,i.Bd)(),[l,d]=(0,o.useState)(!1),[c,u]=(0,o.useState)(!1),m=(0,o.useCallback)(async e=>{if(c)return;if(e.size>0xa00000)return void _.oR.error(r("knowledge.documentsTab.fileSizeExceeded"));u(!0);let a=_.oR.loading(r("knowledge.documentsTab.uploadingFile"));try{let s=await g.ok.uploadDocumentFile(e);await g.ok.uploadKnowledgeBaseFile(t,s.file_id),_.oR.success(r("knowledge.documentsTab.uploadSuccess"),{id:a}),n()}catch(t){console.error("File upload failed:",t);let e=r("knowledge.documentsTab.uploadError");_.oR.error(e,{id:a}),s(e)}finally{u(!1)}},[t,c,n,s,r]),x=(0,o.useCallback)(e=>{e.preventDefault(),d(!0)},[]),h=(0,o.useCallback)(e=>{e.preventDefault(),d(!1)},[]),p=(0,o.useCallback)(e=>{e.preventDefault(),d(!1);let t=Array.from(e.dataTransfer.files);t.length>0&&m(t[0])},[m]),f=(0,o.useCallback)(e=>{let t=e.target.files;t&&t.length>0&&m(t[0])},[m]);return(0,a.jsx)(R.Zp,{className:"mb-4",children:(0,a.jsx)(R.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"\n            relative border-2 border-dashed rounded-lg p-4 text-center transition-colors\n            ".concat(l?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400","\n            ").concat(c?"opacity-50 pointer-events-none":"","\n          "),onDragOver:x,onDragLeave:h,onDrop:p,children:[(0,a.jsx)("input",{type:"file",id:"file-upload",className:"hidden",onChange:f,accept:".pdf,.doc,.docx,.txt,.md,.html,.zip",disabled:c}),(0,a.jsx)("label",{htmlFor:"file-upload",className:"cursor-pointer block",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"mx-auto w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-base font-medium text-gray-900 dark:text-gray-100",children:c?r("knowledge.documentsTab.uploading"):r("knowledge.documentsTab.dragAndDrop")}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:r("knowledge.documentsTab.supportedFormats")})]})]})})]})})})}function E(e){let t,{kbId:n}=e,[s,r]=(0,o.useState)([]),{t:l}=(0,i.Bd)();async function d(){r((await g.ok.getKnowledgeBaseFiles(n)).files.map(e=>({uuid:e.uuid,name:e.file_name,status:e.status})))}return(0,o.useEffect)(()=>{d();let e=setInterval(()=>{d()},5e3);return()=>{clearInterval(e)}},[n]),(0,a.jsxs)("div",{className:"container mx-auto py-2",children:[(0,a.jsx)(S,{kbId:n,onUploadSuccess:()=>{d()},onUploadError:e=>{console.error("Upload failed:",e)}}),(0,a.jsx)(M,{columns:(t=e=>{g.ok.deleteKnowledgeBaseFile(n,e).then(()=>{d(),_.oR.success(l("knowledge.documentsTab.fileDeleteSuccess"))}).catch(e=>{console.error("Delete failed:",e),_.oR.error(l("knowledge.documentsTab.fileDeleteFailed"))})},[{accessorKey:"name",header:l("knowledge.documentsTab.name")},{accessorKey:"status",header:l("knowledge.documentsTab.status"),cell:e=>{let{row:t}=e,n=t.original;switch(n.status){case"processing":return(0,a.jsx)(T.E,{variant:"secondary",children:l("knowledge.documentsTab.processing")});case"completed":return(0,a.jsx)(T.E,{variant:"outline",className:"bg-blue-500 text-white",children:l("knowledge.documentsTab.completed")});case"failed":return(0,a.jsx)(T.E,{variant:"outline",className:"bg-yellow-500 text-white",children:l("knowledge.documentsTab.failed")});default:return(0,a.jsx)(T.E,{variant:"outline",className:"bg-gray-500 text-white",children:n.status})}}},{id:"actions",cell:e=>{let{row:n}=e,s=n.original;return(0,a.jsxs)(K.rI,{children:[(0,a.jsx)(K.ty,{asChild:!0,children:(0,a.jsxs)(j.$,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,a.jsx)("span",{className:"sr-only",children:l("knowledge.documentsTab.actions")}),(0,a.jsx)(I.A,{className:"h-4 w-4"})]})}),(0,a.jsxs)(K.SQ,{align:"end",className:"bg-white dark:bg-[#2a2a2e]",children:[(0,a.jsx)(K.lp,{children:l("knowledge.documentsTab.actions")}),(0,a.jsx)(K._2,{onClick:()=>t(s.uuid),children:l("knowledge.documentsTab.delete")})]})]})}}]),data:s})]})}function L(e){let{kbId:t}=e,{t:n}=(0,i.Bd)(),[s,r]=(0,o.useState)(""),[l,d]=(0,o.useState)([]),[c,u]=(0,o.useState)([]),[m,x]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{try{let e=await g.ok.getKnowledgeBaseFiles(t);u(e.files)}catch(e){console.error("Failed to load files:",e)}})()},[t]);let h=async()=>{if(s.trim()){x(!0);try{d([]);let e=await g.ok.retrieveKnowledgeBase(t,s);d(e.results)}catch(e){console.error("Retrieve failed:",e),_.oR.error(n("knowledge.retrieveError"))}finally{x(!1)}}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(k.p,{value:s,onChange:e=>r(e.target.value),placeholder:n("knowledge.queryPlaceholder"),onKeyPress:e=>"Enter"===e.key&&h()}),(0,a.jsx)(j.$,{onClick:h,disabled:m||!s.trim(),children:n("knowledge.query")})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[0===l.length&&!m&&(0,a.jsx)("p",{className:"text-muted-foreground",children:n("knowledge.noResults")}),m?(0,a.jsx)("p",{className:"text-muted-foreground",children:n("common.loading")}):l.map(e=>(0,a.jsxs)(R.Zp,{className:"w-full",children:[(0,a.jsx)(R.aR,{className:"pb-3",children:(0,a.jsxs)(R.ZB,{className:"text-sm font-medium flex justify-between items-center",children:[(0,a.jsx)("span",{children:(e=>{if(!e)return"";let t=c.find(t=>t.uuid===e);return(null==t?void 0:t.file_name)||e})(e.metadata.file_id)}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[n("knowledge.distance"),": ",e.distance.toFixed(4)]})]})}),(0,a.jsx)(R.Wu,{children:(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:(e=>{var t;if(e.content&&Array.isArray(e.content)){let t=e.content.filter(e=>"text"===e.type&&e.text).map(e=>e.text);if(t.length>0)return t.join("\n\n")}return(null==(t=e.metadata)?void 0:t.text)?e.metadata.text:""})(e)})})]},e.id))]})]})}var H=n(3179),A=n(9318),F=n(2472),Z=n(2262);function z(e){let{initKBId:t,onFormSubmit:n,onKBDeleted:s,onNewKBCreated:r}=e,{t:l}=(0,i.Bd)(),d=w.Ik({name:w.Yj().min(1,{message:l("knowledge.nameRequired")}),description:w.Yj().optional(),plugin_author:w.Yj().min(1,{message:"Please select a retriever"}),plugin_name:w.Yj().min(1,{message:"Please select a retriever"}),retriever_name:w.Yj().min(1,{message:"Please select a retriever"}),retriever_config:w.g1(w.Yj(),w.bz())}),c=(0,v.mN)({resolver:(0,b.u)(d),defaultValues:{name:"",description:"",plugin_author:"",plugin_name:"",retriever_name:"",retriever_config:{}}}),[u,m]=(0,o.useState)(!1),[x,h]=(0,o.useState)([]),[f,B]=(0,o.useState)(new Map),[I,K]=(0,o.useState)(!1),[T,V]=(0,o.useState)([]);async function D(){let e=await U();if(t)try{let n=await M(t);c.setValue("name",n.name),c.setValue("description",n.description||""),c.setValue("plugin_author",n.plugin_author),c.setValue("plugin_name",n.plugin_name),c.setValue("retriever_name",n.retriever_name),c.setValue("retriever_config",n.retriever_config);let a="".concat(n.plugin_author,"/").concat(n.plugin_name,"/").concat(n.retriever_name);R(a,e)}catch(e){_.oR.error("Failed to load KB config: "+e.message)}else c.reset()}async function U(){let e=await g.ok.listKnowledgeRetrievers();h(e.retrievers||[]);let t=new Map;return(e.retrievers||[]).forEach(e=>{var n,a,s;let r="".concat(e.plugin_author,"/").concat(e.plugin_name,"/").concat(e.retriever_name),l=(null==(s=e.manifest)||null==(a=s.manifest)||null==(n=a.spec)?void 0:n.config)||[];t.set(r,l.map(e=>new A.HL({default:e.default,id:H.k.generate(),label:e.label,description:e.description,name:e.name,required:e.required,type:(0,A.GG)(e.type),options:e.options})))}),B(t),t}async function M(e){let t=(await g.ok.getExternalKnowledgeBase(e)).base;return{name:t.name,description:t.description,plugin_author:t.plugin_author,plugin_name:t.plugin_name,retriever_name:t.retriever_name,retriever_config:t.retriever_config||{}}}function R(e,t){if(!e)return void K(!1);let n=(t||f).get(e);n&&n.length>0?(V(n),K(!0),t||c.setValue("retriever_config",(0,A.wY)(n))):(K(!1),t||c.setValue("retriever_config",{}))}function S(e){if(!e)return void K(!1);let t=e.split("/");3===t.length&&(c.setValue("plugin_author",t[0]),c.setValue("plugin_name",t[1]),c.setValue("retriever_name",t[2])),R(e)}(0,o.useEffect)(()=>{D()},[t]);let E=c.watch("plugin_author")&&c.watch("plugin_name")&&c.watch("retriever_name")?"".concat(c.watch("plugin_author"),"/").concat(c.watch("plugin_name"),"/").concat(c.watch("retriever_name")):"";return(0,a.jsxs)("div",{children:[(0,a.jsx)(p.lG,{open:u,onOpenChange:m,children:(0,a.jsxs)(p.Cf,{children:[(0,a.jsx)(p.c7,{children:(0,a.jsx)(p.L3,{children:l("common.confirmDelete")})}),(0,a.jsx)(p.rr,{children:l("knowledge.deleteConfirmation")}),(0,a.jsxs)(p.Es,{children:[(0,a.jsx)(j.$,{variant:"outline",onClick:()=>m(!1),children:l("common.cancel")}),(0,a.jsx)(j.$,{variant:"destructive",onClick:()=>{t&&g.ok.deleteExternalKnowledgeBase(t).then(()=>{s(),_.oR.success(l("knowledge.deleteExternalSuccess"))}).catch(e=>{_.oR.error("Failed to delete KB: "+e.message)}),m(!1)},children:l("common.confirmDelete")})]})]})}),(0,a.jsx)(C.lV,{...c,children:(0,a.jsx)("form",{id:"external-kb-form",onSubmit:c.handleSubmit(function(){let e={name:c.getValues().name,description:c.getValues().description||"",plugin_author:c.getValues().plugin_author,plugin_name:c.getValues().plugin_name,retriever_name:c.getValues().retriever_name,retriever_config:c.getValues().retriever_config};t?g.ok.updateExternalKnowledgeBase(t,{...e,uuid:t}).then(()=>{n(c.getValues()),_.oR.success(l("knowledge.updateExternalSuccess"))}).catch(e=>{_.oR.error("Failed to update KB: "+e.message)}):g.ok.createExternalKnowledgeBase(e).then(e=>{_.oR.success(l("knowledge.createExternalSuccess")),r(e.uuid),c.reset()}).catch(e=>{_.oR.error("Failed to create KB: "+e.message)})}),className:"space-y-8",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(C.zB,{control:c.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(C.eI,{children:[(0,a.jsxs)(C.lR,{children:[l("knowledge.kbName"),(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(C.MJ,{children:(0,a.jsx)(k.p,{...t})}),(0,a.jsx)(C.C5,{})]})}}),(0,a.jsx)(C.zB,{control:c.control,name:"description",render:e=>{let{field:t}=e;return(0,a.jsxs)(C.eI,{children:[(0,a.jsx)(C.lR,{children:l("knowledge.kbDescription")}),(0,a.jsx)(C.MJ,{children:(0,a.jsx)(k.p,{...t})}),(0,a.jsx)(C.C5,{})]})}}),(0,a.jsx)(C.zB,{control:c.control,name:"retriever_name",render:()=>(0,a.jsxs)(C.eI,{children:[(0,a.jsxs)(C.lR,{children:[l("knowledge.retriever"),(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(C.MJ,{children:(0,a.jsxs)(N.l6,{onValueChange:S,value:E,children:[(0,a.jsx)(N.bq,{className:"w-full bg-[#ffffff] dark:bg-[#2a2a2e]",children:(0,a.jsx)(N.yv,{placeholder:l("knowledge.selectRetriever")})}),(0,a.jsx)(N.gC,{className:"fixed z-[1000]",children:(0,a.jsx)(N.s3,{children:x.map(e=>{var t,n,s;let r="".concat(e.plugin_author,"/").concat(e.plugin_name,"/").concat(e.retriever_name),l=(null==(s=e.manifest)||null==(n=s.manifest)||null==(t=n.metadata)?void 0:t.label)?(0,Z.Z)(e.manifest.manifest.metadata.label):e.retriever_name,i=(0,Z.Z)(e.retriever_description);return(0,a.jsxs)(y.jc,{openDelay:0,closeDelay:0,children:[(0,a.jsx)(y.d0,{asChild:!0,children:(0,a.jsx)(N.eb,{value:r,children:l})}),(0,a.jsx)(y.Et,{className:"w-80 data-[state=open]:animate-none",align:"end",side:"right",sideOffset:10,children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("img",{src:g.ok.getPluginIconURL(e.plugin_author,e.plugin_name),alt:"plugin icon",className:"w-10 h-10 rounded-[8%] flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:l}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.plugin_author," /"," ",e.plugin_name]})]})]}),i&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:i})]})})]},r)})})})]})}),(0,a.jsx)(C.C5,{}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[l("knowledge.retrieverInstallInfo")," ",(0,a.jsx)("a",{href:"https://space.langbot.app/market?category=KnowledgeRetriever",target:"_blank",rel:"noopener noreferrer",className:"text-primary underline hover:no-underline",children:l("knowledge.retrieverMarketLink")})]})]})}),E&&(0,a.jsxs)("div",{className:"flex items-start gap-3 p-4 rounded-lg border",children:[(0,a.jsx)("img",{src:g.ok.getPluginIconURL(c.watch("plugin_author"),c.watch("plugin_name")),alt:"plugin icon",className:"w-12 h-12 rounded-[8%] flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("div",{className:"font-medium",children:function(e){var t,n,a;let s=x.find(t=>"".concat(t.plugin_author,"/").concat(t.plugin_name,"/").concat(t.retriever_name)===e);return(null==s||null==(a=s.manifest)||null==(n=a.manifest)||null==(t=n.metadata)?void 0:t.label)?(0,Z.Z)(s.manifest.manifest.metadata.label):e}(E)}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[c.watch("plugin_author")," / ",c.watch("plugin_name")]})]})]}),I&&T.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"text-lg font-medium",children:l("knowledge.retrieverConfiguration")}),(0,a.jsx)(F.A,{itemConfigList:T,initialValues:c.watch("retriever_config"),onSubmit:e=>{c.setValue("retriever_config",e)}})]})]})})})]})}function P(e){let{kbId:t,retrieveFunction:n,getResultTitle:s}=e,{t:r}=(0,i.Bd)(),[l,d]=(0,o.useState)(""),[c,u]=(0,o.useState)([]),[m,x]=(0,o.useState)(!1),g=async()=>{if(l.trim()){x(!0);try{u([]);let e=await n(t,l);u(e.results)}catch(e){console.error("Retrieve failed:",e),_.oR.error(r("knowledge.retrieveError"))}finally{x(!1)}}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(k.p,{value:l,onChange:e=>d(e.target.value),placeholder:r("knowledge.queryPlaceholder"),onKeyPress:e=>"Enter"===e.key&&g()}),(0,a.jsx)(j.$,{onClick:g,disabled:m||!l.trim(),children:r("knowledge.query")})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[0===c.length&&!m&&(0,a.jsx)("p",{className:"text-muted-foreground",children:r("knowledge.noResults")}),m?(0,a.jsx)("p",{className:"text-muted-foreground",children:r("common.loading")}):c.map(e=>(0,a.jsxs)(R.Zp,{className:"w-full",children:[(0,a.jsx)(R.aR,{className:"pb-3",children:(0,a.jsxs)(R.ZB,{className:"text-sm font-medium flex justify-between items-center",children:[(0,a.jsx)("span",{children:s?s(e):e.metadata.file_id||e.metadata.document_name||e.id}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[r("knowledge.distance"),": ",e.distance.toFixed(4)]})]})}),(0,a.jsx)(R.Wu,{children:(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:(e=>{if(e.content&&Array.isArray(e.content)){let t=e.content.filter(e=>"text"===e.type&&e.text).map(e=>e.text);if(t.length>0)return t.join("\n\n")}return""})(e)})})]},e.id))]})]})}function q(e){let{kbId:t}=e;return(0,a.jsx)(P,{kbId:t,retrieveFunction:g.ok.retrieveExternalKnowledgeBase.bind(g.ok),getResultTitle:e=>e.metadata.document_name||e.metadata.source||e.id})}function O(e){let{open:t,onOpenChange:n,kbId:s,kbType:r,onFormCancel:l,onKbDeleted:d,onNewKbCreated:c,onKbUpdated:u}=e,{t:m}=(0,i.Bd)(),[x,h]=(0,o.useState)(s),[v,b]=(0,o.useState)("metadata"),[w,k]=(0,o.useState)(!1);(0,o.useEffect)(()=>{h(s),b("metadata")},[s,t]);let C=[{key:"metadata",label:m("knowledge.metadata"),icon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M5 7C5 6.17157 5.67157 5.5 6.5 5.5C7.32843 5.5 8 6.17157 8 7C8 7.82843 7.32843 8.5 6.5 8.5C5.67157 8.5 5 7.82843 5 7ZM6.5 3.5C4.567 3.5 3 5.067 3 7C3 8.933 4.567 10.5 6.5 10.5C8.433 10.5 10 8.933 10 7C10 5.067 8.433 3.5 6.5 3.5ZM12 8H20V6H12V8ZM16 17C16 16.1716 16.6716 15.5 17.5 15.5C18.3284 15.5 19 16.1716 19 17C19 17.8284 18.3284 18.5 17.5 18.5C16.6716 18.5 16 17.8284 16 17ZM17.5 13.5C15.567 13.5 14 15.067 14 17C14 18.933 15.567 20.5 17.5 20.5C19.433 20.5 21 18.933 21 17C21 15.067 19.433 13.5 17.5 13.5ZM4 16V18H12V16H4Z"})})},..."builtin"===r?[{key:"documents",label:m("knowledge.documents"),icon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M21 8V20.9932C21 21.5501 20.5552 22 20.0066 22H3.9934C3.44495 22 3 21.556 3 21.0082V2.9918C3 2.45531 3.4487 2 4.00221 2H14.9968L21 8ZM19 9H14V4H5V20H19V9ZM8 7H11V9H8V7ZM8 11H16V13H8V11ZM8 15H16V17H8V15Z"})})}]:[],{key:"retrieve",label:m("knowledge.retrieve"),icon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15z"})})}];return x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.lG,{open:t,onOpenChange:n,children:(0,a.jsx)(p.Cf,{className:"overflow-hidden p-0 !max-w-[50rem] max-h-[75vh] flex",children:(0,a.jsxs)(f.GB,{className:"items-start w-full flex",children:[(0,a.jsx)(f.Bx,{collapsible:"none",className:"hidden md:flex h-[80vh] w-40 min-w-[120px] border-r bg-white dark:bg-black",children:(0,a.jsx)(f.Yv,{children:(0,a.jsx)(f.Cn,{children:(0,a.jsx)(f.rQ,{children:(0,a.jsx)(f.wZ,{children:C.map(e=>(0,a.jsx)(f.FX,{children:(0,a.jsx)(f.Uj,{asChild:!0,isActive:v===e.key,onClick:()=>b(e.key),children:(0,a.jsxs)("a",{href:"#",children:[e.icon,(0,a.jsx)("span",{children:e.label})]})})},e.key))})})})})}),(0,a.jsxs)("main",{className:"flex flex-1 flex-col h-[75vh]",children:[(0,a.jsx)(p.c7,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,a.jsx)(p.L3,{children:m("metadata"===v?"knowledge.editKnowledgeBase":"documents"===v?"knowledge.editDocument":"knowledge.retrieveTest")})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:["metadata"===v&&("builtin"===r?(0,a.jsx)(B,{initKbId:x,onNewKbCreated:c,onKbUpdated:u}):(0,a.jsx)(z,{initKBId:x,onFormSubmit:()=>n(!1),onKBDeleted:()=>{d(),n(!1)},onNewKBCreated:c})),"documents"===v&&"builtin"===r&&(0,a.jsx)(E,{kbId:x}),"retrieve"===v&&("builtin"===r?(0,a.jsx)(L,{kbId:x}):(0,a.jsx)(q,{kbId:x}))]}),"metadata"===v&&(0,a.jsx)(p.Es,{className:"px-6 py-4 border-t shrink-0",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(j.$,{type:"button",variant:"destructive",onClick:()=>k(!0),children:m("common.delete")}),(0,a.jsx)(j.$,{type:"submit",form:"builtin"===r?"kb-form":"external-kb-form",children:m("common.save")}),(0,a.jsx)(j.$,{type:"button",variant:"outline",onClick:l,children:m("common.cancel")})]})})]})]})})}),(0,a.jsx)(p.lG,{open:w,onOpenChange:k,children:(0,a.jsxs)(p.Cf,{children:[(0,a.jsx)(p.c7,{children:(0,a.jsx)(p.L3,{children:m("common.confirmDelete")})}),(0,a.jsx)("div",{className:"py-4",children:m("knowledge.deleteKnowledgeBaseConfirmation")}),(0,a.jsxs)(p.Es,{children:[(0,a.jsx)(j.$,{variant:"outline",onClick:()=>k(!1),children:m("common.cancel")}),(0,a.jsx)(j.$,{variant:"destructive",onClick:()=>{("builtin"===r?g.ok.deleteKnowledgeBase(null!=x?x:""):g.ok.deleteExternalKnowledgeBase(null!=x?x:"")).then(()=>{d()}),k(!1)},children:m("common.confirmDelete")})]})]})})]}):(0,a.jsx)(p.lG,{open:t,onOpenChange:n,children:(0,a.jsx)(p.Cf,{className:"overflow-hidden p-0 !max-w-[40vw] max-h-[70vh] flex",children:(0,a.jsxs)("main",{className:"flex flex-1 flex-col h-[70vh]",children:[(0,a.jsx)(p.c7,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,a.jsx)(p.L3,{children:m("builtin"===r?"knowledge.createKnowledgeBase":"knowledge.addExternal")})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:"builtin"===r?(0,a.jsx)(B,{initKbId:void 0,onNewKbCreated:c,onKbUpdated:u}):(0,a.jsx)(z,{initKBId:void 0,onFormSubmit:()=>n(!1),onKBDeleted:()=>{},onNewKBCreated:c})}),"metadata"===v&&(0,a.jsx)(p.Es,{className:"px-6 py-4 border-t shrink-0",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(j.$,{type:"submit",form:"builtin"===r?"kb-form":"external-kb-form",children:m("common.save")}),(0,a.jsx)(j.$,{type:"button",variant:"outline",onClick:l,children:m("common.cancel")})]})})]})})})}var Y=n(7366);function $(){let{t:e}=(0,i.Bd)(),[t,n]=(0,o.useState)("builtin"),[r,u]=(0,o.useState)([]),[m,p]=(0,o.useState)([]),[f,j]=(0,o.useState)(""),[v,b]=(0,o.useState)("builtin"),[w,k]=(0,o.useState)(!1),[C,N]=(0,o.useState)(null);async function _(){try{let e=await g.ok.getPluginSystemStatus();N(e)}catch(e){console.error("Failed to fetch plugin system status:",e)}}async function y(){u((await g.ok.getKnowledgeBases()).bases.map(t=>{var n,a;let s=new Date,r=Math.floor((s.getTime()-new Date(null!=(n=t.updated_at)?n:s.getTime()).getTime())/1e3/60/60/24),l=r>0?" ".concat(r," ").concat(e("knowledge.daysAgo")):e("knowledge.today");return new d({id:t.uuid||"",name:t.name,description:t.description,embeddingModelUUID:t.embedding_model_uuid,top_k:null!=(a=t.top_k)?a:5,lastUpdatedTimeAgo:l})}))}async function B(){try{let t=await g.ok.getExternalKnowledgeBases();p(t.bases.map(t=>{var n;let a=new Date,s=Math.floor((a.getTime()-new Date(null!=(n=t.created_at)?n:a.getTime()).getTime())/1e3/60/60/24),r=s>0?" ".concat(s," ").concat(e("knowledge.daysAgo")):e("knowledge.today");return new c({id:t.uuid||"",name:t.name,description:t.description,retrieverName:"".concat(t.plugin_author,"/").concat(t.plugin_name,"/").concat(t.retriever_name),retrieverConfig:t.retriever_config||{},lastUpdatedTimeAgo:r,pluginAuthor:t.plugin_author,pluginName:t.plugin_name})}))}catch(e){console.error("Failed to load external knowledge bases:",e)}}return(0,o.useEffect)(()=>{y(),B(),_()},[]),(0,a.jsxs)("div",{children:[(0,a.jsx)(O,{open:w,onOpenChange:k,kbId:f||void 0,kbType:v,onFormCancel:()=>{k(!1)},onKbDeleted:()=>{"builtin"===v?y():B(),k(!1)},onNewKbCreated:e=>{"builtin"===v?y():B(),j(e),k(!0)},onKbUpdated:()=>{"builtin"===v?y():B()}}),(0,a.jsxs)(Y.tU,{value:t,onValueChange:n,className:"w-full",children:[(0,a.jsx)("div",{className:"flex flex-row justify-between items-center px-[0.8rem]",children:(0,a.jsxs)(Y.j7,{className:"shadow-md py-5 bg-[#f0f0f0] dark:bg-[#2a2a2e]",children:[(0,a.jsx)(Y.Xi,{value:"builtin",className:"px-6 py-4 cursor-pointer",children:e("knowledge.builtIn")}),(null==C?void 0:C.is_enable)&&(null==C?void 0:C.is_connected)&&(0,a.jsx)(Y.Xi,{value:"external",className:"px-6 py-4 cursor-pointer",children:e("knowledge.external")})]})}),(0,a.jsx)(Y.av,{value:"builtin",children:(0,a.jsxs)("div",{className:l().knowledgeListContainer,children:[(0,a.jsx)(s.A,{width:"100%",height:"10rem",plusSize:"90px",onClick:()=>{j(""),b("builtin"),k(!0)}}),r.map(e=>(0,a.jsx)("div",{onClick:()=>{j(e.id),b("builtin"),k(!0)},children:(0,a.jsx)(x,{kbCardVO:e})},e.id))]})}),(0,a.jsx)(Y.av,{value:"external",children:(0,a.jsxs)("div",{className:l().knowledgeListContainer,children:[(0,a.jsx)(s.A,{width:"100%",height:"10rem",plusSize:"90px",onClick:()=>{j(""),b("external"),k(!0)}}),m.map(e=>(0,a.jsx)("div",{onClick:()=>{j(e.id),b("external"),k(!0)},children:(0,a.jsx)(h,{kbCardVO:e})},e.id))]})})]})]})}},7366:(e,t,n)=>{"use strict";n.d(t,{Xi:()=>o,av:()=>d,j7:()=>i,tU:()=>l});var a=n(8629);n(5329);var s=n(4057),r=n(1573);function l(e){let{className:t,...n}=e;return(0,a.jsx)(s.bL,{"data-slot":"tabs",className:(0,r.cn)("flex flex-col gap-2",t),...n})}function i(e){let{className:t,...n}=e;return(0,a.jsx)(s.B8,{"data-slot":"tabs-list",className:(0,r.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...n})}function o(e){let{className:t,...n}=e;return(0,a.jsx)(s.l9,{"data-slot":"tabs-trigger",className:(0,r.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}function d(e){let{className:t,...n}=e;return(0,a.jsx)(s.UC,{"data-slot":"tabs-content",className:(0,r.cn)("flex-1 outline-none",t),...n})}},9247:e=>{e.exports={configPageContainer:"knowledgeBase_configPageContainer__RRvoG",knowledgeListContainer:"knowledgeBase_knowledgeListContainer__DmJ8H"}},9318:(e,t,n)=>{"use strict";n.d(t,{GG:()=>r,HL:()=>s,wY:()=>l});var a=n(5557);class s{constructor(e){this.id=e.id,this.name=e.name,this.default=e.default,this.label=e.label,this.required=e.required,this.type=e.type,this.description=e.description,this.options=e.options}}function r(e){return Object.values(a.P).includes(e)?e:a.P.UNKNOWN}function l(e){return e.reduce((e,t)=>(e[t.name]=t.default,e),{})}}},e=>{e.O(0,[86,346,615,611,785,698,50,204,158,56,48,570,472,882,422,247,358],()=>e(e.s=4879)),_N_E=e.O()}]);