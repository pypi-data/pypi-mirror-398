[project]
name = 'opvious'
description = 'Opvious Python SDK'
authors = [{name='Opvious Engineering', email='oss@opvious.io'}]
readme = 'README.md'
dynamic = ['dependencies', 'version']
requires-python = ">=3.12,<4"

[project.urls]
repository = 'https://github.com/opvious/sdk.py'

[build-system]
requires = ['poetry-core']
build-backend = 'poetry.core.masonry.api'

[tool.poetry]
version = "0.24.0"
packages = [{include = 'opvious', from = 'src'}]

[tool.poetry.dependencies]
aiohttp = {version = '^3.8', optional = true}
backoff = '^2.2'
brotli = {version = '^1.2.0', optional = true}
docopt-ng = {version = '^0.9', optional = true}
humanize = '^4.4.0'
importnb = '^2023.1.7'
lru-dict = {version = '^1.3.0', optional = true}
numpy = '>=2.3'
pandas = '>=2.2'

[tool.poetry.group.dev.dependencies]
flake8 = '^7.0.0'
jupyter = '^1.0.0'
mypy = '^1.19.1'
pandas-stubs = '^2.2.2.240514'
poethepoet = "^0.25.0"
pytest = '^7.1.2'
pytest-asyncio = '^0.20.2'
ruff = "^0.11.0"
sphinx = '^9.0.4'
sphinx-rtd-theme = '^3.0.2'
types-docopt = '^0.6.11.3'

[tool.poetry.extras]
aio = ['aiohttp', 'brotli', 'lru-dict']
cli = ['docopt-ng']

# Poe

[tool.poe.tasks.fix]
help = "format source code"
sequence = [
  {cmd="ruff format ${args}"},
  {cmd="ruff check --fix ${args}"},
]
args = [
  {name="args", help="target folders", positional=true, multiple=true, default="src tests"},
]

[tool.poe.tasks.lint]
help = "lint configuration and source code"
sequence = [
  {cmd="poetry check"},
  {cmd="ruff check ${args}"},
  {cmd="mypy ${args}"},
]
args = [
  {name="args", help="target folders", positional=true, multiple=true, default="src tests"},
]

[tool.poe.tasks.test]
help = "run tests with coverage"
sequence = [
  {cmd="coverage run"},
  {cmd="coverage report"},
]

# Other tools

[tool.coverage.run]
branch = true
command_line = "-m pytest"
relative_files = true

[tool.mypy]
disable_error_code = "import-untyped"
enable_error_code = "exhaustive-match"

[tool.pytest.ini_options]
log_level = 'DEBUG'
addopts = '-p no:importnb'

[tool.ruff]
line-length = 79

[tool.ruff.lint]
select = [
  "A",
  "ANN",
  "ARG",
  "D",
  "E",
  "ERA",
  "F",
  "I",
  "INP",
  "LOG",
  "N",
  "PL",
  "RUF",
  "SIM",
  "SLF",
  "T20",
  "TD",
  "UP",
  "W"
]
ignore = [
  "ANN003", "ANN401",
  "D100", "D102", "D103", "D104", "D105", "D107", "D415",
  "PLC0105", "PLR2004", "PLR0912", "PLR0913", "PLW2901",
  "RUF022",
  "TD002", "TD003",
]

[tool.ruff.lint.isort]
force-sort-within-sections = true
lines-after-imports = 2

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.ruff.lint.pylint]
max-returns = 20

[tool.ruff.lint.per-file-ignores]
"__main__.py" = ["T20"]
"tests/**" = ["ANN", "D", "RUF012", "SLF"]
