# 文档 (Documents) 模块

文档模块提供知识库文档的管理功能，包括通过文本或文件创建文档、更新、删除以及监控索引状态等。

## 方法列表

| 方法                    | 描述             |
| ----------------------- | ---------------- |
| `create_by_text()`      | 从文本创建文档   |
| `create_by_file()`      | 从文件创建文档   |
| `list()`                | 获取文档列表     |
| `get()`                 | 获取文档详情     |
| `update_by_text()`      | 用文本更新文档   |
| `update_by_file()`      | 用文件更新文档   |
| `delete()`              | 删除文档         |
| `get_indexing_status()` | 获取索引状态     |
| `batch_update_status()` | 批量更新文档状态 |
| `get_upload_file()`     | 获取上传文件信息 |

---

## create_by_text() - 从文本创建文档

通过文本内容创建新文档。

### 参数

| 参数                       | 类型           | 必填 | 默认值         | 描述                                                     |
| -------------------------- | -------------- | ---- | -------------- | -------------------------------------------------------- |
| `dataset_id`               | str            | 是   | -              | 数据集 ID                                                |
| `name`                     | str            | 是   | -              | 文档名称                                                 |
| `text`                     | str            | 是   | -              | 文档文本内容                                             |
| `indexing_technique`       | str            | 否   | `high_quality` | 索引技术：`high_quality` 或 `economy`                    |
| `doc_form`                 | str            | 否   | None           | 文档形式：`text_model`、`hierarchical_model`、`qa_model` |
| `doc_language`             | str            | 否   | None           | 文档语言（Q&A 模式使用）                                 |
| `process_rule`             | ProcessRule    | 否   | None           | 处理规则                                                 |
| `retrieval_model`          | RetrievalModel | 否   | None           | 检索模型配置                                             |
| `embedding_model`          | str            | 否   | None           | 嵌入模型名称                                             |
| `embedding_model_provider` | str            | 否   | None           | 嵌入模型提供商                                           |

### 返回值

`DocumentResponse` - 包含创建的文档信息和批次 ID

### 示例

```python
# 基础创建
response = client.documents.create_by_text(
    dataset_id="dataset-id",
    name="产品介绍",
    text="这是产品的详细介绍内容..."
)
print(f"文档 ID: {response.document.id}")
print(f"批次 ID: {response.batch}")

# 完整参数
from dify_dataset_sdk.documents.models import ProcessRule

response = client.documents.create_by_text(
    dataset_id="dataset-id",
    name="技术文档",
    text="# 技术文档\n\n详细内容...",
    indexing_technique="high_quality",
    doc_form="text_model",
    process_rule=ProcessRule(
        mode="automatic"
    )
)
```

---

## create_by_file() - 从文件创建文档

通过上传文件创建新文档。

### 参数

| 参数                       | 类型           | 必填 | 默认值         | 描述                    |
| -------------------------- | -------------- | ---- | -------------- | ----------------------- |
| `dataset_id`               | str            | 是   | -              | 数据集 ID               |
| `file_path`                | str \| Path    | 是   | -              | 文件路径                |
| `original_document_id`     | str            | 否   | None           | 原始文档 ID（用于更新） |
| `indexing_technique`       | str            | 否   | `high_quality` | 索引技术                |
| `doc_form`                 | str            | 否   | None           | 文档形式                |
| `doc_language`             | str            | 否   | None           | 文档语言                |
| `process_rule`             | ProcessRule    | 否   | None           | 处理规则                |
| `retrieval_model`          | RetrievalModel | 否   | None           | 检索模型配置            |
| `embedding_model`          | str            | 否   | None           | 嵌入模型名称            |
| `embedding_model_provider` | str            | 否   | None           | 嵌入模型提供商          |

### 返回值

`DocumentResponse` - 包含创建的文档信息和批次 ID

### 支持的文件格式

- 文本文件：`.txt`, `.md`, `.markdown`
- Office 文档：`.doc`, `.docx`, `.xls`, `.xlsx`, `.ppt`, `.pptx`
- PDF：`.pdf`
- 网页：`.html`, `.htm`
- 其他：`.csv`, `.json`, `.xml`

### 示例

```python
from pathlib import Path

# 使用字符串路径
response = client.documents.create_by_file(
    dataset_id="dataset-id",
    file_path="/path/to/document.pdf"
)

# 使用 Path 对象
response = client.documents.create_by_file(
    dataset_id="dataset-id",
    file_path=Path("./docs/manual.docx"),
    indexing_technique="high_quality"
)

print(f"文档 ID: {response.document.id}")
```

---

## list() - 获取文档列表

获取数据集中的文档列表。

### 参数

| 参数         | 类型 | 必填 | 默认值 | 描述                 |
| ------------ | ---- | ---- | ------ | -------------------- |
| `dataset_id` | str  | 是   | -      | 数据集 ID            |
| `keyword`    | str  | 否   | None   | 搜索关键词           |
| `page`       | int  | 否   | 1      | 页码                 |
| `limit`      | int  | 否   | 20     | 每页数量，范围 1-100 |

### 返回值

`PaginatedResponse` - 分页的文档列表

### 示例

```python
# 获取所有文档
result = client.documents.list(dataset_id="dataset-id")
for doc in result.data:
    print(f"{doc.name}: {doc.id}")

# 搜索文档
result = client.documents.list(
    dataset_id="dataset-id",
    keyword="产品",
    page=1,
    limit=50
)

print(f"总数: {result.total}")
```

---

## get() - 获取文档详情

获取文档的详细信息。

### 参数

| 参数          | 类型 | 必填 | 默认值 | 描述                                 |
| ------------- | ---- | ---- | ------ | ------------------------------------ |
| `dataset_id`  | str  | 是   | -      | 数据集 ID                            |
| `document_id` | str  | 是   | -      | 文档 ID                              |
| `metadata`    | str  | 否   | `all`  | 元数据筛选：`all`、`only`、`without` |

### 返回值

`Document` - 文档详情

### 示例

```python
doc = client.documents.get(
    dataset_id="dataset-id",
    document_id="doc-id"
)

print(f"名称: {doc.name}")
print(f"状态: {doc.indexing_status}")
print(f"字数: {doc.word_count}")
```

---

## update_by_text() - 用文本更新文档

使用新的文本内容更新文档。

### 参数

| 参数           | 类型        | 必填 | 描述       |
| -------------- | ----------- | ---- | ---------- |
| `dataset_id`   | str         | 是   | 数据集 ID  |
| `document_id`  | str         | 是   | 文档 ID    |
| `name`         | str         | 否   | 新文档名称 |
| `text`         | str         | 否   | 新文本内容 |
| `process_rule` | ProcessRule | 否   | 处理规则   |

### 返回值

`DocumentResponse` - 更新后的文档信息

### 示例

```python
response = client.documents.update_by_text(
    dataset_id="dataset-id",
    document_id="doc-id",
    name="更新后的标题",
    text="更新后的内容..."
)
print(f"更新成功: {response.document.id}")
```

---

## update_by_file() - 用文件更新文档

使用新文件更新文档内容。

### 参数

| 参数           | 类型        | 必填 | 描述       |
| -------------- | ----------- | ---- | ---------- |
| `dataset_id`   | str         | 是   | 数据集 ID  |
| `document_id`  | str         | 是   | 文档 ID    |
| `file_path`    | str \| Path | 是   | 新文件路径 |
| `name`         | str         | 否   | 新文档名称 |
| `process_rule` | ProcessRule | 否   | 处理规则   |

### 返回值

`DocumentResponse` - 更新后的文档信息

### 示例

```python
response = client.documents.update_by_file(
    dataset_id="dataset-id",
    document_id="doc-id",
    file_path="/path/to/new_version.pdf"
)
```

---

## delete() - 删除文档

删除指定文档。

### 参数

| 参数          | 类型 | 必填 | 描述      |
| ------------- | ---- | ---- | --------- |
| `dataset_id`  | str  | 是   | 数据集 ID |
| `document_id` | str  | 是   | 文档 ID   |

### 返回值

`Dict[str, Any]` - 成功响应

### 示例

```python
result = client.documents.delete(
    dataset_id="dataset-id",
    document_id="doc-id"
)
print("删除成功")
```

---

## get_indexing_status() - 获取索引状态

获取文档的索引进度。

### 参数

| 参数         | 类型 | 必填 | 描述                         |
| ------------ | ---- | ---- | ---------------------------- |
| `dataset_id` | str  | 是   | 数据集 ID                    |
| `batch`      | str  | 是   | 上传批次号（创建文档时返回） |

### 返回值

`IndexingStatusResponse` - 索引状态信息

### 示例

```python
# 创建文档后获取批次 ID
response = client.documents.create_by_text(
    dataset_id="dataset-id",
    name="文档",
    text="内容..."
)

# 轮询检查索引状态
import time
while True:
    status = client.documents.get_indexing_status(
        dataset_id="dataset-id",
        batch=response.batch
    )

    for doc_status in status.data:
        print(f"状态: {doc_status.indexing_status}")
        print(f"进度: {doc_status.processing_started_at}")

    if all(d.indexing_status == "completed" for d in status.data):
        print("索引完成")
        break

    time.sleep(2)
```

---

## batch_update_status() - 批量更新文档状态

批量更新多个文档的状态。

### 参数

| 参数           | 类型      | 必填 | 描述                                               |
| -------------- | --------- | ---- | -------------------------------------------------- |
| `dataset_id`   | str       | 是   | 数据集 ID                                          |
| `action`       | str       | 是   | 操作：`enable`、`disable`、`archive`、`un_archive` |
| `document_ids` | List[str] | 是   | 文档 ID 列表                                       |

### 返回值

`Dict[str, Any]` - 成功响应

### 示例

```python
# 禁用多个文档
result = client.documents.batch_update_status(
    dataset_id="dataset-id",
    action="disable",
    document_ids=["doc-id-1", "doc-id-2", "doc-id-3"]
)

# 归档文档
result = client.documents.batch_update_status(
    dataset_id="dataset-id",
    action="archive",
    document_ids=["doc-id-1"]
)
```

---

## get_upload_file() - 获取上传文件信息

获取文档关联的上传文件信息。

### 参数

| 参数          | 类型 | 必填 | 描述      |
| ------------- | ---- | ---- | --------- |
| `dataset_id`  | str  | 是   | 数据集 ID |
| `document_id` | str  | 是   | 文档 ID   |

### 返回值

`Dict[str, Any]` - 文件信息

### 示例

```python
file_info = client.documents.get_upload_file(
    dataset_id="dataset-id",
    document_id="doc-id"
)
print(f"文件名: {file_info.get('name')}")
print(f"大小: {file_info.get('size')}")
```

---

## 数据模型

### ProcessRule

处理规则配置。

```python
class ProcessRule:
    mode: str                    # 模式：automatic 或 custom
    rules: Optional[Rules]       # 自定义规则配置
```

### Rules

```python
class Rules:
    pre_processing_rules: List[PreProcessingRule]  # 预处理规则列表
    segmentation: Segmentation   # 分段配置
    parent_mode: Optional[str]   # 父模式
    subchunk_segmentation: Optional[Segmentation]  # 子块分段配置
```

### Document

```python
class Document:
    id: str                      # 文档 ID
    position: int                # 位置
    data_source_type: str        # 数据源类型
    data_source_info: Optional[dict]  # 数据源信息
    dataset_process_rule_id: str # 处理规则 ID
    name: str                    # 文档名称
    created_from: str            # 创建来源
    created_by: str              # 创建者
    created_at: int              # 创建时间戳
    tokens: int                  # Token 数量
    indexing_status: str         # 索引状态
    error: Optional[str]         # 错误信息
    enabled: bool                # 是否启用
    disabled_at: Optional[int]   # 禁用时间
    disabled_by: Optional[str]   # 禁用者
    archived: bool               # 是否归档
    display_status: str          # 显示状态
    word_count: int              # 字数
    hit_count: int               # 命中次数
    doc_form: str                # 文档形式
```
