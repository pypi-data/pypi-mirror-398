# 快速开始

## 安装

```bash
pip install dify-dataset-sdk
```

## 初始化客户端

```python
from dify_dataset_sdk import DifyDatasetClient

# 基础初始化
client = DifyDatasetClient(api_key="your-api-key")

# 自定义配置
client = DifyDatasetClient(
    api_key="your-api-key",
    base_url="https://api.dify.ai",  # 可选，默认为 Dify 官方 API
    timeout=30.0                      # 可选，请求超时时间（秒）
)
```

## 参数说明

| 参数       | 类型  | 必填 | 默认值                | 描述               |
| ---------- | ----- | ---- | --------------------- | ------------------ |
| `api_key`  | str   | 是   | -                     | Dify API 密钥      |
| `base_url` | str   | 否   | `https://api.dify.ai` | Dify API 基础 URL  |
| `timeout`  | float | 否   | `30.0`                | 请求超时时间（秒） |

## 使用上下文管理器

推荐使用上下文管理器来自动管理连接资源：

```python
from dify_dataset_sdk import DifyDatasetClient

with DifyDatasetClient(api_key="your-api-key") as client:
    # 使用客户端进行操作
    datasets = client.datasets.list()
    print(datasets)
# 退出 with 块时自动关闭连接
```

## 手动关闭连接

如果不使用上下文管理器，请在使用完毕后手动关闭连接：

```python
client = DifyDatasetClient(api_key="your-api-key")
try:
    datasets = client.datasets.list()
finally:
    client.close()
```

## 子模块概览

客户端提供以下子模块：

| 模块        | 描述                                       | 访问方式           |
| ----------- | ------------------------------------------ | ------------------ |
| `datasets`  | 数据集管理（CRUD、检索）                   | `client.datasets`  |
| `documents` | 文档管理（文本/文件上传、更新、删除）      | `client.documents` |
| `segments`  | 文档块管理（创建、更新、删除、查询、子块） | `client.segments`  |
| `tags`      | 知识库标签管理                             | `client.tags`      |
| `metadata`  | 元数据管理                                 | `client.metadata`  |
| `models`    | 嵌入模型列表                               | `client.models`    |

## 快速示例

```python
from dify_dataset_sdk import DifyDatasetClient

with DifyDatasetClient(api_key="your-api-key") as client:
    # 创建数据集
    dataset = client.datasets.create(name="我的知识库")

    # 创建文档
    doc = client.documents.create_by_text(
        dataset_id=dataset.id,
        name="示例文档",
        text="这是文档内容..."
    )

    # 获取文档块
    segments = client.segments.list(dataset.id, doc.document.id)

    # 创建标签
    tag = client.tags.create(name="重要")
    client.tags.bind_to_dataset(dataset.id, tag_ids=[tag.id])

    # 获取元数据字段
    fields = client.metadata.list(dataset.id)

    # 获取可用的嵌入模型
    models = client.models.list_embedding_models()
```

## 异常处理

SDK 定义了以下异常类型：

```python
from dify_dataset_sdk import (
    DifyDatasetClient,
    DifyAPIError,
    DifyValidationError,
    DifyAuthenticationError,
    DifyNotFoundError,
    DifyRateLimitError,
)

try:
    with DifyDatasetClient(api_key="your-api-key") as client:
        dataset = client.datasets.get("non-existent-id")
except DifyNotFoundError as e:
    print(f"资源未找到: {e}")
except DifyAuthenticationError as e:
    print(f"认证失败: {e}")
except DifyValidationError as e:
    print(f"参数验证失败: {e}")
except DifyRateLimitError as e:
    print(f"请求频率限制: {e}")
except DifyAPIError as e:
    print(f"API 错误: {e}")
```
