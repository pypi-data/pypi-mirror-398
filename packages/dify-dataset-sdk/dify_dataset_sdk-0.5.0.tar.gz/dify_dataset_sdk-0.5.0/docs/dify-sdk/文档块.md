# 文档块 (Segments) 模块

文档块模块提供文档分段（Segment）和子块（Child Chunk）的管理功能。

## 方法列表

### 文档块操作

| 方法       | 描述           |
| ---------- | -------------- |
| `create()` | 创建文档块     |
| `list()`   | 获取文档块列表 |
| `get()`    | 获取文档块详情 |
| `update()` | 更新文档块     |
| `delete()` | 删除文档块     |

### 子块操作

| 方法                   | 描述         |
| ---------------------- | ------------ |
| `create_child_chunk()` | 创建子块     |
| `list_child_chunks()`  | 获取子块列表 |
| `update_child_chunk()` | 更新子块     |
| `delete_child_chunk()` | 删除子块     |

---

## create() - 创建文档块

为文档创建新的分段。

### 参数

| 参数          | 类型       | 必填 | 描述         |
| ------------- | ---------- | ---- | ------------ |
| `dataset_id`  | str        | 是   | 数据集 ID    |
| `document_id` | str        | 是   | 文档 ID      |
| `segments`    | List[Dict] | 是   | 分段数据列表 |

### segments 结构

每个分段包含：

| 字段       | 类型      | 必填 | 描述                 |
| ---------- | --------- | ---- | -------------------- |
| `content`  | str       | 是   | 文本内容/问题内容    |
| `answer`   | str       | 否   | 答案内容（Q&A 模式） |
| `keywords` | List[str] | 否   | 关键词列表           |

### 返回值

`SegmentResponse` - 创建的分段信息

### 示例

```python
# 创建单个分段
response = client.segments.create(
    dataset_id="dataset-id",
    document_id="doc-id",
    segments=[{
        "content": "这是分段的内容",
        "keywords": ["关键词1", "关键词2"]
    }]
)

# 创建多个分段
response = client.segments.create(
    dataset_id="dataset-id",
    document_id="doc-id",
    segments=[
        {
            "content": "第一个分段的内容",
            "keywords": ["分段1"]
        },
        {
            "content": "第二个分段的内容",
            "keywords": ["分段2"]
        }
    ]
)

for segment in response.data:
    print(f"分段 ID: {segment.id}")
```

### Q&A 模式示例

```python
# 创建 Q&A 类型的分段
response = client.segments.create(
    dataset_id="dataset-id",
    document_id="doc-id",
    segments=[{
        "content": "如何重置密码？",
        "answer": "您可以通过以下步骤重置密码：1. 点击登录页面的忘记密码 2. 输入注册邮箱 3. 查收重置邮件",
        "keywords": ["密码", "重置", "忘记密码"]
    }]
)
```

---

## list() - 获取文档块列表

获取文档中的分段列表。

### 参数

| 参数          | 类型 | 必填 | 默认值 | 描述                     |
| ------------- | ---- | ---- | ------ | ------------------------ |
| `dataset_id`  | str  | 是   | -      | 数据集 ID                |
| `document_id` | str  | 是   | -      | 文档 ID                  |
| `keyword`     | str  | 否   | None   | 搜索关键词               |
| `status`      | str  | 否   | None   | 状态筛选，如 `completed` |
| `page`        | int  | 否   | 1      | 页码                     |
| `limit`       | int  | 否   | 20     | 每页数量，范围 1-100     |

### 返回值

`SegmentResponse` - 分段列表

### 示例

```python
# 获取所有分段
result = client.segments.list(
    dataset_id="dataset-id",
    document_id="doc-id"
)

for segment in result.data:
    print(f"ID: {segment.id}")
    print(f"内容: {segment.content[:50]}...")
    print(f"状态: {segment.status}")

# 带筛选条件
result = client.segments.list(
    dataset_id="dataset-id",
    document_id="doc-id",
    keyword="产品",
    status="completed",
    page=1,
    limit=50
)
```

---

## get() - 获取文档块详情

获取单个分段的详细信息。

### 参数

| 参数          | 类型 | 必填 | 描述      |
| ------------- | ---- | ---- | --------- |
| `dataset_id`  | str  | 是   | 数据集 ID |
| `document_id` | str  | 是   | 文档 ID   |
| `segment_id`  | str  | 是   | 分段 ID   |

### 返回值

`Dict[str, Any]` - 分段详情

### 示例

```python
segment = client.segments.get(
    dataset_id="dataset-id",
    document_id="doc-id",
    segment_id="segment-id"
)

print(f"内容: {segment['content']}")
print(f"关键词: {segment.get('keywords', [])}")
```

---

## update() - 更新文档块

更新分段内容和属性。

### 参数

| 参数           | 类型 | 必填 | 描述           |
| -------------- | ---- | ---- | -------------- |
| `dataset_id`   | str  | 是   | 数据集 ID      |
| `document_id`  | str  | 是   | 文档 ID        |
| `segment_id`   | str  | 是   | 分段 ID        |
| `segment_data` | Dict | 是   | 更新的分段数据 |

### segment_data 结构

| 字段                      | 类型      | 必填 | 描述                 |
| ------------------------- | --------- | ---- | -------------------- |
| `content`                 | str       | 是   | 文本内容/问题内容    |
| `answer`                  | str       | 否   | 答案内容（Q&A 模式） |
| `keywords`                | List[str] | 否   | 关键词列表           |
| `enabled`                 | bool      | 否   | 是否启用             |
| `regenerate_child_chunks` | bool      | 否   | 是否重新生成子块     |

### 返回值

`Dict[str, Any]` - 更新后的分段信息

### 示例

```python
result = client.segments.update(
    dataset_id="dataset-id",
    document_id="doc-id",
    segment_id="segment-id",
    segment_data={
        "content": "更新后的内容",
        "keywords": ["新关键词1", "新关键词2"],
        "enabled": True
    }
)

# 更新 Q&A 分段
result = client.segments.update(
    dataset_id="dataset-id",
    document_id="doc-id",
    segment_id="segment-id",
    segment_data={
        "content": "更新后的问题",
        "answer": "更新后的答案",
        "enabled": True
    }
)
```

---

## delete() - 删除文档块

删除指定分段。

### 参数

| 参数          | 类型 | 必填 | 描述      |
| ------------- | ---- | ---- | --------- |
| `dataset_id`  | str  | 是   | 数据集 ID |
| `document_id` | str  | 是   | 文档 ID   |
| `segment_id`  | str  | 是   | 分段 ID   |

### 返回值

`Dict[str, Any]` - 成功响应

### 示例

```python
result = client.segments.delete(
    dataset_id="dataset-id",
    document_id="doc-id",
    segment_id="segment-id"
)
print("删除成功")
```

---

## create_child_chunk() - 创建子块

为分段创建子块。

### 参数

| 参数          | 类型 | 必填 | 描述      |
| ------------- | ---- | ---- | --------- |
| `dataset_id`  | str  | 是   | 数据集 ID |
| `document_id` | str  | 是   | 文档 ID   |
| `segment_id`  | str  | 是   | 父分段 ID |
| `content`     | str  | 是   | 子块内容  |

### 返回值

`Dict[str, Any]` - 创建的子块信息

### 示例

```python
result = client.segments.create_child_chunk(
    dataset_id="dataset-id",
    document_id="doc-id",
    segment_id="segment-id",
    content="这是子块的内容"
)

print(f"子块 ID: {result.get('id')}")
```

---

## list_child_chunks() - 获取子块列表

获取分段下的子块列表。

### 参数

| 参数          | 类型 | 必填 | 默认值 | 描述               |
| ------------- | ---- | ---- | ------ | ------------------ |
| `dataset_id`  | str  | 是   | -      | 数据集 ID          |
| `document_id` | str  | 是   | -      | 文档 ID            |
| `segment_id`  | str  | 是   | -      | 父分段 ID          |
| `keyword`     | str  | 否   | None   | 搜索关键词         |
| `page`        | int  | 否   | 1      | 页码               |
| `limit`       | int  | 否   | 20     | 每页数量，最大 100 |

### 返回值

`ChildChunkResponse` - 子块列表

### 示例

```python
result = client.segments.list_child_chunks(
    dataset_id="dataset-id",
    document_id="doc-id",
    segment_id="segment-id"
)

for chunk in result.data:
    print(f"子块 ID: {chunk.id}")
    print(f"内容: {chunk.content}")
```

---

## update_child_chunk() - 更新子块

更新子块内容。

### 参数

| 参数             | 类型 | 必填 | 描述         |
| ---------------- | ---- | ---- | ------------ |
| `dataset_id`     | str  | 是   | 数据集 ID    |
| `document_id`    | str  | 是   | 文档 ID      |
| `segment_id`     | str  | 是   | 父分段 ID    |
| `child_chunk_id` | str  | 是   | 子块 ID      |
| `content`        | str  | 是   | 更新后的内容 |

### 返回值

`Dict[str, Any]` - 更新后的子块信息

### 示例

```python
result = client.segments.update_child_chunk(
    dataset_id="dataset-id",
    document_id="doc-id",
    segment_id="segment-id",
    child_chunk_id="child-chunk-id",
    content="更新后的子块内容"
)
```

---

## delete_child_chunk() - 删除子块

删除指定子块。

### 参数

| 参数             | 类型 | 必填 | 描述      |
| ---------------- | ---- | ---- | --------- |
| `dataset_id`     | str  | 是   | 数据集 ID |
| `document_id`    | str  | 是   | 文档 ID   |
| `segment_id`     | str  | 是   | 父分段 ID |
| `child_chunk_id` | str  | 是   | 子块 ID   |

### 返回值

`Dict[str, Any]` - 成功响应

### 示例

```python
result = client.segments.delete_child_chunk(
    dataset_id="dataset-id",
    document_id="doc-id",
    segment_id="segment-id",
    child_chunk_id="child-chunk-id"
)
print("子块删除成功")
```

---

## 数据模型

### Segment

```python
class Segment:
    id: str                      # 分段 ID
    position: int                # 位置
    document_id: str             # 文档 ID
    content: str                 # 内容
    answer: Optional[str]        # 答案（Q&A 模式）
    word_count: int              # 字数
    tokens: int                  # Token 数量
    keywords: List[str]          # 关键词列表
    index_node_id: str           # 索引节点 ID
    index_node_hash: str         # 索引节点哈希
    hit_count: int               # 命中次数
    enabled: bool                # 是否启用
    disabled_at: Optional[int]   # 禁用时间
    disabled_by: Optional[str]   # 禁用者
    status: str                  # 状态
    created_by: str              # 创建者
    created_at: int              # 创建时间戳
    indexing_at: Optional[int]   # 索引时间
    completed_at: Optional[int]  # 完成时间
    error: Optional[str]         # 错误信息
    stopped_at: Optional[int]    # 停止时间
    child_chunks: Optional[List] # 子块列表
```

### ChildChunk

```python
class ChildChunk:
    id: str                      # 子块 ID
    segment_id: str              # 父分段 ID
    content: str                 # 内容
    word_count: int              # 字数
    tokens: int                  # Token 数量
    index_node_id: str           # 索引节点 ID
    index_node_hash: str         # 索引节点哈希
    hit_count: int               # 命中次数
    created_by: str              # 创建者
    created_at: int              # 创建时间戳
    updated_by: Optional[str]    # 更新者
    updated_at: Optional[int]    # 更新时间戳
    indexing_at: Optional[int]   # 索引时间
    completed_at: Optional[int]  # 完成时间
    error: Optional[str]         # 错误信息
    status: str                  # 状态
    position: int                # 位置
```
