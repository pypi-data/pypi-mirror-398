# 数据集 (Datasets) 模块

数据集模块提供知识库的增删改查操作以及知识检索功能。

## 方法列表

| 方法         | 描述           |
| ------------ | -------------- |
| `create()`   | 创建空数据集   |
| `list()`     | 获取数据集列表 |
| `get()`      | 获取数据集详情 |
| `update()`   | 更新数据集     |
| `delete()`   | 删除数据集     |
| `retrieve()` | 知识库检索     |

---

## create() - 创建数据集

创建一个空的知识库。

### 参数

| 参数                        | 类型           | 必填 | 默认值    | 描述                                                   |
| --------------------------- | -------------- | ---- | --------- | ------------------------------------------------------ |
| `name`                      | str            | 是   | -         | 数据集名称                                             |
| `description`               | str            | 否   | None      | 数据集描述                                             |
| `indexing_technique`        | str            | 否   | None      | 索引模式：`high_quality` 或 `economy`                  |
| `permission`                | str            | 否   | `only_me` | 权限：`only_me`、`all_team_members`、`partial_members` |
| `provider`                  | str            | 否   | `vendor`  | 提供商：`vendor` 或 `external`                         |
| `external_knowledge_api_id` | str            | 否   | None      | 外部知识 API ID                                        |
| `external_knowledge_id`     | str            | 否   | None      | 外部知识 ID                                            |
| `embedding_model`           | str            | 否   | None      | 嵌入模型名称                                           |
| `embedding_model_provider`  | str            | 否   | None      | 嵌入模型提供商                                         |
| `retrieval_model`           | RetrievalModel | 否   | None      | 检索模型配置                                           |
| `partial_member_list`       | List[str]      | 否   | None      | 部分成员列表                                           |

### 返回值

`Dataset` - 创建的数据集信息

### 示例

```python
# 基础创建
dataset = client.datasets.create(name="产品文档")

# 完整参数创建
dataset = client.datasets.create(
    name="技术文档库",
    description="存储所有技术相关文档",
    indexing_technique="high_quality",
    permission="all_team_members",
    embedding_model="text-embedding-ada-002",
    embedding_model_provider="openai"
)

print(f"创建成功: {dataset.id}")
```

---

## list() - 获取数据集列表

获取分页的数据集列表。

### 参数

| 参数          | 类型      | 必填 | 默认值 | 描述                               |
| ------------- | --------- | ---- | ------ | ---------------------------------- |
| `keyword`     | str       | 否   | None   | 搜索关键词                         |
| `tag_ids`     | List[str] | 否   | None   | 标签 ID 列表筛选                   |
| `page`        | int       | 否   | 1      | 页码，从 1 开始                    |
| `limit`       | int       | 否   | 20     | 每页数量，最大 100                 |
| `include_all` | bool      | 否   | False  | 是否包含所有数据集（仅所有者可用） |

### 返回值

`PaginatedResponse` - 包含数据集列表的分页响应

### 示例

```python
# 获取第一页
result = client.datasets.list()
for dataset in result.data:
    print(f"{dataset.name}: {dataset.id}")

# 带搜索条件
result = client.datasets.list(
    keyword="技术",
    page=1,
    limit=10
)

# 按标签筛选
result = client.datasets.list(
    tag_ids=["tag-id-1", "tag-id-2"]
)

print(f"总数: {result.total}")
```

---

## get() - 获取数据集详情

根据 ID 获取数据集详细信息。

### 参数

| 参数         | 类型 | 必填 | 描述      |
| ------------ | ---- | ---- | --------- |
| `dataset_id` | str  | 是   | 数据集 ID |

### 返回值

`Dataset` - 数据集详情

### 示例

```python
dataset = client.datasets.get("dataset-id")
print(f"名称: {dataset.name}")
print(f"描述: {dataset.description}")
print(f"文档数量: {dataset.document_count}")
```

---

## update() - 更新数据集

更新数据集的属性。

### 参数

| 参数                       | 类型           | 必填 | 描述           |
| -------------------------- | -------------- | ---- | -------------- |
| `dataset_id`               | str            | 是   | 数据集 ID      |
| `name`                     | str            | 否   | 新名称         |
| `description`              | str            | 否   | 新描述         |
| `indexing_technique`       | str            | 否   | 索引模式       |
| `permission`               | str            | 否   | 权限级别       |
| `embedding_model_provider` | str            | 否   | 嵌入模型提供商 |
| `embedding_model`          | str            | 否   | 嵌入模型       |
| `retrieval_model`          | RetrievalModel | 否   | 检索参数       |
| `partial_member_list`      | List[str]      | 否   | 部分成员列表   |

### 返回值

`Dataset` - 更新后的数据集信息

### 示例

```python
dataset = client.datasets.update(
    dataset_id="dataset-id",
    name="更新后的名称",
    description="更新后的描述"
)
print(f"更新成功: {dataset.name}")
```

---

## delete() - 删除数据集

删除指定的数据集。

### 参数

| 参数         | 类型 | 必填 | 描述      |
| ------------ | ---- | ---- | --------- |
| `dataset_id` | str  | 是   | 数据集 ID |

### 返回值

`Dict[str, Any]` - 成功响应

### 示例

```python
result = client.datasets.delete("dataset-id")
print("删除成功")
```

---

## retrieve() - 知识库检索

从知识库中检索相关内容。

### 参数

| 参数                       | 类型           | 必填 | 默认值 | 描述             |
| -------------------------- | -------------- | ---- | ------ | ---------------- |
| `dataset_id`               | str            | 是   | -      | 数据集 ID        |
| `query`                    | str            | 是   | -      | 检索查询         |
| `retrieval_model`          | RetrievalModel | 否   | None   | 检索参数配置     |
| `external_retrieval_model` | Dict           | 否   | None   | 外部检索模型配置 |

### 返回值

`RetrievalResponse` - 检索结果

### 示例

```python
# 基础检索
result = client.datasets.retrieve(
    dataset_id="dataset-id",
    query="如何配置系统？"
)

for record in result.records:
    print(f"内容: {record.content}")
    print(f"相关度: {record.score}")

# 使用检索参数
from dify_dataset_sdk.datasets.models import RetrievalModel

result = client.datasets.retrieve(
    dataset_id="dataset-id",
    query="产品功能介绍",
    retrieval_model=RetrievalModel(
        search_method="semantic_search",
        top_k=5,
        score_threshold_enabled=True,
        score_threshold=0.5
    )
)
```

---

## 数据模型

### Dataset

```python
class Dataset:
    id: str                      # 数据集 ID
    name: str                    # 名称
    description: Optional[str]   # 描述
    provider: str                # 提供商
    permission: str              # 权限
    data_source_type: str        # 数据源类型
    indexing_technique: str      # 索引技术
    app_count: int               # 应用数量
    document_count: int          # 文档数量
    word_count: int              # 字数
    created_by: str              # 创建者
    created_at: int              # 创建时间戳
    updated_by: str              # 更新者
    updated_at: int              # 更新时间戳
    embedding_model: Optional[str]           # 嵌入模型
    embedding_model_provider: Optional[str]  # 嵌入模型提供商
    embedding_available: Optional[bool]      # 嵌入是否可用
```

### RetrievalModel

```python
class RetrievalModel:
    search_method: str           # 搜索方法：semantic_search, full_text_search, hybrid_search
    reranking_enable: bool       # 是否启用重排序
    reranking_mode: Optional[str]           # 重排序模式
    reranking_model: Optional[RerankingModel]  # 重排序模型配置
    weights: Optional[Weights]              # 权重配置
    top_k: int                   # 返回结果数量
    score_threshold_enabled: bool  # 是否启用分数阈值
    score_threshold: Optional[float]  # 分数阈值
```
