"use strict";(self.webpackChunkjupyterlab_highlight_selected_word=self.webpackChunkjupyterlab_highlight_selected_word||[]).push([[53],{53(e,t,o){o.r(t),o.d(t,{default:()=>_});var i=o(223),l=o(389),n=o(460),s=o(195),d=o(24);const r=s.StateEffect.define(),h=d.Decoration.mark({class:"jp-HighlightSelected"}),a=s.StateField.define({create:()=>d.Decoration.none,update(e,t){e=e.map(t.changes);for(const o of t.effects)o.is(r)&&(e=c(t.state.doc.toString(),o.value));return e},provide:e=>d.EditorView.decorations.from(e)});function c(e,t){if(!t)return d.Decoration.none;const o=new s.RangeSetBuilder;let i;const l=new RegExp(t.source,t.flags.includes("g")?t.flags:t.flags+"g");for(;null!==(i=l.exec(e));){const e=i.index,t=i.index+i[0].length;o.add(e,t,h)}return o.finish()}const g=new s.Compartment;function u(e,t,o,i,l){const n={backgroundColor:l?"transparent":e,outline:`${i}px solid ${t}`},s={backgroundColor:l?"transparent":o,outline:`${i}px solid ${o}`};return d.EditorView.baseTheme({".jp-HighlightSelected":s,".cm-editor.cm-focused .jp-HighlightSelected":n})}const p={highlightColor:"#d7d4f0",outlineColor:"#ababab",highlightColorBlurred:"#e6e4f5",outlineWidth:1,outlineOnly:!1,codeCellsOnly:!1,minChars:2,wholeWords:!0,delay:100,enableOnLoad:!0,highlightWordUnderCursor:!1};class m{constructor(e,t){this._updateTimeout=null,this._panel=e,this._settings=t,this._panel.content.activeCellChanged.connect(this._onActiveCellChanged,this),this._panel.content.activeCell&&this._monitorCell(this._panel.content.activeCell)}dispose(){this._updateTimeout&&clearTimeout(this._updateTimeout)}updateSettings(e){const t=this._settings;this._settings=e,t.highlightColor===e.highlightColor&&t.outlineColor===e.outlineColor||this._broadcastTheme(),this._panel.content.activeCell&&this._scheduleUpdate()}_onActiveCellChanged(){const e=this._panel.content.activeCell;e?this._monitorCell(e):this._broadcast(null)}_monitorCell(e){var t;e.editor&&(null===(t=e.editor)||void 0===t||t.model.selections.changed.connect(this._onSelectionChanged,this))}_onSelectionChanged(){this._scheduleUpdate()}_scheduleUpdate(){this._settings.enableOnLoad&&(this._updateTimeout&&clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout(()=>this._updateQuery(),this._settings.delay))}_updateQuery(){var e;const t=this._panel.content.activeCell;if(!t||!t.editor)return;const o=null===(e=t.editor)||void 0===e?void 0:e.editor;if(!o)return;const i=o.state,l=i.selection.main;let n="";if(l.empty){if(!this._settings.highlightWordUnderCursor)return void this._broadcast(null);{const e=i.wordAt(l.head);e&&(n=i.sliceDoc(e.from,e.to))}}else if(l.from<l.to){const e=i.doc;e.lineAt(l.from).number===e.lineAt(l.to).number&&(n=i.sliceDoc(l.from,l.to))}if(!n||n.length<this._settings.minChars)return void this._broadcast(null);if(!n.trim())return void this._broadcast(null);const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let d=s;this._settings.wholeWords&&/^\w+$/.test(n)&&(d=`\\b${s}\\b`);const r=new RegExp(d,"g");this._broadcast(r)}_broadcast(e){this._panel.content.widgets.forEach(t=>{var o,i;if(this._settings.codeCellsOnly&&t.model.type,this._settings.codeCellsOnly&&"code"!==t.model.type){const e=null===(i=t.editor)||void 0===i?void 0:i.editor;e&&e.dispatch({effects:r.of(null)})}else{const i=null===(o=t.editor)||void 0===o?void 0:o.editor;i&&i.dispatch({effects:r.of(e)})}})}_broadcastTheme(){const e=this._panel.content.widgets,t=u(this._settings.highlightColor,this._settings.outlineColor,this._settings.highlightColorBlurred,this._settings.outlineWidth,this._settings.outlineOnly);e.forEach(e=>{var o;const i=null===(o=e.editor)||void 0===o?void 0:o.editor;i&&i.dispatch({effects:g.reconfigure(t)})})}}const C={id:"jupyterlab-highlight-selected-word:plugin",description:"Highlight selected word in JupyterLab",autoStart:!0,requires:[l.INotebookTracker,n.IEditorExtensionRegistry],optional:[i.ISettingRegistry],activate:(e,t,o,i)=>{console.log("JupyterLab extension jupyterlab-highlight-selected-word is activated!"),e.commands.addCommand("jupyterlab-highlight-selected-word:toggle",{label:"Toggle Highlight Selected Word",execute:()=>{i&&i.load(C.id).then(e=>{const t=e.get("enableOnLoad").composite;e.set("enableOnLoad",!t)})}}),o.addExtension({name:"jupyterlab-highlight-selected-word:editor",factory:()=>n.EditorExtensionRegistry.createImmutableExtension([a,g.of(u("#d7d4f0","#ababab","#e6e4f5",1,!1))])});let l={...p};const s=new WeakMap,d=e=>{if(s.has(e))return;const t=new m(e,l);s.set(e,t),e.disposed.connect(()=>{t.dispose(),s.delete(e)})},r=e=>{var o,i,n,d,r;l={highlightColor:e.get("highlightColor").composite||p.highlightColor,outlineColor:e.get("outlineColor").composite||p.outlineColor,highlightColorBlurred:e.get("highlightColorBlurred").composite||p.highlightColorBlurred,outlineWidth:e.get("outlineWidth").composite||p.outlineWidth,outlineOnly:null!==(o=e.get("outlineOnly").composite)&&void 0!==o?o:p.outlineOnly,codeCellsOnly:null!==(i=e.get("codeCellsOnly").composite)&&void 0!==i?i:p.codeCellsOnly,minChars:e.get("minChars").composite||p.minChars,wholeWords:null!==(n=e.get("wholeWords").composite)&&void 0!==n?n:p.wholeWords,delay:e.get("delay").composite||p.delay,enableOnLoad:null!==(d=e.get("enableOnLoad").composite)&&void 0!==d?d:p.enableOnLoad,highlightWordUnderCursor:null!==(r=e.get("highlightWordUnderCursor").composite)&&void 0!==r?r:p.highlightWordUnderCursor},console.log("[Highlight] Settings loaded:",l),t.forEach(e=>{const t=s.get(e);t&&t.updateSettings(l)})};t.widgetAdded.connect((e,t)=>{d(t)}),t.forEach(e=>{d(e)}),i&&i.load(C.id).then(e=>{console.log("jupyterlab-highlight-selected-word settings loaded:",e.composite),r(e),e.changed.connect(r)}).catch(e=>{console.error("Failed to load settings for jupyterlab-highlight-selected-word.",e)})}},_=C}}]);