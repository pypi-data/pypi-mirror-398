<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="/docs/assets/css/style.css?v=">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Python API</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Python API" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="/docs/Python-API.html" />
<meta property="og:url" content="/docs/Python-API.html" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Python API" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"Python API","url":"/docs/Python-API.html"}</script>
<!-- End Jekyll SEO tag -->

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/docs/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">

          <h1 id="project_title"></h1>
          <h2 id="project_tagline"></h2>

            <section id="menu">
              <a class="try_online_link" href="/">Try online</a>
              <a class="release_link" href="https://pypi.org/project/nyancad-server/">Download</a>
              <a class="documentation_link" href="/docs/Documentation.html">Documentation</a>
              <a class="forkme_link" href="https://github.com/NyanCAD/Mosaic">Source code</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><a id="pyttoresque"></a></p>

<h1 id="pyttoresque">pyttoresque</h1>

<p><a id="pyttoresque.simserver"></a></p>

<h1 id="pyttoresquesimserver">pyttoresque.simserver</h1>

<p>This module handles communication with a simulation server.
The underlying protocol is described in https://github.com/NyanCAD/SimServer/blob/main/Simulator.capnp</p>

<p>Basic usage of this module:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>con = await connect("localhost", simulator=Xyce)
fs = loadFiles(con, "test.cir")
res = fs.commands.run(["V(*)", "I(*)"])
print(await readAll(res))
</code></pre></div></div>

<p>For streaming plots, have a look at <code class="language-plaintext highlighter-rouge">holoviews.streams.Buffer</code> and https://holoviews.org/user_guide/Streaming_Data.html.</p>

<p><a id="pyttoresque.simserver.connect"></a></p>

<h4 id="connect">connect</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5923</span><span class="p">,</span> <span class="n">simulator</span><span class="o">=</span><span class="n">Ngspice</span><span class="p">,</span> <span class="n">autostart</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>Connect to a simulation server at the given <code class="language-plaintext highlighter-rouge">host:port</code>,
which should be a <code class="language-plaintext highlighter-rouge">simulator</code> such as <code class="language-plaintext highlighter-rouge">Ngspice</code> or <code class="language-plaintext highlighter-rouge">Xyce</code>.</p>

<p>If <code class="language-plaintext highlighter-rouge">host</code> is set to “localhost” and no server is running,
we will attempt to start one automatically,
unless <code class="language-plaintext highlighter-rouge">autostart=False</code>.</p>

<p><a id="pyttoresque.simserver.loadFiles"></a></p>

<h4 id="loadfiles">loadFiles</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">loadFiles</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="o">*</span><span class="n">names</span><span class="p">)</span>
</code></pre></div></div>

<p>Load the specified filenames into the simulation server.
The first file is the entrypoint for the simulator.
Returns a handle to run simulation commands on.</p>

<p>For in-memory data, directly call <code class="language-plaintext highlighter-rouge">sim.loadFiles</code>.
The data should be of the form <code class="language-plaintext highlighter-rouge">[{"name": name, "contents": contents}]</code></p>

<p>For files already present on the simulator use <code class="language-plaintext highlighter-rouge">sim.loadPath</code>.</p>

<p><a id="pyttoresque.simserver.read"></a></p>

<h4 id="read">read</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">io</span><span class="o">=</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div></div>

<p>Read one chunk from a simulation command</p>

<p><a id="pyttoresque.simserver.stream"></a></p>

<h4 id="stream">stream</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="n">response</span><span class="p">,</span>
                 <span class="n">streamdict</span><span class="p">,</span>
                 <span class="n">newkey</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">io</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span>
                 <span class="n">suffix</span><span class="o">=</span><span class="sh">""</span><span class="p">)</span>
</code></pre></div></div>

<p>Stream simulation data into a Buffer (DataFrame)</p>

<p><code class="language-plaintext highlighter-rouge">streamdict</code> is a dictionary, where Buffers are added as needed.
This is done because some simulation commands have multiple results.</p>

<p>The <code class="language-plaintext highlighter-rouge">newkey</code> function is called when a new Buffer is added.</p>

<p>Additionally, a custom “file-like” object can be passed for logging,
and a suffix can be passed that is appended to the dictionary key.</p>

<p><a id="pyttoresque.simserver.readAll"></a></p>

<h4 id="readall">readAll</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">readAll</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">io</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="sh">""</span><span class="p">)</span>
</code></pre></div></div>

<p>Read all the simulation data from a simulation command.</p>

<p><a id="pyttoresque.netlist"></a></p>

<h1 id="pyttoresquenetlist">pyttoresque.netlist</h1>

<p>This module communicates with CouchDB to fetch schematics, and generate SPICE netlists out of them.</p>

<p>Basic usage:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>async with SchematicService("http://localhost:5984/offline") as service:
    name = "top$top"
    seq, docs = await service.get_all_schem_docs(name)
    print(spice_netlist(name, docs))
</code></pre></div></div>

<p>The sequence number can later be used to efficiently update the netlist with <code class="language-plaintext highlighter-rouge">update_schem</code>.
For live updates, use <code class="language-plaintext highlighter-rouge">live_schem_docs</code>.</p>

<p><a id="pyttoresque.netlist.StatusError"></a></p>

<h2 id="statuserror-objects">StatusError Objects</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StatusError</span><span class="p">(</span><span class="n">ClientError</span><span class="p">)</span>
</code></pre></div></div>

<p>Non-200 response</p>

<p><a id="pyttoresque.netlist.SchematicService"></a></p>

<h2 id="schematicservice-objects">SchematicService Objects</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SchematicService</span><span class="p">(</span><span class="n">AbstractAsyncContextManager</span><span class="p">)</span>
</code></pre></div></div>

<p>A context manager for getting schematics from a CouchDB database</p>

<p><a id="pyttoresque.netlist.SchematicService.__init__"></a></p>

<h4 id="__init__">__init__</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></div>

<p>Create a HTTP session with the given database URL</p>

<p><a id="pyttoresque.netlist.SchematicService.dbget"></a></p>

<h4 id="dbget">dbget</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">dbget</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></div>

<p>Do a GET request to the given database endpoint and query parameters</p>

<p><a id="pyttoresque.netlist.SchematicService.dbpost"></a></p>

<h4 id="dbpost">dbpost</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">dbpost</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></div>

<p>Do a POST request to the given database endpoint, JSON data, and query parameters</p>

<p><a id="pyttoresque.netlist.SchematicService.dbput"></a></p>

<h4 id="dbput">dbput</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">dbput</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></div>

<p>Do a PUT request to the given database endpoint, data, and query parameters</p>

<p><a id="pyttoresque.netlist.SchematicService.dbstream"></a></p>

<h4 id="dbstream">dbstream</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">dbstream</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></div>

<p>Stream data from the given database endpoint, JSON data, and query parameters</p>

<p><a id="pyttoresque.netlist.SchematicService.get_docs"></a></p>

<h4 id="get_docs">get_docs</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_docs</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<p>Get all the documents with the specified schematic ID</p>

<p><a id="pyttoresque.netlist.SchematicService.get_all_schem_docs"></a></p>

<h4 id="get_all_schem_docs">get_all_schem_docs</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_all_schem_docs</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<p>Recursively get all the documents of the specified schematic and all the subcircuits inside it.
And all the model definitions.
Returns a sequence number and a dictionary of schematic ID: documents.</p>

<p><a id="pyttoresque.netlist.SchematicService.update_schem"></a></p>

<h4 id="update_schem">update_schem</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">update_schem</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">schem</span><span class="p">)</span>
</code></pre></div></div>

<p>Take a sequence number and dictionary as returned by <code class="language-plaintext highlighter-rouge">get_all_schem_docs</code> and update it.</p>

<p><a id="pyttoresque.netlist.SchematicService.live_schem_docs"></a></p>

<h4 id="live_schem_docs">live_schem_docs</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">live_schem_docs</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<p>A live stream of updated dictionaries, as returned by <code class="language-plaintext highlighter-rouge">get_all_schem_docs</code></p>

<p><a id="pyttoresque.netlist.SchematicService.save_simulation"></a></p>

<h4 id="save_simulation">save_simulation</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">save_simulation</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</code></pre></div></div>

<p>takes a schematic name and data as populated by
<code class="language-plaintext highlighter-rouge">pyttoresque.simserver.stream</code> and saves it to the database.
Additional keys can be added as the designer sees fit.</p>

<p><a id="pyttoresque.netlist.netlist"></a></p>

<h4 id="netlist">netlist</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">netlist</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">models</span><span class="p">)</span>
</code></pre></div></div>

<p>Turn a collection of documents as returned by <code class="language-plaintext highlighter-rouge">get_docs</code> into a netlist structure.
Returns a dictionary of device ID: {port: net}
Usage:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>async with SchematicService("http://localhost:5984/offline") as service:
    name = "top$top"
    seq, docs = await service.get_all_schem_docs(name)
    print(netlist(docs[name], models))
</code></pre></div></div>

<p><a id="pyttoresque.netlist.spice_netlist"></a></p>

<h4 id="spice_netlist">spice_netlist</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">spice_netlist</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>
                  <span class="n">schem</span><span class="p">,</span>
                  <span class="n">extra</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span>
                  <span class="n">corner</span><span class="o">=</span><span class="sh">'</span><span class="s">tt</span><span class="sh">'</span><span class="p">,</span>
                  <span class="n">temp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">sim</span><span class="o">=</span><span class="sh">"</span><span class="s">NgSpice</span><span class="sh">"</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></div>

<p>Generate a spice netlist, taking a dictionary of schematic documents, and the name of the top level schematic.
It is possible to pass extra SPICE code and specify the simulation corner.</p>

<p><a id="pyttoresque.netlist.ngspice_vectors"></a></p>

<h4 id="ngspice_vectors">ngspice_vectors</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ngspice_vectors</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schem</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">())</span>
</code></pre></div></div>

<p>Extract all the relevant vectors from the schematic,
and format them in NgSpice syntax.
Saves label/port net names, and vectors indicated on spice models.</p>

<p><a id="pyttoresque.app.main"></a></p>

<h1 id="pyttoresqueappmain">pyttoresque.app.main</h1>

<p><a id="pyttoresque.app"></a></p>

<h1 id="pyttoresqueapp">pyttoresque.app</h1>

<p><a id="pyttoresque.api"></a></p>

<h1 id="pyttoresqueapi">pyttoresque.api</h1>

<p><a id="pyttoresque.api.examples.blink_multisim"></a></p>

<h1 id="pyttoresqueapiexamplesblink_multisim">pyttoresque.api.examples.blink_multisim</h1>

<p><a id="pyttoresque.analysis"></a></p>

<h1 id="pyttoresqueanalysis">pyttoresque.analysis</h1>


      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
  </body>
</html>
