<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="/docs/assets/css/style.css?v=">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>MCP Server</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="MCP Server" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="/docs/MCP-Server.html" />
<meta property="og:url" content="/docs/MCP-Server.html" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="MCP Server" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"MCP Server","url":"/docs/MCP-Server.html"}</script>
<!-- End Jekyll SEO tag -->

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/docs/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">

          <h1 id="project_title"></h1>
          <h2 id="project_tagline"></h2>

            <section id="menu">
              <a class="try_online_link" href="/">Try online</a>
              <a class="release_link" href="https://pypi.org/project/nyancad-server/">Download</a>
              <a class="documentation_link" href="/docs/Documentation.html">Documentation</a>
              <a class="forkme_link" href="https://github.com/NyanCAD/Mosaic">Source code</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1 id="mcp-server">MCP Server</h1>

<p>NyanCAD provides a <a href="https://modelcontextprotocol.io/">Model Context Protocol (MCP)</a> server that allows LLM clients to interact with your schematics, component library, and simulations. This enables AI assistants to help you design circuits, analyze simulation results, and manage your component library.</p>

<h2 id="connecting-to-the-mcp-server">Connecting to the MCP Server</h2>

<h3 id="nyancad-cloud">NyanCAD Cloud</h3>

<p>For the hosted NyanCAD service, use the following MCP server URL:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://nyancad.com/ai/mcp
</code></pre></div></div>

<h3 id="self-hosted-deployments">Self-Hosted Deployments</h3>

<p>For your own nyancad-server deployment, the MCP server is available at:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://your-server-url/ai/mcp
</code></pre></div></div>

<p>Replace <code class="language-plaintext highlighter-rouge">your-server-url</code> with your deployment’s base URL.</p>

<h2 id="adding-to-llm-clients">Adding to LLM Clients</h2>

<h3 id="claude-desktop">Claude Desktop</h3>

<p>Add the following to your Claude Desktop configuration file (<code class="language-plaintext highlighter-rouge">claude_desktop_config.json</code>):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"mcpServers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"nyancad"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://nyancad.com/ai/mcp"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The configuration file location depends on your operating system:</p>

<ul>
  <li><strong>macOS</strong>: <code class="language-plaintext highlighter-rouge">~/Library/Application Support/Claude/claude_desktop_config.json</code></li>
  <li><strong>Windows</strong>: <code class="language-plaintext highlighter-rouge">%APPDATA%\Claude\claude_desktop_config.json</code></li>
  <li><strong>Linux</strong>: <code class="language-plaintext highlighter-rouge">~/.config/Claude/claude_desktop_config.json</code></li>
</ul>

<h3 id="claude-code">Claude Code</h3>

<p>Add the MCP server using the Claude Code CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>claude mcp add nyancad <span class="nt">--transport</span> http https://nyancad.com/ai/mcp
</code></pre></div></div>

<h3 id="other-mcp-clients">Other MCP Clients</h3>

<p>Any MCP-compatible client can connect using the HTTP transport with the server URL. The server uses OAuth authentication - you will be prompted to log in with your NyanCAD account when first connecting.</p>

<h2 id="authentication">Authentication</h2>

<p>The MCP server uses OAuth 2.0 authentication. When you connect from an LLM client:</p>

<ol>
  <li>The client will open a browser window to authenticate</li>
  <li>Log in with your NyanCAD account credentials</li>
  <li>Authorize the MCP client to access your account</li>
  <li>The client will receive a token to make authenticated requests</li>
</ol>

<p>Your schematics and component library are private to your account. The MCP server accesses your personal database using the authenticated session.</p>

<h2 id="available-tools">Available Tools</h2>

<p>The MCP server exposes the following tools:</p>

<h3 id="get_schematic">get_schematic</h3>

<p>Get a schematic with computed port locations and SPICE netlist.</p>

<p><strong>Parameters:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">id</code> (optional): Schematic ID in UUID format</li>
  <li><code class="language-plaintext highlighter-rouge">name</code> (optional): Schematic name to search for</li>
</ul>

<p>Provide either <code class="language-plaintext highlighter-rouge">id</code> or <code class="language-plaintext highlighter-rouge">name</code>. If <code class="language-plaintext highlighter-rouge">name</code> is provided, the tool searches your library and uses the first matching schematic.</p>

<p><strong>Returns:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">schematic</code>: Dictionary of devices (Wires and Components) with computed port locations</li>
  <li><code class="language-plaintext highlighter-rouge">spice</code>: Generated SPICE netlist including all subcircuits and models</li>
</ul>

<h3 id="list_library">list_library</h3>

<p>List available component models with optional filtering.</p>

<p><strong>Parameters:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">filter</code> (optional): Filter by model name (substring match)</li>
  <li><code class="language-plaintext highlighter-rouge">category</code> (optional): Filter by category path (e.g., <code class="language-plaintext highlighter-rouge">["passives", "resistors"]</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">include_templates</code> (optional): Include full template code in results (default: false)</li>
</ul>

<p><strong>Returns:</strong> Dictionary mapping model IDs to ModelMetadata objects. Use the dictionary keys (e.g., <code class="language-plaintext highlighter-rouge">models:1ef9c9d7-...</code>) as identifiers in other tools.</p>

<h3 id="bulk_update_schematic">bulk_update_schematic</h3>

<p>Bulk update schematic documents (create, update, or delete devices).</p>

<p><strong>Parameters:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">schematic_id</code>: The schematic ID to update</li>
  <li><code class="language-plaintext highlighter-rouge">docs</code>: List of Wire or Component documents</li>
</ul>

<p><strong>Document requirements:</strong></p>

<ul>
  <li><strong>New documents</strong>: Omit the <code class="language-plaintext highlighter-rouge">_rev</code> field</li>
  <li><strong>Updates</strong>: Include the current <code class="language-plaintext highlighter-rouge">_rev</code> from the database</li>
  <li><strong>Deletions</strong>: Include <code class="language-plaintext highlighter-rouge">_id</code>, <code class="language-plaintext highlighter-rouge">_rev</code>, and <code class="language-plaintext highlighter-rouge">_deleted: true</code></li>
</ul>

<p><strong>Conflict resolution:</strong> If you receive a conflict error, fetch the latest document with <code class="language-plaintext highlighter-rouge">get_schematic()</code> to get the current <code class="language-plaintext highlighter-rouge">_rev</code>, then retry.</p>

<h3 id="update_model">update_model</h3>

<p>Update a single model in the library (create, update, or delete).</p>

<p><strong>Parameters:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">model</code>: ModelMetadata document with required fields</li>
</ul>

<p><strong>Operations:</strong></p>

<ul>
  <li><strong>Create</strong>: Provide model with <code class="language-plaintext highlighter-rouge">_id</code> (no <code class="language-plaintext highlighter-rouge">_rev</code>)</li>
  <li><strong>Update</strong>: Provide model with <code class="language-plaintext highlighter-rouge">_id</code> and current <code class="language-plaintext highlighter-rouge">_rev</code></li>
  <li><strong>Delete</strong>: Provide model with <code class="language-plaintext highlighter-rouge">_id</code>, current <code class="language-plaintext highlighter-rouge">_rev</code>, and <code class="language-plaintext highlighter-rouge">_deleted: true</code></li>
</ul>

<h3 id="get_simulation_result">get_simulation_result</h3>

<p>Get the latest simulation result for a schematic.</p>

<p><strong>Parameters:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">id</code>: Schematic ID</li>
</ul>

<p><strong>Returns:</strong> Dictionary containing the simulation result data, or empty dict if none found.</p>

<h3 id="hello">hello</h3>

<p>Test authentication by verifying the JWT token with CouchDB. Useful for debugging connection issues.</p>

<h2 id="example-usage">Example Usage</h2>

<p>Here are some example prompts you can use with an LLM client connected to the NyanCAD MCP server:</p>

<ul>
  <li>“List all schematics in my library”</li>
  <li>“Get the schematic named ‘inverter’ and show me the SPICE netlist”</li>
  <li>“What components are available in the passives category?”</li>
  <li>“Show me the simulation results for my amplifier circuit”</li>
  <li>“Add a 10k resistor to my test schematic”</li>
</ul>

<h2 id="data-model">Data Model</h2>

<h3 id="devices">Devices</h3>

<p>Schematics contain two types of devices:</p>

<ul>
  <li><strong>Wire</strong>: Connections between components with a path of coordinates</li>
  <li><strong>Component</strong>: Circuit elements with position, rotation, model reference, and parameters</li>
</ul>

<p>Both device types include computed <code class="language-plaintext highlighter-rouge">ports</code> field showing connection points as <code class="language-plaintext highlighter-rouge">(x,y): port_name</code> mappings.</p>

<h3 id="models">Models</h3>

<p>Component models define the symbol, SPICE template, and parameters for circuit elements. Models are referenced by ID (e.g., <code class="language-plaintext highlighter-rouge">models:1ef9c9d7-...</code>) and can be browsed using <code class="language-plaintext highlighter-rouge">list_library</code>.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="authentication-fails">Authentication Fails</h3>

<p>Ensure you have a valid NyanCAD account and can log in to the web interface. The MCP server uses the same authentication system.</p>

<h3 id="connection-refused">Connection Refused</h3>

<p>For self-hosted deployments, verify that:</p>

<ul>
  <li>The nyancad-server is running and accessible</li>
  <li>The <code class="language-plaintext highlighter-rouge">/ai/mcp</code> endpoint is properly configured</li>
  <li>Any firewalls allow traffic to the server</li>
</ul>

<h3 id="conflict-errors">Conflict Errors</h3>

<p>When updating documents, always fetch the latest version first to get the current <code class="language-plaintext highlighter-rouge">_rev</code>. CouchDB uses optimistic concurrency control and will reject updates with stale revision numbers.</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
  </body>
</html>
