var z=Object.defineProperty;var i=(m,h)=>z(m,"name",{value:h,configurable:!0});import{h as G,a as J,ae as D,d as K,s as w,af as F,r as B,b as R,I as Q}from"./vendor-primevue-B1C3YRTk.js";import{bf as N,a5 as M,bg as W,q as X,a2 as Y,G as Z,a4 as ee,B as te,p as se,dj as ae,dk as oe}from"./index-azSeANjR.js";import{ci as O,r as A,w as V,bs as H,E as P,k as ie,c as p,d as x,A as n,bq as t,q as b,h as j,t as l,p as T,e as d,s as U,l as ne,u as re}from"./vendor-other-Dl5_1vG6.js";import{u as le}from"./vendor-vue-CuB5mYeL.js";import"./vendor-xterm-DV1MVhAx.js";import"./vendor-three-zdhtZbSm.js";import"./vendor-tiptap-BgsBtbxI.js";var I=(m=>(m.CREDIT_ADDED="credit_added",m.ACCOUNT_CREATED="account_created",m.API_USAGE_STARTED="api_usage_started",m.API_USAGE_COMPLETED="api_usage_completed",m))(I||{});const q=O.create({baseURL:N(),headers:{"Content-Type":"application/json"}}),ce=i(()=>{const m=A(!1),h=A(null),{d:k}=le();V(()=>N(),e=>{q.defaults.baseURL=e});const g=i((e,a,v)=>{if(W(e))return;let o;if(!O.isAxiosError(e))o=`${a} failed: ${e instanceof Error?e.message:String(e)}`;else{const r=e,u=r.response?.status;u&&v?.[u]?o=v[u]:o=r.response?.data?.message??`${a} failed with status ${u}`}h.value=o},"handleRequestError"),y=i(async(e,a)=>{const{errorContext:v,routeSpecificErrors:o}=a;m.value=!0,h.value=null;try{return(await e()).data}catch(r){return g(r,v,o),null}finally{m.value=!1}},"executeRequest");function f(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}}i(f,"formatEventType");function c(e){const a=new Date(e);return k(a,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}i(c,"formatDate");function C(e){return e.split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}i(C,"formatJsonKey");function E(e){return typeof e=="number"?e.toLocaleString():typeof e=="string"&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}i(E,"formatJsonValue");function $(e){switch(e){case"credit_added":return"success";case"account_created":return"info";case"api_usage_completed":return"warning";default:return"info"}}i($,"getEventSeverity");function S(e){const{amount:a,api_name:v,model:o,...r}=e.params||{};return Object.keys(r).length>0}i(S,"hasAdditionalInfo");function L(e){const{...a}=e.params||{};return Object.entries(a).map(([v,o])=>{const r=C(v),u=E(o);return`<strong>${r}:</strong> ${u}`}).join("<br>")}i(L,"getTooltipContent");function s(e){return e?(e/100).toFixed(2):"0.00"}i(s,"formatAmount");async function _({page:e=1,limit:a=10}={}){const v="Fetching customer events",o={400:"Invalid input, object invalid",404:"Not found"},r=await M().getAuthHeader();return r?await y(()=>q.get("/customers/events",{params:{page:e,limit:a},headers:r}),{errorContext:v,routeSpecificErrors:o}):(h.value="Authentication header is missing",null)}return i(_,"getMyEvents"),{isLoading:m,error:h,getMyEvents:_,formatEventType:f,getEventSeverity:$,formatAmount:s,hasAdditionalInfo:S,formatDate:c,formatJsonKey:C,formatJsonValue:E,getTooltipContent:L}},"useCustomerEventsService"),de={key:0,class:"flex items-center justify-center p-8"},ue={key:1,class:"p-4"},pe={class:"event-details"},me={key:0,class:"font-semibold text-green-500"},fe={key:1},ve={key:2,class:"flex flex-col gap-1"},he={class:"font-semibold"},ge={class:"text-sm text-smoke-400"},_e=H({__name:"UsageLogsTable",setup(m,{expose:h}){const k=A([]),g=A(!0),y=A(null),f=ce(),c=A({page:1,limit:7,total:0,totalPages:0}),C=P(()=>(c.value.page-1)*c.value.limit),E=P(()=>{const s=new Map;return k.value.forEach(_=>{f.hasAdditionalInfo(_)&&_.event_id&&s.set(_.event_id,f.getTooltipContent(_))}),s}),$=i(async()=>{g.value=!0,y.value=null;try{const s=await f.getMyEvents({page:c.value.page,limit:c.value.limit});s?(s.events&&(k.value=s.events),s.page&&(c.value.page=s.page),s.limit&&(c.value.limit=s.limit),s.total&&(c.value.total=s.total),s.totalPages&&(c.value.totalPages=s.totalPages),X()?.checkForCompletedTopup(s.events)):y.value=f.error.value||"Failed to load events"}catch(s){y.value=s instanceof Error?s.message:"Unknown error",console.error("Error loading events:",s)}finally{g.value=!1}},"loadEvents"),S=i(s=>{c.value.page=s.page+1,$().catch(_=>{console.error("Error loading events:",_)})},"onPageChange");return h({refresh:i(async()=>{c.value.page=1,await $()},"refresh")}),(s,_)=>{const e=ie("tooltip");return p(),x("div",null,[g.value?(p(),x("div",de,[n(t(G))])):y.value?(p(),x("div",ue,[n(t(J),{severity:"error",closable:!1},{default:b(()=>[j(l(y.value),1)]),_:1})])):(p(),T(t(F),{key:2,value:k.value,paginator:!0,rows:c.value.limit,"total-records":c.value.total,first:C.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:S},{default:b(()=>[n(t(D),{field:"event_type",header:s.$t("credits.eventType")},{body:b(({data:a})=>[n(t(K),{value:t(f).formatEventType(a.event_type),severity:t(f).getEventSeverity(a.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),n(t(D),{field:"details",header:s.$t("credits.details")},{body:b(({data:a})=>[d("div",pe,[a.event_type===t(I).CREDIT_ADDED?(p(),x("div",me,l(s.$t("credits.added"))+" $"+l(t(f).formatAmount(a.params?.amount)),1)):a.event_type===t(I).ACCOUNT_CREATED?(p(),x("div",fe,l(s.$t("credits.accountInitialized")),1)):a.event_type===t(I).API_USAGE_COMPLETED?(p(),x("div",ve,[d("div",he,l(a.params?.api_name||"API"),1),d("div",ge,l(s.$t("credits.model"))+": "+l(a.params?.model||"-"),1)])):U("",!0)])]),_:1},8,["header"]),n(t(D),{field:"createdAt",header:s.$t("credits.time")},{body:b(({data:a})=>[j(l(t(f).formatDate(a.createdAt)),1)]),_:1},8,["header"]),n(t(D),{field:"params",header:s.$t("credits.additionalInfo")},{body:b(({data:a})=>[t(f).hasAdditionalInfo(a)?ne((p(),T(t(w),{key:0,icon:"pi pi-info-circle",class:"p-button-text p-button-sm"},null,512)),[[e,{escape:!1,value:E.value.get(a.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):U("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),ye={class:"flex h-full flex-col"},be={class:"mb-2 text-2xl font-bold"},Ce={class:"flex flex-col gap-2"},$e={class:"text-sm font-medium text-muted"},xe={class:"flex items-center justify-between"},Ae={class:"flex flex-row items-center"},ke={key:1,class:"text-xs text-muted"},we={class:"flex items-center justify-between"},Ee={key:0,class:"grow"},Se={class:"text-sm font-medium"},De={class:"text-xs text-muted"},Te={class:"flex flex-row gap-2"},Fe=H({__name:"LegacyCreditsPanel",setup(m){const{buildDocsUrl:h}=Y(),k=Z(),g=M(),y=ee(),f=te(),{isActiveSubscription:c}=se(),C=P(()=>g.loading),E=P(()=>g.isFetchingBalance),$=A(null),S=P(()=>g.lastBalanceUpdateTime?g.lastBalanceUpdateTime.toLocaleString():"");V(()=>g.lastBalanceUpdateTime,(o,r)=>{o&&o!==r&&$.value&&$.value.refresh()});const L=i(()=>{k.showTopUpCreditsDialog()},"handlePurchaseCreditsClick"),s=i(async()=>{await y.accessBillingPortal()},"handleCreditsHistoryClick"),_=i(async()=>{await f.execute("Comfy.ContactSupport")},"handleMessageSupport"),e=i(()=>{window.open(h("/tutorials/api-nodes/faq",{includeLocale:!0}),"_blank")},"handleFaqClick"),a=i(()=>{window.open(h("/tutorials/api-nodes/overview#api-nodes",{includeLocale:!0}),"_blank")},"handleOpenPartnerNodesInfo"),v=A([]);return(o,r)=>(p(),T(t(Q),{value:"Credits",class:"credits-container h-full"},{default:b(()=>[d("div",ye,[d("h2",be,l(o.$t("credits.credits")),1),n(t(B)),d("div",Ce,[d("h3",$e,l(o.$t("credits.yourCreditBalance")),1),d("div",xe,[n(ae,{"text-class":"text-3xl font-bold"}),C.value?(p(),T(t(R),{key:0,width:"2rem",height:"2rem"})):t(c)?(p(),T(t(w),{key:1,label:o.$t("credits.purchaseCredits"),loading:C.value,onClick:L},null,8,["label","loading"])):U("",!0)]),d("div",Ae,[E.value?(p(),T(t(R),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):S.value?(p(),x("div",ke,l(o.$t("credits.lastUpdated"))+": "+l(S.value),1)):U("",!0),n(t(w),{icon:"pi pi-refresh",text:"",size:"small",severity:"secondary",onClick:r[0]||(r[0]=()=>t(y).fetchBalance())})])]),d("div",we,[d("h3",null,l(o.$t("credits.activity")),1),n(t(w),{label:o.$t("credits.invoiceHistory"),text:"",severity:"secondary",icon:"pi pi-arrow-up-right",loading:C.value,onClick:s},null,8,["label","loading"])]),v.value.length>0?(p(),x("div",Ee,[n(t(F),{value:v.value,"show-headers":!1},{default:b(()=>[n(t(D),{field:"title",header:o.$t("g.name")},{body:b(({data:u})=>[d("div",Se,l(u.title),1),d("div",De,l(u.timestamp),1)]),_:1},8,["header"]),n(t(D),{field:"amount",header:o.$t("g.amount")},{body:b(({data:u})=>[d("div",{class:re(["text-center text-base font-medium",u.isPositive?"text-sky-500":"text-red-400"])},l(u.isPositive?"+":"-")+"$"+l(t(oe)(u.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):U("",!0),n(t(B)),n(_e,{ref_key:"usageLogsTableRef",ref:$},null,512),d("div",Te,[n(t(w),{label:o.$t("credits.faqs"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:e},null,8,["label"]),n(t(w),{label:o.$t("subscription.partnerNodesCredits"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:a},null,8,["label"]),n(t(w),{label:o.$t("credits.messageSupport"),text:"",severity:"secondary",icon:"pi pi-comments",onClick:_},null,8,["label"])])])]),_:1}))}});export{Fe as default};
//# sourceMappingURL=LegacyCreditsPanel-DeaB9EcM.js.map
