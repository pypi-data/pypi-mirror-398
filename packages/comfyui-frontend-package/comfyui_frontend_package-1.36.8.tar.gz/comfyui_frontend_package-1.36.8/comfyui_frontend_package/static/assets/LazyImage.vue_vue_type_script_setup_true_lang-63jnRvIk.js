var ee=Object.defineProperty;var d=(o,t)=>ee(o,"name",{value:t,configurable:!0});import{cA as E,a as S,c as Q,_ as j,W as te,k as ae,h as q,s as X,u as G,d as z,l as se}from"./index-DmNbzHC1.js";import{b as Y,E as V,a as oe,bq as k,cB as K,cC as J,p as _,d as u,br as c,m as le,q as M,e as r,G as N,c as f,s as w,t as m,f as re,cU as ne,cl as ie,A as F,w as H,cT as de,ew as ue,r as y,h as D,o as ce,b9 as pe,d8 as me,c6 as fe,u as O}from"./vendor-other-D1YBujLf.js";import{j as ve,z as ge,f as he,b as be}from"./vendor-primevue-Cc-dhheY.js";import{u as ye}from"./vendor-vue-BE-2AxAL.js";function we(){const o=Y({get supportsPreviewMetadata(){return S.getServerFeature("supports_preview_metadata")},get maxUploadSize(){return S.getServerFeature("max_upload_size")},get supportsManagerV4(){return S.getServerFeature("extension.manager.supports_v4")},get modelUploadButtonEnabled(){return E.value.model_upload_button_enabled??S.getServerFeature("model_upload_button_enabled",!1)},get assetUpdateOptionsEnabled(){return E.value.asset_update_options_enabled??S.getServerFeature("asset_update_options_enabled",!1)},get privateModelsEnabled(){return E.value.private_models_enabled??S.getServerFeature("private_models_enabled",!1)},get onboardingSurveyEnabled(){return E.value.onboarding_survey_enabled??S.getServerFeature("onboarding_survey_enabled",!0)}}),t=d((l,s)=>V(()=>S.getServerFeature(l,s)),"featureFlag");return{flags:oe(o),featureFlag:t}}d(we,"useFeatureFlags");const $e={class:"flex items-center gap-2 text-sm"},Me={key:0,class:"text-base-foreground"},Ue={key:1,class:"text-base-foreground"},_e={class:"truncate"},ke={key:0,class:"icon-[lucide--check] text-base-foreground"},xe=k({inheritAttrs:!1,__name:"SingleSelect",props:K({label:{},options:{},listMaxHeight:{default:"28rem"},popoverMinWidth:{},popoverMaxWidth:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const t=J(o,"modelValue"),{t:l}=ye(),s=d(a=>{if(a==null||!o.options)return o.label??"";const n=o.options.find(i=>i.value===a);return n?n.name:o.label??""},"getLabel"),e=V(()=>{if(!o.popoverMinWidth&&!o.popoverMaxWidth)return;const a=[];return o.popoverMinWidth&&a.push(`min-width: ${o.popoverMinWidth}`),o.popoverMaxWidth&&a.push(`max-width: ${o.popoverMaxWidth}`),a.join("; ")});return(a,n)=>(u(),_(c(ve),le({modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=i=>t.value=i)},a.$attrs,{options:a.options,"option-label":"name","option-value":"value",unstyled:"",pt:{root:d(({props:i})=>({class:["h-10 relative inline-flex cursor-pointer select-none items-center","rounded-lg","bg-secondary-background text-base-foreground","border-[2.5px] border-solid border-transparent","transition-all duration-200 ease-in-out","focus-within:border-node-component-border",{"opacity-60 cursor-default":i.disabled}]}),"root"),label:{class:"flex-1 flex items-center whitespace-nowrap pl-4 py-2 outline-hidden"},dropdown:{class:"flex shrink-0 items-center justify-center px-3 py-2"},overlay:{class:c(Q)("mt-2 p-2 rounded-lg","bg-base-background text-base-foreground","border border-solid border-border-default")},listContainer:d(()=>({style:`max-height: min(${a.listMaxHeight}, 50vh)`,class:"scrollbar-custom"}),"listContainer"),list:{class:"flex flex-col gap-0 p-0 m-0 list-none border-none text-sm"},option:d(({context:i})=>({class:c(Q)("flex items-center justify-between gap-3 px-2 py-3 rounded","hover:bg-secondary-background-hover",i.focused&&"bg-secondary-background-hover",i.selected&&"bg-secondary-background-selected hover:bg-secondary-background-selected")}),"option"),optionLabel:{class:"truncate"},optionGroupLabel:{class:"px-3 py-2 text-xs uppercase tracking-wide text-muted-foreground"},emptyMessage:{class:"px-3 py-2 text-sm text-muted-foreground"}},"aria-label":a.label||c(l)("g.singleSelectDropdown"),role:"combobox","aria-expanded":!1,"aria-haspopup":"listbox",tabindex:0}),{value:M(i=>[r("div",$e,[re(a.$slots,"icon"),i.value!==null&&i.value!==void 0?(u(),f("span",Me,m(s(i.value)),1)):(u(),f("span",Ue,m(a.label),1))])]),dropdownicon:M(()=>n[1]||(n[1]=[r("i",{class:"icon-[lucide--chevron-down] text-muted-foreground"},null,-1)])),option:M(({option:i,selected:p})=>[r("div",{class:"flex w-full items-center justify-between gap-3",style:N(e.value)},[r("span",_e,m(i.name),1),p?(u(),f("i",ke)):w("",!0)],4)]),_:3},16,["modelValue","options","pt","aria-label"]))}});function Ce(o){const t={loras:"LoRA",ipadapter:"IP-Adapter",sams:"SAM",clip_vision:"CLIP Vision",animatediff_motion_lora:"AnimateDiff Motion LoRA",animatediff_models:"AnimateDiff Model",vae:"VAE",sam2:"SAM 2",controlnet:"ControlNet",gligen:"GLIGEN"};return t[o]?t[o]:o.split("_").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" ")}d(Ce,"formatDisplayName");const Z=ne(()=>{const{state:o,isLoading:t,error:l,execute:s}=ie(async()=>(await S.getModelFolders()).map(a=>({name:Ce(a.name),value:a.name})),[],{immediate:!1,onError:d(e=>{console.error("Failed to fetch model types:",e)},"onError")});return{modelTypes:o,isLoading:t,error:l,fetchModelTypes:s}}),Se={class:"flex flex-col gap-4 text-sm text-muted-foreground"},Le={class:"flex flex-col gap-2"},je={class:"m-0"},Fe={class:"flex items-center gap-3 bg-secondary-background p-3 rounded-lg"},Ie=["src","alt"],Be={class:"m-0 text-base-foreground"},Ve={class:"flex flex-col gap-2"},Ae={class:""},Re={class:"flex items-center gap-2"},Te=k({__name:"UploadModelConfirmation",props:K({metadata:{},previewImage:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const t=J(o,"modelValue"),{modelTypes:l,isLoading:s}=Z();return(e,a)=>(u(),f("div",Se,[r("div",Le,[r("p",je,m(e.$t("assetBrowser.modelAssociatedWithLink")),1),r("div",Fe,[e.previewImage?(u(),f("img",{key:0,src:e.previewImage,alt:e.metadata?.filename||e.metadata?.name||"Model preview",class:"w-14 h-14 rounded object-cover flex-shrink-0"},null,8,Ie)):w("",!0),r("p",Be,m(e.metadata?.filename||e.metadata?.name),1)])]),r("div",Ve,[r("label",Ae,m(e.$t("assetBrowser.modelTypeSelectorLabel")),1),F(xe,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=n=>t.value=n),label:c(s)?e.$t("g.loading"):e.$t("assetBrowser.modelTypeSelectorPlaceholder"),options:c(l),disabled:c(s),"data-attr":"upload-model-step2-type-selector"},null,8,["modelValue","label","options","disabled"]),r("div",Re,[a[1]||(a[1]=r("i",{class:"icon-[lucide--circle-question-mark]"},null,-1)),r("span",null,m(e.$t("assetBrowser.notSureLeaveAsIs")),1)])])]))}}),De={class:"relative"},Ee=["aria-label","src"],ze=k({__name:"VideoHelpDialog",props:K({videoUrl:{},ariaLabel:{default:"Help video"}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const t=J(o,"modelValue"),l=d(s=>{s.key==="Escape"&&(s.stopImmediatePropagation(),s.stopPropagation(),s.preventDefault(),t.value=!1)},"handleEscapeKey");return H(t,s=>{if(s){const e=de(document,"keydown",l,{capture:!0});ue(e)}},{immediate:!0}),(s,e)=>(u(),_(c(ge),{visible:t.value,"onUpdate:visible":e[1]||(e[1]=a=>t.value=a),modal:"",closable:!1,"close-on-escape":!1,"dismissable-mask":!0,pt:{root:{class:"video-help-dialog"},header:{class:"!hidden"},content:{class:"!p-0"},mask:{class:"!bg-black/70"}},style:{width:"90vw",maxWidth:"800px"}},{default:M(()=>[r("div",De,[F(j,{variant:"textonly",size:"icon",class:"absolute top-4 right-6 z-10","aria-label":s.$t("g.close"),onClick:e[0]||(e[0]=a=>t.value=!1)},{default:M(()=>e[2]||(e[2]=[r("i",{class:"pi pi-times text-sm"},null,-1)])),_:1},8,["aria-label"]),r("video",{autoplay:"",muted:"",loop:"","aria-label":s.ariaLabel,class:"w-full rounded-lg",src:s.videoUrl},m(s.$t("g.videoFailedToLoad")),9,Ee)])]),_:1},8,["visible"]))}}),He={class:"flex justify-end gap-2 w-full"},We={key:3},Pe={key:0,class:"icon-[lucide--loader-circle] animate-spin"},qe={key:0,class:"icon-[lucide--loader-circle] animate-spin"},Oe=k({__name:"UploadModelFooter",props:{currentStep:{},isFetchingMetadata:{type:Boolean},isUploading:{type:Boolean},canFetchMetadata:{type:Boolean},canUploadModel:{type:Boolean},uploadStatus:{}},emits:["back","fetchMetadata","upload","close"],setup(o,{emit:t}){const l=y(!1),s=t;return(e,a)=>(u(),f("div",He,[e.currentStep===1?(u(),_(j,{key:0,variant:"muted-textonly",size:"lg",class:"mr-auto underline","data-attr":"upload-model-step1-help-link",onClick:a[0]||(a[0]=n=>l.value=!0)},{default:M(()=>[a[7]||(a[7]=r("i",{class:"icon-[lucide--circle-question-mark]"},null,-1)),r("span",null,m(e.$t("assetBrowser.uploadModelHowDoIFindThis")),1)]),_:1})):w("",!0),e.currentStep===1?(u(),_(j,{key:1,variant:"muted-textonly",size:"lg","data-attr":"upload-model-step1-cancel-button",disabled:e.isFetchingMetadata||e.isUploading,onClick:a[1]||(a[1]=n=>s("close"))},{default:M(()=>[D(m(e.$t("g.cancel")),1)]),_:1},8,["disabled"])):w("",!0),e.currentStep!==1&&e.currentStep!==3?(u(),_(j,{key:2,variant:"muted-textonly",size:"lg","data-attr":`upload-model-step${e.currentStep}-back-button`,disabled:e.isFetchingMetadata||e.isUploading,onClick:a[2]||(a[2]=n=>s("back"))},{default:M(()=>[D(m(e.$t("g.back")),1)]),_:1},8,["data-attr","disabled"])):(u(),f("span",We)),e.currentStep===1?(u(),_(j,{key:4,variant:"secondary",size:"lg","data-attr":"upload-model-step1-continue-button",disabled:!e.canFetchMetadata||e.isFetchingMetadata,onClick:a[3]||(a[3]=n=>s("fetchMetadata"))},{default:M(()=>[e.isFetchingMetadata?(u(),f("i",Pe)):w("",!0),r("span",null,m(e.$t("g.continue")),1)]),_:1},8,["disabled"])):e.currentStep===2?(u(),_(j,{key:5,variant:"secondary",size:"lg","data-attr":"upload-model-step2-confirm-button",disabled:!e.canUploadModel||e.isUploading,onClick:a[4]||(a[4]=n=>s("upload"))},{default:M(()=>[e.isUploading?(u(),f("i",qe)):w("",!0),r("span",null,m(e.$t("assetBrowser.upload")),1)]),_:1},8,["disabled"])):e.currentStep===3&&e.uploadStatus==="success"?(u(),_(j,{key:6,variant:"secondary","data-attr":"upload-model-step3-finish-button",onClick:a[5]||(a[5]=n=>s("close"))},{default:M(()=>[D(m(e.$t("assetBrowser.finish")),1)]),_:1})):w("",!0),F(ze,{modelValue:l.value,"onUpdate:modelValue":a[6]||(a[6]=n=>l.value=n),"video-url":"https://media.comfy.org/compressed_768/civitai_howto.webm","aria-label":e.$t("assetBrowser.uploadModelHelpVideo")},null,8,["modelValue","aria-label"])]))}}),Ne={class:"flex flex-1 flex-col gap-6 text-sm text-muted-foreground"},Ge={key:0,class:"flex flex-1 flex-col items-center justify-center gap-2"},Ke={class:"text-center"},Je={class:"m-0 font-bold"},Qe={key:1,class:"flex flex-col gap-2"},Xe={class:"m-0 font-bold"},Ye={class:"m-0"},Ze={class:"flex flex-row items-center gap-3 p-4 bg-modal-card-background rounded-lg"},et=["src","alt"],tt={class:"flex flex-col justify-center items-start gap-1 flex-1"},at={class:"text-base-foreground m-0"},st={class:"text-sm text-muted m-0"},ot={key:2,class:"flex flex-1 flex-col items-center justify-center gap-6"},lt={class:"text-center"},rt={class:"m-0 text-sm font-bold"},nt={key:0,class:"text-sm text-muted mb-0"},it=k({__name:"UploadModelProgress",props:{status:{},error:{},metadata:{},modelType:{},previewImage:{}},setup(o){return(t,l)=>(u(),f("div",Ne,[t.status==="uploading"?(u(),f("div",Ge,[l[0]||(l[0]=r("i",{class:"icon-[lucide--loader-circle] animate-spin text-6xl text-muted-foreground"},null,-1)),r("div",Ke,[r("p",Je,m(t.$t("assetBrowser.uploadingModel")),1)])])):t.status==="success"?(u(),f("div",Qe,[r("p",Xe,m(t.$t("assetBrowser.modelUploaded")),1),r("p",Ye,m(t.$t("assetBrowser.findInLibrary",{type:t.modelType})),1),r("div",Ze,[t.previewImage?(u(),f("img",{key:0,src:t.previewImage,alt:t.metadata?.filename||t.metadata?.name||"Model preview",class:"w-14 h-14 rounded object-cover flex-shrink-0"},null,8,et)):w("",!0),r("div",tt,[r("p",at,m(t.metadata?.filename||t.metadata?.name),1),r("p",st,m(t.modelType),1)])])])):t.status==="error"?(u(),f("div",ot,[l[1]||(l[1]=r("i",{class:"icon-[lucide--x-circle] text-6xl text-error"},null,-1)),r("div",lt,[r("p",rt,m(t.$t("assetBrowser.uploadFailed")),1),t.error?(u(),f("p",nt,m(t.error),1)):w("",!0)])])):w("",!0)]))}}),dt={class:"flex flex-col gap-6 text-sm text-muted-foreground"},ut={class:"flex flex-col gap-2"},ct={class:"m-0"},pt={class:"list-disc space-y-1 pl-5 mt-0"},mt=["innerHTML"],ft=["innerHTML"],vt={class:"flex flex-col gap-2"},gt=["innerHTML"],ht={key:0,class:"text-xs text-error"},bt=["innerHTML"],yt=k({__name:"UploadModelUrlInput",props:{modelValue:{},error:{}},emits:["update:modelValue"],setup(o,{emit:t}){const l=o,s=t,e=V({get:d(()=>l.modelValue,"get"),set:d(a=>s("update:modelValue",a),"set")});return(a,n)=>(u(),f("div",dt,[r("div",ut,[r("p",ct,m(a.$t("assetBrowser.uploadModelDescription1")),1),r("ul",pt,[r("li",{innerHTML:a.$t("assetBrowser.uploadModelDescription2")},null,8,mt),r("li",{innerHTML:a.$t("assetBrowser.uploadModelDescription3")},null,8,ft)])]),r("div",vt,[r("label",{class:"mb-0",innerHTML:a.$t("assetBrowser.civitaiLinkLabel")},null,8,gt),F(c(he),{modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=i=>e.value=i),autofocus:"",placeholder:a.$t("assetBrowser.civitaiLinkPlaceholder"),class:"w-full bg-secondary-background border-0 p-4","data-attr":"upload-model-step1-url-input"},null,8,["modelValue","placeholder"]),a.error?(u(),f("p",ht,m(a.error),1)):(u(),f("p",{key:1,innerHTML:a.$t("assetBrowser.civitaiLinkExample")},null,8,bt))])]))}});function wt(o){const t=te(),l=ae(),s=y(1),e=y(!1),a=y(!1),n=y("idle"),i=y(""),p=y({url:"",name:"",tags:[]}),h=y();H(()=>p.value.url,()=>{i.value=""});const x=V(()=>p.value.url.trim().length>0),b=V(()=>!!h.value);function v($){try{const g=new URL($).hostname.toLowerCase();return g==="civitai.com"||g.endsWith(".civitai.com")}catch{return!1}}d(v,"isCivitaiUrl");async function U(){if(!x.value)return;let $=p.value.url.trim();try{$=new URL(encodeURI($)).toString()}catch{}if(p.value.url=$,!v(p.value.url)){i.value=X("assetBrowser.onlyCivitaiUrlsSupported","Only Civitai URLs are supported");return}e.value=!0;try{const g=await q.getAssetMetadata(p.value.url);if(p.value.metadata=g,p.value.name=g.filename||g.name||"",p.value.previewImage=g.preview_image,g.tags&&g.tags.length>0){p.value.tags=g.tags;const B=g.tags.find(C=>o.value.some(I=>I.value===C));B&&(h.value=B)}s.value=2}catch(g){console.error("Failed to retrieve metadata:",g),i.value=g instanceof Error?g.message:X("assetBrowser.uploadModelFailedToRetrieveMetadata","Failed to retrieve metadata. Please check the link and try again."),s.value=1}finally{e.value=!1}}d(U,"fetchMetadata");async function A(){if(b.value){a.value=!0,n.value="uploading";try{const $=h.value?["models",h.value]:["models"],g=p.value.metadata?.filename||p.value.metadata?.name||"model";let B;if(p.value.previewImage)try{const C=g.split(".")[0];let I="png";const R=p.value.previewImage.match(/^data:image\/([^;]+);/);R&&(I=R[1]==="jpeg"?"jpg":R[1]),B=(await q.uploadAssetFromBase64({data:p.value.previewImage,name:`${C}_preview.${I}`,tags:["preview"]})).id}catch(C){console.error("Failed to upload preview image:",C)}if(await q.uploadAssetFromUrl({url:p.value.url,name:g,tags:$,user_metadata:{source:"civitai",source_url:p.value.url,model_type:h.value},preview_id:B}),n.value="success",s.value=3,h.value){const C=l.getAllNodeProviders(h.value);await Promise.all(C.map(I=>t.updateModelsForNodeType(I.nodeDef.name)))}return!0}catch($){return console.error("Failed to upload asset:",$),n.value="error",i.value=$ instanceof Error?$.message:"Failed to upload model",s.value=3,!1}finally{a.value=!1}}}d(A,"uploadModel");function W(){s.value>1&&(s.value=s.value-1)}return d(W,"goToPreviousStep"),{currentStep:s,isFetchingMetadata:e,isUploading:a,uploadStatus:n,uploadError:i,wizardData:p,selectedModelType:h,canFetchMetadata:x,canUploadModel:b,fetchMetadata:U,uploadModel:A,goToPreviousStep:W}}d(wt,"useUploadModelWizard");const $t={class:"upload-model-dialog flex flex-col justify-between gap-6 p-4 pt-6 border-t border-border-default"},Mt=k({__name:"UploadModelDialog",emits:["upload-success"],setup(o,{emit:t}){const l=G(),{modelTypes:s,fetchModelTypes:e}=Z(),a=t,{currentStep:n,isFetchingMetadata:i,isUploading:p,uploadStatus:h,uploadError:x,wizardData:b,selectedModelType:v,canFetchMetadata:U,canUploadModel:A,fetchMetadata:W,uploadModel:$,goToPreviousStep:g}=wt(s);async function B(){await W()}d(B,"handleFetchMetadata");async function C(){await $()&&a("upload-success")}d(C,"handleUploadModel");function I(){l.closeDialog({key:"upload-model"})}return d(I,"handleClose"),ce(()=>{e()}),(R,T)=>(u(),f("div",$t,[c(n)===1?(u(),_(yt,{key:0,modelValue:c(b).url,"onUpdate:modelValue":T[0]||(T[0]=P=>c(b).url=P),error:c(x)},null,8,["modelValue","error"])):c(n)===2?(u(),_(Te,{key:1,modelValue:c(v),"onUpdate:modelValue":T[1]||(T[1]=P=>pe(v)?v.value=P:null),metadata:c(b).metadata,"preview-image":c(b).previewImage},null,8,["modelValue","metadata","preview-image"])):c(n)===3?(u(),_(it,{key:2,status:c(h),error:c(x),metadata:c(b).metadata,"model-type":c(v),"preview-image":c(b).previewImage},null,8,["status","error","metadata","model-type","preview-image"])):w("",!0),F(Oe,{"current-step":c(n),"is-fetching-metadata":c(i),"is-uploading":c(p),"can-fetch-metadata":c(U),"can-upload-model":c(A),"upload-status":c(h),onBack:c(g),onFetchMetadata:B,onUpload:C,onClose:I},null,8,["current-step","is-fetching-metadata","is-uploading","can-fetch-metadata","can-upload-model","upload-status","onBack"])]))}}),Ut=z(Mt,[["__scopeId","data-v-d6449e84"]]),_t=""+new URL("images/civitai.svg",import.meta.url).href,kt={},xt={class:"flex items-center gap-2 p-4 font-bold"},Ct={class:"rounded-full bg-white px-1.5 py-0 text-xxs font-inter font-semibold uppercase text-black"};function St(o,t){return u(),f("div",xt,[t[0]||(t[0]=r("img",{src:_t,class:"size-4"},null,-1)),r("span",null,m(o.$t("assetBrowser.uploadModelFromCivitai")),1),r("span",Ct,m(o.$t("g.beta")),1)])}d(St,"_sfc_render$2");const Lt=z(kt,[["render",St]]),jt={},Ft={class:"flex flex-1 flex-col items-center justify-center text-base text-muted-foreground"},It={class:"m-0 max-w-md"};function Bt(o,t){return u(),f("div",Ft,[r("p",It,m(o.$t("assetBrowser.upgradeFeatureDescription")),1)])}d(Bt,"_sfc_render$1");const Vt=z(jt,[["render",Bt]]),At={class:"flex flex-wrap justify-end gap-2 w-full"},Rt={href:"https://blog.comfy.org/p/comfy-cloud-new-features-and-pricing",target:"_blank",rel:"noopener noreferrer",class:"text-muted-foreground mr-auto underline flex items-center gap-2"},Tt=k({__name:"UploadModelUpgradeModalFooter",emits:["close","subscribe"],setup(o,{emit:t}){const l=t;return(s,e)=>(u(),f("div",At,[r("a",Rt,[e[2]||(e[2]=r("i",{class:"icon-[lucide--external-link]"},null,-1)),r("span",null,m(s.$t("g.learnMore")),1)]),F(j,{variant:"textonly",onClick:e[0]||(e[0]=a=>l("close"))},{default:M(()=>[D(m(s.$t("g.close")),1)]),_:1}),F(j,{variant:"secondary",onClick:e[1]||(e[1]=a=>l("subscribe"))},{default:M(()=>[D(m(s.$t("subscription.required.subscribe")),1)]),_:1})]))}}),Dt={class:"flex flex-col justify-between gap-10 p-4 border-t border-border-default w-auto max-w-[min(500px,90vw)]"},Et=k({__name:"UploadModelUpgradeModal",setup(o){const t=G(),{showSubscriptionDialog:l}=se();function s(){t.closeDialog({key:"upload-model-upgrade"})}d(s,"handleClose");function e(){l()}return d(e,"handleSubscribe"),(a,n)=>(u(),f("div",Dt,[F(Vt),F(Tt,{onClose:s,onSubscribe:e})]))}}),zt={},Ht={class:"flex items-center gap-2 p-4 font-bold"};function Wt(o,t){return u(),f("div",Ht,[r("span",null,m(o.$t("assetBrowser.upgradeToUnlockFeature")),1)])}d(Wt,"_sfc_render");const Pt=z(zt,[["render",Wt]]);function aa(o){const t=G(),{flags:l}=we(),s=V(()=>l.modelUploadButtonEnabled);function e(){l.privateModelsEnabled?t.showDialog({key:"upload-model",headerComponent:Lt,component:Ut,props:{onUploadSuccess:d(async()=>{await o?.()},"onUploadSuccess")},dialogComponentProps:{pt:{header:"py-0! pl-0!",content:"p-0!"}}}):t.showDialog({key:"upload-model-upgrade",headerComponent:Pt,component:Et,dialogComponentProps:{pt:{header:"py-0! pl-0!",content:"p-0!"}}})}return d(e,"showUploadDialog"),{isUploadButtonEnabled:s,showUploadDialog:e}}d(aa,"useModelUpload");const qt=""+new URL("images/default-template.png",import.meta.url).href;function Ot(o,t,l={}){const{immediate:s=!0,...e}=l,a=typeof window<"u"&&"IntersectionObserver"in window,n=y(!1);let i=null;const p=d(()=>{i&&(i.disconnect(),i=null)},"cleanup"),h=d(()=>{p(),!(!a||!o.value)&&(i=new IntersectionObserver(b=>{n.value=b.some(v=>v.isIntersecting),t(b,i)},e),i.observe(o.value))},"observe"),x=d(()=>{i&&o.value&&i.unobserve(o.value)},"unobserve");return s&&H(o,h,{immediate:!0,flush:"post"}),me(p),{isSupported:a,isIntersecting:n,observe:h,unobserve:x,cleanup:p}}d(Ot,"useIntersectionObserver");class Nt{static{d(this,"MediaCacheService")}cache=Y(new Map);maxSize;maxAge;cleanupInterval=null;urlRefCount=new Map;constructor(t={}){this.maxSize=t.maxSize??100,this.maxAge=t.maxAge??1800*1e3,this.startCleanupInterval()}startCleanupInterval(){this.cleanupInterval=window.setInterval(()=>{this.cleanup()},300*1e3)}cleanup(){const t=Date.now(),l=[];for(const[s,e]of Array.from(this.cache.entries()))t-e.lastAccessed>this.maxAge&&(e.objectUrl?(this.urlRefCount.get(e.objectUrl)||0)===0&&(URL.revokeObjectURL(e.objectUrl),this.urlRefCount.delete(e.objectUrl),l.push(s)):l.push(s));if(l.forEach(s=>this.cache.delete(s)),this.cache.size>this.maxSize){const s=Array.from(this.cache.entries());s.sort((n,i)=>n[1].lastAccessed-i[1].lastAccessed);let e=0;const a=this.cache.size-this.maxSize;for(const[n,i]of s){if(e>=a)break;i.objectUrl?(this.urlRefCount.get(i.objectUrl)||0)===0&&(URL.revokeObjectURL(i.objectUrl),this.urlRefCount.delete(i.objectUrl),this.cache.delete(n),e++):(this.cache.delete(n),e++)}}}async getCachedMedia(t){let l=this.cache.get(t);if(l)return l.lastAccessed=Date.now(),l;l={src:t,isLoading:!0,lastAccessed:Date.now()},this.cache.set(t,l);try{const s=await fetch(t,{cache:"force-cache"});if(!s.ok)throw new Error(`Failed to fetch: ${s.status}`);const e=await s.blob(),a=URL.createObjectURL(e),n={src:t,blob:e,objectUrl:a,isLoading:!1,lastAccessed:Date.now()};return this.cache.set(t,n),n}catch(s){console.warn("Failed to cache media:",t,s);const e={src:t,error:!0,isLoading:!1,lastAccessed:Date.now()};return this.cache.set(t,e),e}}acquireUrl(t){const l=this.cache.get(t);if(l?.objectUrl){const s=this.urlRefCount.get(l.objectUrl)||0;return this.urlRefCount.set(l.objectUrl,s+1),l.objectUrl}}releaseUrl(t){const l=this.cache.get(t);if(l?.objectUrl){const s=(this.urlRefCount.get(l.objectUrl)||1)-1;s<=0?(URL.revokeObjectURL(l.objectUrl),this.urlRefCount.delete(l.objectUrl),this.cache.delete(t)):this.urlRefCount.set(l.objectUrl,s)}}clearCache(){for(const t of Array.from(this.cache.values()))t.objectUrl&&URL.revokeObjectURL(t.objectUrl);this.cache.clear(),this.urlRefCount.clear()}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.clearCache()}}let L=null;function Gt(o){return L||(L=new Nt(o)),{getCachedMedia:d(a=>L.getCachedMedia(a),"getCachedMedia"),clearCache:d(()=>L.clearCache(),"clearCache"),acquireUrl:d(a=>L.acquireUrl(a),"acquireUrl"),releaseUrl:d(a=>L.releaseUrl(a),"releaseUrl"),cache:L.cache}}d(Gt,"useMediaCache");typeof window<"u"&&window.addEventListener("beforeunload",()=>{L&&L.destroy()});const Kt=["src","alt"],Jt={key:2,class:"absolute inset-0 flex items-center justify-center"},Qt=["alt"],sa=k({__name:"LazyImage",props:{src:{},alt:{default:""},containerClass:{type:[Array,Object,String,Number,null,Boolean],default:""},imageClass:{type:[Array,Object,String,Number,null,Boolean],default:""},imageStyle:{},rootMargin:{default:"300px"}},setup(o){const t=y(null),l=y(!1),s=y(!1),e=y(!1),a=y(void 0),{getCachedMedia:n,acquireUrl:i,releaseUrl:p}=Gt();Ot(t,v=>{const U=v[0];l.value=U?.isIntersecting??!1},{rootMargin:o.rootMargin,threshold:.1});const h=V(()=>l.value);H(h,async v=>{if(v&&o.src&&!a.value&&!e.value)try{const U=await n(o.src);if(U.error)e.value=!0;else if(U.objectUrl){const A=i(o.src);a.value=A||U.objectUrl}else a.value=o.src}catch(U){console.warn("Failed to load cached media:",U),a.value=o.src}else v||(a.value?.startsWith("blob:")&&p(o.src),s.value=!1,a.value=void 0,e.value=!1)},{immediate:!0});const x=d(()=>{s.value=!0,e.value=!1},"onImageLoad"),b=d(()=>{e.value=!0,s.value=!1},"onImageError");return fe(()=>{a.value?.startsWith("blob:")&&p(o.src)}),(v,U)=>(u(),f("div",{ref_key:"containerRef",ref:t,class:O(["relative flex h-full w-full items-center justify-center overflow-hidden",v.containerClass])},[s.value?w("",!0):(u(),_(c(be),{key:0,width:"100%",height:"100%",class:"absolute inset-0"})),a.value?(u(),f("img",{key:1,src:a.value,alt:v.alt,draggable:"false",class:O(v.imageClass),style:N(v.imageStyle),onLoad:x,onError:b},null,46,Kt)):w("",!0),e.value?(u(),f("div",Jt,[r("img",{src:qt,alt:v.alt,draggable:"false",class:O(v.imageClass),style:N(v.imageStyle)},null,14,Qt)])):w("",!0)],2))}});export{xe as _,aa as a,qt as b,sa as c,Ot as d,we as u};
//# sourceMappingURL=LazyImage.vue_vue_type_script_setup_true_lang-63jnRvIk.js.map
