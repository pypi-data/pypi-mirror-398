var G=Object.defineProperty;var i=(m,h)=>G(m,"name",{value:h,configurable:!0});import{h as J,a as K,ad as F,e as Q,ae as T,s as k,r as R,b as N,H as W}from"./vendor-primevue-De0k_7Rd.js";import{a2 as M,bh as X,bi as O,m as Y,$ as Z,o as ee,a1 as te,z as se,l as ae,dm as oe,dn as ie}from"./index-DxFSMtyW.js";import{r as $,w as H,ci as V,bq as z,E as L,k as ne,c as C,d as p,p as P,A as n,br as t,q as y,h as j,t as r,e as c,s as I,l as re,u as le}from"./vendor-other-CSCK_VYO.js";import{u as ce}from"./vendor-vue-C_r2VRgZ.js";import"./vendor-xterm-CWYFmgbN.js";import"./vendor-three-BsnVSA6y.js";import"./vendor-tiptap-B2vFozDB.js";var B=(m=>(m.CREDIT_ADDED="credit_added",m.ACCOUNT_CREATED="account_created",m.API_USAGE_STARTED="api_usage_started",m.API_USAGE_COMPLETED="api_usage_completed",m))(B||{});const q=V.create({baseURL:O(),headers:{"Content-Type":"application/json"}}),de=i(()=>{const m=$(!1),h=$(null),{d:x}=ce();H(()=>O(),e=>{q.defaults.baseURL=e});const A=i((e,a,_)=>{if(X(e))return;let u;if(!V.isAxiosError(e))u=`${a} failed: ${e instanceof Error?e.message:String(e)}`;else{const o=e,v=o.response?.status;v&&_?.[v]?u=_[v]:u=o.response?.data?.message??`${a} failed with status ${v}`}h.value=u},"handleRequestError"),f=i(async(e,a)=>{const{errorContext:_,routeSpecificErrors:u}=a;m.value=!0,h.value=null;try{return(await e()).data}catch(o){return A(o,_,u),null}finally{m.value=!1}},"executeRequest");function d(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}}i(d,"formatEventType");function l(e){const a=new Date(e);return x(a,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}i(l,"formatDate");function w(e){return e.split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}i(w,"formatJsonKey");function b(e){return typeof e=="number"?e.toLocaleString():typeof e=="string"&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}i(b,"formatJsonValue");function S(e){switch(e){case"credit_added":return"success";case"account_created":return"info";case"api_usage_completed":return"warning";default:return"info"}}i(S,"getEventSeverity");function E(e){const{amount:a,api_name:_,model:u,...o}=e.params||{};return Object.keys(o).length>0}i(E,"hasAdditionalInfo");function U(e){const{...a}=e.params||{};return Object.entries(a).map(([_,u])=>{const o=w(_),v=b(u);return`<strong>${o}:</strong> ${v}`}).join("<br>")}i(U,"getTooltipContent");function s(e){return e?(e/100).toFixed(2):"0.00"}i(s,"formatAmount");async function g({page:e=1,limit:a=10}={}){const _="Fetching customer events",u={400:"Invalid input, object invalid",404:"Not found"},o=await M().getAuthHeader();return o?await f(()=>q.get("/customers/events",{params:{page:e,limit:a},headers:o}),{errorContext:_,routeSpecificErrors:u}):(h.value="Authentication header is missing",null)}return i(g,"getMyEvents"),{isLoading:m,error:h,getMyEvents:g,formatEventType:d,getEventSeverity:S,formatAmount:s,hasAdditionalInfo:E,formatDate:l,formatJsonKey:w,formatJsonValue:b,getTooltipContent:U}},"useCustomerEventsService"),ue={key:0,class:"flex items-center justify-center p-8"},pe={key:1,class:"p-4"},me={class:"event-details"},fe={key:0,class:"font-semibold text-green-500"},ve={key:1},he={key:2,class:"flex flex-col gap-1"},ge={class:"font-semibold"},_e={class:"text-sm text-smoke-400"},ye=z({__name:"UsageLogsTable",setup(m,{expose:h}){const x=$([]),A=$(!0),f=$(null),d=de(),l=$({page:1,limit:7,total:0,totalPages:0}),w=L(()=>(l.value.page-1)*l.value.limit),b=L(()=>{const s=new Map;return x.value.forEach(g=>{d.hasAdditionalInfo(g)&&g.event_id&&s.set(g.event_id,d.getTooltipContent(g))}),s}),S=i(async()=>{A.value=!0,f.value=null;try{const s=await d.getMyEvents({page:l.value.page,limit:l.value.limit});s?(s.events&&(x.value=s.events),s.page&&(l.value.page=s.page),s.limit&&(l.value.limit=s.limit),s.total&&(l.value.total=s.total),s.totalPages&&(l.value.totalPages=s.totalPages),Y()?.checkForCompletedTopup(s.events)):f.value=d.error.value||"Failed to load events"}catch(s){f.value=s instanceof Error?s.message:"Unknown error",console.error("Error loading events:",s)}finally{A.value=!1}},"loadEvents"),E=i(s=>{l.value.page=s.page+1,S().catch(g=>{console.error("Error loading events:",g)})},"onPageChange");return h({refresh:i(async()=>{l.value.page=1,await S()},"refresh")}),(s,g)=>{const e=ne("tooltip");return p(),C("div",null,[A.value?(p(),C("div",ue,[n(t(J))])):f.value?(p(),C("div",pe,[n(t(K),{severity:"error",closable:!1},{default:y(()=>[j(r(f.value),1)]),_:1})])):(p(),P(t(F),{key:2,value:x.value,paginator:!0,rows:l.value.limit,"total-records":l.value.total,first:w.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:E},{default:y(()=>[n(t(T),{field:"event_type",header:s.$t("credits.eventType")},{body:y(({data:a})=>[n(t(Q),{value:t(d).formatEventType(a.event_type),severity:t(d).getEventSeverity(a.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),n(t(T),{field:"details",header:s.$t("credits.details")},{body:y(({data:a})=>[c("div",me,[a.event_type===t(B).CREDIT_ADDED?(p(),C("div",fe,r(s.$t("credits.added"))+" $"+r(t(d).formatAmount(a.params?.amount)),1)):a.event_type===t(B).ACCOUNT_CREATED?(p(),C("div",ve,r(s.$t("credits.accountInitialized")),1)):a.event_type===t(B).API_USAGE_COMPLETED?(p(),C("div",he,[c("div",ge,r(a.params?.api_name||"API"),1),c("div",_e,r(s.$t("credits.model"))+": "+r(a.params?.model||"-"),1)])):I("",!0)])]),_:1},8,["header"]),n(t(T),{field:"createdAt",header:s.$t("credits.time")},{body:y(({data:a})=>[j(r(t(d).formatDate(a.createdAt)),1)]),_:1},8,["header"]),n(t(T),{field:"params",header:s.$t("credits.additionalInfo")},{body:y(({data:a})=>[t(d).hasAdditionalInfo(a)?re((p(),P(t(k),{key:0,icon:"pi pi-info-circle",class:"p-button-text p-button-sm"},null,512)),[[e,{escape:!1,value:b.value.get(a.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):I("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),be={class:"flex h-full flex-col"},Ce={class:"mb-2 text-2xl font-bold"},$e={class:"flex flex-col gap-2"},xe={class:"text-sm font-medium text-muted"},Ae={class:"flex items-center justify-between"},Ee={class:"flex flex-row items-center"},ke={key:1,class:"text-xs text-muted"},we={class:"flex items-center justify-between"},Se={key:0,class:"grow"},De={class:"text-sm font-medium"},Te={class:"text-xs text-muted"},Pe={class:"flex flex-row gap-2"},Fe=z({__name:"LegacyCreditsPanel",setup(m){const{buildDocsUrl:h,docsPaths:x}=Z(),A=ee(),f=M(),d=te(),l=se(),{isActiveSubscription:w}=ae(),b=L(()=>f.loading),S=L(()=>f.isFetchingBalance),E=$(null),U=L(()=>f.lastBalanceUpdateTime?f.lastBalanceUpdateTime.toLocaleString():"");H(()=>f.lastBalanceUpdateTime,(o,v)=>{o&&o!==v&&E.value&&E.value.refresh()});const s=i(()=>{A.showTopUpCreditsDialog()},"handlePurchaseCreditsClick"),g=i(async()=>{await d.accessBillingPortal()},"handleCreditsHistoryClick"),e=i(async()=>{await l.execute("Comfy.ContactSupport")},"handleMessageSupport"),a=i(()=>{window.open(h("/tutorials/api-nodes/faq",{includeLocale:!0}),"_blank")},"handleFaqClick"),_=i(()=>{window.open(h(x.partnerNodesPricing,{includeLocale:!0}),"_blank")},"handleOpenPartnerNodesInfo"),u=$([]);return(o,v)=>(p(),P(t(W),{value:"Credits",class:"credits-container h-full"},{default:y(()=>[c("div",be,[c("h2",Ce,r(o.$t("credits.credits")),1),n(t(R)),c("div",$e,[c("h3",xe,r(o.$t("credits.yourCreditBalance")),1),c("div",Ae,[n(oe,{"text-class":"text-3xl font-bold"}),b.value?(p(),P(t(N),{key:0,width:"2rem",height:"2rem"})):t(w)?(p(),P(t(k),{key:1,label:o.$t("credits.purchaseCredits"),loading:b.value,onClick:s},null,8,["label","loading"])):I("",!0)]),c("div",Ee,[S.value?(p(),P(t(N),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):U.value?(p(),C("div",ke,r(o.$t("credits.lastUpdated"))+": "+r(U.value),1)):I("",!0),n(t(k),{icon:"pi pi-refresh",text:"",size:"small",severity:"secondary",onClick:v[0]||(v[0]=()=>t(d).fetchBalance())})])]),c("div",we,[c("h3",null,r(o.$t("credits.activity")),1),n(t(k),{label:o.$t("credits.invoiceHistory"),text:"",severity:"secondary",icon:"pi pi-arrow-up-right",loading:b.value,onClick:g},null,8,["label","loading"])]),u.value.length>0?(p(),C("div",Se,[n(t(F),{value:u.value,"show-headers":!1},{default:y(()=>[n(t(T),{field:"title",header:o.$t("g.name")},{body:y(({data:D})=>[c("div",De,r(D.title),1),c("div",Te,r(D.timestamp),1)]),_:1},8,["header"]),n(t(T),{field:"amount",header:o.$t("g.amount")},{body:y(({data:D})=>[c("div",{class:le(["text-center text-base font-medium",D.isPositive?"text-sky-500":"text-red-400"])},r(D.isPositive?"+":"-")+"$"+r(t(ie)(D.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):I("",!0),n(t(R)),n(ye,{ref_key:"usageLogsTableRef",ref:E},null,512),c("div",Pe,[n(t(k),{label:o.$t("credits.faqs"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:a},null,8,["label"]),n(t(k),{label:o.$t("subscription.partnerNodesCredits"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:_},null,8,["label"]),n(t(k),{label:o.$t("credits.messageSupport"),text:"",severity:"secondary",icon:"pi pi-comments",onClick:e},null,8,["label"])])])]),_:1}))}});export{Fe as default};
//# sourceMappingURL=LegacyCreditsPanel-DcN0ryYN.js.map
