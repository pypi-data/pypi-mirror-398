[build-system]
requires = ["setuptools>=69", "wheel", "setuptools-scm[toml]>=8"]
build-backend = "setuptools.build_meta"

[project]
name = "esrf-statusgui"
dynamic = ["version"]
authors = [
    { name="Charles ROMAIN", email="charles.romain@protonmail.com" },
]
description = "Get the post-treatment progress of any ESRF-ID11 experiment. Option to launch the post-treatment from the GUI."
readme = { file = "README.md", content-type = "text/markdown" }
requires-python = ">=3.9"
license = "MIT"
license-files = ["LICENSE.md"]
keywords = ["ESRF", "Jupyter", "widgets", "diffraction", "tomography", "beamline"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Science/Research",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3 :: Only",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Operating System :: POSIX :: Linux",
    "Framework :: Jupyter",
    "Framework :: Jupyter :: JupyterLab",
    "Topic :: Scientific/Engineering",
    "Topic :: Scientific/Engineering :: Physics",
]
dependencies = [
    "silx",
    "numpy",
    "scipy",
    "tqdm",
    "h5py",
    "esrf-loadfile>=0.1.0",
    "json5",
    "pandas",
    "fasteners",
    "matplotlib",
    "nbformat",
    "esrf-pathlib>=0.5.0",
    "mysqlclient"
]

[project.optional-dependencies]
dev = [
    "ruff>=0.4.0",
    "mypy>=1.8.0",
    "pytest",
    "bandit",
    "black", # auto-format
    "flake8", # lint
    "flake8-pep585",
    "pre-commit",
    "pytest-cov",
    "pytest-mock",
    "pytest-profiling!=1.8.0", # https://gitlab.esrf.fr/bliss/bliss/-/issues/4543
    "pytest-rerunfailures",
    "pytest-xvfb",
    "scriv>=1.3.1",
    "build",
    "twine",
]
dev-rust = [
    "maturin>=1.4.0",
    "setuptools-rust>=1.8.1",
]
gui = [
    "ipykernel",
    "ipywidgets",
    "ipympl",
    "matplotlib-inline",
]
jupyter = [
    "esrf-statusgui[gui]",
    "jupyterhub",
    "jupyterlab",
    "batchspawner",
]
full = [
    "esrf-statusgui[dev]",
    "esrf-statusgui[dev-rust]",
    "esrf-statusgui[gui]",
]
extra = [
    "ImageD11==2.1.2",
    "dct>=0.0.2",
    "Dans-Diffraction",
]
all = [
    "esrf-statusgui[jupyter]",
    "esrf-statusgui[full]",
    "esrf-statusgui[extra]",
]

[project.urls]
Homepage = "https://gitlab.esrf.fr/graintracking/statusgui"
Repository = "https://gitlab.esrf.fr/graintracking/statusgui"
Issues = "https://gitlab.esrf.fr/graintracking/statusgui/-/issues"
Changelog = "https://gitlab.esrf.fr/graintracking/statusgui/-/blob/dev/CHANGELOG.md"

[project.scripts]
statusGUI = "esrf_statusgui.visualization.statusGUI:main"
statusgui = "esrf_statusgui.visualization.statusGUI:main"

[tool.setuptools]
package-dir = { "" = "src" }
include-package-data = true

[tool.setuptools_scm]
fallback_version = "0.0.0"
local_scheme = "no-local-version"

[tool.setuptools.packages.find]
where = ["src"]
include = ["esrf_statusgui*"]

[tool.setuptools.package-data]
"*" = ["*", "**/*"]

# [tool.setuptools.sdist]
# include = ["**/*"]
# exclude = [
#   "**/__pycache__/**",
#   "**/*.py[co]",
#   ".git/**",
#   ".github/**",
#   ".idea/**",
#   ".vscode/**",
# ]

# [tool.setuptools.data-files]
# "share/dct" = ["resources/**"]

[tool.black]
line-length = 88
target-version = ["py39", "py310", "py311", "py312"]

[tool.ruff]
line-length = 88
extend-exclude = ["src/notebooks/*.ipynb"]

[tool.ruff.lint]
select = ["E", "F", "I", "B", "UP"]   # pycodestyle, pyflakes, isort, bugbear, pyupgrade
ignore = ["E501"]                      # Ruff/Black handle line-length; adjust if you prefer
exclude = ["venv", ".venv", "build", "dist"]

[tool.ruff.lint.isort]
known-first-party = ["esrf_statusgui"]

[tool.flake8]
max-line-length = 88
extend-ignore = ["E203", "W503"]
exclude = [".venv", "venv", "build", "dist"]

[tool.mypy]
python_version = "3.11"
warn_unused_ignores = true
warn_redundant_casts = true
disallow_untyped_defs = false
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = false

[[tool.mypy.overrides]]
module = "dct.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "src.esrf_statusgui.brain.post_process"
disallow_untyped_defs = true

[[tool.mypy.overrides]]
module = "tests.brain.test_post_process"
disallow_untyped_defs = true
