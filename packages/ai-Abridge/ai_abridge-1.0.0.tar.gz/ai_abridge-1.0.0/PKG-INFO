Metadata-Version: 2.4
Name: ai-Abridge
Version: 1.0.0
Summary: A pure AI model bridge - transparent, native SDK, multi-vendor support.
License-Expression: MIT
Keywords: ai,batch,gemini,kimi,llm,openai,qwen
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.9
Requires-Dist: dashscope>=1.0.0
Requires-Dist: google-genai>=1.0.0
Requires-Dist: openai>=1.0.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: typer>=0.9.0
Description-Content-Type: text/markdown

# AI Bridge ğŸŒ‰

**çº¯å‡€çš„ AI æ¨¡å‹æ¡¥æ¥åº“** - é€æ˜ã€åŸç”Ÿ SDKã€å¤šå‚å•†æ”¯æŒã€æ— ä¸»è§‚ä¾µå…¥ã€‚

AI Bridge (aib) æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ Python æ¥å£ï¼Œç”¨äºè°ƒç”¨å„å¤§ä¸»æµ AI å‚å•†ï¼ˆGemini, Kimi, Qwen, OpenAIï¼‰çš„åŸç”Ÿèƒ½åŠ›ã€‚å®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ **"é€æ˜æ¡¥æ¥"**ï¼šæˆ‘ä»¬åªåšæ¬è¿å·¥ï¼Œä¸åšä»»ä½•åŠ å·¥ï¼Œè®©ç”¨æˆ·ç›´æ¥è·å¾—å¤§æ¨¡å‹çš„åŸå§‹è¿”å›å’Œé”™è¯¯ä¿¡æ¯ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **å¤šå‚å•†æ”¯æŒ**: 
  - **Google Gemini**: æ”¯æŒ Gemini 2.0 Flash/Pro ç­‰å…¨ç³»æ¨¡å‹
  - **Moonshot Kimi**: æ”¯æŒ moonshot-v1 ç³»åˆ—
  - **Aliyun Qwen**: æ”¯æŒ Qwen-Plus/Turbo/Max åŠ VL è§†è§‰å¤§æ¨¡å‹
  - **OpenAI**: æ”¯æŒ GPT-4o/3.5 ç­‰åŠå…¼å®¹æ¥å£

- **é€æ˜æ¡¥æ¥ (Transparent Bridge)**: 
  - ğŸ›¡ï¸ **æ— ä¸»è§‚å¤„ç†**: ä¸æ‹¦æˆªé”™è¯¯ï¼Œä¸åå™¬å¼‚å¸¸ï¼Œä¸ä¿®æ”¹å“åº”å†…å®¹ã€‚
  - ğŸ“¦ **åŸç”Ÿå¯¹è±¡**: è¿”å›åŒ…å«åŸå§‹ SDK å“åº”å¯¹è±¡çš„ `Response`ï¼Œæ–¹ä¾¿é«˜çº§ç”¨æˆ·è°ƒè¯•ã€‚
  - âš¡ **åŸç”Ÿ SDK**: åº•å±‚ç›´æ¥è°ƒç”¨å®˜æ–¹ SDK (`google-genai`, `openai`, `dashscope`)ï¼Œç¡®ä¿èƒ½åŠ›é›¶æŸè€—ã€‚

- **å¼ºå¤§çš„æ–‡ä»¶å¤„ç†**: 
  - ğŸ“‚ **Native File API**: ä¼˜å…ˆä½¿ç”¨å‚å•†åŸç”Ÿ File API ä¸Šä¼ æ–‡ä»¶ï¼ˆæ”¯æŒ PDF/è§†é¢‘/éŸ³é¢‘ï¼‰ï¼Œè€Œéç²—æš´çš„ Base64 è½¬æ¢ã€‚
  - ğŸ–¼ï¸ **å¤šæ¨¡æ€æ”¯æŒ**: å®Œç¾æ”¯æŒè§†è§‰é—®ç­”ã€æ–‡æ¡£åˆ†æç­‰åœºæ™¯ã€‚

- **ç‹¬å®¶åŠŸèƒ½**:
  - ğŸš€ **Batch API**: é›†æˆ Qwen å’Œ Gemini çš„æ‰¹é‡å¤„ç†æ¥å£ï¼Œæˆæœ¬é™ä½ 50%ã€‚
  - â±ï¸ **è¶…æ—¶æ§åˆ¶**: æ”¯æŒå…¨å±€æˆ–å•æ¬¡è¯·æ±‚çš„ Timeout è®¾ç½®ã€‚
  - ğŸ”Œ **ä¸­è½¬ç«™æ”¯æŒ**: å®Œç¾æ”¯æŒè‡ªå®šä¹‰ `base_url`ï¼Œé€‚é…å„ç±» API ä»£ç†ã€‚

## ğŸ“¦ å®‰è£…

```bash
pip install ai-bridge
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. SDK ä½¿ç”¨æ˜¯

```python
from aib import AIBridge

# åˆå§‹åŒ– (è‡ªåŠ¨è¯»å–ç¯å¢ƒå˜é‡æˆ–é…ç½®ï¼Œä¹Ÿå¯ä»¥æ˜¾å¼ä¼ å…¥)
bridge = AIBridge(
    vendor="gemini", 
    api_key="YOUR_API_KEY", 
    model="gemini-2.0-flash",
    timeout=60  # 60ç§’è¶…æ—¶
)

# ç®€å•å¯¹è¯
response = bridge.chat("ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±")
print(response.content)

# å¸¦æ–‡ä»¶çš„å¤šæ¨¡æ€å¯¹è¯ (è‡ªåŠ¨å¤„ç†æ–‡ä»¶ä¸Šä¼ )
response = bridge.chat(
    prompt="è¯·æ€»ç»“è¿™ä»½æ–‡æ¡£ä¸»è¦è®²äº†ä»€ä¹ˆï¼Œå¹¶åˆ†æç¬¬äºŒå¼ å›¾è¡¨",
    files=["./report.pdf", "./chart.png"]
)
print(response.content)

# æŸ¥çœ‹ Token æ¶ˆè€—
print(f"Token ä½¿ç”¨: {response.usage.total_tokens}")
```

### 2. CLI å‘½ä»¤è¡Œä½¿ç”¨

AI Bridge æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…· `ab`ã€‚

```bash
# ç®€å•å¯¹è¯ (é»˜è®¤ä½¿ç”¨ gemini)
ab chat "ä½ å¥½ï¼"

# æŒ‡å®šå‚å•†å’Œæ¨¡å‹
ab chat "å†™é¦–è¯—" -v kimi -m moonshot-v1-8k

# å¸¦æ–‡ä»¶åˆ†æ
ab chat "è§£é‡Šè¿™ä¸ªä»£ç æˆªå›¾" -v gemini -f error.png

# å¸¦è¶…æ—¶è®¾ç½® (60ç§’)
ab chat "ç”Ÿæˆé•¿æ–‡ç« ..." -v openai --timeout 60

# æŸ¥çœ‹ Token ä½¿ç”¨æƒ…å†µ
ab chat "è®¡ç®—..." -v qwen --usage

# ä½¿ç”¨è‡ªå®šä¹‰ä¸­è½¬ç«™
ab chat "Hello" -v openai --base-url "https://api.proxy.com/v1"
```

## âš™ï¸ é…ç½®æŒ‡å—

ä½ å¯ä»¥é€šè¿‡ **YAML é…ç½®æ–‡ä»¶** æˆ– **ç¯å¢ƒå˜é‡** æ¥ç®¡ç† API Key å’Œé»˜è®¤è®¾ç½®ã€‚

### æ–¹å¼ä¸€ï¼šé…ç½®æ–‡ä»¶ (æ¨è)

åˆ›å»º `~/.aib/config.yaml` æˆ–å½“å‰ç›®å½•ä¸‹çš„ `config.yaml`ï¼š

```yaml
# é»˜è®¤ä½¿ç”¨çš„å‚å•†
default_vendor: gemini

# å¯é€‰ï¼šå…¨å±€è¶…æ—¶æ—¶é—´ (ç§’)
timeout: 60

vendors:
  gemini:
    api_key: "AIzaSy..."
    model: "gemini-2.0-flash"
    timeout: 120  # å‚å•†ç‰¹å®šè¶…æ—¶ï¼Œè¦†ç›–å…¨å±€
  
  kimi:
    api_key: "sk-..."
    model: "moonshot-v1-auto"
  
  qwen:
    api_key: "sk-..."
    model: "qwen-plus"
  
  openai:
    api_key: "sk-..."
    model: "gpt-4o"
    base_url: "https://api.openai.com/v1"  # æ”¯æŒè‡ªå®šä¹‰ä»£ç†åœ°å€
```

### æ–¹å¼äºŒï¼šç¯å¢ƒå˜é‡

```bash
export AIB_DEFAULT_VENDOR="gemini"

# API Key
export AIB_GEMINI_API_KEY="AIza..."
export AIB_KIMI_API_KEY="sk-..."
export AIB_QWEN_API_KEY="sk-..."
export AIB_OPENAI_API_KEY="sk-..."

# è‡ªå®šä¹‰ Base URL (ä¸­è½¬ç«™)
export AIB_OPENAI_BASE_URL="https://api.proxy.com/v1"

# è¶…æ—¶è®¾ç½®
export AIB_GEMINI_TIMEOUT="120"
```

## ğŸ’¡ è¿›é˜¶åŠŸèƒ½

### æ‰¹é‡å¤„ç† (Batch API)

å¯¹äºä¸ç€æ€¥ï¼ˆ24å°æ—¶å†…å®Œæˆï¼‰çš„å¤§æ‰¹é‡ä»»åŠ¡ï¼Œä½¿ç”¨ Batch API å¯èŠ‚çœ **50% æˆæœ¬**ã€‚ç›®å‰æ”¯æŒ Qwen å’Œ Geminiã€‚

```python
from aib.batch import QwenBatchManager

manager = QwenBatchManager(api_key="sk-...")

# æäº¤æ‰¹é‡ä»»åŠ¡
job = manager.submit(
    requests=[
        {"prompt": "åˆ†æç”¨æˆ·è¯„è®º: ..."},
        {"prompt": "ç¿»è¯‘è¿™æ®µè¯: ..."},
        # ... ä¸Šåƒæ¡è¯·æ±‚
    ],
    model="qwen-plus"
)
print(f"ä»»åŠ¡å·²æäº¤ï¼ŒID: {job.id}")

# ... ç­‰å¾…ä¸€æ®µæ—¶é—´å ...

# è·å–ç»“æœ
results = manager.get_results(job.id)
for prompt_id, result in results.items():
    print(f"{prompt_id}: {result}")
```

### é”™è¯¯å¤„ç†

éµå¾ªé€æ˜åŸåˆ™ï¼Œå¦‚æœ API è°ƒç”¨å¤±è´¥ï¼Œåº“ä¼šç›´æ¥æŠ›å‡ºå‚å•† SDK çš„åŸå§‹å¼‚å¸¸ï¼Œè€Œéé€šç”¨çš„å°è£…å¼‚å¸¸ã€‚è¿™æœ‰åŠ©äºä½ æ ¹æ®å…·ä½“é”™è¯¯ç ï¼ˆå¦‚ `rate_limit_exceeded`ï¼‰è¿›è¡Œç²¾ç¡®å¤„ç†ã€‚

```python
try:
    bridge.chat("...")
except Exception as e:
    # è¿™é‡Œçš„ e æ˜¯ openai.APIError / google.api_core.exceptions.GoogleAPICallError ç­‰åŸå§‹å¼‚å¸¸
    print(f"API è°ƒç”¨å¤±è´¥: {e}")
```

## ğŸ“„ License

MIT License
