from __future__ import annotations

from typing import Protocol

from namel3ss.runtime.storage.metadata import PersistenceMetadata

from namel3ss.schema.records import RecordSchema


class Storage(Protocol):
    def begin(self) -> None: ...
    def commit(self) -> None: ...
    def rollback(self) -> None: ...

    def save(self, schema: RecordSchema, record: dict) -> dict: ...
    def find(self, schema: RecordSchema, predicate) -> list[dict]: ...
    def list_records(self, schema: RecordSchema, limit: int = 20) -> list[dict]: ...
    def check_unique(self, schema: RecordSchema, record: dict) -> str | None: ...
    def clear(self) -> None: ...

    def load_state(self) -> dict: ...
    def save_state(self, state: dict) -> None: ...
    def get_metadata(self) -> PersistenceMetadata: ...
