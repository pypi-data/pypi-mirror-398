Metadata-Version: 2.4
Name: liangent
Version: 0.0.11
Summary: A lightweight agent framework
Author: Liang
License: MIT License
        
        Copyright (c) 2025 Lagent Developers
        
        Permission is hereby granted, free of charge, to any person obtaining a copy
        of this software and associated documentation files (the "Software"), to deal
        in the Software without restriction, including without limitation the rights
        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
        copies of the Software, and to permit persons to whom the Software is
        furnished to do so, subject to the following conditions:
        
        The above copyright notice and this permission notice shall be included in all
        copies or substantial portions of the Software.
        
        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
        SOFTWARE.
        
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.10
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fastapi
Requires-Dist: uvicorn
Requires-Dist: sqlalchemy
Requires-Dist: jinja2
Requires-Dist: pydantic
Requires-Dist: pydantic-settings
Requires-Dist: requests
Requires-Dist: python-dotenv
Requires-Dist: openai
Requires-Dist: socksio
Dynamic: license-file

# Lagent: Minimalist Lightweight Agent
# Lagentï¼šæç®€è½»é‡çº§ Agent

> **Slogan**: Minimalist lightweight agent, your first usable agent.
> **Slogan**: æç®€è½»é‡ agentï¼Œä½ çš„ç¬¬ä¸€ä¸ªå¯ç”¨ agentã€‚

[English](#english) | [ä¸­æ–‡](#chinese)

---

<a name="english"></a>
## ğŸ‡¬ğŸ‡§ English Introduction

**Lagent** is a lightweight, extensible, and memory-aware agent framework designed for building LLM-based applications. It is designed to be a **teaching prototype** and a practical solution for **simple tasks**.

Unlike complex frameworks that rely on heavy planning steps, Lagent focuses on solving problems through **forced tool usage constraints** and **dynamic prompt injection**. This approach significantly reduces hallucinations and improves usability for everyday tasks, making it an ideal starting point for developers building their first agent.

### âœ¨ Key Highlights

1.  **ğŸ›¡ï¸ Local Code Sandbox**: 
    *   Safely execute **Python** and **Shell** scripts locally.
    *   **Double Security Guarantee**: Configurable **whitelists** and **blacklists** for Python dependencies and Shell commands ensure that the agent only executes what is safe.
    *   Prevents dangerous operations (e.g., specific file access, network requests) while allowing powerful automation.

2.  **ğŸ“‰ Hallucination Reduction via Dynamic Constraints**:
    *   **Minimum Tool Usage**: You can define a `MIN_TOOL_USE` threshold (e.g., must use at least 1 tool). 
    *   **Dynamic Prompt Injection**: If the agent attempts to answer without meeting the tool usage quota, the system intercepts the response and injects a prompt into the agent's stream, forcing it to "reflect" and use tools to verify facts. This is highly effective for reducing hallucinations in simple tasks.

3.  **ğŸ”§ Custom Tool Registration (No Function Call Required)**:
    *   Register tools using a simple `@tool` decorator.
    *   **Universal Compatibility**: Does *not* rely on the specific "Function Calling" API features of models. The agent parses JSON-like actions from standard text output. This allows even **smaller, less capable models** to use tools effectively, depending on the task difficulty.

4.  **ğŸ’¾ Minimalist SQLite Storage**:
    *   Built-in **SQLite** support for zero-config persistence.
    *   Stores sessions, messages, and logs in a simple, portable local database file.

5.  **ğŸ” High Observability**:
    *   **Full Traceability**: Every stepâ€”thoughts, tool inputs, stdout/stderr outputsâ€”is recorded in SQLite.
    *   **Console streams**: Real-time visibility into the agent's internal state and decision-making process during local runs.
    *   **Debug Logs**: Detailed cost and token usage tracking per step.

6.  **â˜ï¸ Serverless Ready (Function Compute)**:
    *   Comes with a built-in `fc_handler.py`.
    *   Ready to deploy to **Aliyun Function Compute** (or AWS Lambda/Google Cloud Functions) as a stateless backend.

---

### ğŸš€ Getting Started

#### 1. Prerequisites
*   Python 3.10+
*   An OpenAI-compatible API Key

#### 1. Installation
```bash
pip install lagent
```

#### 2. Configuration
Create a `.env` file in your project root:
```env
OPENAI_API_KEY=sk-xxxxxx
OPENAI_BASE_URL=https://api.openai.com/v1
MIN_TOOL_USE=1  # Force agent to use at least 1 tool
MAX_TOOL_USE=15 # Safety limit
DEBUG=True
```

#### 3. Usage Example (Python SDK)
Create a file named `main.py`:
```python
from lagent import Lagent

# Initialize the agent (loads config from .env automatically)
client = Lagent()

query = "Check the local time using python"
print(f"User: {query}")

# Stream the response to see thoughts and tool calls in real-time
print("Agent: ", end="", flush=True)
for event in client.stream(query):
    if event.get("event") == "thought":
        print(f"\n[Thinking] {event.get('content')}", end="", flush=True)
    elif event.get("event") == "final_answer":
        print(f"\n\n{event.get('content')}\n")
```

#### 4. Running the Server (Optional)
If you want to deploy as an API server:
```bash
# Initialize config if needed
lagent init

# Start the server
lagent start
```
*   **API Endpoint**: `http://localhost:8000/api/chat`
*   **Docs**: `http://localhost:8000/docs`

### 5. Custom Tools

Lagent allows you to register your own tools using the `@tool` decorator. 
**IMPORTANT**: You must use Google-style docstrings to define arguments, otherwise the agent may not be able to use them correctly.

```python
from lagent import tool

@tool
def calculate_bmi(weight: float, height: float) -> float:
    """
    Calculate Body Mass Index (BMI).
    
    Args:
        weight: Weight in kilograms (kg).
        height: Height in meters (m).
    """
    return weight / (height * height)
```
---

<a name="chinese"></a>
## ğŸ‡¨ğŸ‡³ ä¸­æ–‡ä»‹ç»

**Lagent** æ˜¯ä¸€ä¸ªè½»é‡çº§ã€å¯æ‰©å±•ä¸”å…·å¤‡è®°å¿†æ„ŸçŸ¥èƒ½åŠ›çš„ Agent æ¡†æ¶ã€‚å®ƒçš„åˆè¡·æ˜¯ä½œä¸º **Agent æ•™å­¦åŸå‹**ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è§£å†³**ç®€å•ä»»åŠ¡**çš„å®æˆ˜åˆ©å™¨ã€‚

ä¸åŒäºé‚£äº›ä¾èµ–ç¹é‡â€œè§„åˆ’ï¼ˆPlanningï¼‰â€æ­¥éª¤çš„å¤æ‚æ¡†æ¶ï¼ŒLagent ä¸“æ³¨äºé€šè¿‡ **å¼ºåˆ¶å·¥å…·è°ƒç”¨** å’Œ **è¿è¡Œæ—¶åŠ¨æ€ Prompt æ³¨å…¥** æ¥è§£å†³é—®é¢˜ã€‚è¿™ç§æ–¹æ³•åœ¨å¤„ç†ç®€å•ä»»åŠ¡æ—¶ï¼Œèƒ½æœ‰æ•ˆå‡å°‘å¤§æ¨¡å‹çš„å¹»è§‰ï¼Œæé«˜å¯ç”¨æ€§ã€‚

**Sloganï¼šæç®€è½»é‡ Agentï¼Œä½ çš„ç¬¬ä¸€ä¸ªå¯ç”¨ Agentã€‚**

### âœ¨ æ ¸å¿ƒäº®ç‚¹

1.  **ğŸ›¡ï¸ æœ¬åœ°ä»£ç æ²™ç®± (Local Code Sandbox)**:
    *   æ”¯æŒé€šè¿‡ Shell æ‰§è¡Œè„šæœ¬æ–‡ä»¶ï¼Œæˆ–ç›´æ¥æ‰§è¡Œ Python ä»£ç ã€‚
    *   **åŒé‡å®‰å…¨ä¿è¯**ï¼šæ²™ç®±æ”¯æŒåˆ†åˆ«è®¾ç½® Python ä¾èµ–çš„ç™½åå•ã€Shell å‘½ä»¤çš„ç™½åå•ä¸é»‘åå•ã€‚
    *   ç¡®ä¿ Agent åœ¨æ‹¥æœ‰å¼ºå¤§èƒ½åŠ›çš„åŒæ—¶ï¼Œä¸ä¼šæ‰§è¡Œå±é™©æ“ä½œï¼ˆå¦‚åˆ é™¤ç³»ç»Ÿæ–‡ä»¶ã€éæ³•çš„ç½‘ç»œè¯·æ±‚ç­‰ï¼‰ã€‚

2.  **ğŸ“‰ åŠ¨æ€ Prompt æ³¨å…¥ä¸åæ€æœºåˆ¶**:
    *   **è‡ªå®šä¹‰æœ€å°è°ƒç”¨æ¬¡æ•°**ï¼šä½ å¯ä»¥è®¾ç½® `MIN_TOOL_USE`ï¼ˆä¾‹å¦‚è‡³å°‘è°ƒç”¨ 1 æ¬¡å·¥å…·ï¼‰ã€‚
    *   **åŠ¨æ€å¹²é¢„**ï¼šå¦‚æœ Agent åœ¨æœªæ»¡è¶³è°ƒç”¨æ¬¡æ•°çš„æƒ…å†µä¸‹è¯•å›¾ç›´æ¥å›ç­”ï¼Œç³»ç»Ÿä¼šæ‹¦æˆªè¯¥æ“ä½œï¼Œå¹¶**åŠ¨æ€æ³¨å…¥ Prompt** åˆ° Agent çš„æ€ç»´æµä¸­ï¼Œå¼ºåˆ¶æ¨¡å‹è¿›è¡Œâ€œåæ€â€å¹¶è°ƒç”¨å·¥å…·éªŒè¯ä¿¡æ¯ã€‚è¿™æ˜¯è§£å†³ç®€å•ä»»åŠ¡ä¸­å¹»è§‰é—®é¢˜çš„æ€æ‰‹é”ã€‚

3.  **ğŸ”§ ä½é—¨æ§›è‡ªå®šä¹‰å·¥å…·æ³¨å†Œ**:
    *   é€šè¿‡ç®€å•çš„ `@tool` è£…é¥°å™¨å³å¯æ³¨å†Œå·¥å…·ã€‚
    *   **æ— éœ€ Function Call ç‰¹æ€§æ”¯æŒ**ï¼šå·¥å…·è°ƒç”¨æœºåˆ¶ä¸ä¾èµ–å¤§æ¨¡å‹è‡ªèº«çš„ Function Calling ç‰¹æ€§ã€‚Agent èƒ½å¤Ÿä»æ™®é€šæ–‡æœ¬ä¸­è§£æå‡ºå·¥å…·è°ƒç”¨æŒ‡ä»¤ã€‚è¿™æ„å‘³ç€**å‚æ•°é‡è¾ƒå°çš„æ¨¡å‹**ä¹Ÿå¯ä»¥ä¾æ®æ­¤ç‰¹æ€§ä½¿ç”¨å·¥å…·ï¼Œæå¤§åœ°é™ä½äº†æ¨¡å‹é—¨æ§›ï¼ˆå…·ä½“å¯ç”¨æ€§å–å†³äºä»»åŠ¡éš¾åº¦ï¼‰ã€‚

4.  **ğŸ’¾ SQLite æç®€æ•°æ®åº“**:
    *   é»˜è®¤é›†æˆ **SQLite**ï¼Œæ— éœ€é…ç½®å¤æ‚çš„æ•°æ®åº“æœåŠ¡ã€‚
    *   è½»ä¾¿ã€æ˜“è¿ç§»ï¼Œé€‚åˆæœ¬åœ°å¼€å‘å’Œè½»é‡çº§åº”ç”¨ã€‚

5.  **ğŸ” é«˜å¯è§‚æµ‹æ€§**:
    *   **å…¨é“¾è·¯å›æº¯**ï¼šAgent çš„æ¯ä¸€æ­¥æ“ä½œï¼ˆæ€è€ƒã€å·¥å…·å…¥å‚ã€æ‰§è¡Œç»“æœï¼‰å‡å®Œæ•´çš„è®°å½•åœ¨ SQLite ä¸­ã€‚
    *   **ç›´è§‚æ§åˆ¶å°**ï¼šæœ¬åœ°è¿è¡Œæ—¶ï¼Œæ§åˆ¶å°ä¼šå®æ—¶æ‰“å° Agent çš„æ€ç»´è¿‡ç¨‹å’Œæ‰§è¡Œç»†èŠ‚ï¼Œè°ƒè¯•æä¸ºæ–¹ä¾¿ã€‚

6.  **â˜ï¸ å‡½æ•°è®¡ç®—å‹å¥½ (Serverless)**:
    *   è‡ªå¸¦ `fc_handler.py`ï¼Œå¼€ç®±å³ç”¨ã€‚
    *   å®Œç¾é€‚é… **é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—** ç­‰ Serverless å¹³å°ï¼Œè½»æ¾å®ç°ä½æˆæœ¬ã€é«˜å¼¹æ€§çš„äº‘ç«¯éƒ¨ç½²ã€‚

---

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### 1. ç¯å¢ƒå‡†å¤‡
*   Python 3.10+
*   OpenAI å…¼å®¹çš„ API Key

#### 1. å®‰è£…
```bash
pip install lagent
```

#### 2. é…ç½®
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š
```env
OPENAI_API_KEY=sk-xxxxxx
OPENAI_BASE_URL=https://api.openai.com/v1
MIN_TOOL_USE=1  # å¼ºåˆ¶è¦æ±‚ Agent è‡³å°‘ä½¿ç”¨ 1 æ¬¡å·¥å…·
MAX_TOOL_USE=15 # æœ€å¤§æ­¥æ•°é™åˆ¶
DEBUG=True
```

#### 3. è°ƒç”¨ç¤ºä¾‹ (Python SDK)
åˆ›å»ºä¸€ä¸ª `main.py` æ–‡ä»¶ï¼š
```python
from lagent import Lagent

# åˆå§‹åŒ– Agent (è‡ªåŠ¨åŠ è½½ .env é…ç½®)
client = Lagent()

query = "å¸®æˆ‘æŸ¥çœ‹ä¸€ä¸‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶"
print(f"User: {query}")

# æµå¼è·å–å“åº”ï¼Œå®æ—¶æŸ¥çœ‹æ€è€ƒè¿‡ç¨‹å’Œå·¥å…·è°ƒç”¨
print("Agent: ", end="", flush=True)
for event in client.stream(query):
    if event.get("event") == "thought":
        print(f"\n[Thinking] {event.get('content')}", end="", flush=True)
    elif event.get("event") == "final_answer":
        print(f"\n\n{event.get('content')}\n")
```

#### 4. å¯åŠ¨ API æœåŠ¡ (å¯é€‰)
å¦‚æœä½ å¸Œæœ›å°†å…¶éƒ¨ç½²ä¸º API æœåŠ¡ï¼š
```bash
# åˆå§‹åŒ–é…ç½®
lagent init

# å¯åŠ¨æœåŠ¡
lagent start
```
*   **API æ¥å£**: `http://localhost:8000/api/chat`
*   **æ¥å£æ–‡æ¡£**: `http://localhost:8000/docs`

### 6. è‡ªå®šä¹‰å·¥å…·

Lagent å…è®¸ä½ é€šè¿‡ `@tool` è£…é¥°å™¨æ³¨å†Œè‡ªå®šä¹‰å·¥å…·ã€‚ 
**é‡è¦æç¤º**ï¼šå¿…é¡»ä½¿ç”¨ Google-style docstrings æ¥å®šä¹‰å‚æ•°ï¼Œå¦åˆ™ Agent å¯èƒ½æ— æ³•æ­£ç¡®ä½¿ç”¨å®ƒä»¬ã€‚

```python
from lagent import tool

@tool
def calculate_bmi(weight: float, height: float) -> float:
    """
    è®¡ç®— Body Mass Index (BMI)ã€‚
    
    Args:
        weight: ä½“é‡ï¼ˆå…¬æ–¤ï¼‰ã€‚
        height: èº«é«˜ï¼ˆç±³ï¼‰ã€‚
    """
    return weight / (height * height)
```
