"""Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT."""

from __future__ import annotations
from cribl_control_plane import models, utils
from cribl_control_plane.types import BaseModel
from cribl_control_plane.utils import validate_open_enum
from enum import Enum
import pydantic
from pydantic import field_serializer
from pydantic.functional_validators import PlainValidator
from typing import Optional
from typing_extensions import Annotated, NotRequired, TypedDict


class PipelineFunctionNotifyID(str, Enum):
    r"""Function ID"""

    NOTIFY = "notify"


class PipelineFunctionNotifyTriggerType(str, Enum, metaclass=utils.OpenEnumMeta):
    r"""Type of the trigger condition. custom applies a kusto expression over the results, and results count applies a comparison over results count"""

    # Where
    CUSTOM = "custom"
    # Count of Results
    RESULTS_COUNT = "resultsCount"


class PipelineFunctionNotifyCountComparator(str, Enum, metaclass=utils.OpenEnumMeta):
    r"""Operation to be applied over the results count"""

    # greater than
    GREATER_THAN_ = ">"
    # less than
    LESS_THAN_ = "<"
    # equals
    EQUAL_EQUAL_EQUAL_ = "==="
    # not equal to
    NOT_EQUAL_EQUAL_ = "!=="
    # greater than or equal to
    GREATER_THAN_EQUAL_ = ">="
    # less than or equal to
    LESS_THAN_EQUAL_ = "<="


class NotifyConfigurationTypedDict(TypedDict):
    search_id: str
    r"""Id of the search this function is running on."""
    saved_query_id: str
    r"""Id of the saved query"""
    search_url: str
    r"""Url of the search results"""
    auth_token: str
    r"""Auth token for sending notification messages"""
    messages_endpoint: str
    r"""System messages api endpoint"""
    group: NotRequired[str]
    r"""Group the notification belongs to"""
    notification_id: NotRequired[str]
    r"""Workspace within the deployment to send the search results to."""
    trigger: NotRequired[str]
    r"""Js expression that filters events, a greater than 'Trigger Count' events will trigger the notification"""
    trigger_type: NotRequired[PipelineFunctionNotifyTriggerType]
    r"""Type of the trigger condition. custom applies a kusto expression over the results, and results count applies a comparison over results count"""
    trigger_comparator: NotRequired[PipelineFunctionNotifyCountComparator]
    r"""Operation to be applied over the results count"""
    trigger_count: NotRequired[float]
    r"""How many results that match trigger the condition"""
    results_limit: NotRequired[float]
    r"""Number of results to include in the notification event"""
    message: NotRequired[str]
    r"""Message content template, available fields: searchId, resultSet, savedQueryId, notificationId, searchResultsUrl"""
    tenant_id: NotRequired[str]
    r"""Current tenant id"""


class NotifyConfiguration(BaseModel):
    search_id: Annotated[str, pydantic.Field(alias="searchId")]
    r"""Id of the search this function is running on."""

    saved_query_id: Annotated[str, pydantic.Field(alias="savedQueryId")]
    r"""Id of the saved query"""

    search_url: Annotated[str, pydantic.Field(alias="searchUrl")]
    r"""Url of the search results"""

    auth_token: Annotated[str, pydantic.Field(alias="authToken")]
    r"""Auth token for sending notification messages"""

    messages_endpoint: Annotated[str, pydantic.Field(alias="messagesEndpoint")]
    r"""System messages api endpoint"""

    group: Optional[str] = "default"
    r"""Group the notification belongs to"""

    notification_id: Annotated[
        Optional[str], pydantic.Field(alias="notificationId")
    ] = "main"
    r"""Workspace within the deployment to send the search results to."""

    trigger: Optional[str] = None
    r"""Js expression that filters events, a greater than 'Trigger Count' events will trigger the notification"""

    trigger_type: Annotated[
        Annotated[
            Optional[PipelineFunctionNotifyTriggerType],
            PlainValidator(validate_open_enum(False)),
        ],
        pydantic.Field(alias="triggerType"),
    ] = None
    r"""Type of the trigger condition. custom applies a kusto expression over the results, and results count applies a comparison over results count"""

    trigger_comparator: Annotated[
        Annotated[
            Optional[PipelineFunctionNotifyCountComparator],
            PlainValidator(validate_open_enum(False)),
        ],
        pydantic.Field(alias="triggerComparator"),
    ] = None
    r"""Operation to be applied over the results count"""

    trigger_count: Annotated[Optional[float], pydantic.Field(alias="triggerCount")] = 0
    r"""How many results that match trigger the condition"""

    results_limit: Annotated[Optional[float], pydantic.Field(alias="resultsLimit")] = 50
    r"""Number of results to include in the notification event"""

    message: Optional[str] = None
    r"""Message content template, available fields: searchId, resultSet, savedQueryId, notificationId, searchResultsUrl"""

    tenant_id: Annotated[Optional[str], pydantic.Field(alias="tenantId")] = None
    r"""Current tenant id"""

    @field_serializer("trigger_type")
    def serialize_trigger_type(self, value):
        if isinstance(value, str):
            try:
                return models.PipelineFunctionNotifyTriggerType(value)
            except ValueError:
                return value
        return value

    @field_serializer("trigger_comparator")
    def serialize_trigger_comparator(self, value):
        if isinstance(value, str):
            try:
                return models.PipelineFunctionNotifyCountComparator(value)
            except ValueError:
                return value
        return value


class PipelineFunctionNotifyTypedDict(TypedDict):
    id: PipelineFunctionNotifyID
    r"""Function ID"""
    conf: NotifyConfigurationTypedDict
    filter_: NotRequired[str]
    r"""Filter that selects data to be fed through this Function"""
    description: NotRequired[str]
    r"""Simple description of this step"""
    disabled: NotRequired[bool]
    r"""If true, data will not be pushed through this function"""
    final: NotRequired[bool]
    r"""If enabled, stops the results of this Function from being passed to the downstream Functions"""
    group_id: NotRequired[str]
    r"""Group ID"""


class PipelineFunctionNotify(BaseModel):
    id: PipelineFunctionNotifyID
    r"""Function ID"""

    conf: NotifyConfiguration

    filter_: Annotated[Optional[str], pydantic.Field(alias="filter")] = "true"
    r"""Filter that selects data to be fed through this Function"""

    description: Optional[str] = None
    r"""Simple description of this step"""

    disabled: Optional[bool] = None
    r"""If true, data will not be pushed through this function"""

    final: Optional[bool] = None
    r"""If enabled, stops the results of this Function from being passed to the downstream Functions"""

    group_id: Annotated[Optional[str], pydantic.Field(alias="groupId")] = None
    r"""Group ID"""
