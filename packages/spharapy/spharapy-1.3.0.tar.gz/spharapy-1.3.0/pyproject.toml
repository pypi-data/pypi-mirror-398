# =============================================================================
# SpharaPy packaging configuration (PEP 621 + setuptools)
#
# This file is the single source of truth for:
#   - build backend and build tools
#   - project metadata (name, version, description, dependencies, URLs, license)
#   - packaging options (which packages / data files to include)
#   - tooling configuration (ruff, mypy)
#
# Notes for future maintenance:
#   * If you change supported Python versions, update:
#       - [project].requires-python
#       - [project].classifiers
#   * If you add new runtime dependencies, update:
#       - [project].dependencies
#   * If you add optional/extra features, introduce:
#       - [project.optional-dependencies]
#
# Developer notes (release workflow):
#   1. Create / activate a fresh virtual environment.
#      python -m venv .venv && source .venv/bin/activate
#
#   2. Install development tools.
#      python -m pip install -U pip build twine ruff mypy pytest pytest-cov
#
#   3. Run code quality checks.
#      ruff check .
#      mypy spharapy
#      pytest -q
#
#   4. Build the documentation (HTML + linkcheck).
#      sphinx-build -nW -b html docs docs/_build/html
#      sphinx-build -b linkcheck docs docs/_build/linkcheck#

#   5. Build distributions.
#      python -m build
#
#   6. Check distributions (important before uploading to PyPI).
#      twine check dist/*
#
#   7. Upload to PyPI (when ready).
#      twine upload dist/*
#
# =============================================================================

# ---------------------------------------------------------------------------
# Build system configuration (PEP 517)
# ---------------------------------------------------------------------------
[build-system]
requires = [
  "setuptools>=77",
  "wheel",
  "build",
]
build-backend = "setuptools.build_meta"

# ---------------------------------------------------------------------------
# Core project metadata (PEP 621)
# ---------------------------------------------------------------------------
[project]
name = "spharapy"
version = "1.3.0"  # Keep in sync with spharapy.__version__ (if defined)
description = "SPHARA-based spatial harmonic analysis and filtering"

# Long description shown on PyPI. This must be valid plain ReST (no Sphinx roles).
readme = "README.rst"

requires-python = ">=3.10"

license = "BSD-3-Clause"
license-files = ["LICENSE*"]

authors = [
  { name = "Uwe Graichen", email = "uwe.graichen@kl.ac.at" },
]

classifiers = [
  "Programming Language :: Python :: 3 :: Only",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
]

dependencies = [
  "numpy>=1.23.5",
  "scipy>=1.14",
  "matplotlib>=3.6",
]

# ---------------------------------------------------------------------------
# Project URLs (PyPI side bar)
# ---------------------------------------------------------------------------
[project.urls]
Homepage = "https://gitlab.com/uwegra/spharapy"
Documentation = "https://spharapy.readthedocs.io/"
Tracker = "https://gitlab.com/uwegra/spharapy/-/issues"

# ---------------------------------------------------------------------------
# Setuptools configuration
# ---------------------------------------------------------------------------
[tool.setuptools]
packages = { find = { include = ["spharapy*"] } }

[tool.setuptools.package-data]
"spharapy" = [
  "datasets/data/*.csv",
  "datasets/descr/*.rst",
]

# ---------------------------------------------------------------------------
# Ruff (linter + formatter)
# ---------------------------------------------------------------------------
[tool.ruff]
line-length = 100
target-version = "py310"

exclude = [
  "examples/**",
  "docs/_build/**",
]

[tool.ruff.lint]
select = ["E", "F", "I", "UP", "B", "W"]
ignore = [
  "E203",
  "E501",
]

[tool.ruff.lint.isort]
known-first-party = ["spharapy"]

[tool.ruff.format]
# Using Ruff defaults.

# ---------------------------------------------------------------------------
# MyPy (static type checking)
# ---------------------------------------------------------------------------
[tool.mypy]
python_version = "3.12"
files = ["spharapy"]
exclude = '(^|/)(examples|docs/_build)(/|$)'

check_untyped_defs = true
no_implicit_optional = true
warn_unused_ignores = true

[[tool.mypy.overrides]]
module = ["spharapy.examples.*"]
ignore_errors = true
