"use strict";(self.webpackChunkjupyterlab_nb_venv_kernels_ui_extension=self.webpackChunkjupyterlab_nb_venv_kernels_ui_extension||[]).push([[509],{509:(e,n,t)=>{t.r(n),t.d(n,{default:()=>E});var r=t(780),o=t(366),a=t(690),i=t(827),s=t(907),l=t(292),c=t(247);const d="launcher:show-kernel-in-file-browser",u="launcher:open-terminal-at-kernel",v="launcher:unregister-venv-kernel",m="launcher:remove-venv-environment",h="nb_venv_kernels:refresh";function p(e){const n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.gap="12px",n.style.padding="8px 0",n.innerHTML=`\n    <div style="\n      width: 24px;\n      height: 24px;\n      border: 3px solid var(--jp-border-color2);\n      border-top-color: var(--jp-brand-color1);\n      border-radius: 50%;\n      animation: launcher-ext-spin 1s linear infinite;\n    "></div>\n    <span>${e}</span>\n    <style>\n      @keyframes launcher-ext-spin {\n        to { transform: rotate(360deg); }\n      }\n    </style>\n  `;const t=new c.Widget({node:n}),r=new i.Dialog({title:"Please Wait",body:t,buttons:[]});return r.launch(),r}let g=null,w=!1;async function b(e){const n=s.ServerConnection.makeSettings(),t=l.URLExt.join(n.baseUrl,"api","kernel-path",encodeURIComponent(e));try{const e=await s.ServerConnection.makeRequest(t,{},n);if(!e.ok){const n=await e.json();return console.warn(`Failed to get kernel path: ${n.error}`),null}return await e.json()}catch(e){return console.error("Error fetching kernel path:",e),null}}async function f(e){const n=await async function(){const e=s.ServerConnection.makeSettings(),n=l.URLExt.join(e.baseUrl,"nb-venv-kernels","environments");try{const t=await s.ServerConnection.makeRequest(n,{},e);return t.ok?await t.json():(console.warn("nb_venv_kernels API not available"),null)}catch(e){return console.debug("nb_venv_kernels extension not installed:",e),null}}();if(!n)return null;for(const t of n.environments){if("conda"===t.type)continue;const n=t.name||"",r=t.custom_name||"";if(n&&e.includes(n)||r&&e.includes(r))return t}return null}async function k(e){const n=s.ServerConnection.makeSettings(),t=l.URLExt.join(n.baseUrl,"nb-venv-kernels","unregister");try{const r=await s.ServerConnection.makeRequest(t,{method:"POST",body:JSON.stringify({path:e})},n),o=await r.json();return r.ok?{success:!0,message:o.message}:{success:!1,error:o.error||"Failed to unregister kernel"}}catch(e){return console.error("Error unregistering kernel:",e),{success:!1,error:`Network error: ${e}`}}}function y(e,n){const t=e.replace(/\/+$/,""),r=function(e,n){if(!e.startsWith("~"))return e;const t=n.match(/^(\/(?:home|Users)\/[^/]+)/);if(!t)return e;const r=t[1];return"~"===e?r:e.startsWith("~/")?r+e.slice(1):e}(n,e).replace(/\/+$/,"");if(t===r)return"";const o=r+"/";return t.startsWith(o)?t.slice(o.length):null}const E={id:"jupyterlab_nb_venv_kernels_ui_extension:plugin",description:"Right-click kernel launcher cards to navigate file browser to kernel's location or open terminal there",autoStart:!0,requires:[r.IDefaultFileBrowser],optional:[o.ILauncher,a.ITerminalTracker],activate:(e,n,t,r)=>{console.log("JupyterLab extension jupyterlab_nb_venv_kernels_ui_extension is activated!");const{commands:o}=e,a=l.PageConfig.getOption("serverRoot");document.addEventListener("contextmenu",e=>{const n=e.target;n&&n.closest(".jp-LauncherCard")&&(g=function(e){const n=e.closest(".jp-LauncherCard");if(!n)return null;const t=n.querySelector(".jp-LauncherCard-label");return t&&t.textContent?t.textContent.trim():n.title?n.title:null}(n))},!0),async function(){const e=s.ServerConnection.makeSettings(),n=l.URLExt.join(e.baseUrl,"nb-venv-kernels","environments");try{return(await s.ServerConnection.makeRequest(n,{},e)).ok}catch(e){return console.debug("nb_venv_kernels extension not installed:",e),!1}}().then(e=>{w=e,e&&console.log("nb_venv_kernels extension detected - unregister feature enabled")}),o.addCommand(d,{label:"Show in File Browser",caption:"Navigate file browser to kernel's directory",isEnabled:()=>null!==g,execute:async()=>{if(!g)return void await(0,i.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await b(g);if(!e)return void await(0,i.showErrorMessage)("Kernel Not Found",`Could not find path information for kernel "${g}".`);if(e.is_global_conda){const n=document.createElement("div");n.innerHTML=`\n            <p>Global conda environments are not associated with any specific project location.</p>\n            <p>The environment <strong>${g}</strong> is installed at:</p>\n            <p><code>${e.env_path||e.resource_dir}</code></p>\n          `;const t=new c.Widget({node:n});return void await(0,i.showDialog)({title:"Global Conda Environment",body:t,buttons:[i.Dialog.okButton()]})}const t=e.env_path||e.resource_dir,r=y(t,a),o=null===r?"":r;try{const e=""===o?"/":"/"+o;await n.model.cd(e)}catch(e){console.error("Failed to navigate file browser:",e),await(0,i.showErrorMessage)("Navigation Error",`Failed to navigate to: ${t}\nError: ${e}`)}}}),o.addCommand(u,{label:"Open Terminal at Location",caption:"Open a terminal at the kernel's directory",isEnabled:()=>null!==g&&null!==r,execute:async()=>{if(!g)return void await(0,i.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await b(g);if(!e)return void await(0,i.showErrorMessage)("Kernel Not Found",`Could not find path information for kernel "${g}".`);if(e.is_global_conda){const n=document.createElement("div");n.innerHTML=`\n            <p>Global conda environments are not associated with any specific project location.</p>\n            <p>The environment <strong>${g}</strong> is installed at:</p>\n            <p><code>${e.env_path||e.resource_dir}</code></p>\n          `;const t=new c.Widget({node:n});return void await(0,i.showDialog)({title:"Global Conda Environment",body:t,buttons:[i.Dialog.okButton()]})}const n=e.env_path||e.resource_dir,t=y(n,a),r=null===t?"":t;try{await o.execute("terminal:create-new",{cwd:r})}catch(e){console.error("Failed to open terminal:",e),await(0,i.showErrorMessage)("Terminal Error",`Failed to open terminal at: ${n}\nError: ${e}`)}}}),o.addCommand(v,{label:"Unregister Kernel",caption:"Remove this kernel from nb_venv_kernels registry",isEnabled:()=>null!==g&&w,isVisible:()=>w,execute:async()=>{if(!g)return void await(0,i.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await f(g);if(!e)return void await(0,i.showErrorMessage)("Cannot Unregister",`"${g}" is not managed by nb_venv_kernels.`);const n=p(`Unregistering kernel "${e.name}"...`);try{const t=await k(e.path);if(n.dispose(),t.success){console.log(`Kernel unregistered: ${e.path}`),await o.execute(h).catch(()=>{});const n=new c.Widget,t=document.createElement("p");t.textContent=`Successfully unregistered "${e.name}" (${e.path}).`;const r=document.createElement("p");r.textContent=`To re-register, run: nb_venv_kernels register ${e.path}`,n.node.appendChild(t),n.node.appendChild(r),await(0,i.showDialog)({title:"Kernel Unregistered",body:n,buttons:[i.Dialog.okButton()]})}else await(0,i.showErrorMessage)("Unregister Failed",`Failed to unregister kernel: ${t.error}`)}catch(e){n.dispose(),await(0,i.showErrorMessage)("Unregister Failed",`An unexpected error occurred: ${e}`)}}}),o.addCommand(m,{label:"Remove Environment (dangerous)",caption:"Physically remove the .venv folder containing this environment",isEnabled:()=>null!==g&&w,isVisible:()=>w,execute:async()=>{if(!g)return void await(0,i.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await f(g);if(!e)return void await(0,i.showErrorMessage)("Cannot Remove",`"${g}" is not managed by nb_venv_kernels.`);if(!(n=e.path).includes("/.venv")&&!n.includes("\\.venv")){const n=new c.Widget,t=document.createElement("p");t.textContent=`"${e.name}" is not a local .venv environment.`;const r=document.createElement("p");return r.textContent="Only local environments (with .venv in their path) can be removed.",n.node.appendChild(t),n.node.appendChild(r),void await(0,i.showDialog)({title:"Cannot Remove",body:n,buttons:[i.Dialog.okButton()]})}var n;const t=new c.Widget,r=document.createElement("p");r.textContent=`Are you sure you want to permanently remove virtual environment "${e.name}"?`;const d=document.createElement("p");d.textContent=`This will delete: ${e.path}`;const u=document.createElement("p");if(u.style.fontWeight="bold",u.textContent="This action cannot be undone!",t.node.appendChild(r),t.node.appendChild(d),t.node.appendChild(u),!(await(0,i.showDialog)({title:"Remove Environment",body:t,buttons:[i.Dialog.cancelButton(),i.Dialog.warnButton({label:"Remove"})]})).button.accept)return;const v=p(`Removing environment "${e.name}"...`);try{const n=await k(e.path);if(!n.success)return v.dispose(),void await(0,i.showErrorMessage)("Remove Failed",`Failed to unregister kernel before removal: ${n.error}`);const t=await async function(e,n){const t=s.ServerConnection.makeSettings();let r=null;if(e.startsWith("/")){if(r=y(e,n),null===r){if(console.debug(`Path conversion failed: dirPath="${e}", serverRoot="${n}"`),!n||"~"===n||""===n){const n=e.match(/^\/(?:home|Users)\/[^/]+\/(.+)$/);n&&(r=n[1],console.debug(`Using home-relative fallback path: ${r}`))}if(null===r)return{success:!1,error:`Environment path "${e}" is outside the workspace (root: "${n}") and cannot be removed.`}}}else r=e,console.debug(`Path is already relative: ${r}`);const o=l.URLExt.join(t.baseUrl,"api","contents",r);try{const e=await s.ServerConnection.makeRequest(o,{method:"DELETE"},t);if(!e.ok){const n=await e.text();return{success:!1,error:`Server error: ${e.status} ${n}`}}return{success:!0}}catch(e){return console.error("Error removing directory:",e),{success:!1,error:`Network error: ${e}`}}}(e.path,a);v.dispose(),t.success?(console.log(`Environment removed: ${e.path}`),await o.execute(h).catch(()=>{}),await(0,i.showDialog)({title:"Environment Removed",body:`Successfully removed "${e.name}".`,buttons:[i.Dialog.okButton()]})):await(0,i.showErrorMessage)("Remove Failed",`Kernel was unregistered but failed to remove directory: ${t.error}`)}catch(e){v.dispose(),await(0,i.showErrorMessage)("Remove Failed",`An unexpected error occurred: ${e}`)}}}),console.log(`Commands registered: ${d}, ${u}, ${v}, ${m}`)}}}}]);