# Copyright (c) Meta Platforms, Inc. and affiliates.
FROM python:3.12-alpine

# Create directories
RUN mkdir -p /logs /etc/ssl/certs /etc/ssl/private

# Copy pre-generated certificate and key
COPY server.crt /etc/ssl/certs/analytics-init.telemetry-cdn.com.crt
COPY server.key /etc/ssl/private/analytics-init.telemetry-cdn.com.key

# Set proper permissions
RUN chmod 644 /etc/ssl/certs/analytics-init.telemetry-cdn.com.crt && \
    chmod 600 /etc/ssl/private/analytics-init.telemetry-cdn.com.key

# Copy the server script
COPY server.py /server.py

# Make it executable
RUN chmod +x /server.py

# Expose the HTTPS server port
EXPOSE 443

# Run the server
CMD ["python3", "/server.py"]
