Metadata-Version: 2.4
Name: get_nhanes
Version: 0.1.2
Summary: A Python package for processing NHANES data
Home-page: https://github.com/wqlttt/getNhanes
Author: wqlt
Author-email: P2415627@mpu.edu.mo
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.6
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pandas
Requires-Dist: numpy
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

<div align="center">

# get_nhanes

**NHANES Data Processing Toolkit / NHANES æ•°æ®å¤„ç†å·¥å…·åŒ…**

[English](#english) | [ä¸­æ–‡](#chinese)

</div>

---

<a name="english"></a>

# English

`get_nhanes` is a Python toolkit designed for efficient processing and calculation of **NHANES** (National Health and Nutrition Examination Survey) data. It encapsulates logic for complex data extraction, cleaning, and merging, and includes built-in automated calculation models for various common clinical health metrics.

## ğŸ“¦ Installation

1. Clone the repository locally:
    ```bash
    git clone https://github.com/wqlttt/getNhanes.git
    cd getNhanes
    ```

2. Install the package and dependencies:
    ```bash
    pip install -e .
    ```

## âš™ï¸ Configuration

Before usage, you need to configure the storage path for your raw NHANES data. The directory structure must follow this format:

**Directory Structure Requirements**:
```text
/path/to/NHANES/
â”œâ”€â”€ 1999-2000
â”‚   â”œâ”€â”€ Demographics/tsv/*.tsv
â”‚   â”œâ”€â”€ Dietary/tsv/*.tsv
â”‚   â”œâ”€â”€ Examination/tsv/*.tsv
â”‚   â”œâ”€â”€ Laboratory/tsv/*.tsv
â”‚   â””â”€â”€ Questionnaire/tsv/*.tsv
â”œâ”€â”€ 2001-2002
    ...
```

**Setting the Data Path**:
```python
from get_nhanes import config

# Set and save the base path (only need to run once; config is persisted)
config.set_base_path("/path/to/your/NHANES_dataset")
```

## ğŸš€ Core Features

### 1. Basic Data Extraction (`get_nhanes_data`)

`get_nhanes_data` is the core function for general-purpose data extraction.

```python
from get_nhanes import get_nhanes_data

# Extract Triglycerides data (prefix TRIGLY) for years 2007-2010
df = get_nhanes_data(
    years=['2007-2008', '2009-2010'],
    metric_prefix='TRIGLY',    # File name prefix
    features=['seqn', 'LBXTR'], # Columns to extract (must include seqn)
    merge_output=True          # Whether to merge output into a single CSV
)

print(df.head())
```

### 2. Built-in Calculated Metrics (`coreCalculated`)

`get_nhanes` includes calculation modules for various complex clinical metrics. You can directly call the `calculation_*` function of each module to generate result CSVs.

**Supported Metrics**:

| Module | Full Name |
| :--- | :--- |
| **AIP** | Atherogenic index of plasma |
| **BMI** | Body mass index |
| **BRI** | Body roundness index |
| **CKM** | Cardiovascular-Kidney-Metabolic (CKM) Syndrome |
| **CVD10** | CVD 10-year Risk |
| **eGFR** | Estimated glomerular filtration rate |
| **FIB-4** | Fibrosis-4 index |
| **HALP** | Hemoglobin-albumin-lymphocyte-platelet index |
| **HRR** | Hemoglobin-to-red cell distribution width ratio |
| **MAR** | Monocyte-to-albumin ratio |
| **NLR** | Neutrophil-to-lymphocyte ratio |
| **NPAR** | Neutrophil percentage-to-albumin ratio |
| **RAR** | Red cell distribution width-to-albumin ratio |
| **SBP** | Systolic Blood Pressure |
| **SII** | Systemic immune-inflammation index |
| **TyG** | Triglyceride-glucose index |
| **TyG-BMI**| TyG-body mass index |
| **UHR** | Uric acid-to-high-density lipoprotein cholesterol ratio |
| **VAI** | Visceral adiposity index |
| **PhenoAge**| Phenotypic Age |

**Usage Example (Calculate BMI)**:

```python
from get_nhanes.coreCalculated import BMICalculated

# Calculate and save BMI results
BMICalculated.calculation_bmi(save_path="./results/")
```

### 3. Covariate Processing (`getCovariates`)

Provides standardized extraction and processing for covariates, including age, gender, race, education, marital status, income, smoking, and alcohol consumption.

```python
from get_nhanes.getCovariates import covariates

# Calculate standard covariate set
covariates.calculation_covariates(save_path="./results/")
```

## ğŸ› ï¸ Advanced Usage

### Automatic Missing Value Handling
`get_nhanes_data` automatically handles `seqn` formatting issues and supports the `strict_features=False` parameter to fill missing year columns with `NaN`.

### Custom Calculation Extensions
All calculation modules follow the `fit_*` (extraction and cleaning) and `calculation_*` (calculation and saving) design pattern, making them easy to read and extend.

## ğŸ“„ License
MIT License

---

<a name="chinese"></a>

# ä¸­æ–‡ (Chinese)

`get_nhanes` æ˜¯ä¸€ä¸ªç”¨äºé«˜æ•ˆå¤„ç†å’Œè®¡ç®— **NHANES** (National Health and Nutrition Examination Survey) æ•°æ®çš„ Python å·¥å…·åŒ…ã€‚å®ƒå°è£…äº†å¤æ‚çš„æ•°æ®æå–ã€æ¸…æ´—å’Œåˆå¹¶é€»è¾‘ï¼Œå¹¶å†…ç½®äº†å¤šç§å¸¸è§ä¸´åºŠå¥åº·æŒ‡æ ‡çš„è‡ªåŠ¨è®¡ç®—æ¨¡å‹ã€‚

## ğŸ“¦ å®‰è£…

1. å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°ï¼š
    ```bash
    git clone https://github.com/wqlttt/getNhanes.git
    cd getNhanes
    ```

2. å®‰è£…ä¾èµ–åŒ…ï¼š
    ```bash
    pip install -e .
    ```

## âš™ï¸ é…ç½®

åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œéœ€è¦è®¾ç½® NHANES åŸå§‹æ•°æ®çš„å­˜å‚¨è·¯å¾„ã€‚æ•°æ®ç›®å½•ç»“æ„éœ€éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š

**ç›®å½•ç»“æ„è¦æ±‚**:
```text
/path/to/NHANES/
â”œâ”€â”€ 1999-2000
â”‚   â”œâ”€â”€ Demographics/tsv/*.tsv
â”‚   â”œâ”€â”€ Dietary/tsv/*.tsv
â”‚   â”œâ”€â”€ Examination/tsv/*.tsv
â”‚   â”œâ”€â”€ Laboratory/tsv/*.tsv
â”‚   â””â”€â”€ Questionnaire/tsv/*.tsv
â”œâ”€â”€ 2001-2002
    ...
```

**è®¾ç½®æ•°æ®è·¯å¾„**:
```python
from get_nhanes import config

# è®¾ç½®å¹¶ä¿å­˜åŸºç¡€è·¯å¾„ï¼ˆåªéœ€è¿è¡Œä¸€æ¬¡ï¼Œé…ç½®ä¼šè‡ªåŠ¨æŒä¹…åŒ–ï¼‰
config.set_base_path("/path/to/your/NHANES_dataset")
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. åŸºç¡€æ•°æ®æå– (`get_nhanes_data`)

`get_nhanes_data` æ˜¯æœ€æ ¸å¿ƒçš„é€šç”¨æ•°æ®æå–å‡½æ•°ã€‚

```python
from get_nhanes import get_nhanes_data

# æå– 2007-2010 å¹´çš„ç”˜æ²¹ä¸‰é…¯æ•°æ® (Triglycerides - å‰ç¼€ TRIGLY)
df = get_nhanes_data(
    years=['2007-2008', '2009-2010'],
    metric_prefix='TRIGLY',    # æ–‡ä»¶åå‰ç¼€
    features=['seqn', 'LBXTR'], # éœ€è¦æå–çš„åˆ— (å¿…é¡»åŒ…å« seqn)
    merge_output=True          # æ˜¯å¦åˆå¹¶è¾“å‡ºä¸ºä¸€ä¸ª CSV
)

print(df.head())
```

### 2. å†…ç½®è®¡ç®—æŒ‡æ ‡ (`coreCalculated`)

`get_nhanes` å†…ç½®äº†å¤šç§å¤æ‚ä¸´åºŠæŒ‡æ ‡çš„è®¡ç®—æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨å„ä¸ªæ¨¡å—çš„ `calculation_*` å‡½æ•°ç”Ÿæˆç»“æœ CSVã€‚

**æ”¯æŒçš„è®¡ç®—æŒ‡æ ‡**:

| æ¨¡å—å | æŒ‡æ ‡å…¨ç§° |
| :--- | :--- |
| **AIP** | Atherogenic index of plasma |
| **BMI** | Body mass index |
| **BRI** | Body roundness index |
| **CKM** | Cardiovascular-Kidney-Metabolic (CKM) Syndrome |
| **CVD10** | CVD 10-year Risk |
| **eGFR** | Estimated glomerular filtration rate |
| **FIB-4** | Fibrosis-4 index |
| **HALP** | Hemoglobin-albumin-lymphocyte-platelet index |
| **HRR** | Hemoglobin-to-red cell distribution width ratio |
| **MAR** | Monocyte-to-albumin ratio |
| **NLR** | Neutrophil-to-lymphocyte ratio |
| **NPAR** | Neutrophil percentage-to-albumin ratio |
| **RAR** | Red cell distribution width-to-albumin ratio |
| **SBP** | Systolic Blood Pressure |
| **SII** | Systemic immune-inflammation index |
| **TyG** | Triglyceride-glucose index |
| **TyG-BMI**| TyG-body mass index |
| **UHR** | Uric acid-to-high-density lipoprotein cholesterol ratio |
| **VAI** | Visceral adiposity index |
| **PhenoAge**| Phenotypic Age |

**ä½¿ç”¨ç¤ºä¾‹ (è®¡ç®— BMI)**:

```python
from get_nhanes.coreCalculated import BMICalculated

# è®¡ç®—å¹¶ä¿å­˜ BMI ç»“æœ
BMICalculated.calculation_bmi(save_path="./results/")
```

### 3. åå˜é‡å¤„ç† (`getCovariates`)

æä¾›æ ‡å‡†åŒ–çš„åå˜é‡æå–å’Œå¤„ç†ï¼ŒåŒ…æ‹¬å¹´é¾„ã€æ€§åˆ«ã€ç§æ—ã€æ•™è‚²ç¨‹åº¦ã€å©šå§»çŠ¶å†µã€æ”¶å…¥ã€å¸çƒŸå’Œé¥®é…’æƒ…å†µç­‰ã€‚

```python
from get_nhanes.getCovariates import covariates

# è®¡ç®—æ ‡å‡†åå˜é‡é›†
covariates.calculation_covariates(save_path="./results/")
```

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### è‡ªåŠ¨å¤„ç†ç¼ºå¤±å€¼
`get_nhanes_data` ä¼šè‡ªåŠ¨å¤„ç† `seqn` åºåˆ—å·çš„æ ¼å¼é—®é¢˜ï¼Œå¹¶æ”¯æŒ `strict_features=False` å‚æ•°æ¥ç”¨ `NaN` å¡«å……ç¼ºå¤±çš„å¹´ä»½åˆ—ã€‚

### è‡ªå®šä¹‰è®¡ç®—æ‰©å±•
æ‰€æœ‰è®¡ç®—æ¨¡å—å‡éµå¾ª `fit_*` (æå–ä¸æ¸…æ´—) å’Œ `calculation_*` (è®¡ç®—ä¸ä¿å­˜) çš„è®¾è®¡æ¨¡å¼ï¼Œæ˜“äºé˜…è¯»å’Œæ‰©å±•ã€‚

## ğŸ“„ License
MIT License
