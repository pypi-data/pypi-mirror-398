import random
import string
import time
from datetime import datetime


class MockAPIClient:  # This class is used to mock an api.
    def __init__(self, userid, token, delay, proxies) -> None:
        self._data = {}
        self.userid = userid
        self.token = token
        self.delay = delay

    def _generate_post(self):
        # Generate a 12-digit alphanumeric mixture
        id = "".join(random.choices(string.ascii_letters + string.digits, k=64))
        userid = "".join(random.choices(string.ascii_letters + string.digits, k=7))
        title = "Title" + "".join(random.choices(string.ascii_letters, k=5))
        # Get the current date and time
        now = datetime.now()
        # create content
        content = f"This is a post with id {id}, generated at {now}, requested by user {self.userid}"
        ip_location = random.choice(["New York", "London", "Paris", "Tokyo"])
        author_statement = "Generated by AI"

        result = {
            "id": id,
            "content": content,
            "title": title,
            "userid": userid,
            "username": f"MockUser{userid}",
            "timestamp": int(now.timestamp()),
            "url": f"https://mock.url/{id}",
            "picture": [
                "https://pure80spop.co.uk/wp-content/uploads/2020/04/Rick-Astley-1600x1069.jpg"
            ],
            "ip_location": ip_location,
            "author_statement": author_statement,
        }
        self._data[id] = result

        return result

    def get_list(self, mock_new_book_count=2):
        """return post id list"""
        time.sleep(self.delay)
        return [self._generate_post()["id"] for i in range(mock_new_book_count)]

    def get_post(self, id):
        """return post detail by id"""
        time.sleep(self.delay)
        return self._data[id]
