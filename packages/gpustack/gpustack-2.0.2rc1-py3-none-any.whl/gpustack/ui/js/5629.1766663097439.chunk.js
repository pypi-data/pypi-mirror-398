"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5629],{89843:function(e,t,n){n.d(t,{Bx:function(){return u},Cb:function(){return r},Ho:function(){return l},Um:function(){return o},m3:function(){return s},m4:function(){return a},zv:function(){return i}});var a={seed:"seed",stop:"stop",temperature:"temperature",top_p:"top_p",n_ctx:"n_ctx",n_slot:"n_slot",max_model_len:"max_model_len",frequency_penalty:"frequency_penalty",presence_penalty:"presence_penalty",max_total_tokens:"max_total_tokens",max_stop_sequences:"stop"},o=["temperature","top_p","frequency_penalty","presence_penalty"],i=["sample_method","sampling_steps","schedule_method","cfg_scale","guidance","negative_prompt","seed","strength"],u={seed:null,stop:null,temperature:1,top_p:1,max_tokens:1024,frequency_penalty:0,presence_penalty:0},l={seed:null},s={style:null},r={n:1,size:"512x512",response_format:"b64_json",width:512,height:512,random_seed:!0}},45629:function(e,t,n){n.d(t,{M:function(){return C},X:function(){return g}});var a=n(15558),o=n.n(a),i=n(26068),u=n.n(i),l=n(48305),s=n.n(l),r=n(2825),m=n(66876),d=n(48075),c=n(53231),f=n(25383),p=n(32699),h=n.n(p),_=n(75271),v=n(89843),g=function(e,t){var n=e.modelList,a=e.model,o=e.isChat,i=t.metaKeys,l=void 0===i?{}:i,m=t.defaultValues,d=void 0===m?{}:m,f=t.defaultParamsConfig,p=void 0===f?[]:f,g=(0,_.useRef)(null),C=(0,c.useSearchParams)(),x=s()(C,1)[0],k=(0,_.useState)({}),y=s()(k,2),b=y[0],S=y[1],z=(0,_.useState)(u()(u()({},d),{},{model:""})),w=s()(z,2),V=w[0],M=w[1],F=(0,_.useState)({model:""}),P=s()(F,2),I=P[0],O=P[1],U=(0,_.useState)(p),H=s()(U,2),L=H[0],q=H[1],R=(0,_.useRef)(null),D=(0,r.Z)().initialize,Q=(0,_.useMemo)((function(){var e;return o?x.get("model")||a||(null==n||null===(e=n[0])||void 0===e?void 0:e.value):a}),[a,n,o]),j=function(e){var t=new Set(v.Um),n=e||{},a=h().pick(n,h().keys(l)),o=Object.entries(l).reduce((function(e,n){var o=s()(n,2),i=o[0],u=o[1],l=a[i];return h().hasIn(a,i)&&(e[u]=t.has(i)?h().round(l,2):l),e}),{}),i=function(e){var t=e||{},n=t.max_model_len,a=t.n_ctx,o=t.n_slot,i=t.max_total_tokens,u=0;return a&&o?u=h().divide(a,o):n?u=n:i&&(u=i),{max_tokens:u||16384,defaultFormValue:u?h().divide(u,2):1024}}(o);return{form:h().merge({},d,u()(u()({},h().omit(o,["n_ctx","n_slot","max_model_len","max_total_tokens"])),{},{seed:-1===o.seed?null:o.seed,max_tokens:i.defaultFormValue})),meta:u()(u()({},o),{},{max_tokens:i.max_tokens})}},E=(0,_.useMemo)((function(){var e=null==L?void 0:L.map((function(e){return e.name}));return null==e?void 0:e.join(",")}),[L]),B=(0,_.useCallback)((function(e){if(e){var t=n.find((function(t){return t.value===e})),a=j(null==t?void 0:t.meta),o=a.form,i=a.meta;S(i),M(u()(u()({},o),{},{model:e})),O(u()(u()({},o),{},{model:e}));var l=p.map((function(e){return u()(u()({},e),{},{attrs:"max_tokens"===e.name?u()(u()({},e.attrs),{},{max:i.max_tokens}):u()({},e.attrs)})}));q(l)}}),[n,p]),G=(0,_.useCallback)((function(e,t){e.model?B(e.model):(O(t),M(t))}),[B]);return(0,_.useEffect)((function(){Q&&n.length&&B(Q)}),[Q,n.length]),(0,_.useEffect)((function(){R.current&&D(R.current)}),[D]),{extractLLMMeta:j,handleOnModelChange:B,handleOnValuesChange:G,setModelMeta:S,setInitialValues:M,setParams:O,setParamsConfig:q,formRef:g,paramsConfig:L,initialValues:V,parameters:I,modelMeta:b,paramsRef:R,formFields:E}},C=function(e,t){var n=e.modelList,a="edit"===t.type?m.GF:m.GF.filter((function(e){return"strength"!==e.name})),i=(0,_.useRef)(null),l=(0,c.useSearchParams)(),r=s()(l,1)[0],p=(0,_.useState)({}),g=s()(p,2),C=g[0],x=g[1],k=(0,_.useState)(!1),y=s()(k,2),b=y[0],S=y[1],z=_.useState([]),w=s()(z,2),V=w[0],M=w[1],F=_.useState([].concat(o()(m.pL),o()(m.yU))),P=s()(F,2),I=P[0],O=P[1],U=(0,d.Hq)(),H=(0,_.useState)(u()(u()(u()({},v.Cb),v.Ho),{},{seed:U,model:""})),L=s()(H,2),q=L[0],R=L[1],D=(0,_.useState)([].concat(o()(m.pL),o()(m.yU),o()(a))),Q=s()(D,2),j=Q[0],E=Q[1],B=(0,_.useState)(u()(u()(u()({},v.Cb),v.Ho),{},{seed:U,model:""})),G=s()(B,2),Z=G[0],A=G[1],K=(0,_.useMemo)((function(){var e;return r.get("model")||(null==n||null===(e=n[0])||void 0===e?void 0:e.value)||""}),[n]),T=_.useRef(u()(u()(u()({},v.Cb),v.m3),v.Ho)),X=function(e,t){if(t.length){var n=m.yU.map((function(e){return u()(u()({},e),{},{options:t})}));return[].concat(o()(m.pL),o()(n))}var a=e.meta||{},i=a.max_height,l=a.max_width,s=h().cloneDeep(m.Ci).map((function(e){var t="height"===e.name?i:l;return u()(u()({},e),{},{attrs:u()(u()({},e.attrs),{},{max:t||e.attrs.max})})}));return[].concat(o()(m.pL),o()(s))},J=function(e){var t=function(e){var t=e||{},n=t.max_height,a=t.max_width;if(!n||!a)return m.od;var o=m.od.filter((function(e){return e.width<=a&&e.height<=n||"custom"===e.value}));return o.find((function(e){return e.width===a&&e.height===n}))||o.push({width:a,height:n,label:"".concat(a,"x").concat(n),value:"".concat(a,"x").concat(n)}),o}(e);return{form:h().merge({},u()(u()({},v.Cb),v.Ho),u()(u()({},h().pick(e,v.zv)),{},{seed:-1===(null==e?void 0:e.seed)?null:null==e?void 0:e.seed,size:t.length?"".concat((null==e?void 0:e.default_width)||512,"x").concat((null==e?void 0:e.default_height)||512):"custom",width:(null==e?void 0:e.default_width)||512,height:(null==e?void 0:e.default_height)||512})),meta:e,sizeOptions:t}},N=function(e){return"custom"===e.size?[].concat(o()(I),o()(m.Ci),o()(e.isOpenaiCompatible?m.QU:a)):[].concat(o()(I),o()(e.isOpenaiCompatible?m.QU:a))},W=function(e){h().merge(T.current,e)},Y=(0,_.useMemo)((function(){var e=null==j?void 0:j.map((function(e){return e.name}));return null==e?void 0:e.join(",")}),[j]),$=(0,_.useCallback)((function(e){if(e){var t=n.find((function(t){return t.value===e})),i=J(null==t?void 0:t.meta),l=i.form,s=i.sizeOptions,r=X(t,s);E(b?r:[].concat(o()(r),o()(a))),O(r),M(s),x((null==t?void 0:t.meta)||{}),R(u()(u()({},l),{},{seed:Z.seed,model:e})),A(u()(u()({},l),{},{seed:Z.seed,model:e})),W(l)}}),[n,b]),ee=(0,f.Z)((function(e,t){var n;if(e.model)$(e.model);else if(e.size&&"custom"===e.size)E([].concat(o()(I),o()(m.Ci),o()(b?m.QU:a))),A(u()(u()({},t),{},{width:C.default_width||512,height:C.default_height||512})),null===(n=i.current)||void 0===n||null===(n=n.form)||void 0===n||n.setFieldsValue({width:C.default_width||512,height:C.default_height||512}),W(e);else if(e.size&&"custom"===Z.size)E([].concat(o()(I),o()(b?m.QU:a))),A(t),W(e);else if(h().isBoolean(e.random_seed)){var l,s=e.random_seed?(0,d.Hq)():Z.seed;A(u()(u()({},t),{},{seed:s})),null===(l=i.current)||void 0===l||null===(l=l.form)||void 0===l||l.setFieldsValue({seed:s}),W(e)}else A(t),W(e)}));return(0,_.useEffect)((function(){K&&n.length&&$(K)}),[K,n.length]),{extractIMGMeta:J,generateImageParamsConfig:X,setImageSizeOptions:M,setBasicParamsConfig:O,updateCacheFormData:W,handleOnValuesChange:ee,handleToggleParamsStyle:function(){var e,t={};t=b?h().pick(T.current,h().keys(u()(u()({},v.Cb),v.Ho))):h().pick(T.current,h().keys(u()(u()({},v.Cb),v.m3)));var n=N({size:t.size,isOpenaiCompatible:!b});null===(e=i.current)||void 0===e||null===(e=e.form)||void 0===e||e.setFieldsValue(u()(u()({},t),{},{model:Z.model})),E(n),A(u()(u()({},t),{},{model:Z.model})),S(!b),W(u()(u()({},t),{},{model:Z}))},setParams:A,setInitialValues:R,updateParamsConfig:N,setParamsConfig:E,form:i,modelMeta:C,formFields:Y,paramsConfig:j,initialValues:q,parameters:Z,isOpenaiCompatible:b,cacheFormData:T,basicParamsConfig:I,imageSizeOptions:V,openaiCompatibleFieldsDefaultValus:v.m3,advancedFieldsDefaultValus:v.Ho,ImageAdvancedParamsConfig:a,imgInitialValues:v.Cb,ImageCountConfig:m.pL,ImageSizeConfig:m.yU,ImageCustomSizeConfig:m.Ci,ImageconstExtraConfig:m.QU}}}}]);