# aiterm v0.4.0 Plan: Workflow Automation & Craft Integration

**Created:** 2025-12-26
**Updated:** 2025-12-26
**Target:** v0.4.0
**Theme:** Workflow automation through aiterm CLI + craft plugin integration

---

## Overview

v0.4.0 bridges the gap between:
- **aiterm CLI** - Terminal setup, context detection, settings management
- **craft plugin** - Claude Code commands, skills, and orchestration (v1.3.0)

**Goal:** Seamless developer workflows from terminal to Claude Code.

---

## Current State

### aiterm v0.3.1
- IDE integrations (VS Code, Cursor, Zed, Positron, Windsurf)
- Session coordination (hook-based tracking, conflict detection)
- MCP server management
- Context detection (8 project types)
- 323 tests passing

### craft v1.2.0 → v1.3.0 (Prerequisite)
**Before aiterm v0.4.0, we must upgrade craft to v1.3.0**

| Metric | v1.2.0 | v1.3.0 | Change |
|--------|--------|--------|--------|
| Commands | 46 | 50 | +4 |
| Agents | 1 | 6 | +5 |
| Skills | 8 | 11 | +3 |

**New in v1.3.0:**
- 5 documentation agents (ported from documentation-generation plugin)
- 3 documentation skills (changelog, ADR, OpenAPI)
- 4 new commands: `docs:generate`, `docs:api`, `test:cli-gen`, `test:cli-run`

**See:** `PROPOSAL-craft-enhancements-2025-12-26.md` for full specification

---

## v0.4.0 Features

### Phase 0: craft v1.3.0 Enhancement (Priority: Critical)
**Goal:** Upgrade craft plugin before starting aiterm workflow features

**Status:** IN PROGRESS

**Tasks:**
1. Port 5 documentation agents from documentation-generation plugin
2. Port 3 documentation skills (changelog, ADR, OpenAPI)
3. Create `docs:generate` command (routes to agents)
4. Create `docs:api` command (OpenAPI generation)
5. Create `test:cli-gen` command (CLI test suite generation)
6. Create `test:cli-run` command (CLI test execution)
7. Update craft README for v1.3.0
8. Validate all new components work correctly

**Source:** `~/.claude/plugins/cache/claude-code-workflows/documentation-generation/1.2.1/`
**Target:** `/Users/dt/projects/dev-tools/claude-plugins/craft/`

### Phase 1: Workflow Templates (Priority: High)
**Goal:** Pre-configured workflows that chain aiterm + craft commands

```bash
# Example: Full stack development workflow
ait workflow apply fullstack

# Expands to:
# 1. aiterm: Context detection, profile switching
# 2. craft: /craft:check → /craft:test:run → /craft:git:sync
```

**New CLI Module:** `src/aiterm/cli/workflow_recipes.py`

| Command | Description |
|---------|-------------|
| `ait recipes list` | List available workflow recipes |
| `ait recipes show <name>` | Show recipe details |
| `ait recipes apply <name>` | Apply a recipe to current project |
| `ait recipes create` | Interactive recipe builder |
| `ait recipes export` | Export recipe as shareable config |

**Built-in Recipes:**
1. `fullstack` - Full-stack development (test, lint, commit)
2. `release` - Release preparation (/craft:check --for release)
3. `feature` - Feature development flow
4. `debug` - Debugging session setup
5. `docs` - Documentation workflow
6. `r-dev` - R package development (integrates with rforge v0.1.0 tools: `rforge_plan`, `rforge_deps`)

### Phase 1b: CLI Test Runner (Priority: Medium)
**Goal:** Run interactive tests in split terminal from Claude Code

```bash
ait test interactive                    # New window (default)
ait test interactive --split right      # Vertical split
ait test interactive --split below      # Horizontal split
ait test interactive --split tab        # New tab
ait test interactive --terminal ghostty # Force specific terminal
```

**Terminal Support:**
| Terminal | Splits | Tabs | Windows |
|----------|--------|------|---------|
| **Ghostty** (default) | ✅ | ✅ | ✅ |
| **iTerm2** | ✅ | ✅ | ✅ |
| **Terminal.app** | ❌ | ✅ | ✅ |

**Implementation:** `src/aiterm/cli/test_runner.py`
**Prototype:** `scripts/run-interactive-tests.sh` (already implemented)

### Phase 2: Craft Plugin Management (Priority: Medium)
**Goal:** Manage craft plugin from aiterm CLI

```bash
# Install/update craft
ait craft install
ait craft update

# Sync craft with aiterm context
ait craft sync              # Auto-configure based on project type

# Run craft commands from terminal
ait craft run check         # Same as /craft:check in Claude Code
ait craft run test:run release
```

**New CLI Module:** `src/aiterm/cli/craft.py`

| Command | Description |
|---------|-------------|
| `ait craft status` | Show craft plugin status |
| `ait craft install` | Install craft plugin |
| `ait craft update` | Update craft plugin |
| `ait craft sync` | Sync with project context |
| `ait craft run <cmd>` | Execute craft command |
| `ait craft list` | List available craft commands |

### Phase 3: Session-Aware Workflows (Priority: Medium)
**Goal:** Workflows that respect active Claude Code sessions

```bash
# Check if Claude Code is active before running
ait workflow run release --require-session

# Workflows can interact with session task
ait sessions task "Running release workflow"
ait workflow run release
# Task auto-updates as workflow progresses
```

**Integration Points:**
- Hook into `~/.claude/sessions/active/` for session awareness
- Update session task field during workflow execution
- Prevent conflicting workflows on same project

### Phase 4: AI Recipe Intelligence (Priority: Low)
**Goal:** AI-powered recipe suggestions based on project state

```bash
# Suggest next steps based on context
ait recipes suggest

# Output:
# Based on current state:
# - 3 uncommitted changes
# - Tests passing
# - On feature branch
#
# Suggested recipe: 'commit-flow'
# Run: ait recipes apply commit-flow
```

---

## Implementation Timeline

### Week 1-2: Phase 1 (Workflow Templates)
- [ ] Create `workflow_recipes.py` CLI module
- [ ] Define recipe format (YAML/JSON)
- [ ] Implement 6 built-in recipes
- [ ] Add recipe storage in `~/.config/aiterm/recipes/`
- [ ] Write tests (target: 20+ tests)

### Week 3: Phase 2 (Craft Management)
- [ ] Create `craft.py` CLI module
- [ ] Implement install/update/sync commands
- [ ] Add craft command passthrough (`ait craft run`)
- [ ] Write tests (target: 15+ tests)

### Week 4: Phase 3 (Session Integration)
- [ ] Add session checks to workflow runner
- [ ] Implement task auto-update during workflows
- [ ] Add conflict prevention
- [ ] Write tests (target: 10+ tests)

---

## Recipe Format

```yaml
# ~/.config/aiterm/recipes/release.yaml
name: release
description: Release preparation workflow
version: 1.0.0

# Prerequisites
requires:
  - clean_git: true
  - tests_passing: true
  - craft_installed: true

# Steps
steps:
  - name: pre-flight
    type: aiterm
    command: ait sessions prune  # Clean stale sessions

  - name: check
    type: craft
    command: /craft:check --for release

  - name: test
    type: craft
    command: /craft:test:run release

  - name: audit
    type: craft
    command: /craft:code:deps-audit

  - name: changelog
    type: craft
    command: /craft:docs:changelog

# Post-completion
on_success:
  - notify: "Release checks complete"
  - update_task: "Ready for release"
```

---

## Success Criteria

### v0.4.0 MVP
- [ ] 6+ built-in recipes working
- [ ] Recipe list/show/apply commands functional
- [ ] Craft status/install/sync commands working
- [ ] Session-aware workflow execution
- [ ] 45+ new tests
- [ ] Documentation updated

### Quality Metrics
- [ ] 85%+ code coverage on new modules
- [ ] All existing tests passing
- [ ] No regressions in v0.3.1 features

---

## Files to Create

```
src/aiterm/
├── cli/
│   ├── workflow_recipes.py    # Recipe management
│   └── craft.py               # Craft plugin management
├── recipes/
│   ├── __init__.py
│   ├── loader.py              # Recipe loading/parsing
│   ├── runner.py              # Recipe execution
│   └── templates/             # Built-in recipes
│       ├── fullstack.yaml
│       ├── release.yaml
│       ├── feature.yaml
│       ├── debug.yaml
│       ├── docs.yaml
│       └── r-dev.yaml
tests/
├── test_recipes.py
└── test_craft_integration.py
docs/
├── guide/workflow-recipes.md
└── reference/REFCARD-RECIPES.md
```

---

## Dependencies

- **craft plugin v1.3.0** - Required for command integration (Phase 0 prerequisite)
- **documentation-generation v1.2.1** - Source for porting agents/skills (Phase 0)
- **Session hooks** - For session-aware workflows (already in v0.3.0)
- **PyYAML** - For recipe parsing (already a dependency)

---

## Risks & Mitigations

| Risk | Mitigation |
|------|------------|
| craft not installed | Graceful fallback, install prompt |
| Recipe execution fails mid-way | Rollback support, resume capability |
| Version mismatch | Version compatibility checks |

---

## Notes

- Recipes should be project-portable (no absolute paths)
- User recipes override built-in recipes with same name
- Consider marketplace for community recipes in future
