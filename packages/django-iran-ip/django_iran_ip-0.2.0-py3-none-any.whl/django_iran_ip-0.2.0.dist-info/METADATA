Metadata-Version: 2.4
Name: django-iran-ip
Version: 0.2.0
Summary: A professional Django package for IP detection with Iran network support
License-File: LICENSE
Author: shayan taki
Author-email: takishayan@icloud.com
Requires-Python: >=3.10
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Programming Language :: Python :: 3.14
Requires-Dist: django (>=4.2,<6.0)
Requires-Dist: httpx (>=0.28.1,<0.29.0)
Description-Content-Type: text/markdown

# Django Iran IP

ÛŒÚ© Ù¾Ú©ÛŒØ¬ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Django Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª IP Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ØŒ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÙˆÛŒÚ˜Ù‡ Ø§Ø² Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ Ùˆ CDNÙ‡Ø§ÛŒ Ù…Ø­Ù„ÛŒ.

## ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§

- âœ… Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± IP Ø§Ø² Ù‡Ø¯Ø±Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù (ArvancloudØŒ CloudflareØŒ Ùˆ...)
- âœ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² CDNÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ (Ø§Ø¨Ø±Ø¢Ø±ÙˆØ§Ù†ØŒ Ø¯Ø±Ø§Ú©)
- âœ… Fallback Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ø±Ø¬ÛŒ Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù‡Ø¯Ø±
- âœ… Ú©Ø´ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ API
- âœ… Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ IPâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ
- âœ… Geolocation Ùˆ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ ISP
- âœ… Rate limiting Ø¨Ø± Ø§Ø³Ø§Ø³ IP
- âœ… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ IP
- âœ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ Ø§Ø² IPv4
- âœ… Middleware Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Django
- âœ… Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§ Django 4.2+ Ùˆ Python 3.10+

## Ù†ØµØ¨

```bash
pip install django-iran-ip
```

ÛŒØ§ Ø¨Ø§ Poetry:

```bash
poetry add django-iran-ip
```

## Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÛŒØ¹

### 1. Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ INSTALLED_APPS

```python
# settings.py
INSTALLED_APPS = [
    # ...
    'django_iran_ip',
]
```

### 2. Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Middleware

```python
# settings.py
MIDDLEWARE = [
    # ...
    'django_iran_ip.contrib.django.middleware.IranIPMiddleware',
]
```

### 3. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± View

```python
from django.http import JsonResponse

def my_view(request):
    client_ip = request.client_ip
    
    return JsonResponse({
        'ip': client_ip,
        'is_valid': request.client_ip_valid,
        'type': request.client_ip_type,
        'is_iran': getattr(request, 'is_iran_ip', None),
    })
```

## Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¯ÙˆÙ† Middleware

```python
from django_iran_ip.contrib.django.utils import get_client_ip

def my_view(request):
    client_ip = get_client_ip(request)
    return JsonResponse({'ip': client_ip})
```

## ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡

```python
# settings.py

# Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒâ€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ IP (Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø§ÙˆÙ„ÙˆÛŒØª)
IRAN_IP_STRATEGIES = [
    'django_iran_ip.core.strategies.HeaderStrategy',
    'django_iran_ip.core.strategies.ServiceStrategy',
]

# Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ø±Ø¬ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª IP
IRAN_IP_SERVICE_URLS = [
    "https://api.ipify.org",
    "https://ifconfig.me/ip",
    "https://icanhazip.com",
]

# Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ
IRAN_IP_USE_IRAN_SERVICES = True

# ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ú©Ø´
IRAN_IP_ENABLE_CACHE = True
IRAN_IP_CACHE_DURATION = 3600  # 1 Ø³Ø§Ø¹Øª

# ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
IRAN_IP_REQUEST_TIMEOUT = 3.0

# Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ IP
IRAN_IP_VALIDATE_IP = True

# Ø¨Ø±Ø±Ø³ÛŒ IP Ø§ÛŒØ±Ø§Ù†ÛŒ
IRAN_IP_CHECK_IRAN_IP = True

# Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† IPâ€ŒÙ‡Ø§ÛŒ ØºÛŒØ± Ø§ÛŒØ±Ø§Ù†ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
IRAN_IP_BLOCK_NON_IRAN_IP = False

# ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Geolocation
IRAN_IP_ENABLE_GEOLOCATION = True

# Ø³Ø·Ø­ Ù„Ø§Ú¯
IRAN_IP_LOG_LEVEL = 'INFO'  # DEBUG, INFO, WARNING, ERROR

# Ø§ÙˆÙ„ÙˆÛŒØª Ù‡Ø¯Ø±Ù‡Ø§
IRAN_IP_HEADER_PRIORITY = [
    'HTTP_AR_REAL_IP',       # Ø§Ø¨Ø±Ø¢Ø±ÙˆØ§Ù†
    'HTTP_X_REAL_IP',        # Ø¯Ø±Ø§Ú©
    'HTTP_CF_CONNECTING_IP', # Ú©Ù„ÙˆØ¯ÙÙ„Ø±
    'HTTP_X_FORWARDED_FOR',
    'REMOTE_ADDR',
]
```
## ðŸ›¡ï¸ Ø§Ù…Ù†ÛŒØª Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¬Ø¹Ù„ IP (Anti-Spoofing)

Ø§Ø² Ù†Ø³Ø®Ù‡ `0.2.0`ØŒ Ø§ÛŒÙ† Ù¾Ú©ÛŒØ¬ Ø¨Ù‡ Ù…Ú©Ø§Ù†ÛŒØ²Ù… Ù¾ÛŒØ´Ø±ÙØªÙ‡ **Chain of Trust** Ù…Ø¬Ù‡Ø² Ø´Ø¯Ù‡ Ø§Ø³Øª ØªØ§ Ø§Ø² Ø­Ù…Ù„Ø§Øª Ø¬Ø¹Ù„ IP (IP Spoofing) Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ú©Ù†Ø¯.

- âœ… ØªØ´Ø®ÛŒØµ Ù‡ÙˆØ´Ù…Ù†Ø¯ IP ÙˆØ§Ù‚Ø¹ÛŒ Ø­ØªÛŒ Ø¯Ø± Ù¾Ø´Øª CloudflareØŒ ArvanCloud Ùˆ Load BalancerÙ‡Ø§.
- âœ… Ù‚Ø§Ø¨Ù„ÛŒØª ØªØ¹Ø±ÛŒÙ `TRUSTED_PROXIES` Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª Ø­Ø¯Ø§Ú©Ø«Ø±ÛŒ.
- âœ… Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… **Right-to-Left** Ø¨Ø±Ø§ÛŒ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ† Ù‡Ø¯Ø±Ù‡Ø§ÛŒ Ø¬Ø¹Ù„ÛŒ (`X-Forwarded-For`).

ðŸ“– **[Ø¨Ø±Ø§ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù„ Ø§Ù…Ù†ÛŒØªÛŒ Ùˆ Ù†Ø­ÙˆÙ‡ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒØŒ Ø§ÛŒÙ†Ø¬Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯](https://github.com/shayanTaki/django-iran-ip/blob/0.2.0/docs/SPOOFING_DETECTION.md)**


## Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡

### 1. Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ IP Ø§ÛŒØ±Ø§Ù†ÛŒ

```python
from django_iran_ip.core.validators import IranIPChecker

checker = IranIPChecker()
is_iran = checker.is_iran_ip("5.22.10.20")  # True
print(f"IP is from Iran: {is_iran}")
```

### 2. Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ

```python
from django_iran_ip.core.validators import IPGeolocation

geo = IPGeolocation()
info = geo.get_location("8.8.8.8")
print(info)
# {
#     'country': 'United States',
#     'country_code': 'US',
#     'city': 'Mountain View',
#     'isp': 'Google LLC',
#     'timezone': 'America/Los_Angeles'
# }
```

### 3. Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ IP

```python
from django_iran_ip.core.validators import IPValidator

validator = IPValidator()
print(validator.is_valid_ipv4("192.168.1.1"))  # True
print(validator.is_private_ip("192.168.1.1"))  # True
print(validator.get_ip_type("8.8.8.8"))  # "public"
```

### 4. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ

```python
from django_iran_ip.core.resolver import IPResolver
from django_iran_ip.core.strategies import HeaderStrategy, ServiceStrategy

# Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø®Ø§Øµ
resolver = IPResolver(strategies=[
    HeaderStrategy(),
    ServiceStrategy(timeout=5.0)
])

ip = resolver.get_client_ip(request)
```

### 5. Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„

```python
from django_iran_ip.core.resolver import IPResolver

resolver = IPResolver()
info = resolver.get_client_info(request)
print(info)
# {
#     'ip': '5.22.10.20',
#     'strategy_used': 'HeaderStrategy',
#     'is_valid': True
# }
```

## Middlewareâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ

### 1. Logging Middleware

```python
# settings.py
MIDDLEWARE = [
    'django_iran_ip.contrib.django.middleware.IranIPLoggingMiddleware',
    # ...
]
```

### 2. Rate Limiting Middleware

```python
# settings.py
MIDDLEWARE = [
    'django_iran_ip.contrib.django.middleware.IranIPRateLimitMiddleware',
    # ...
]

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Rate Limit
IRAN_IP_RATE_LIMIT = 100  # ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
IRAN_IP_RATE_PERIOD = 3600  # Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ (Ø«Ø§Ù†ÛŒÙ‡)
```

## Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ

### Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ IPâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ

```python
from django.http import HttpResponseForbidden
from django_iran_ip.core.validators import IranIPChecker

def iran_only_view(request):
    checker = IranIPChecker()
    
    if not checker.is_iran_ip(request.client_ip):
        return HttpResponseForbidden("ÙÙ‚Ø· Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§ÛŒØ±Ø§Ù†ÛŒ Ù…Ø¬Ø§Ø² Ù‡Ø³ØªÙ†Ø¯")
    
    return render(request, 'template.html')
```

### Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±

```python
def user_info_view(request):
    context = {
        'ip': request.client_ip,
        'is_iran': getattr(request, 'is_iran_ip', False),
        'geo': getattr(request, 'client_geo', {}),
    }
    return render(request, 'user_info.html', context)
```

## CDNâ€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡

- âœ… Ø§Ø¨Ø±Ø¢Ø±ÙˆØ§Ù† (Arvancloud)
- âœ… Ø¯Ø±Ø§Ú© (Derak)
- âœ… Ú©Ù„ÙˆØ¯ÙÙ„Ø± (Cloudflare)
- âœ… Akamai
- âœ… Ùˆ Ø³Ø§ÛŒØ± CDNÙ‡Ø§ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯

## Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### IP Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

1. Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Middleware Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª
2. Ø³Ø·Ø­ Ù„Ø§Ú¯ Ø±Ø§ Ø¨Ù‡ `DEBUG` ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯:
   ```python
   IRAN_IP_LOG_LEVEL = 'DEBUG'
   ```
3. Ø¯Ø± Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ú©Ø¯Ø§Ù… Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª

### IP Ø§Ø´ØªØ¨Ø§Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯

Ø§ÙˆÙ„ÙˆÛŒØª Ù‡Ø¯Ø±Ù‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯. Ø¨Ø±Ø§ÛŒ CDNâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ:

```python
IRAN_IP_HEADER_PRIORITY = [
    'HTTP_AR_REAL_IP',       # Ø§Ø¨Ø±Ø¢Ø±ÙˆØ§Ù† Ø±Ø§ Ø§ÙˆÙ„ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯
    'HTTP_X_REAL_IP',
    'HTTP_CF_CONNECTING_IP',
    'REMOTE_ADDR',
]
```

## Ù…Ø´Ø§Ø±Ú©Øª

Ù…Ø´Ø§Ø±Ú©Øªâ€ŒÙ‡Ø§ Ù‡Ù…ÛŒØ´Ù‡ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯ Ù‡Ø³ØªÙ†Ø¯! Ù„Ø·ÙØ§Ù‹:

1. Ù…Ø®Ø²Ù† Ø±Ø§ Fork Ú©Ù†ÛŒØ¯
2. ÛŒÚ© branch Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯ (`git checkout -b feature/amazing-feature`)
3. ØªØºÛŒÛŒØ±Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ commit Ú©Ù†ÛŒØ¯ (`git commit -m 'Add amazing feature'`)
4. Ø¨Ù‡ branch Ø®ÙˆØ¯ push Ú©Ù†ÛŒØ¯ (`git push origin feature/amazing-feature`)
5. ÛŒÚ© Pull Request Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯

## Ù„Ø§ÛŒØ³Ù†Ø³

MIT License - Ø¨Ø±Ø§ÛŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ± ÙØ§ÛŒÙ„ [LICENSE](LICENSE) Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯.

## Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

- ðŸ“§ Email: takishayan@icloud.com
- ðŸ› Issues: [GitHub Issues](https://github.com/shayanTaki/django-iran-ip/issues)
- ðŸ“– Documentation: [Full Documentation](https://github.com/shayanTaki/django-iran-ip/wiki)

## ØªØºÛŒÛŒØ±Ø§Øª Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§

### Ù†Ø³Ø®Ù‡ 0.1.0

- Ø§ÙˆÙ„ÛŒÙ† Ø§Ù†ØªØ´Ø§Ø±
- Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ IP Ø§Ø² Ù‡Ø¯Ø±Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
- Fallback Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ API
- Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² CDNâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ
- Ú©Ø´ Ù‡ÙˆØ´Ù…Ù†Ø¯
- Middleware Ø¢Ù…Ø§Ø¯Ù‡

---

Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ Ø¨Ø±Ø§ÛŒ Ø¬Ø§Ù…Ø¹Ù‡ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ø§ÛŒØ±Ø§Ù†ÛŒ
