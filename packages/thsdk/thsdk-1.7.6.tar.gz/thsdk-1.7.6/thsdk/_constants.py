# encoding: utf-8

import base64
import random

# 订阅数据类型：1-指数快照，2-证券快照，3-委托队列，4-逐笔委托，5-逐笔成交，5-极速盘口
DATA_CLASS_LIST = [1, 2, 3, 4, 5, 6]
DATA_CLASS_NAMES = ['index', 'stock', 'queue', 'order', 'trans', 'superstock']
# 数据类型：0xf-数据类型，0x0-交易所原始数据，0x1-使用压缩，0xf0-数据类型，0x10-更新补全后的数据
DATA_OP_TYPE = [0xf, 0x0, 0x1, 0xf0, 0x10]
# 订阅操作类型：1-全新订阅，2-取消订阅，3-该市场增加订阅代码，4-该市场删除订阅代码
SUB_OP_TYPE = [1, 2, 3, 4]

# 市场代码
MarketUSHI = "USHI"  # 上海指数
MarketUSHA = "USHA"  # 上海A股
MarketUSHB = "USHB"  # 上海B股
MarketUSHD = "USHD"  # 上海债券
MarketUSHJ = "USHJ"  # 上海基金
MarketUSHP = "USHP"  # 上海退市整理
MarketUSHT = "USHT"  # 上海ST风险警示板
MarketUSZI = "USZI"  # 深圳指数
MarketUSZA = "USZA"  # 深圳A股
MarketUSZB = "USZB"  # 深圳B股
MarketUSZD = "USZD"  # 深圳债券
MarketUSZJ = "USZJ"  # 深圳基金
MarketUSZP = "USZP"  # 深圳退市整理
MarketUSTM = "USTM"  # 北交所


def market_to_market_id(market: str) -> str:
    market_map = {
        "USHI": "16",
        "USHA": "17",
        "USHB": "18",
        "USHD": "19",  # 退市票沪也用这个
        "USHJ": "20",
        "USHT": "22",  # st 沪，优先使用 22（21 被注释掉）
        "USZI": "32",
        "USZA": "33",
        "USZB": "34",
        "USZD": "35",  # 退市票深也用这个
        "USZJ": "36",
        "USZP": "37",
        "URFI": "48",
        "UCFS": "65",
        "UCFF": "66",
        "UCFZ": "67",
        "UFII": "88",
        "UFXB": "97",
        "UHFF": "113",
        "UHFS": "114",
        "UZZI": "120",
        "UIFF": "129",
        "USTM": "151",
        "UEUA": "161",
        "UHKM": "177",
        "UHKG": "178",
        "UNQQ": "185",
        "UNQS": "186",
        "UCMN": "217",
        "UCMS": "219"
    }
    return market_map.get(market, f"{market}_")


# 市场代码列表
MARKETS = ['USHI', 'USHA', 'USHB', 'USHD', 'USHJ', 'USHP', 'USHT', 'USZI', 'USZA', 'USZB', 'USZD', 'USZJ', 'USZP',
           'USOO', 'UZOO', 'UNQQ', 'UNQS', 'UHKM', 'UHKG', 'USTI', 'UFXB', 'UEUA', 'UCFD', 'UCFS', 'UCFZ', 'UGFF',
           'UIFF', 'UDEF']

BLOCK_MARKETS = ['URFI']

CALL_AUCTION_ANOMALY_MAP = {
    68710: "涨停试盘",
    68711: "跌停试盘",
    68712: "涨停撤单",
    68713: "竞价抢筹",
    68714: "竞价砸盘",
    68715: "大幅高开",
    68716: "大幅低开",
    68717: "急速上涨",
    68718: "急速下跌",
    68721: "买一剩余大",
    68722: "卖一剩余大",
    68726: "大买单试盘",
    68727: "大卖单试盘",
}

TIP_CALL_AUCTION_ANOMALY_MAP = {
    68710: "第%d次涨停试盘",
    68711: "第%d次跌停试盘",
    68712: "涨停撤单%.2f%%",
    68713: "单笔放量10%以上抢筹",
    68714: "单笔放量10%以上砸盘",
    68715: "大幅高开%.2f%%",
    68716: "大幅低开%.2f%%",
    68717: "一分钟涨幅大于3%",
    68718: "一分钟跌幅大于3%",
    68721: "买一剩余%.0f万",
    68722: "卖一剩余%.0f万",
    68726: "%.0f万大买单试盘",
    68727: "%.0f万大卖单试盘",
}

# 字段名称映射（已修正重复值问题）
FieldNameMap = {
    1: "时间",
    5: "代码",
    6: "昨收价",
    7: "开盘价",
    8: "最高价",
    9: "最低价",
    10: "价格",
    11: "收盘价",
    12: "成交方向",
    13: "成交量",
    14: "外盘成交量",
    15: "内盘成交量",
    16: "对倒成交量",
    17: "开盘成交量",
    18: "交易笔数",
    19: "总金额",
    20: "委托买入价",
    21: "委托卖出价",
    22: "委买总量",
    23: "委卖总量",
    24: "买1价",
    25: "买1量",
    26: "买2价",
    27: "买2量",
    28: "买3价",
    29: "买3量",
    30: "卖1价",
    31: "卖1量",
    32: "卖2价",
    33: "卖2量",
    34: "卖3价",
    35: "卖3量",
    36: "指数种类",
    37: "股票总数",
    38: "上涨家数",
    39: "下跌家数",
    40: "领先指标",
    41: "上涨趋势",
    42: "下跌趋势",
    43: "最近成交金额",
    44: "证券名称(繁体)",
    45: "五日成交总量",
    46: "证券名称(英文)",
    47: "证券名称(Unicode)",
    48: "涨速",
    49: "当前量",
    50: "代码(港)",
    53: "委比",
    54: "均价(中金所)",
    55: "名称",
    56: "挂单时间",
    60: "H股昨收",
    61: "异动类型1",
    64: "状态",
    65: "持仓",
    66: "昨结",
    69: "涨停价",
    70: "跌停价",
    71: "现增仓",
    72: "今结",
    73: "昨持仓",
    74: "买单ID",
    75: "卖单ID",
    80: "利息",
    82: "撤单时间",
    84: "所属行业",
    85: "盈利情况",
    89: "转让状态参数",
    90: "板块流通市值",
    91: "市盈率",
    92: "板块总市值",
    93: "交易单位",
    95: "52周最高",
    96: "52周最低",
    100: "现价(港)",
    102: "买6价",
    103: "买6量",
    104: "卖6价",
    105: "卖6量",
    106: "买7价",
    107: "买7量",
    108: "卖7价",
    109: "卖7量",
    110: "买8价",
    111: "买8量",
    112: "卖8价",
    113: "卖8量",
    114: "买9价",
    115: "买9量",
    116: "卖9价",
    117: "卖9量",
    118: "买10价",
    119: "买10量",
    120: "卖10价",
    121: "卖10量",
    122: "加权平均买价",
    123: "总委买量",
    124: "加权平均卖价",
    125: "总委卖量",
    130: "总手(港)",
    141: "波动性中断参考价",
    142: "波动性中断虚拟匹配量",
    143: "合约代码",
    144: "标的证券代码",
    145: "标的证券名称",
    146: "标的证券类型",
    147: "期权类型",
    148: "认购认沽",
    149: "合约单位",
    150: "买4价",
    151: "买4量",
    152: "卖4价",
    153: "卖4量",
    154: "买5价",
    155: "买5量",
    156: "卖5价",
    157: "卖5量",
    160: "市场分层",
    191: "买差价",
    192: "卖差价",
    201: "主动买入特大单量",
    202: "主动卖出特大单量",
    203: "主动买入大单量",
    204: "主动卖出大单量",
    205: "主动买入中单量",
    206: "主动卖出中单量",
    207: "被动买入特大单量",
    208: "被动卖出特大单量",
    209: "被动买入大单量",
    210: "被动卖出大单量",
    211: "被动买入中单量",
    212: "被动卖出中单量",
    213: "主动买入小单量",
    214: "主动卖出小单量",
    215: "主动买入特大单笔数",
    216: "主动卖出特大单笔数",
    217: "主动买入大单笔数",
    218: "主动卖出大单笔数",
    219: "被动买入特大单笔数",
    220: "被动卖出特大单笔数",
    221: "被动买入大单笔数",
    222: "被动卖出大单笔数",
    223: "主动买入特大单金额",
    224: "主动卖出特大单金额",
    225: "主动买入大单金额",
    226: "主动卖出大单金额",
    227: "被动买入特大单金额",
    228: "被动卖出特大单金额",
    229: "被动买入大单金额",
    230: "被动卖出大单金额",
    231: "买入单数量",
    232: "卖出单数量",
    233: "资金流入",
    234: "资金流出",
    235: "大单净量正",
    236: "大单净量负",
    237: "主动买入小单金额",
    238: "主动卖出小单金额",
    239: "成交笔数",
    240: "昨日收盘收益率",
    241: "昨日加权平均收益率",
    242: "开盘收益率",
    243: "最高收益率",
    244: "最低收益率",
    245: "最新收益率",
    246: "当日加权平均收益率",
    250: "委托买入前五档金额",
    251: "委托卖出前五档金额",
    252: "委托买入前十档金额",
    253: "委托卖出前十档金额",
    255: "主动买入中单笔数",
    256: "主动卖出中单笔数",
    257: "被动买入中单笔数",
    258: "被动卖出中单笔数",
    259: "主动买入中单金额",
    260: "主动卖出中单金额",
    261: "被动买入中单金额",
    262: "被动卖出中单金额",
    271: "52周最高日期",
    272: "52周最低日期",
    273: "年度最高日期",
    274: "年度最低日期",
    275: "领涨股",
    276: "涨停家数",
    277: "跌停家数",
    278: "盘后最新价",
    279: "港股指数人民币成交金额",
    280: "期权行权价",
    281: "首个交易日",
    282: "最后交易日1",
    283: "期权行权日",
    284: "期权到期日",
    285: "合约版本号",
    286: "行权交割日",
    288: "标的证券前收盘",
    289: "涨跌幅限制类型",
    290: "保证金比例参数1",
    291: "保证金比例参数2",
    292: "单位保证金",
    294: "整手数",
    295: "单笔限价申报下限",
    296: "单笔限价申报上限",
    297: "单笔市价申报下限",
    298: "单笔市价申报上限",
    299: "期权合约状态标签",
    402: "总股本",
    407: "流通股本",
    410: "流通B股",
    471: "权息资料",
    497: "转股价",
    499: "债券余额",
    520: "流动资产",
    543: "资产总计",
    593: "公积金",
    602: "主营收入",
    605: "营业利润",
    615: "利润总额",
    619: "净利润1",
    672: "申购限额(万股)",
    675: "实际涨幅",
    676: "首日振幅",
    873: "引伸波幅",
    874: "对冲值",
    875: "街货占比",
    876: "街货量",
    877: "最后交易日2",
    879: "回收价",
    880: "牛熊证种类",
    881: "标的证券",
    882: "权证类型",
    887: "行使价",
    888: "换股比率1",
    890: "到期日",
    899: "财务数据项",
    900: "流通股变动量",
    981: "港元人民币汇率",
    1002: "每股收益",
    1005: "每股净资产",
    1015: "净资产收益率",
    1024: "债券规模",
    1047: "转股起始日",
    1110: "星级",
    1121: "标记",
    1322: "利率",
    1384: "融资余额",
    1385: "融券余额",
    1386: "融资买入",
    1387: "融券卖出",
    1566: "净利润2",
    1606: "发行价",
    1612: "中签率",
    1670: "股东总数",
    1674: "流通A股",
    2026: "评级",
    2039: "纯债价值",
    2041: "期权价值",
    2570: "卖出信号",
    2579: "机构持股比例",
    2719: "人均持股数",
    2942: "市盈率(动态)1",
    2946: "市盈率(静态)",
    2947: "市净率1",
    3153: "市盈率TTM",
    3250: "5日涨幅",
    3251: "10日涨幅",
    3252: "20日涨幅",
    3397: "净值",
    9810: "溢价率",
    32772: "时间戳",
    68107: "板块主力净量1",
    68166: "板块主力流入",
    68167: "板块主力流出",
    68213: "板块主力净流入",
    68285: "板块主力净量2",
    68759: "板块开盘价",
    133702: "细分行业",
    133778: "基差",
    133964: "日增仓1",
    134071: "市销率TTM",
    134072: "净资产收益率TTM",
    134141: "净利润增长率",
    134143: "营业收入增长率",
    134152: "市盈率(静态)2",
    134160: "换股比率2",
    134162: "折溢率",
    134237: "杠杆比率",
    134238: "溢价",
    199112: "涨幅",
    199643: "大单净量",
    264648: "涨跌",
    330321: "异动类型2",
    330322: "竞价评级1",
    330325: "涨停类型",
    330329: "涨停状态",
    331070: "今日主力增仓占比",
    331077: "2日主力增仓占比",
    331078: "3日主力增仓占比",
    331079: "5日主力增仓占比",
    331080: "10日主力增仓占比",
    331124: "2日主力增仓排名",
    331125: "3日主力增仓排名",
    331126: "5日主力增仓排名",
    331127: "10日主力增仓排名",
    331128: "今日主力增仓排名",
    395720: "委差",
    461256: "委比",
    461346: "年初至今涨幅",
    461438: "涨速(10分钟)",
    461439: "涨速(15分钟)",
    462057: "散户数量",
    526792: "振幅",
    527198: "未知字段527198",
    527526: "涨速(3分钟)",
    527527: "涨速(1分钟)",
    592544: "贡献度",
    592920: "市净率2",
    592741: "机构动向",
    592888: "主力净量",
    592890: "主力净流入",
    592893: "5日大单净量",
    592894: "10日大单净量",
    592946: "多空比",
    625362: "每股公积金",
    625295: "成交笔数2",
    658784: "金叉个数",
    658785: "利好",
    658786: "利空",
    920371: "开盘涨幅",
    920372: "实体涨幅",
    920428: "股票分类标记",
    1149395: "市净率3",
    1378761: "均价",
    1509847: "户均持股数",
    1640904: "手每笔",
    1771976: "量比",
    1968584: "换手率",
    1991120: "涨幅(港)",
    2034120: "市盈率(动态)2",
    2034121: "资产负债率",
    2097453: "流通股",
    2263506: "流通比例",
    2427336: "均笔额",
    2646480: "H股涨跌",
    2820564: "内盘",
    3082712: "涨幅(结算)",
    3475914: "流通市值",
    3541450: "总市值",
    3934664: "板块涨速",
    4065737: "买价",
    4099083: "日增仓2",
    4131273: "卖价",
    4525375: "小单流入",
    4525376: "中单流入",
    4525377: "大单流入",
    7000001: "占基金规模1",
    7000002: "持股变动1",
    7000003: "基金规模1",
    7000004: "代码2",
    7000005: "涨幅百分比",
    7000006: "持股变动2",
    7000007: "占基金规模2",
    7000008: "业绩表现",
    7000009: "近一年收益",
    7000010: "近一周收益",
    7000011: "近一月收益",
    7000012: "近三月收益",
    7000013: "今年以来收益",
    7000014: "成立以来收益",
    7000015: "产品类型",
    7000016: "基金规模2",
    7000017: "基金公司",
    7000018: "投资类型",
    7000019: "基金经理",
    7000020: "资产占比",
    7000021: "较上期",
    8311855: "类别",
    8719679: "小单流出",
    8719680: "中单流出",
    8719681: "大单流出",
    12345671: "A股关联主题",
    12913983: "小单净额",
    12913984: "中单净额",
    12913985: "大单净额",
    17108287: "小单净额占比",
    17108288: "中单净额占比",
    17108289: "大单净额占比",
    18550831: "成分股数",
    20190901: "标签",
    21302591: "小单总额",
    21302592: "中单总额",
    21302593: "大单总额",
    25496895: "小单总额占比",
    25496896: "中单总额占比",
    25496897: "大单总额占比",
    189546735: "计算数据项",
    2018090319: "竞价评级2",
    2018090320: "竞价异动说明",
    2018090410: "异动说明",
    2018090411: "竞价涨幅",

    32773: "ServerDelay",
    34056: "total_count",
}



def forward_transform(s):
    parts = s.split('$')
    transformed_parts = []
    for part in parts:
        if '@' in part:
            user, hash_str = part.split('@', 1)
            reversed_user = user[::-1]
            reversed_hash = hash_str[::-1]
            transformed_part = f"{reversed_user}@{reversed_hash}"
        else:
            transformed_part = part[::-1]
        transformed_parts.append(transformed_part)
    return '$'.join(transformed_parts)


def rand_account():
    data = "gakj(urh_ts(ugsht@(11782b!(c(b!3(1782(6(427b3f($x3v32cdz_ts(ugsht@af115ab3!3(80276ab057(475(620a2$o8zj(d1k_ts(ugsht@1(043(d!8f36026bab6a87!2(a0d22($5wu!8b!2_ts(ugsht@835a!6cdd5462f616(4bcbadd316(310$qaia7b8(_ts(ugsht@12f0(68a7c!806c617(!6b72c551c(0$pj!3yclc_ts(ugsht@5f77f7!563d1c(0ca18764!2572bb(f0$jatduxul_ts(ugsht@434a48aac!8a57008c81d!ac4c44f324$htmfmg!_ts(ugsht@!1664(!08a8d8c3fc7c4a!21!708!64c$pkfd(t4a_ts(ugsht@f!da2!b!42bf8!3677475106837b65f6$sbs7qcj6_ts(ugsht@85c261c27!03!ad4d3b44733a5fb6468$j!1hcdpw_ts(ugsht@8ad(8c51d38d7(8ca748af0cfdc5(!7$22czor5n_ts(ugsht@3602fd(b85f2(04a82aa8345ab710!ad$m8uah736_ts(ugsht@d(!76caba635ab826(b400462a6(f(8$t64vqmo6_ts(ugsht@4d!632(732!d4382770!(458a458ac01$4qj21ndu_ts(ugsht@4c2(46201285123550b4c63(!aa4fd(c$fcroagp2_ts(ugsht@b10d233f2d4(6!f(5b663fa22f8!cc!0$lkuffat3_ts(ugsht@c88bf!d!6b!173228df6b3(c6(aaf23d$l8i6thn3_ts(ugsht@83d14d1017cc8582a04a3!b38!8f00fb$mgatufk(_ts(ugsht@fdcf1078c064f408d8a0d(02c407a06($r0uscc18_ts(ugsht@c!3b7!7cf8(!1bc47c(720b4d0b5a8($yyw!thiy_ts(ugsht@a33fa33a(ac60(87c0(a3f6!74df4dc5$n63tjtk4_ts(ugsht@42f743c20c8fd7b321!0036f34074f76$!pvlli88_ts(ugsht@ad7067!a!773c21876b1fc126!6f2d13$cuk(4go8_ts(ugsht@75!3!07ab0b(ffd7054f(6ccd48!015$ray5cor2_ts(ugsht@8f0ad0f3b7f0b3!20a5db2ca6cb22db$qmkbscvf_ts(ugsht@(5a7d4(5!1f4a6056201557(3(b2f4b8$!(fmnm1t_ts(ugsht@f(5dd78062a65(27(6d873(f0!662(6f$qw8naynz_ts(ugsht@2!1!db615b21fa!dc64318a772(a81$hgvmpj3o_ts(ugsht@f3(f667651!a8fc388!ba01f81!d571d$qdf6tt5c_ts(ugsht@6cf3(76432b6c7c43d5cc2(f478(1!f$lhy7d74z_ts(ugsht@f33(71d056065c5f5c84228!5a876c3f$bghx7t4o_ts(ugsht@c13d2!c087d3f20582d2ccfd0(faca28$p7wmlpoc_ts(ugsht@0fc0(86a7315f582b08!0!4(4c73a471$qpw8o1sm_ts(ugsht@!aa!2f02dcf4a4b1f7761f87c670182b$8w5oywf0_ts(ugsht@1!ffd47d2bd5!8c417d2d1385(767fcb$ioglxagb_ts(ugsht@4752fa62c48(a3bd56(!c174a4!(80$k!7ws(qq_ts(ugsht@3247a2a6bd8!a5cb8(dcba(5f4832f23$hd4tw4c4_ts(ugsht@a41cdc(4f621!3d813080d8f68f517a8$gvio(w1b_ts(ugsht@6(!410f13!ad374f613!1b8!6f8f(3!$x2!27psr_ts(ugsht@53fcc66dbccf2b57605ada6(2c1!3ac$!76gwnnf_ts(ugsht@!b54c(7!5fda(7affdb1bc80b!d!8!(d$ospmm0!n_ts(ugsht@dbbf4877f343!acada3aaa51(a70!214$0jm370x3_ts(ugsht@2c06(c265014d!46ffaaac8c!bfb2b6!$7lfzkd(6_ts(ugsht@765045c!811c(dd8(f36dd81d(d65(8$mcxswoav_ts(ugsht@021cc22(7aca81faa43(c75312f2f1db$khm0ow42_ts(ugsht@1c766b00!cba6177!4f2404(7!255!11$by(260(x_ts(ugsht@1683b500(8f156b0c003(0372285c0(7$wt08h8sq_ts(ugsht@d6a435cc!3(a140c!c8c(2(4!0c5b(a1$(pgwhvld_ts(ugsht@46a42!fad!81780862c!4778bf(6bb$wn(42fwm_ts(ugsht@7717366f6f45b76dc!7(b76c11d!17cd"

    decrypted_string = forward_transform(data)
    parts = decrypted_string.split("$")
    account = random.choice(parts).split("@")
    return account[0].replace("(", "e").replace("!", "9"), account[1].replace("(", "e").replace("!", "9")
