{"version":3,"file":"lib_index_js.fdd441e13805c8ffaa0a.js","mappings":"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","sources":["webpack://jupyter_firefly_extensions/./src/AnyFileViewerExt.js","webpack://jupyter_firefly_extensions/./src/FireflyCommonUtils.js","webpack://jupyter_firefly_extensions/./src/FitsViewerExt.js","webpack://jupyter_firefly_extensions/./src/SlateCommandExt.js","webpack://jupyter_firefly_extensions/./src/handler.ts","webpack://jupyter_firefly_extensions/./src/index.ts"],"sourcesContent":["import { ABCWidgetFactory, DocumentModel } from '@jupyterlab/docregistry';\nimport { Widget } from '@lumino/widgets';\nimport { requestAPI } from './handler';\nimport { findFirefly } from './FireflyCommonUtils.js';\nimport { SLATE_CMD_ID } from './SlateCommandExt.js';\n\n\nexport const ANYFACTORY = 'Firefly Viewer'; // name that appears in JL \"Open With\" menu\nconst NO_OP_ERROR = 'NoOpDocWidgetOpen';\nconst SUPPORTED_TYPES = {\n\tFITS: ['.fits', '.fits.gz', '.fits.zip'],\n\tVOTable: ['.vot', '.xml'],\n\tCSV: ['.csv'],\n\tTSV: ['.tsv'],\n\tParquet: ['.parquet'],\n\tIPACTable: ['.tbl']\n};\n\n/**\n * Activate the AnyFileViewer extension.\n *\n * @param {JupyterLab} app\n * @param {ILayoutRestorer} _restorer\n */\nexport function activateAnyFileViewerExt(app, _restorer) {\n\t// Register supported file types only if missing\n\tObject.entries(SUPPORTED_TYPES).forEach(([name, extensions]) => {\n\t\tapp.docRegistry.addFileType({\n            name,\n            displayName: `${name} file`,\n            extensions,\n            // mimeTypes can be added here if needed later\n        });\n\t});\n\n    console.log(app.docRegistry.getDefaultFileTypes(), app.docRegistry)\n\n\t// Register a minimal no-load model to avoid fetching/decoding large file content on the client\n\tconst nullModelFactory = new FireflyNullModelFactory();\n\tapp.docRegistry.addModelFactory(nullModelFactory);\n\n\t// Create a non-default reader that routes the file open event to Firefly's upload tab flow.\n\t// Use the custom 'firefly-null-model' so JL does not attempt to fetch/parse the file.\n\tconst widgetFactory = new ABCWidgetFactory({\n\t\tname: ANYFACTORY,\n\t\tmodelName: FireflyNullModelFactory.MODEL_NAME, // modelFactory to use\n\t\tfileTypes: Object.keys(SUPPORTED_TYPES),\n\t\tdefaultFor: Object.keys(SUPPORTED_TYPES),\n\t\treadOnly: true\n\t});\n\n\t// JL expects createNewWidget to return a DocumentWidget for the file.\n\t// We instead forward the file to Firefly which uploads it to the Firefly server\n\t// and tells Firefly Viewer (client-side) to display it. So we fire\n\t// forwardToFirefly() and throw a No Op error to cancel JL's default open action.\n\twidgetFactory.createNewWidget = (context) => {\n\t\tvoid forwardToFirefly(app, context.path);\n\n        // since we don't return a DocumentWidget, abort the normal open flow\n\t\tconst err = new Error('Open DocumentWidget canceled by Any file viewer extension');\n\t\terr.name = NO_OP_ERROR;\n\t\tthrow err;\n\t};\n\tapp.docRegistry.addWidgetFactory(widgetFactory);\n\n\t// Suppress the expected No Op error in the console generated by createNewWidget()\n    // (this is a workaround to remove noise from the console)\n\tif (!window.__fireflyCancelErrorHandlerInstalled) {\n\t\tconst cancelHandler = (e) => {\n\t\t\tconst err = e?.error;\n\t\t\tif (err && err.name === NO_OP_ERROR) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener('error', cancelHandler, true);\n\t\twindow.__fireflyCancelErrorHandlerInstalled = true; // flag to attach listener only once\n\t}\n}\n\nasync function forwardToFirefly(app, filepath) {\n\t// 1) Ensure Firefly Viewer is open/active (singleton behavior handled by SlateCommandExt)\n\ttry {\n\t\tawait app.commands.execute(SLATE_CMD_ID);\n\t} catch (e) {\n\t\tconsole.error('Could not activate Firefly viewer:', e);\n\t\treturn;\n\t}\n\n\t// 2) Upload file to Firefly server and get file's cache key\n\tlet cacheKey;\n\ttry {\n        const responseText = await (await requestAPI(`sendToFirefly?path=${encodeURIComponent(filepath)}`)).text();\n        if (!responseText?.startsWith('${')) {\n            throw new Error(`Unexpected response from Firefly server: ${responseText}`);\n        }\n        cacheKey = responseText;\n\t} catch (e) {\n\t\tconsole.error('Error while uploading to Firefly server:', e);\n\t\treturn;\n\t}\n\n\t// 3) Tell Firefly JS API to display the uploaded file\n\ttry {\n\t\tconst { firefly } = await findFirefly();\n\n\t\tconst displayName = filepath.substring(filepath.lastIndexOf('/') + 1);\n\t\tfirefly.action.dispatchExternalUpload({\n\t\t\tfileOnServer: cacheKey,\n\t\t\timmediate: false,\n\t\t\tdisplayName\n\t\t});\n\t} catch (e) {\n\t\tconsole.error('Error dispatching external upload to Firefly client:', e);\n\t}\n    console.debug('File forwarded to Firefly Viewer successfully: ', filepath);\n}\n\n// ---------------------------------------------------------------------\n// Custom no-op document model and factory\n// ---------------------------------------------------------------------\n\n/**\n * A minimal document model that never loads or decodes file contents.\n * This is to avoid base64/text decoding for large binary files which\n * takes time and throws errors sometimes.\n */\nclass FireflyNullDocModel extends DocumentModel {\n\tconstructor(options) {\n\t\tsuper(options);\n\t\t// Never mark dirty; we never edit this model\n\t\tthis.dirty = false;\n\t}\n\t// Ignore incoming content completely\n\tfromString(_value) {}\n\tfromJSON(_value) {}\n\t// Provide empty content on save (should not be called since readOnly is true)\n\ttoString() { return ''; }\n\ttoJSON() { return null; }\n}\n\nclass FireflyNullModelFactory {\n\tstatic MODEL_NAME = 'firefly-null-model';\n\tget name() { return FireflyNullModelFactory.MODEL_NAME; }\n\t// Treat as a generic file model\n\tget contentType() { return 'file'; }\n\t// Return null to indicate no content should be fetched for this model.\n\tget fileFormat() { return null; }\n\t// JupyterLab queries this for syntax highlighting; return empty/undefined is fine\n\tpreferredLanguage(_path) { return ''; }\n\tget isDisposed() { return !!this._disposed; }\n\tget preferKernel() { return false; }\n\tget canStartKernel() { return false; }\n\tget collaborative() { return false; }\n\tdispose() { this._disposed = true; }\n\tcreateNew(options) { return new FireflyNullDocModel(options); }\n}\n","import {initFirefly} from 'firefly-api-access';\nimport {requestAPI} from './handler';\n\n\nlet cachedLoc;\nlet cachedFindFireflyResult;\nconst ffLocEndpoint = 'fireflyLocation';\nconst fetchOptions= {\n    method: 'get',\n    mode: 'cors',\n    credentials: 'include',\n    cache: 'default',\n    headers: { 'X-Requested-With': 'XMLHttpRequest' }\n};\n\n/**\n * Determine where firefly is my calling the lab server extension then load firefly.\n * Results are cache so this function can be call many times.\n * @return {Promise<{firefly: Object, channel: string, fireflyURL: string}>}\n */\nexport async function findFirefly()  {\n    if (cachedFindFireflyResult) return cachedFindFireflyResult;\n\n    try {\n        // request the config from server at /jupyter-firefly-extensions/fireflyLocation (see handlers.py)\n        if (!cachedLoc) {\n            const response = await requestAPI(ffLocEndpoint, fetchOptions);\n            cachedLoc = await response.json();\n        }\n\n        // make sure that response of the above request contains non-empty fireflyURL\n        const {fireflyURL, fireflyChannel:channel, fireflyHtmlFile}= cachedLoc;\n        if (!fireflyURL) throw new Error(`fireflyURL couldn't be retrieved from ${ffLocEndpoint} endpoint`);\n\n        // load firefly API from fireflyURL at /lab (window)\n        // (CORS errors might happen here if headers aren't set up correctly, maybe due to caching)\n        if (!window.firefly?.initialized) window.firefly= {...window.firefly, wsch:channel};\n        if (!window.getFireflyAPI) window.getFireflyAPI= initFirefly(fireflyURL);\n        const firefly= await window.getFireflyAPI();\n\n        // resolve Promise\n        cachedFindFireflyResult= {fireflyURL, channel, firefly, fireflyHtmlFile};\n        console.log('Firefly loaded successfully\\n', cachedFindFireflyResult);\n        return cachedFindFireflyResult;\n    }\n    catch (e) {\n        // log information about error(s) before rejecting Promise\n        console.group('Firefly Load Failed');\n        console.log('findFirefly: Could not determine firefly location or load firefly, call failed');\n        if (cachedLoc) console.log(`firefly url: ${cachedLoc.fireflyURL} channel: ${cachedLoc.fireflyChannel}`);\n        console.log(e);\n        console.groupEnd('Firefly Load Failed');\n        throw e;  // to let promise reject\n    }\n\n}\n\n\n\nexport function buildURLErrorHtml(e) {\n    const details= `<br>Set the firefly URL by setting <code>c.Firefly.url</code> in \n                    <code>jupyter_notebook_config.py</code>\n                    <br>or the environment variable <code>FIREFLY_URL</code>`;\n    return `<div style='padding: 30px 0 0 30px'>${e.message}${details}</div>`;\n}\n","import b64toBlob from 'b64-to-blob';\nimport { buildURLErrorHtml, findFirefly } from './FireflyCommonUtils.js';\nimport { Widget } from '@lumino/widgets';\nimport { ABCWidgetFactory, DocumentWidget } from '@jupyterlab/docregistry';\nimport { requestAPI } from './handler';\n\n\nexport const FITS_MIME_TYPE = 'application/fits';\nconst CLASS_NAME = 'jp-OutputWidgetFITS'; // the class name added to the extension\nconst FACTORY = 'Firefly - Individual Image Viewer';\n\nlet idCounter=0;\n\n\nconst fitsIFileType = {\n    name: 'FITS',\n    displayName: 'FITS file',\n    fileFormat: null, // prevent client from auto-loading bytes; server path or on-demand upload handles it\n    format: 'base64',\n    mimeTypes: [FITS_MIME_TYPE],\n    extensions: ['.fits']\n};\n\n/**\n *\n * @param {JupyterLab} app\n * @param {ILayoutRestorer} restorer\n */\nexport function activateFitsViewerExt(app, restorer) {\n    if (!app.docRegistry.getFileType('FITS')) { //prevent duplicate registration of file type\n        app.docRegistry.addFileType(fitsIFileType);\n    }\n\n    const factory = new ABCWidgetFactory({\n        name: FACTORY,\n        modelName: 'base64', // so that context.model.toString() returns base64 encoded file data\n        fileTypes: ['FITS'],\n        defaultFor: ['FITS'],\n        readOnly: true\n    });\n    factory.createNewWidget = createNewFitsViewerDocumentWidget;\n    app.docRegistry.addWidgetFactory(factory);\n\n    factory.widgetCreated.connect((_sender, widget) => {\n        const types = app.docRegistry.getFileTypesForPath(widget.context.path);\n        if (types.length) {\n            widget.title.iconClass = types[0].iconClass || '';\n            widget.title.iconLabel = types[0].iconLabel || '';\n        }\n    });\n}\n\n\n\n\n\nexport function createNewFitsViewerDocumentWidget(context) {\n    // DocumentWidget wrapper (no toolbar, default save etc. needed for read-only viewer)\n    return new DocumentWidget({ content: new FitsViewerWidget(context), context, reveal: true, toolbar: null });\n}\n\n/**\n * A widget for rendering a Firefly FITS Image Viewer.\n */\nexport class FitsViewerWidget extends Widget {\n    /**\n     * Construct a new output widget.\n     * @param context\n     */\n    constructor(context) {\n        super({ node: createNode(context.path) });\n        // jlExtUseModel flag controls whether to upload from JL client-side file \"model\"\n        // default is false to upload from JL server which is faster\n        const useModel = window?.firefly?.jlExtUseModel || false;\n        this.addClass(CLASS_NAME);\n        this.filename = context.path;\n        idCounter++;\n        this.plotId = `${this.filename}-${idCounter}`;\n        this.loaded = false;\n        if (this.isDisposed) return;\n\n        // Initial render\n        void this.renderModel(context, useModel);\n        // Re-render if content or file changes (e.g., save-as, rename)\n        context.model.contentChanged.connect(this.renderModel, this);\n        context.fileChanged.connect(this.renderModel, this);\n    }\n\n    /**\n     * Render FITS into this widget's node.\n     * @param context\n     * @param useModelFirst\n     * @return {Promise<{firefly: Object, channel: string, fireflyURL: string}>}\n     */\n    async renderModel(context, useModelFirst) {\n        if (this.isDisposed) return;\n\n        // If already loaded, just activate the existing plot view\n        if (this.loaded) {\n            return findFirefly().then(\n                ({firefly}) => firefly.action.dispatchChangeActivePlotView(this.plotId)\n            );\n        }\n\n        try {\n            const { firefly, fireflyURL } = await findFirefly();\n\n            // 1. Acquire server response (either upload file from JL-client model OR ask JL server to upload)\n            let responseText;\n            if (useModelFirst) {\n                await context.ready; // ensure model contents ready\n                const uploadResp = await loadFileToServer(context.model.toString(), this.filename, firefly, fireflyURL);\n                responseText = await uploadResp.text();\n            } else {\n                 responseText = await tellLabToLoadFileToServer(this.filename, firefly);\n            }\n\n            // 2. Interpret response or fallback\n            let cacheKey = null; // Firefly server cache key for the uploaded file\n            if (useModelFirst) {\n                [, cacheKey] = (responseText || '').split('::::'); // Expected format: <something>::::<cacheKey>\n                if (!cacheKey) {\n                    console.warn('Firefly FitsViewExt: unexpected upload response, cannot extract cache key');\n                }\n            } else {\n                if (responseText && responseText.length < 300 && responseText.startsWith('${')) { // Server upload succeeded; response itself is the cache key\n                    cacheKey = responseText;\n                } else { // Fallback to client upload\n                    console.log('Firefly FitsViewExt: failed to upload from server, falling back to (slower) browser upload');\n                    await context.ready;\n                    const upResp = await loadFileToServer(context.model.toString(), this.filename, firefly, fireflyURL);\n                    const upText = await upResp.text();\n                    [, cacheKey] = (upText || '').split('::::');\n                    if (!cacheKey) {\n                        console.error('Firefly FitsViewExt: fallback upload response missing cache key');\n                    }\n                }\n            }\n\n            // 3. Show image if upload succeeded and we have a cache key for the file\n            if (cacheKey) {\n                // firefly.action.dispatchExternalUpload({fileOnServer: cacheKey, immediate: false}); //TODO: remove after testing\n                showImage(cacheKey, this.plotId, this.filename, firefly);\n                this.loaded = true;\n                return;\n            }\n\n            // If we reach here we failed to display\n            const div = document.getElementById(this.filename);\n            if (div && !this.loaded) {\n                div.innerHTML = buildURLErrorHtml('Failed to load FITS file');\n            }\n        } catch (e) {\n            const div = document.getElementById(this.filename);\n            if (div) div.innerHTML = buildURLErrorHtml(e);\n        }\n    }\n\n    dispose() {\n        // Attempt to remove Firefly image view; ignore errors if firefly not available.\n        findFirefly()\n            .then(({ firefly }) => firefly.action.dispatchDeletePlotView({ plotId: this.plotId, holdWcsMatch: true }))\n            .catch(() => undefined);\n        super.dispose();\n    }\n\n    activate() {\n        super.activate();\n        if (this.loaded) {\n            return findFirefly().then(\n                ({ firefly }) => firefly.action.dispatchChangeActivePlotView(this.plotId)\n            );\n        }\n    }\n}\n\n/**\n * Load a file to the Firefly server from JL server.\n * \n * Invokes the server extension (at /jupyter-firefly-extensions/sendToFirefly endpoint)\n * to upload the file by using the firefly python client\n */\nfunction tellLabToLoadFileToServer(path, firefly) {\n    console.debug(`Firefly FitsViewExt: asking JL server to upload file: ${path}`);\n    return requestAPI(`sendToFirefly?path=${encodeURIComponent(path)}`)\n        .then((response) => response.text())\n        .catch((e) => {\n            console.error('Firefly FitsViewExt: error from server upload request', e);\n            return 'FAILED'; // dummy response text to trigger fallback\n        });\n}\n\n/**\n * Load a file to the Firefly server from the JL client.\n * \n * It's slower because JL client will read the file into browser memory first, \n * encode it and then upload to server.\n */\nfunction loadFileToServer(fileData, filename, firefly, fireflyURL) {\n    const { fetchUrl, ServerParams } = firefly.util;\n    const UPLOAD_URL = `${fireflyURL}/sticky/CmdSrv?${ServerParams.COMMAND}=${ServerParams.UPLOAD}&filename=${encodeURIComponent(filename)}`;\n    const fitsBlob = b64toBlob(fileData);\n    const options = { method: 'multipart', params: { filename, type: 'FITS', file: fitsBlob } };\n    console.debug(`Firefly FitsViewExt: uploading file from JL client to ${UPLOAD_URL}`);\n    return fetchUrl(UPLOAD_URL, options);\n}\n\n/**\n * Show an uploaded FITS file as image in the Firefly viewer.\n * \n * This calls the Firefly JS API directly to display an image viewer for the file.\n */\nfunction showImage(cacheKey, plotId, filename, firefly) {\n    const req = {\n        type: 'FILE',\n        FILE: cacheKey,\n        plotId,\n        plotGroupId: 'JUPLAB',\n        title: filename\n    };\n    // firefly.action.dispatchApiToolsView(true);\n    // firefly.setGlobalPref({ imageDisplayType: 'encapusulate' });\n\n    // high-level API that attaches an independent imageviewer to a target div\n    // alongside dispatching action to display the image in that viewer\n    firefly.showImage(filename, req, null, false); // targetDivId = filename\n}\n\nfunction createNode(filename) {\n    const node = document.createElement('div');\n    node.id = filename;\n    return node;\n}\n\n//=========================================================================================================\n//============ Keep code below for reference\n//============ Keep code below for reference\n//============ Keep code below for reference\n\n\n// /**\n//  * A mime renderer factory for FITS data.\n//  */\n// export const fitsViewerRendererFactory = {\n//     safe: true,\n//     mimeTypes: [FITS_MIME_TYPE],\n//     createRenderer: options => {\n//         return new FitsViewerWidget (options);\n//     }\n// };\n\n\n\n// import { ABCWidgetFactory, DocumentRegistry, DocumentWidget, IDocumentWidget } from '@jupyterlab/docregistry';\n// import { PageConfig, URLExt } from '@jupyterlab/coreutils';\n\n\n// const ERROR_MSG_CONT= `Make sure you set the firefly URL in your jupyter_notebook_config.py.\n//                 For example- 'c.Firefly.url= http://some.firefly.url/firefly'`;\n\n// for adding a second extension for a mime type - does not work yet in Jupyter Lab\n// --- https://github.com/jupyterlab/jupyterlab/issues/5381\n// export const fitsViewerRendererFactory2 = {\n//     safe: true,\n//     mimeTypes: [FITS_MIME_TYPE],\n//     createRenderer: options => {\n//         return new FitsViewerWidget (options);\n//     }\n// };\n\n\n// export class FitsViewerDocument extends DocumentWidget {\n//\n//   constructor(context) {\n//       super({ content:new FitsViewerWidget(context), context, reveal:true, toolbar:null });\n//     // const toolbar = Private.createToolbar(content.viewer);\n//     // const reveal = content.ready;\n//   }\n// }\n\n\n// export class FitsViewerFactory extends ABCWidgetFactory {\n//\n//     constructor(options) {\n//         super(options);\n//     }\n//\n//\n//\n//     /**\n//      * Create a new widget given a context.\n//      * @param context DocumentRegistry.IContext<DocumentRegistry.IModel>\n//      * @return DocumentWidget\n//      */\n//     createNewWidget(context) {\n//         // return new FitsViewerDocument(context);\n//         return new DocumentWidget({ content:new FitsViewerWidget(context), context, reveal:true, toolbar:null });\n//     }\n// }\n\n\n// const a= {\n//     name: 'some-name',\n//     fileTypes: ['csv'],\n//     defaultFor: [],\n//     defaultRendered: [],\n//     readOnly: false,\n//     modelName: 'text',\n//     preferKernel: false,\n//     canStartKernel: false,\n//     widgetCreated: new Signal(null),\n// }\n","import { Widget } from '@lumino/widgets';\nimport { ICommandPalette } from '@jupyterlab/apputils';\nimport { JupyterFrontEnd } from '@jupyterlab/application';\nimport { ILauncher } from '@jupyterlab/launcher';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport { set } from 'lodash';\n\nimport { findFirefly } from './FireflyCommonUtils.js';\nimport fireflyIconStr from '../style/fftools-logo.svg';\n\n\nlet widgetId;\nconst TAB_ID= 'firefly-viewer-tab-id';\nexport const SLATE_CMD_ID = 'firefly:open-slate-viewer';\nconst SLATE_CMD_LABEL = 'Open Firefly Viewer';\n\n/**\n * Extension can be started in two ways.\n * 1. as a jupyter command\n * 2. firefly_client sending a 'StartLabWindow' action\n * @param {JupyterFrontEnd} app\n * @param {ICommandPalette} palette\n * @param {ILauncher | null} launcher\n */\nexport function activateSlateCommandExt(app, palette, launcher) {\n    findFirefly().then( (ffConfig) => {\n        const {firefly}= ffConfig;\n        firefly.util.addActionListener(['StartLabWindow'], (action) => {\n            openSlateSingleOnly(app, TAB_ID, action.payload?.fireflyHtmlFile);\n        });\n        firefly.util.addActionListener(['StartBrowserTab'], (action) => {\n            firefly.setViewerConfig(firefly.ViewerType.Grid);\n            firefly.getViewer(action.payload.channel).openViewer();\n        });\n\n    });\n\n    // for starting extension as a jupyter command -----------\n    const command = SLATE_CMD_ID;\n    const category = 'Firefly';\n    const icon = new LabIcon({\n        name: 'jupyter_firefly_extensions:firefly-icon',\n        svgstr: fireflyIconStr\n      }); \n\n    app.commands.addCommand(command, {\n        label: SLATE_CMD_LABEL,\n        caption: SLATE_CMD_LABEL,\n        icon,\n        isEnabled: () => true,\n        execute: () => {\n            openSlateSingleOnly(app,TAB_ID);\n        }\n    });\n\n    palette.addItem({ command, category });\n    if (launcher) launcher.add({ command, category});\n}\n\n\n/**\n * Open only one slate tab.  Using this keeps the tab as a singleton.\n * @param app\n * @param id\n * @param firelfyHtmlFile\n */\nfunction openSlateSingleOnly(app, id, firelfyHtmlFile) {\n    if (!widgetId) {\n        const widget = new SlateRootWidget(id, firelfyHtmlFile);\n        widgetId= widget.id;\n        if (app.shell.addToMainArea) app.shell.addToMainArea(widget); // --- pre version 1\n        else if (app.shell.add) app.shell.add(widget, 'main');  // version 1\n        else throw Error('Could not add firefly to tab');\n\n        findFirefly().then( (ffConfig) => {\n            const {action}= ffConfig.firefly;\n            action.dispatchChangeActivePlotView(undefined);\n        });\n    }\n    app.shell.activateById(widgetId);\n}\n\nexport class SlateRootWidget extends Widget {\n    /**\n     * Construct a new output widget.\n     */\n    constructor(id,fireflyHtmlFile) {\n        super({node: createNode(id)});\n        this.id= id;\n        this.title.label= 'Firefly Viewer';\n        this.title.closable= true;\n        findFirefly().then( (ffConfig) => {\n            this.startViewer(ffConfig.firefly, id, ffConfig.fireflyURL, fireflyHtmlFile ?? ffConfig.fireflyHtmlFile);\n        } );\n    }\n\n    startViewer(firefly, id, fireflyURL, fireflyHtmlFile) {\n        const {util,action}= firefly;\n        const props=  {\n            div: id,\n            renderTreeId: id,\n            template: fireflyHtmlFile==='slate.html' ? 'FireflySlate' : 'FireflyViewer',\n            disableDefaultDropDown: true,\n        };\n        const fallbackMenu= [\n            {label:'Images', action:'ImageSelectDropDownSlateCmd'},\n            {label:'TAP Searches', action: 'TAPSearch'},\n            {label:'Catalogs', action:'IrsaCatalogDropDown'},\n            {label:'Charts', action:'ChartSelectDropDownCmd'},\n            {label:'Upload', action: 'FileUploadDropDownCmd'},\n        ];\n        if (!firefly.originalAppProps) {\n            props.menu= fallbackMenu;\n        }\n        if (fireflyURL.endsWith('irsaviewer')) {\n            // unset the appIcon styles that irsaviewer applies for its double banner layout\n            set(props,'slotProps.banner.slotProps.tabs.pl', 0);\n            set(props,'slotProps.banner.slotProps.icon.style.marginTop', 0);\n            set(props,'slotProps.banner.slotProps.icon.sx', \n                {'.MuiSvgIcon-root': {height: '3rem', width: '3rem', pl: 0}});\n        }\n        action.dispatchApiToolsView(true);\n        this.controlApp= util.startAsAppFromApi(id, props);\n    }\n\n    dispose() {\n        widgetId= undefined;\n    }\n    close() {\n        super.close();\n        widgetId= undefined;\n        if (this.controlApp) this.controlApp.unrender();\n        this.controlApp= undefined;\n    }\n\n    activate() {\n        super.activate();\n        if (this.controlApp) {\n            this.controlApp.unrender();\n            this.controlApp.render();\n        }\n        findFirefly().then( (ffConfig) => {\n            const {action}= ffConfig.firefly;\n            action.dispatchChangeActivePlotView(undefined);\n        });\n    }\n}\n\n\nfunction createNode(filename) {\n    const node = document.createElement('div');\n    node.id= filename;\n    const tmpElement=  document.createElement('div');\n    tmpElement.innerHTML= '<div>Firefly Loading...</div>';\n    node.appendChild(tmpElement);\n    return node;\n}\n","/**\n * This is JupyterLab's recommended way of creating handlers for extension with server.\n */\n\nimport { URLExt } from '@jupyterlab/coreutils';\n\nimport { ServerConnection } from '@jupyterlab/services';\n\n/**\n * Call the API extension\n *\n * @param endPoint API REST end point for the extension\n * @param init Initial values for the request\n * @returns The response object\n */\nexport async function requestAPI(\n  endPoint = '',\n  init: RequestInit = {}\n): Promise<Response> {\n  // Make request to Jupyter API\n  const settings = ServerConnection.makeSettings();\n  const requestUrl = URLExt.join(\n    settings.baseUrl,\n    'jupyter-firefly-extensions', // API Namespace\n    endPoint\n  );\n\n  let response: Response;\n  try {\n    response = await ServerConnection.makeRequest(requestUrl, init, settings);\n  } catch (error) {\n    throw new ServerConnection.NetworkError(error as any);\n  }\n\n  if (!response.ok) {\n    const data = await response.text();\n    throw new ServerConnection.ResponseError(response, data);\n  }\n\n  return response;\n}\n","import { JupyterFrontEndPlugin, ILayoutRestorer } from '@jupyterlab/application';\nimport { ICommandPalette } from '@jupyterlab/apputils';\nimport { ILauncher } from '@jupyterlab/launcher';\n\n\nimport { activateSlateCommandExt } from './SlateCommandExt.js';\nimport { activateFitsViewerExt } from './FitsViewerExt.js';\nimport { activateAnyFileViewerExt } from './AnyFileViewerExt.js';\n\n/**\n * Initialization data for each extension.\n */\nconst showSlateExt: JupyterFrontEndPlugin<void> = {\n  id: 'jupyter_firefly_extensions:showSlate',\n  description: 'Show Firefly Viewer',\n  autoStart: true,\n  requires: [ICommandPalette],\n  optional: [ILauncher],\n  activate: activateSlateCommandExt\n};\n\nconst fitsViewerExt: JupyterFrontEndPlugin<void> = {\n  id: 'jupyter_firefly_extensions:fitsviewer',\n  description: 'View a FITS file',\n  autoStart: true,\n  requires: [ILayoutRestorer],\n  activate: activateFitsViewerExt\n};\n\nconst anyFileViewerExt: JupyterFrontEndPlugin<void> = {\n  id: 'jupyter_firefly_extensions:anyfileviewer',\n  description: 'Open files with Firefly Viewer',\n  autoStart: true,\n  requires: [ILayoutRestorer],\n  activate: activateAnyFileViewerExt\n};\n\n// More than one extension/plugin can be exported as a list\nexport default [showSlateExt, fitsViewerExt, anyFileViewerExt];\n"],"names":[],"sourceRoot":""}