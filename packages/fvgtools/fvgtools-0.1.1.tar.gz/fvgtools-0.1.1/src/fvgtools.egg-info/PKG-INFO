Metadata-Version: 2.4
Name: fvgtools
Version: 0.1.1
Summary: Data processing tools for Fundamental Vision Group (FVG) of SenseTime Co, Ltd.
Author-email: Jianan Fan <fanjianan@sensetime.com>
License-Expression: MIT
Project-URL: Homepage, https://github.com/SenseTime-FVG
Project-URL: Issues, https://github.com/SenseTime-FVG/uniad_data_process/issues
Classifier: Programming Language :: Python :: 3
Classifier: Operating System :: OS Independent
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: Pillow>=10.0.0
Requires-Dist: numpy>=1.19.5
Requires-Dist: boto3
Requires-Dist: requests>=2.20.0
Requires-Dist: coloredlogs
Requires-Dist: environs
Requires-Dist: humanize
Requires-Dist: multiprocessing-logging
Dynamic: license-file

# fvgtools

ä¸€ä¸ªå®ç”¨çš„Pythonå·¥å…·åŒ…ï¼Œæä¾›äº†æ–‡ä»¶æ“ä½œã€é¢œè‰²æ‰“å°ã€Cephå­˜å‚¨è®¿é—®ç­‰å¸¸ç”¨åŠŸèƒ½ã€‚æ‰€æœ‰æ–‡ä»¶æ“ä½œå‡æ”¯æŒæœ¬åœ°è·¯å¾„å’ŒS3è·¯å¾„ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ“¦ é›†æˆäº†aoss_clientçš„å®‰è£…ï¼Œä¸ç”¨å†ä»å®˜ç½‘ä¼ è¾“.tar.gzå®‰è£…äº†
- ğŸ¨ å½©è‰²ç»ˆç«¯è¾“å‡º
- ğŸ“ æ–‡ä»¶è¯»å†™å·¥å…·ï¼ˆæ”¯æŒJSONã€Pickleã€JSONLã€TXTï¼Œæ”¯æŒæœ¬åœ°å’ŒS3è·¯å¾„ï¼‰
- â˜ï¸ Ceph/S3çš„è·¯å¾„æ“ä½œä¸ç›¸å…³åŠŸèƒ½
- â±ï¸ å®ç”¨è£…é¥°å™¨ï¼ˆé‡è¯•ã€è®¡æ—¶ç­‰ï¼‰
- ğŸŒ å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£å’Œé”™è¯¯æç¤º

## å®‰è£…

```bash
# ä»äº‘å®‰è£…
pip install fvgtools

# ä»æœ¬åœ°å®‰è£…
pip install -e .
```

å‘å¸ƒpypiæºå‚è€ƒï¼šhttps://packaging.python.org/en/latest/tutorials/packaging-projects/

## ä½¿ç”¨ç¤ºä¾‹

å¦‚æœä½ preferä¾¿æ·åœ°ä½¿ç”¨ï¼Œå¯¹åº“ä¸­çš„å‡½æ•°æ¯”è¾ƒç†Ÿæ‚‰ï¼Œæ¨èä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š
```python
from fvgtools.utils import *
# load_json("xxx")
# color.green("xxx")
```

æ›´åŠ å®‰å…¨çš„ä½¿ç”¨æ–¹å¼ï¼š
```python
from fvgtools import utils
# utils.load_json("xxx")
# utils.color.green("xxx")
```

## åŠŸèƒ½ç¤ºä¾‹
### å½©è‰²è¾“å‡º

```python
from fvgtools.utils import color

# åŸºç¡€é¢œè‰²
color.red("è¿™æ˜¯çº¢è‰²æ–‡æœ¬")
color.blue("è¿™æ˜¯è“è‰²æ–‡æœ¬")
color.green("è¿™æ˜¯ç»¿è‰²æ–‡æœ¬")

# è‡ªå®šä¹‰é¢œè‰²
color.custom("è‡ªå®šä¹‰é¢œè‰²", color="#ff5733")  # ä½¿ç”¨HEXé¢œè‰²
color.custom("è‡ªå®šä¹‰é¢œè‰²", color=(255, 87, 51))  # ä½¿ç”¨RGBé¢œè‰²

# æ–‡æœ¬æ ·å¼
color.bold("ç²—ä½“æ–‡æœ¬")
color.underline("ä¸‹åˆ’çº¿æ–‡æœ¬")
```

### æ–‡ä»¶æ“ä½œï¼ˆæ”¯æŒæœ¬åœ°å’ŒS3è·¯å¾„ï¼‰

```python
from fvgtools.utils import load_json, save_json, load_pickle, save_pickle
from fvgtools.utils import init_client

# åˆå§‹åŒ–S3å®¢æˆ·ç«¯ï¼ˆå¦‚æœéœ€è¦æ“ä½œS3è·¯å¾„ï¼‰
client = init_client("/path/to/aoss.conf")

# JSONæ“ä½œ
data = load_json("config.json")  # è¯»å–æœ¬åœ°JSON
data_s3 = load_json("s3://bucket/config.json", client=client)  # è¯»å–S3ä¸Šçš„JSON
save_json(data, "config_new.json", verbose=True)  # ä¿å­˜åˆ°æœ¬åœ°
save_json(data, "s3://bucket/config_new.json", client=client, verbose=True)  # ä¿å­˜åˆ°S3

# Pickleæ“ä½œ
obj = load_pickle("data.pkl")  # è¯»å–æœ¬åœ°Pickle
obj_s3 = load_pickle("s3://bucket/data.pkl", client=client)  # è¯»å–S3ä¸Šçš„Pickle
save_pickle(obj, "data_new.pkl", verbose=True)  # ä¿å­˜åˆ°æœ¬åœ°
save_pickle(obj, "s3://bucket/data_new.pkl", client=client, verbose=True)  # ä¿å­˜åˆ°S3

# æ–‡æœ¬æ–‡ä»¶æ“ä½œï¼ˆä»…æ”¯æŒæœ¬åœ°æ–‡ä»¶ï¼‰
from fvgtools.utils import load_txt_as_lines, save_lines_to_txt
lines = load_txt_as_lines("input.txt")
save_lines_to_txt(lines, "output.txt")
```

é’ˆå¯¹JSONLæ–‡ä»¶ï¼Œæä¾›äº†ä¸¤ç§è¯»å–å’Œå­˜å‚¨æ–¹å¼ï¼ˆå‡æ”¯æŒæœ¬åœ°å’ŒS3è·¯å¾„ï¼‰ï¼š

1. åˆ—è¡¨æ–¹å¼ï¼ˆè‡ªåŠ¨è§£æJSONï¼‰ï¼š
```python
# JSONLæ“ä½œ
from fvgtools.utils import load_jsonl_as_list, save_list_to_jsonl

# è¯»å–JSONLæ–‡ä»¶ï¼Œæ¯è¡Œè§£æä¸ºä¸€ä¸ªJSONå¯¹è±¡
data_list = load_jsonl_as_list("data.jsonl")  # æœ¬åœ°JSONL
data_list_s3 = load_jsonl_as_list("s3://bucket/data.jsonl", client=client)  # S3ä¸Šçš„JSONL

# å°†åˆ—è¡¨ä¿å­˜ä¸ºJSONLæ–‡ä»¶ï¼Œæ¯ä¸ªå…ƒç´ è½¬ä¸ºä¸€è¡ŒJSON
save_list_to_jsonl(data_list, "output.jsonl")
save_list_to_jsonl(data_list, "s3://bucket/output.jsonl", client=client)
```

2. å­—ç¬¦ä¸²è¡Œæ–¹å¼ï¼ˆä¿æŒåŸå§‹æ ¼å¼ï¼‰ï¼š
```python
from fvgtools.utils import load_jsonl_as_lines, save_lines_to_jsonl

# è¯»å–JSONLæ–‡ä»¶ï¼Œä¿æŒæ¯è¡Œçš„åŸå§‹å­—ç¬¦ä¸²æ ¼å¼
lines = load_jsonl_as_lines("data.jsonl")  # æœ¬åœ°æ–‡ä»¶
lines_s3 = load_jsonl_as_lines("s3://bucket/data.jsonl", client=client)  # S3æ–‡ä»¶

# ç›´æ¥ä¿å­˜å­—ç¬¦ä¸²è¡Œï¼Œä¸è¿›è¡ŒJSONè§£æ
save_lines_to_jsonl(lines, "output.jsonl")  # ä¿å­˜åˆ°æœ¬åœ°
save_lines_to_jsonl(lines, "s3://bucket/output.jsonl", client=client)  # ä¿å­˜åˆ°S3
```

ç‰¹åˆ«åœ°ï¼Œé’ˆå¯¹S3æ–‡ä»¶çš„æ“ä½œæ”¯æŒè·¨host baseæ“ä½œï¼Œå¯ä»¥åœ¨ä¸åŒçš„å­˜å‚¨é›†ç¾¤ä¹‹é—´ä¼ è¾“æ•°æ®ï¼š
```python
# ä»section1é…ç½®çš„å­˜å‚¨é›†ç¾¤è¯»å–æ•°æ®
data = load_jsonl_as_list("section1:s3://bucket/data.jsonl", client=client)

# ä¿å­˜åˆ°section2é…ç½®çš„å­˜å‚¨é›†ç¾¤
save_list_to_jsonl(data, "section2:s3://bucket/data.jsonl", client=client)
```
ä¾æ­¤ç±»æ¨ã€‚è¿™ä¸ºä¾‹å¦‚ä»å…¬æœ‰äº‘è¯»å–Mé›†ç¾¤æ•°æ®ï¼Œå¹¶å­˜å‚¨åˆ°ç¦å»ºé›†ç¾¤ï¼Œè¿™æ ·çš„åœºæ™¯æä¾›äº†ä¾¿åˆ©ã€‚

### Ceph/S3çš„ç›¸å…³æ“ä½œ
ç›®å‰ä¸»è¦æ”¯æŒäº†è·¯å¾„çš„è½¬æ¢ï¼Œå¿«é€Ÿåˆ‡åˆ†æ¡¶åå’Œå‰©ä½™è·¯å¾„ï¼›æ”¯æŒå¤šç§è·¯å¾„æ ¼å¼çš„åŠ è½½å›¾ç‰‡å‡½æ•°ã€‚
```python
from fvgtools.utils import general_load_image
from fvgtools.utils import s3path_to_ads, ads_to_s3path

# åŠ è½½å›¾ç‰‡ï¼Œæ­¤å¤„å¯ä»¥æ˜¯æœ¬åœ°è·¯å¾„ï¼Œnumpy.arrayï¼Œä¹Ÿå¯ä»¥æ˜¯S3è·¯å¾„
image = general_load_image("s3://bucket/image.jpg")

# S3è·¯å¾„è½¬æ¢
ads_path = s3path_to_ads("s3://bucket/file.txt")
s3_path = ads_to_s3path(ads_path)

# å¿«é€Ÿè·å–æ¡¶ä¸å‰©ä½™è·¯å¾„
bucket_name, path_left = split_s3path("s3://bucket/file.txt")
```

### è£…é¥°å™¨

```python
from fvgtools.utils import retry, timer

# é‡è¯•è£…é¥°å™¨
@retry(times=3)
def may_fail_function():
    # å¯èƒ½ä¼šå¤±è´¥çš„å‡½æ•°
    pass

# è®¡æ—¶è£…é¥°å™¨
@timer
def slow_function():
    # è€—æ—¶çš„æ“ä½œ
    pass
```

## ç›®å½•ç»“æ„

```
fvgtools/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ utils/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ color.pyï¼ˆé¢œè‰²æ‰“å°å·¥å…·ï¼‰
        â”œâ”€â”€ ceph_related.pyï¼ˆCephå­˜å‚¨ç›¸å…³åŠŸèƒ½ï¼‰
        â”œâ”€â”€ load_save.pyï¼ˆæ–‡ä»¶è¯»å†™åŠŸèƒ½ï¼‰
        â””â”€â”€ decorators.pyï¼ˆè£…é¥°å™¨å·¥å…·ï¼‰
```

## ç‰¹æ€§

- ç»Ÿä¸€çš„æ–‡ä»¶æ“ä½œæ¥å£ï¼Œæ— ç¼æ”¯æŒæœ¬åœ°æ–‡ä»¶å’ŒS3è·¯å¾„
- æ™ºèƒ½è·¯å¾„è¯†åˆ«ï¼Œè‡ªåŠ¨åˆ¤æ–­æ˜¯æœ¬åœ°è·¯å¾„è¿˜æ˜¯S3è·¯å¾„
- ä¸°å¯Œçš„é¢œè‰²è¾“å‡ºé€‰é¡¹ï¼Œæ”¯æŒRGBå’ŒHEXé¢œè‰²ä»£ç 
- å®Œæ•´çš„ä¸­æ–‡é”™è¯¯æç¤ºå’Œæ–‡æ¡£
- ç®€å•æ˜“ç”¨çš„APIè®¾è®¡
- å®ç”¨çš„è£…é¥°å™¨å·¥å…·é›†

## æ³¨æ„äº‹é¡¹

- S3æ“ä½œéœ€è¦æ­£ç¡®é…ç½®AOSSé…ç½®æ–‡ä»¶
- ä½¿ç”¨S3è·¯å¾„æ—¶éœ€è¦æä¾›å·²åˆå§‹åŒ–çš„clientå‚æ•°
- é¢œè‰²è¾“å‡ºåŠŸèƒ½ä¾èµ–äºç»ˆç«¯çš„ANSIæ”¯æŒ
- å›¾ç‰‡æ“ä½œéœ€è¦å®‰è£…PILåº“
- å»ºè®®åœ¨ä½¿ç”¨å‰æŸ¥çœ‹ç›¸å…³å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²äº†è§£è¯¦ç»†ç”¨æ³•

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥å¸®åŠ©æ”¹è¿›è¿™ä¸ªå·¥å…·åŒ…ã€‚

## è®¸å¯è¯

MIT License 
