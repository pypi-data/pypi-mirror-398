import{d as $,a8 as v,a9 as R,l as t,F as B,f as n,r as s,A as ee,C as G,b as te,L as ae,o as H,ay as se,az as ne,e as b,h as T,i as _,al as oe,w as o,aI as le,aa as U,ah as J,s as ue,t as re,a7 as q,S as ie,aJ as ce,as as M,V as O,ar as P,am as _e,aH as de,E as pe,a$ as j,b9 as me}from"./index-BwlMlHGj.js";import{d as fe,e as ve}from"./autoCali-BClfEyaO.js";import{_ as ge,D as ye}from"./DotLoader-D2SYMCz3.js";import{u as he}from"./autoCali-Bx2FKSKK.js";import"./Image-B_0rm4XX.js";import"./download-C2161hUv.js";const be=$({__name:"EntityLog",props:{logs:{}},setup(S){return(l,c)=>t(B)(l.logs)?R("",!0):(n(),v(ge,{key:0,logs:l.logs},null,8,["logs"]))}}),xe={class:"flex ml-5"},F=120,ke=$({__name:"EntitiesView",props:{entities:{}},setup(S){const l=s(!1),c=he(),p=ee(),x=G(),{t:z}=te(),u=s(),e=s(),m=s(0),A=s(),g=s(0),i=s(!1),k=s(),D=S,Q=ae(()=>{const r=D.entities.length;return Array(r<F?F:r).fill(0).map((a,f)=>D.entities[f])}),W=r=>{r&&(k.value||(k.value=!0,u.value=r,e.value=[],A.value=[],m.value=0,g.value=0,i.value=!0,y()))},y=async()=>{var f,E,h,L,N;if(!l.value||!u.value||!x.query.session_id)return;i.value=!0;const[r,a]=await fe({session_id:+x.query.session_id,entity:u.value,last_record_id:m.value});k.value=!1,!r&&(a==null?void 0:a.status)===0&&(m.value!==((f=a.data)==null?void 0:f.last_record_id)&&((E=a.data)!=null&&E.last_record_id)&&(e.value=[...(h=a.data)==null?void 0:h.logs.reverse(),...e.value||[]]),(L=a.data)!=null&&L.last_record_id&&(m.value=(N=a.data)==null?void 0:N.last_record_id),pe(()=>{var V,I;((V=c.sessionInfo)==null?void 0:V.status)===j.RUNNING&&X(),((I=c.sessionInfo)==null?void 0:I.status)!==j.RUNNING&&(i.value=!1)}))},C=s(),X=()=>{C.value=setTimeout(()=>{y(),K()},3e3)},K=()=>{C.value&&(clearInterval(C.value),C.value=null)},w=s(0),Y=r=>{w.value=r,u.value&&y()};return H(()=>{l.value=!0,y()}),se(()=>{l.value=!0,y()}),ne(()=>{l.value=!1,K()}),(r,a)=>{const f=ce,E=le,h=oe,L=_e,N=de,V=P,I=M;return n(),b("div",xe,[T("div",null,[_(h,{style:{height:"calc(100vh - 310px)"}},{default:o(()=>[_(E,{cols:10,style:{width:"560px"}},{default:o(()=>[(n(!0),b(U,null,J(t(Q),(d,Z)=>(n(),v(f,{key:Z,class:ie(["border min-w-14 min-h-14 flex items-center justify-center p-1",[d?"cursor-pointer":""]]),style:q({borderColor:t(p).dividerColor,backgroundColor:t(u)===d&&t(u)?"#00B42A":"inherit",color:t(u)===d?"#fff":"inherit"}),onClick:()=>W(d)},{default:o(()=>[ue(re(d),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),_(I,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:t(w),"onUpdate:value":a[0]||(a[0]=d=>O(w)?w.value=d:null),onUpdateValue:Y},{suffix:o(()=>[t(i)?(n(),v(ye,{key:0})):R("",!0)]),default:o(()=>[_(V,{name:0,key:"0",tab:t(z)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[_(h,{style:q({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:t(p).baseColor})},{default:o(()=>[t(k)?(n(),v(L,{key:0})):(n(),b(U,{key:1},[_(be,{logs:t(e)},null,8,["logs"]),t(B)(t(e))?(n(),v(N,{key:0,class:"mt-32"})):R("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),Ie=$({__name:"AutoCaliEntity",setup(S){const l=G(),c=s(),p=s(),x=async()=>{const[u,e]=await ve({device_group_name:l.query.device_group_name,space_id:+l.query.space_id});!u&&(e==null?void 0:e.status)===0&&(p.value=e.data,c.value=Object.keys(e.data)[0])},z=()=>{};return H(()=>{x()}),(u,e)=>{const m=P,A=M;return n(),b("div",null,[_(A,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:t(c),"onUpdate:value":e[0]||(e[0]=g=>O(c)?c.value=g:null),onUpdateValue:z,"tab-class":"w-[128px]"},me({suffix:o(()=>[e[2]||(e[2]=T("div",null,null,-1))]),default:o(()=>[(n(!0),b(U,null,J(t(p),(g,i)=>(n(),v(m,{name:i,key:i,tab:i},{default:o(()=>[_(ke,{"active-key":i,entities:g},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[t(B)(t(p))?void 0:{name:"prefix",fn:o(()=>[e[1]||(e[1]=T("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{Ie as default};
