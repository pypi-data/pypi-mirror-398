import{d as E,b as F,r as x,a8 as $,f as I,W as A,l as s,V as q,w as u,i as o,k as ne,h as N,m as le,n as ie,p as re,B as Y,s as H,t as U,v as V,I as i,aO as K,ap as G,aQ as z,C as B,a3 as W,E as J,aK as R,ao as O,aP as P,ad as X,a9 as pe,j as Z,F as ue,a2 as ee,K as ce,az as te,c as _e,ay as de,aR as me,U as fe,N as ge,aS as ve,aq as xe}from"./index-BwlMlHGj.js";import{c as ke,S as ye,g as he}from"./StarOutline-DlU6FzvB.js";import{u as ae}from"./useInterval-C0oJbCEJ.js";import{_ as se}from"./PaginationView.vue_vue_type_script_setup_true_lang-IR55gl3R.js";import{u as we}from"./groupDetail-Bjf-6Lmm.js";import{a as De,t as be,R as Le,g as Te}from"./RecordStop24Regular-A3Huc0_U.js";import{_ as Ce}from"./ConfirmModal.vue_vue_type_script_setup_true_lang-DPOFDHZH.js";import{_ as Q}from"./DataTable-CfoqEf8t.js";import{u as Se}from"./expList-CPsdoT0A.js";import{s as Me}from"./exp-BFwh7v1l.js";import{_ as Re}from"./BackToOverview.vue_vue_type_script_setup_true_lang-B3HE7W32.js";import{A as $e}from"./Add-CvJqOuqG.js";import"./Pagination-Do-f8cxW.js";import"./Checkbox-UFZekRDE.js";import"./RadioGroup-BB1a5vev.js";import"./download-C2161hUv.js";import"./ExitOutline-BKfO8kvq.js";const Ie={class:"flex justify-end"},qe=E({__name:"CreateTask",emits:["success"],setup(j,{expose:d,emit:D}){const c=D,{t:n}=F(),m=we(),p=x(!1),r=x(),_=x({title:void 0,description:void 0,space_name:void 0}),b={title:{required:!0,message:"groupDetail.taskList.taskTitleErrMsg"},description:{required:!0,message:"groupDetail.taskList.descErrMsg"},space_name:{required:!0,message:"groupDetail.taskList.idErrMsg"}},h=x(!1),f=()=>{h.value=!1,_.value={title:void 0,description:void 0,space_name:void 0}},S=k=>{k||f()},L=()=>{var k;p.value||(p.value=!0,(k=r.value)==null||k.validate(async l=>{var t;if(l){p.value=!1;return}const[g,v]=await ke({..._.value,device_group_name:(t=m.groupInfo)==null?void 0:t.device_group_name});p.value=!1,!g&&v&&v.status===0&&(f(),c("success"))}))},C=k=>i("div",{class:"flex gap-3 items-baseline"},[i("div",{class:"text-base"},`${k.label}`),i("div",{class:"text-xs opacity-50"},`[${new Date(k.create_time).toLocaleString()}] ${k.description}`)]);return d({open:()=>h.value=!0,close:f}),(k,l)=>{const g=ie,v=le,t=re,e=Y,a=ne,w=V,T=A;return I(),$(T,{show:s(h),"onUpdate:show":l[3]||(l[3]=y=>q(h)?h.value=y:null),"on-update:show":S},{default:u(()=>[o(w,{style:{width:"600px"},size:"huge",bordered:!1,role:"dialog","aria-modal":"true"},{default:u(()=>[o(a,{ref_key:"formRef",ref:r,model:s(_),rules:b},{default:u(()=>[o(v,{label:s(n)("groupDetail.taskList.taskTitleLabel"),path:"title"},{default:u(()=>[o(g,{value:s(_).title,"onUpdate:value":l[0]||(l[0]=y=>s(_).title=y),placeholder:s(n)("groupDetail.taskList.taskTitlePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(v,{label:s(n)("groupDetail.taskList.descLabel"),path:"description"},{default:u(()=>[o(g,{value:s(_).description,"onUpdate:value":l[1]||(l[1]=y=>s(_).description=y),placeholder:s(n)("groupDetail.taskList.descPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(v,{label:s(n)("groupDetail.taskList.spaceLabel"),path:"space_name"},{default:u(()=>[o(t,{value:s(_).space_name,"onUpdate:value":l[2]||(l[2]=y=>s(_).space_name=y),placeholder:s(n)("groupDetail.taskList.spacePlaceholder"),options:s(m).spaceList,"render-label":C},null,8,["value","placeholder","options"])]),_:1},8,["label"]),N("div",Ie,[o(e,{type:"primary",loading:s(p),onClick:L},{default:u(()=>[H(U(s(n)("groupDetail.taskList.createTask")),1)]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),Ne={class:"text-xl font-bold text-center"},Ue=E({__name:"FavorityList",setup(j,{expose:d}){const D=K(),{t:c}=F(),n=x(!1),m=x(!1),p=x(),r=G({page:1,per_page:z,total:0}),_=B(),b=()=>{m.value=!1,p.value=[],L.value=void 0},h=t=>{t||b()},f=async()=>{var w;if(n.value)return;n.value=!0;const t=r.page,[e,a]=await De({device_group_name:_.query.device_group_name,page:t,per_page:r.per_page});n.value=!1,!e&&(a==null?void 0:a.status)==0&&(ue((w=a.data)==null?void 0:w.list)||(r.page=t),r.total=a.data.total,p.value=a.data.list||[])};W(m,t=>{t&&(r.page=1,r.total=0,J(()=>{f()}))});const S=t=>{const e=new URLSearchParams({device_group_name:_.query.device_group_name,task_id:t.task_id,task_title:t.task_title,space_id:t.space_id,exp_id:String(t.sub_process_id)});window.open(`/experiment/plotter?${e.toString()}`,D.expOpenForm)};d({open:()=>m.value=!0});const L=x(),C=x(),k=(t,e)=>{var a;e.preventDefault(),e.stopPropagation(),L.value=t,(a=C.value)==null||a.open()},l=async()=>{var a;if(!L.value)return;const[t,e]=await be({exp_id:L.value.sub_process_id,is_marked:!L.value.is_marked});!t&&(e==null?void 0:e.status)===0&&(f(),(a=C.value)==null||a.close())},g=[{title:c("groupDetail.exps.expTableId"),key:"sub_process_id",width:100},{title:c("groupDetail.exps.expTableTitle"),key:"title",width:200,render(t){return i(R,{lineClamp:1},{default:()=>t.title})}},{title:c("groupDetail.exps.expTableDesc"),key:"description",width:200,render(t){return i(R,{lineClamp:1},{default:()=>t.description})}},{title:c("groupDetail.exps.expTableStatus"),key:"status",width:180,render(t){return i("div",{class:"flex items-center"},[i(O,{color:{color:P[t.status].color,textColor:"#fff"},bordered:!1,class:"w-[180px] flex items-center justify-between text-xs"},{default:()=>{var e;return[i("span",c((e=P[t.status])==null?void 0:e.text)),i("span",t.progress)]}})])}},{title:c("groupDetail.exps.expTableCreateTime"),key:"create_timestamp",width:180,render(t){return X(t.create_timestamp*1e3).format("YYYY-MM-DD HH:mm:ss")}},{title:c("groupDetail.exps.expTableMarkNote"),key:"mark_note",render(t){return i(R,{lineClamp:1},{default:()=>t.mark_note||"-"})}},{title:c("groupDetail.exps.expTableAction"),key:"actions",align:"center",render(t){return i(Y,{onClick:e=>k(t,e),size:"small",quaternary:!0,type:"primary"},{icon:()=>i(ye),default:()=>c("groupDetail.exps.unfavority")})}}],v=t=>({class:"cursor-pointer",onClick:()=>{S(t)}});return(t,e)=>{const a=Z,w=Q,T=V,y=A;return I(),$(y,{show:s(m),"onUpdate:show":e[1]||(e[1]=M=>q(m)?m.value=M:null),onUpdateShow:h},{default:u(()=>[o(T,{style:{width:"1300px"}},{default:u(()=>[N("div",Ne,U(s(c)("groupDetail.exps.favorites")),1),o(a),o(w,{columns:g,data:s(p),pagination:!1,"row-props":v,"max-height":"calc(100vh - 400px)"},null,8,["columns","data"]),s(r).total>s(z)?(I(),$(se,{key:0,"page-info":s(r),"onUpdate:pageInfo":e[0]||(e[0]=M=>q(r)?r.value=M:null),onUpdateList:f},null,8,["page-info"])):pe("",!0),o(Ce,{ref_key:"confirmModalRef",ref:C,contentTips:s(c)("groupDetail.exps.unfavorityTips"),onOk:l},null,8,["contentTips"])]),_:1})]),_:1},8,["show"])}}}),Pe=ee(Ue,[["__scopeId","data-v-7f8a8260"]]),Ee={class:"text-xl font-bold text-center"},Fe=E({__name:"ExpQueue",setup(j,{expose:d}){const D=ce(),c=K(),{t:n}=F(),m=x(!1),p=x(!1),r=x(),_=B(),b=()=>{p.value=!1,r.value=[],l.value=void 0},h=e=>{e||b()},f=async()=>{if(m.value)return;m.value=!0;const[e,a]=await Te({device_group_name:_.query.device_group_name});m.value=!1,!e&&(a==null?void 0:a.status)==0&&(r.value=a.data.list||[])},{stop:S,start:L,runing:C}=ae(f,{isManual:!0,duration:2*1e3});W(p,e=>{e&&!C.value?(f(),L()):e||S()}),te(()=>{S()});const k=e=>{const a=new URLSearchParams({device_group_name:_.query.device_group_name,task_id:e.task_id,task_title:e.task_title,space_id:e.space_id,exp_id:String(e.exp_id)});window.open(`/experiment/plotter?${a.toString()}`,c.expOpenForm)};d({open:()=>p.value=!0});const l=x(),g=async(e,a)=>{a.stopPropagation();const[w,T]=await Me({exp_id:e.exp_id});!w&&(T==null?void 0:T.status)===0&&(D.success("实验终止成功"),f())},v=[{title:n("groupDetail.exps.expTableId"),key:"exp_id",width:100},{title:n("groupDetail.exps.expTableTitle"),key:"exp_name",width:200,render(e){return i(R,{lineClamp:1},{default:()=>e.exp_name})}},{title:n("groupDetail.exps.expTableDesc"),key:"description",width:200,render(e){return i(R,{lineClamp:1},{default:()=>e.description})}},{title:n("groupDetail.exps.expTableSpaceName"),key:"space_name",width:120},{title:n("groupDetail.exps.expTableStatus"),key:"status",width:180,render(e){return i("div",{class:"flex items-center"},[i(O,{color:{color:P[e.status].color,textColor:"#fff"},bordered:!1,class:"w-[180px] flex items-center justify-center text-xs"},{default:()=>{var a;return[i("span",n((a=P[e.status])==null?void 0:a.text)),i("span",e.process)]}})])}},{title:n("groupDetail.exps.expTableCreateTime"),key:"create_time",width:180,render(e){return X(e.create_time*1e3).format("YYYY-MM-DD HH:mm:ss")}},{title:n("groupDetail.exps.expTableCreator"),key:"create_user_name",width:80},{title:n("groupDetail.exps.expTableAction"),key:"actions",align:"center",render(e){return i(Y,{size:"small",quaternary:!0,type:"primary",onClick:a=>g(e,a)},{icon:()=>i(Le),default:()=>n("groupDetail.exps.stop")})}}],t=e=>({class:"cursor-pointer",onClick:()=>{k(e)}});return(e,a)=>{const w=Z,T=Q,y=V,M=A;return I(),$(M,{show:s(p),"onUpdate:show":a[0]||(a[0]=oe=>q(p)?p.value=oe:null),onUpdateShow:h},{default:u(()=>[o(y,{style:{width:"1200px"}},{default:u(()=>[N("div",Ee,U(s(n)("groupDetail.exps.expQueue")),1),o(w),o(T,{columns:v,data:s(r),pagination:!1,"row-props":t,"max-height":"calc(100vh - 400px)"},null,8,["columns","data"])]),_:1})]),_:1},8,["show"])}}}),Ye=ee(Fe,[["__scopeId","data-v-fd744c03"]]),je={class:"flex justify-between items-center gap-5 mb-5"},ze={class:"text-xl"},nt=E({__name:"TaskList",setup(j){const{t:d}=F(),D=Se(),c=_e(),n=B(),m=x(),p=x(),r=[{title:d("groupDetail.taskList.id"),key:"task_id",width:100,render(l){return i(O,{type:"success",size:"small",class:"min-w-[60px] flex justify-center items-center",color:{color:"#b63636",textColor:"#fff"}},{default:()=>l.task_id})}},{title:d("groupDetail.taskList.title"),key:"title"},{title:d("groupDetail.taskList.description"),key:"description"},{title:d("groupDetail.taskList.spaceName"),key:"space_name"},{title:d("groupDetail.taskList.source"),key:"source",width:100},{title:d("groupDetail.taskList.createTime"),key:"create_time",width:180},{title:d("createuser"),key:"user_name"},{title:d("groupDetail.taskList.progress"),key:"progress"}],_=({task_id:l,title:g,space_id:v})=>({class:"cursor-pointer",onClick:()=>{D.curNode=void 0,D.loadingCurNode=!0,D.curExpList=[],D.curExpNode=void 0,D.curFolderNode=void 0,J(()=>{c.push({name:"experimentList",query:{task_id:l,task_title:g,space_id:v,...n.query}})})}}),b=G({page:1,per_page:z,total:0}),h=x(),f=async(l={})=>{var e;const g=n.query.device_group_name;if(!g)return;const[v,t]=await he({...((e=p.value)==null?void 0:e.searchParasm)||{},...l,...xe(b),device_group_name:g});!v&&t&&t.status===0&&(h.value=t.data.list,b.total=t.data.total)},S=()=>{var l;(l=m.value)==null||l.open()},{start:L,stop:C,runing:k}=ae(f,{isManual:!0});return de(()=>{k.value||(f(),L())}),te(()=>{C()}),(l,g)=>{const v=ge,t=Y,e=fe,a=Q,w=me,T=ve;return I(),$(T,{"has-sider":""},{default:u(()=>[o(w,null,{default:u(()=>[N("div",je,[o(Re,null,{default:u(()=>[N("div",ze,U(s(d)("groupDetail.taskList.tabName")),1)]),_:1}),o(e,null,{default:u(()=>[o(t,{type:"primary",onClick:S},{icon:u(()=>[o(v,null,{default:u(()=>[o(s($e))]),_:1})]),default:u(()=>[H(" "+U(s(d)("groupDetail.taskList.createTask")),1)]),_:1})]),_:1})]),o(a,{columns:r,data:s(h),pagination:!1,"row-props":_,"max-height":"calc(100vh - 400px)"},null,8,["data"]),o(se,{"page-info":s(b),"onUpdate:pageInfo":g[0]||(g[0]=y=>q(b)?b.value=y:null),onUpdateList:f},null,8,["page-info"]),o(qe,{ref_key:"createTaskRef",ref:m,onSuccess:f},null,512),o(Pe,{ref:"favorityListRef"},null,512),o(Ye,{ref:"expQueueRef"},null,512)]),_:1})]),_:1})}}});export{nt as default};
