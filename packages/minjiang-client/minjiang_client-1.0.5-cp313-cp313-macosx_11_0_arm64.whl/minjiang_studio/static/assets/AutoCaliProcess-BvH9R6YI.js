import{C as W}from"./CommingSoon-DLAzaSwV.js";import{d as K,e as p,f as l,h as y,r as i,A as X,b as Y,C as Z,L as ee,o as te,E as q,ay as ae,az as se,a3 as oe,F as j,i as m,w as C,aa as M,ah as re,l as e,a9 as A,a7 as $,t as I,ao as le,aP as x,s as L,j as ne,N as ie,al as ce,a8 as V}from"./index-BwlMlHGj.js";import{b as ue,c as de}from"./autoCali-BClfEyaO.js";import{D as _e,_ as fe}from"./DotLoader-D2SYMCz3.js";import"./Image-B_0rm4XX.js";import"./download-C2161hUv.js";import"./autoCali-Bx2FKSKK.js";const ve={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},me=K({name:"ChevronDown",render:function(N,k){return l(),p("svg",ve,k[0]||(k[0]=[y("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1)]))}}),pe={class:"flex p-5 pb-0"},he=["onClick"],ge={class:"flex-1 break-all"},xe={key:0,class:"flex items-center justify-between pt-2"},ye={class:"flex flex-1 items-center flex-col"},Ne={key:0,class:"flex gap-2 items-center mb-5 text-lg"},De=K({__name:"AutoCaliProcess",setup(O){const N=i(!1),k=X(),{t:F}=Y(),c=Z(),R=i(),o=i(),n=ee(()=>{var r;return(r=R.value)==null?void 0:r.find(s=>s.node_id===o.value)}),w=i(!0),u=i(),T=i(!1),h=i(0),b=async()=>{var f,v,g,d,a,D,G,P;if(!N.value||!o.value||!c.query.session_id)return;w.value=!0;const r={node_id:o.value,session_id:+c.query.session_id,last_record_id:h.value},[s,t]=await ue(r);T.value=!1,!s&&(t==null?void 0:t.status)===0&&(((v=(f=t.data)==null?void 0:f.logs)==null?void 0:v.find(U=>{if(typeof U.msg=="string")return U.msg.includes("COMPLETE")}))?(stop(),w.value=!1,h.value!==t.data.last_record_id&&t.data.last_record_id&&(u.value=[...(g=t.data)==null?void 0:g.logs.reverse(),...u.value||[]]),t.data.last_record_id&&(h.value=t.data.last_record_id),((d=n.value)==null?void 0:d.status)==="RUNNING"&&B()):(h.value!==t.data.last_record_id&&t.data.last_record_id&&(u.value=[...(a=t.data)==null?void 0:a.logs.reverse(),...u.value||[]]),t.data.last_record_id&&(h.value=t.data.last_record_id),((D=n.value)==null?void 0:D.status)==="RUNNING"&&(J(),w.value=!0),((G=n.value)==null?void 0:G.status)!=="RUNNING"&&(stop(),b()),((P=n.value)==null?void 0:P.status)!=="RUNNING"&&(w.value=!1)))},B=async()=>{var t,f,v;if(!N.value||!c.query.session_id)return;const[r,s]=await de({session_id:+c.query.session_id});!r&&(s==null?void 0:s.status)===0&&(R.value=s.data,(t=s.data)!=null&&t.find(d=>d.node_id===o.value)||(o.value=(f=s.data[0])==null?void 0:f.node_id,q(()=>{b()})),(v=s.data)!=null&&v.find(d=>d.status=="RUNNING")||z())},S=i(),H=()=>{S.value&&(clearInterval(S.value),_.value=null)},J=()=>{S.value=setTimeout(()=>{b()},10*1e3)},_=i(),z=()=>{_.value&&(clearInterval(_.value),_.value=null)},E=()=>{_.value=setInterval(()=>{B()},10*1e3)};te(()=>{c.query.node_id&&(o.value=+c.query.node_id),N.value=!0,q(()=>{_.value||(B(),E())})}),ae(()=>{c.query.node_id&&(o.value=+c.query.node_id),N.value=!0,q(()=>{_.value||(B(),E())})}),se(()=>{z(),H()}),oe(n,r=>{j(r)||q(()=>{b()})});const Q=r=>{T.value||(T.value=!0,u.value=void 0,o.value=r,h.value=0,b())};return(r,s)=>{const t=le,f=ne,v=ie,g=ce,d=W;return l(),p("div",pe,[y("div",null,[m(g,{style:{height:"calc(100vh - 335px)","padding-right":"40px"}},{default:C(()=>[(l(!0),p(M,null,re(e(R),(a,D)=>(l(),p("div",{key:a.node_id,class:"cursor-pointer"},[y("div",{class:"px-2 pb-2 pt-2.5 w-full max-w-96 border text-center min-w-72 flex items-center",style:$({borderTopLeftRadius:"40px",borderBottomLeftRadius:"40px",borderTopRightRadius:"100px",borderBottomRightRadius:"100px",backgroundColor:e(o)===a.node_id?"rgba(0, 180, 42, 0.15)":"inherit",borderColor:e(o)===a.node_id?"rgb(0, 180, 42)":"#999A9B",color:e(o)===a.node_id?e(k).primaryColor:"inherit"}),onClick:()=>Q(a.node_id)},[y("span",ge,I(a.node_name),1),m(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full !w-20 !flex !items-center !justify-center",color:{color:e(x)[a.status].color}},{default:C(()=>[L(I(e(F)(e(x)[a.status].text)),1)]),_:2},1032,["color"])],12,he),D<e(R).length-1?(l(),p("div",xe,[y("div",ye,[m(f,{class:"!h-10 !bg-[#999A9B]",vertical:""}),m(v,{class:"-mt-2",color:"#999A9B",component:e(me)},null,8,["component"])]),m(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full invisible !w-20",color:{color:e(x)[a.status].color}},{default:C(()=>[L(I(e(F)(e(x)[a.status].text)),1)]),_:2},1032,["color"])])):A("",!0)]))),128))]),_:1})]),y("div",{class:"border-l pl-10 flex-1",style:$({borderColor:e(k).dividerColor})},[m(g,{style:{height:"calc(100vh - 335px)"}},{default:C(()=>{var a;return[e(j)(e(n))?A("",!0):(l(),p("div",Ne,[L(I((a=e(n))==null?void 0:a.node_name)+" ",1),m(t,{size:"tiny",color:{color:e(x)[e(n).status].color}},{default:C(()=>[L(I(e(F)(e(x)[e(n).status].text)),1)]),_:1},8,["color"]),e(w)?(l(),V(_e,{key:0})):A("",!0)])),Array.isArray(e(u))&&e(u).length===0?(l(),V(d,{key:1,class:"h-full"})):(l(),p(M,{key:2},[e(T)?A("",!0):(l(),V(fe,{key:0,logs:e(u)},null,8,["logs"]))],64))]}),_:1})],4)])}}});export{De as default};
