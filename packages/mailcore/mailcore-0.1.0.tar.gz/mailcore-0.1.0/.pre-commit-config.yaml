# Pre-commit hooks
# See https://pre-commit.com for more information

repos:
  # Ruff - Fast Python linter and formatter
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.6
    hooks:
      - id: ruff
        args: [--fix]
        name: ruff linting
      - id: ruff-format
        name: ruff formatting

  # Mypy - Static type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.18.2
    hooks:
      - id: mypy
        name: mypy type checking
        args: [--ignore-missing-imports]
        exclude: ^tests/  # Skip type checking for tests

  # Detect-secrets - Prevent committing secrets
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: detect secrets
        args: ['--baseline', '.secrets.baseline']
        exclude: package.lock.json

  # Local hooks - Run project-specific tools
  - repo: local
    hooks:
      - id: no-future-annotations
        name: prevent from __future__ import annotations
        entry: bash -c 'if grep -r "from __future__ import annotations" src/ tests/; then echo "ERROR - Do not use from __future__ import annotations (Python 3.10+ has native support)"; exit 1; fi'
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]
      
      - id: pytest-coverage
        name: pytest with 60% coverage
        entry: bash -c 'uv run pytest tests/ --cov=src/mailcore --cov-fail-under=60 --cov-report=term-missing:skip-covered'
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

# Configuration
default_stages: [pre-commit]
fail_fast: false  # Run all hooks even if one fails
