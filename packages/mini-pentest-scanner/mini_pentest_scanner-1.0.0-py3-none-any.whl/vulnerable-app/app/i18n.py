"""
Internationalization (i18n) Support
รองรับหลายภาษา: ไทย และ อังกฤษ
"""

# Translation dictionaries
TRANSLATIONS = {
    'en': {
        # Navigation
        'nav_home': 'Home',
        'nav_dashboard': 'Dashboard',
        'nav_profile': 'Profile',
        'nav_admin': 'Admin',
        'nav_login': 'Login',
        'nav_logout': 'Logout',
        'nav_register': 'Register',
        'nav_search': 'Search',
        
        # Common
        'welcome': 'Welcome to Mini Pentest Lab',
        'subtitle': 'Security Testing Environment',
        'warning_banner': '⚠️ For educational purposes only! Not for production use',
        
        # Home page
        'home_title': 'Welcome to Mini Pentest Lab',
        'home_description': 'This is a vulnerable web application designed for educational purposes and security awareness training.',
        'home_objectives': 'Objectives:',
        'home_obj1': 'Understand how security vulnerabilities occur',
        'home_obj2': 'Analyze security risks and their impact',
        'home_obj3': 'Learn proper security mitigation techniques',
        'home_getting_started': 'Getting Started',
        'home_step1': 'Login using the default test accounts',
        'home_step2': 'Explore the application features and functionality',
        'home_step3': 'Open Browser DevTools to inspect requests and responses',
        'home_step4': 'Review the source code in app/auth.py and app/routes.py',
        'home_step5': 'Identify vulnerabilities and consider remediation strategies',
        'home_test_accounts': 'Test Accounts',
        'home_vulnerabilities': 'Vulnerability Categories',
        'home_get_started': 'Get Started - Login',
        
        # Login
        'login_title': 'User Authentication',
        'login_username': 'Username',
        'login_password': 'Password',
        'login_submit': 'Sign In',
        'login_no_account': "Don't have an account?",
        'login_register_link': 'Register here',
        'login_tip': 'Learning Tip',
        'login_tip_text': 'Open Browser DevTools (F12) and navigate to the Network tab to observe HTTP requests and responses during authentication.',
        
        # Register
        'register_title': 'Create Account',
        'register_email_optional': '(optional)',
        'register_submit': 'Create Account',
        'register_have_account': 'Already have an account?',
        'register_login_link': 'Sign in here',
        
        # Dashboard
        'dashboard_title': 'Dashboard',
        'dashboard_welcome': 'Welcome back,',
        'dashboard_role': 'Role:',
        'dashboard_your_posts': 'Your Posts',
        'dashboard_create_post': 'Create New Post',
        'dashboard_no_posts': "You don't have any posts yet.",
        'dashboard_create_first': 'Create Your First Post',
        'dashboard_quick_links': 'Quick Links',
        'dashboard_view_profile': 'View Your Profile',
        'dashboard_search_posts': 'Search Posts',
        
        # Profile
        'profile_title': 'User Profile',
        'profile_user_id': 'User ID',
        'profile_username': 'Username',
        'profile_email': 'Email',
        'profile_role': 'Role',
        
        # Search
        'search_title': 'Search',
        'search_query': 'Search Query',
        'search_placeholder': 'Enter search term...',
        'search_results': 'Search Results',
        'search_no_results': 'No results found',
        'search_xss_notice': 'Security Notice: XSS Vulnerability',
        'search_xss_text': 'This page contains a Cross-Site Scripting (XSS) vulnerability. User input is not properly sanitized before being rendered in the response.',
        'search_test_payload': 'Test payload:',
        
        # Post
        'post_create_title': 'Create New Post',
        'post_title': 'Post Title',
        'post_content': 'Content',
        'post_content_placeholder': 'Enter post content...',
        'post_publish': 'Publish Post',
        'post_vulnerabilities': 'Security Vulnerabilities',
        'post_xss': 'XSS: User input is not sanitized before being rendered in the response.',
        'post_csrf': 'CSRF: No CSRF token protection is implemented for form submissions.',
        'post_view_author': 'Author:',
        'post_view_date': 'Date:',
        
        # Admin
        'admin_title': 'Administration Panel',
        'admin_description': 'System administration and user management interface.',
        'admin_users': 'User Management',
        'admin_posts': 'Content Management',
        
        # Error
        'error_title': 'Error',
        'error_return': 'Return to Home',
        'error_disclosure': 'Security Notice: Information Disclosure',
        'error_disclosure_text': 'This error message may disclose excessive information about the system. In a production environment, error messages should be generic and not reveal internal system details, stack traces, or file paths.',
        
        # Flash messages
        'flash_welcome': 'Welcome back, {}!',
        'flash_login_required': 'Please login to access this page',
        'flash_logged_out': 'You have been logged out',
        'flash_registration_success': 'Registration successful! Please login.',
        'flash_post_created': 'Post created successfully!',
        'flash_invalid_credentials': 'Invalid username or password',
        'flash_username_required': 'Username and password are required',
        'flash_username_exists': 'Username already exists',
        
        # IDOR notice
        'idor_notice': 'Security Notice: IDOR Vulnerability',
        'idor_text': 'This page demonstrates an Insecure Direct Object Reference (IDOR) vulnerability. Try modifying the user ID in the URL (e.g., /profile/1 or /profile/2) to access other users\' profiles.',
        'idor_note': 'Note: This vulnerability occurs because the application does not verify that the authenticated user has permission to access the requested resource.',
        
        # XSS notice
        'xss_notice': 'Security Notice: XSS Vulnerability',
        'xss_text': 'Post content is not sanitized before being rendered. If the content contains script tags, they will be executed in the browser, demonstrating a Cross-Site Scripting (XSS) vulnerability.',
        
        # Table headers
        'table_id': 'ID',
        'table_title': 'Title',
        'table_content': 'Content',
        'table_author': 'Author',
        'table_created_at': 'Created At',
        'table_action': 'Action',
        'table_field': 'Field',
        'table_value': 'Value',
        'table_role': 'Role',
        'table_username': 'Username',
        'table_email': 'Email',
    },
    'th': {
        # Navigation
        'nav_home': 'หน้าแรก',
        'nav_dashboard': 'แดชบอร์ด',
        'nav_profile': 'โปรไฟล์',
        'nav_admin': 'ผู้ดูแลระบบ',
        'nav_login': 'เข้าสู่ระบบ',
        'nav_logout': 'ออกจากระบบ',
        'nav_register': 'สมัครสมาชิก',
        'nav_search': 'ค้นหา',
        
        # Common
        'welcome': 'ยินดีต้อนรับสู่ Mini Pentest Lab',
        'subtitle': 'สภาพแวดล้อมทดสอบความปลอดภัย',
        'warning_banner': '⚠️ ใช้เพื่อการศึกษาเท่านั้น! ไม่ควรใช้ใน production',
        
        # Home page
        'home_title': 'ยินดีต้อนรับสู่ Mini Pentest Lab',
        'home_description': 'นี่คือเว็บแอปพลิเคชันที่มีช่องโหว่สำหรับการศึกษาและฝึกอบรมด้านความปลอดภัย',
        'home_objectives': 'วัตถุประสงค์:',
        'home_obj1': 'เข้าใจว่าช่องโหว่ด้านความปลอดภัยเกิดขึ้นได้อย่างไร',
        'home_obj2': 'วิเคราะห์ความเสี่ยงด้านความปลอดภัยและผลกระทบ',
        'home_obj3': 'เรียนรู้เทคนิคการป้องกันที่ถูกต้อง',
        'home_getting_started': 'วิธีเริ่มต้น',
        'home_step1': 'เข้าสู่ระบบด้วยบัญชีทดสอบเริ่มต้น',
        'home_step2': 'สำรวจฟีเจอร์ต่างๆ ของแอปพลิเคชัน',
        'home_step3': 'เปิด Browser DevTools เพื่อตรวจสอบ requests และ responses',
        'home_step4': 'อ่านโค้ดใน app/auth.py และ app/routes.py',
        'home_step5': 'ระบุช่องโหว่และพิจารณาวิธีการแก้ไข',
        'home_test_accounts': 'บัญชีทดสอบ',
        'home_vulnerabilities': 'ประเภทช่องโหว่',
        'home_get_started': 'เริ่มต้น - เข้าสู่ระบบ',
        
        # Login
        'login_title': 'การยืนยันตัวตน',
        'login_username': 'ชื่อผู้ใช้',
        'login_password': 'รหัสผ่าน',
        'login_submit': 'เข้าสู่ระบบ',
        'login_no_account': 'ยังไม่มีบัญชี?',
        'login_register_link': 'สมัครสมาชิกที่นี่',
        'login_tip': 'เคล็ดลับการเรียนรู้',
        'login_tip_text': 'เปิด Browser DevTools (F12) และไปที่แท็บ Network เพื่อดู HTTP requests และ responses ระหว่างการยืนยันตัวตน',
        
        # Register
        'register_title': 'สร้างบัญชี',
        'register_email_optional': '(ไม่บังคับ)',
        'register_submit': 'สร้างบัญชี',
        'register_have_account': 'มีบัญชีแล้ว?',
        'register_login_link': 'เข้าสู่ระบบที่นี่',
        
        # Dashboard
        'dashboard_title': 'แดชบอร์ด',
        'dashboard_welcome': 'ยินดีต้อนรับ,',
        'dashboard_role': 'บทบาท:',
        'dashboard_your_posts': 'โพสต์ของคุณ',
        'dashboard_create_post': 'สร้างโพสต์ใหม่',
        'dashboard_no_posts': 'คุณยังไม่มีโพสต์ใดๆ',
        'dashboard_create_first': 'สร้างโพสต์แรกของคุณ',
        'dashboard_quick_links': 'ลิงก์ด่วน',
        'dashboard_view_profile': 'ดูโปรไฟล์ของคุณ',
        'dashboard_search_posts': 'ค้นหาโพสต์',
        
        # Profile
        'profile_title': 'โปรไฟล์ผู้ใช้',
        'profile_user_id': 'รหัสผู้ใช้',
        'profile_username': 'ชื่อผู้ใช้',
        'profile_email': 'อีเมล',
        'profile_role': 'บทบาท',
        
        # Search
        'search_title': 'ค้นหา',
        'search_query': 'คำค้นหา',
        'search_placeholder': 'กรอกคำค้นหา...',
        'search_results': 'ผลการค้นหา',
        'search_no_results': 'ไม่พบผลลัพธ์',
        'search_xss_notice': 'คำเตือนด้านความปลอดภัย: ช่องโหว่ XSS',
        'search_xss_text': 'หน้านี้มีช่องโหว่ Cross-Site Scripting (XSS) เนื่องจากไม่ได้ sanitize input ก่อนแสดงผล',
        'search_test_payload': 'Payload ทดสอบ:',
        
        # Post
        'post_create_title': 'สร้างโพสต์ใหม่',
        'post_title': 'หัวข้อโพสต์',
        'post_content': 'เนื้อหา',
        'post_content_placeholder': 'กรอกเนื้อหาโพสต์...',
        'post_publish': 'เผยแพร่โพสต์',
        'post_vulnerabilities': 'ช่องโหว่ด้านความปลอดภัย',
        'post_xss': 'XSS: ไม่ได้ sanitize input ก่อนแสดงผล',
        'post_csrf': 'CSRF: ไม่มีการป้องกัน CSRF token สำหรับ form submissions',
        'post_view_author': 'ผู้เขียน:',
        'post_view_date': 'วันที่:',
        
        # Admin
        'admin_title': 'แผงควบคุมผู้ดูแลระบบ',
        'admin_description': 'อินเทอร์เฟซการจัดการระบบและการจัดการผู้ใช้',
        'admin_users': 'การจัดการผู้ใช้',
        'admin_posts': 'การจัดการเนื้อหา',
        
        # Error
        'error_title': 'เกิดข้อผิดพลาด',
        'error_return': 'กลับไปหน้าแรก',
        'error_disclosure': 'คำเตือนด้านความปลอดภัย: การเปิดเผยข้อมูล',
        'error_disclosure_text': 'ข้อความ error นี้เปิดเผยข้อมูลมากเกินไป ใน production ควรแสดงข้อความทั่วไปและไม่เปิดเผยรายละเอียดภายในระบบ',
        
        # Flash messages
        'flash_welcome': 'ยินดีต้อนรับ, {}!',
        'flash_login_required': 'กรุณาเข้าสู่ระบบเพื่อเข้าถึงหน้านี้',
        'flash_logged_out': 'คุณได้ออกจากระบบแล้ว',
        'flash_registration_success': 'สมัครสมาชิกสำเร็จ! กรุณาเข้าสู่ระบบ',
        'flash_post_created': 'สร้างโพสต์สำเร็จ!',
        'flash_invalid_credentials': 'ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง',
        'flash_username_required': 'ต้องกรอกชื่อผู้ใช้และรหัสผ่าน',
        'flash_username_exists': 'ชื่อผู้ใช้นี้มีอยู่แล้ว',
        
        # IDOR notice
        'idor_notice': 'คำเตือนด้านความปลอดภัย: ช่องโหว่ IDOR',
        'idor_text': 'หน้านี้แสดงช่องโหว่ Insecure Direct Object Reference (IDOR) ลองเปลี่ยน user ID ใน URL (เช่น /profile/1 หรือ /profile/2) เพื่อเข้าถึงโปรไฟล์ของผู้ใช้คนอื่น',
        'idor_note': 'หมายเหตุ: ช่องโหว่นี้เกิดจากการที่แอปพลิเคชันไม่ตรวจสอบว่าผู้ใช้ที่ยืนยันตัวตนแล้วมีสิทธิ์เข้าถึงทรัพยากรที่ร้องขอหรือไม่',
        
        # XSS notice
        'xss_notice': 'คำเตือนด้านความปลอดภัย: ช่องโหว่ XSS',
        'xss_text': 'เนื้อหาโพสต์ไม่ได้ถูก sanitize ก่อนแสดงผล หากเนื้อหามี script tag จะถูก execute ในเบราว์เซอร์ แสดงให้เห็นช่องโหว่ Cross-Site Scripting (XSS)',
        
        # Table headers
        'table_id': 'ID',
        'table_title': 'หัวข้อ',
        'table_content': 'เนื้อหา',
        'table_author': 'ผู้เขียน',
        'table_created_at': 'วันที่สร้าง',
        'table_action': 'การดำเนินการ',
        'table_field': 'ฟิลด์',
        'table_value': 'ค่า',
        'table_role': 'บทบาท',
        'table_username': 'ชื่อผู้ใช้',
        'table_email': 'อีเมล',
    }
}

def get_locale():
    """Get current locale from session or default to 'en'"""
    from flask import session
    return session.get('locale', 'en')

def set_locale(locale):
    """Set locale in session"""
    from flask import session
    if locale in TRANSLATIONS:
        session['locale'] = locale
    else:
        session['locale'] = 'en'

def t(key, **kwargs):
    """
    Translate a key to current locale
    Usage: t('home_title') or t('flash_welcome', username='John')
    """
    locale = get_locale()
    translation = TRANSLATIONS.get(locale, TRANSLATIONS['en']).get(key, key)
    
    # Format string if kwargs provided
    if kwargs:
        try:
            return translation.format(**kwargs)
        except:
            return translation
    
    return translation

# Make t() available in templates
def init_i18n(app):
    """Initialize i18n for Flask app"""
    @app.context_processor
    def inject_i18n():
        return dict(t=t, get_locale=get_locale)

