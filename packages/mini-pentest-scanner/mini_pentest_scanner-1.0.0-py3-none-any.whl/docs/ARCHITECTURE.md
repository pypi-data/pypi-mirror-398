# Security Scanner Architecture

## Overview

This document describes the architecture of the Security Scanner - a Non-intrusive Security Assessment Tool designed for educational and authorized security testing purposes.

## System Architecture

### High-Level Architecture

```
┌─────────────────────┐
│     User (CLI)      │
│   or Dashboard      │
└─────────┬───────────┘
          │
          ▼
┌─────────────────────┐
│  Security Scanner   │
│   (Orchestrator)    │
└─────────┬───────────┘
          │
          ├──► Scanner Engine
          │    ├── HTTP Client
          │    ├── Config Manager
          │    └── Result Builder
          │
          ├──► Security Checks (Plugin-based)
          │    ├── SQL Injection
          │    ├── XSS
          │    ├── IDOR
          │    ├── Information Disclosure
          │    ├── Authentication
          │    └── Session Management
          │
          └──► Report Generator
               ├── JSON
               ├── HTML
               └── PDF
```

## Core Components

### 1. Scanner Engine (`scanner/core/engine.py`)

**Purpose:** Orchestrates the scanning process

**Responsibilities:**
- Manages scan lifecycle
- Coordinates check execution
- Handles authorization verification
- Aggregates results

**Key Methods:**
- `run_scan()` - Execute all checks
- `register_check()` - Register security checks
- `_verify_authorization()` - Verify scan authorization

---

### 2. HTTP Client (`scanner/core/http_client.py`)

**Purpose:** Handles HTTP communication

**Responsibilities:**
- Makes HTTP requests
- Observes responses (Non-intrusive)
- Checks security headers
- Manages sessions

**Key Methods:**
- `get()` - GET requests
- `post()` - POST requests
- `observe_response()` - Analyze response
- `check_security_headers()` - Header analysis

---

### 3. Result Schema (`scanner/core/result.py`)

**Purpose:** Standardized result format

**Key Classes:**
- `ScanResult` - Complete scan result
- `Finding` - Individual security finding
- `Location` - Where finding was found
- `Evidence` - Non-intrusive evidence
- `Summary` - Scan statistics

**Schema Structure:**
```json
{
  "scan_id": "uuid",
  "target": "https://example.com",
  "scan_time": "ISO timestamp",
  "summary": {...},
  "findings": [...],
  "metadata": {...}
}
```

---

### 4. Configuration (`scanner/core/config.py`)

**Purpose:** Manages scanner configuration

**Configuration Options:**
- Scanner mode (passive/active-light)
- Timeout settings
- User agent
- Policy settings
- Report formats

**Config File:** `config.yaml`

---

## Security Checks (Plugin Architecture)

### Check Interface

All checks implement:
```python
def check_new(engine: ScannerEngine) -> List[Finding]:
    """Check for vulnerabilities"""
    findings = []
    # Check logic here
    return findings
```

### Available Checks

1. **SQL Injection** (`checks/sql_injection.py`)
   - Tests for SQL error patterns
   - Active-light mode only

2. **XSS** (`checks/xss.py`)
   - Tests for reflected XSS
   - Active-light mode only

3. **IDOR** (`checks/idor.py`)
   - Tests access control
   - Active-light mode only

4. **Information Disclosure** (`checks/information_disclosure.py`)
   - Checks error messages
   - Checks headers
   - Passive mode compatible

5. **Authentication** (`checks/authentication.py`)
   - Tests password policy
   - Tests rate limiting
   - Active-light mode only

6. **Session Management** (`checks/session_management.py`)
   - Checks cookie security
   - Tests session fixation
   - Active-light mode only

---

## Scan Flow

### End-to-End Flow

```
1. User initiates scan
   ↓
2. Load configuration
   ↓
3. Verify authorization
   ↓
4. Initialize Scanner Engine
   ↓
5. Register security checks
   ↓
6. For each check:
   ├─ Execute check
   ├─ Collect findings
   └─ Update summary
   ↓
7. Generate reports (JSON/HTML/PDF)
   ↓
8. Display results
```

### Check Execution Flow

```
Check Function
   ↓
HTTP Request (via HTTP Client)
   ↓
Observe Response (Non-intrusive)
   ↓
Analyze Patterns
   ↓
Create Finding (if issue found)
   ↓
Return Findings
```

---

## Scan Policies

### Passive Mode Flow

```
[ Start Passive Scan ]
   ↓
[ Send Normal Requests ]
   ↓
[ Observe Responses ]
   ├─ Headers
   ├─ Cookies
   └─ Status Codes
   ↓
[ Analyze Patterns ]
   ↓
[ Compare with Best Practices ]
   ↓
[ Create Findings ]
   ↓
[ Generate Report ]
```

### Active-light Mode Flow

```
[ Start Active-light Scan ]
   ↓
[ Verify Authorization ]
   ├─ ❌ Not authorized → Force Passive
   └─ ✅ Authorized → Continue
   ↓
[ Prepare Safe Inputs ]
   ↓
[ Send Controlled Requests ]
   ↓
[ Observe Logic Behavior ]
   ↓
[ Detect Inconsistencies ]
   ↓
[ Create Findings ]
   ↓
[ Generate Report ]
```

---

## Data Flow

### Result Generation

```
Security Check
   ↓
Finding Object
   ├─ ID
   ├─ Title
   ├─ Severity
   ├─ Location
   ├─ Evidence
   └─ Recommendation
   ↓
ScanResult
   ├─ Summary
   ├─ Findings[]
   └─ Metadata
   ↓
Report Formats
   ├─ JSON
   ├─ HTML
   └─ PDF
```

---

## Security Considerations

### Non-intrusive Design

- **No Exploitation** - Only observes behavior
- **No Data Modification** - Read-only operations
- **No Brute Force** - Limited, controlled requests
- **No Payload Injection** - Safe inputs only

### Authorization

- **Pre-scan Verification** - Checks authorization before active-light
- **Policy Gates** - Enforces scan policies
- **Scope Limitation** - Respects defined scope

### Rate Limiting

- **Request Throttling** - Limits request rate
- **Timeout Controls** - Prevents hanging
- **Resource Awareness** - Respects system limits

---

## Extensibility

### Adding New Checks

1. Create check file in `scanner/checks/`
2. Implement `check_new(engine)` function
3. Return `List[Finding]`
4. Register in `scanner.py`

### Adding Report Formats

1. Extend `ScanResult` class
2. Implement format generator
3. Add to `reports/output_formats` in config

---

## Technology Stack

- **Language:** Python 3.9+
- **HTTP Library:** requests
- **Configuration:** YAML
- **Data Format:** JSON
- **Report Formats:** JSON, HTML, PDF (planned)

---

## File Structure

```
scanner/
├── core/
│   ├── engine.py          # Scanner orchestrator
│   ├── http_client.py     # HTTP communication
│   ├── result.py          # Result schema
│   └── config.py          # Configuration
├── checks/
│   ├── sql_injection.py
│   ├── xss.py
│   ├── idor.py
│   ├── information_disclosure.py
│   ├── authentication.py
│   └── session_management.py
└── scanner.py              # Main entry point

reports/
├── json/                  # JSON reports
├── html/                  # HTML reports
└── pdf/                   # PDF reports (planned)

docs/
├── DISCLAIMER.md
├── SCAN_POLICY.md
└── ARCHITECTURE.md
```

---

## Design Principles

1. **Non-intrusive** - Observe, don't exploit
2. **Modular** - Plugin-based architecture
3. **Standardized** - Consistent result format
4. **Extensible** - Easy to add new checks
5. **Ethical** - Legal and responsible use

---

**Last Updated:** 2025-01-22

