#!/usr/bin/env python3
"""
#exonware/xwdata/tests/0.core/runner.py

Core test runner for xwdata.
Runs fast, high-value core tests (80/20 rule).

Company: eXonware.com
Author: Eng. Muhammad AlShehri
Email: connect@exonware.com
Version: 0.0.1.3
Generation Date: 26-Oct-2025
"""

import sys
import pytest
from pathlib import Path
from datetime import datetime
import io

# Set UTF-8 encoding for Windows console
if sys.platform == 'win32':
    try:
        sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
        sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')
    except:
        pass


def main():
    """Core test runner - 20% tests for 80% value."""
    # Add src to Python path
    src_path = Path(__file__).parent.parent.parent / "src"
    sys.path.insert(0, str(src_path))
    
    print("üéØ Core Tests - Fast, High-Value Checks")
    print(f"   Directory: {Path(__file__).parent}")
    
    # Run core tests
    exit_code = pytest.main([
        "-v",
        "--tb=short",
        "-x",  # Stop on first failure
        str(Path(__file__).parent),
        "-m", "xwdata_core"
    ])
    
    # Status output
    if exit_code == 0:
        status = "‚úÖ Core tests PASSED"
    else:
        status = "‚ùå Core tests FAILED"
    
    print(f"\n{status}")
    
    # Save Markdown output
    output_file = Path(__file__).parent / "runner_out.md"
    markdown_content = f"""# Core Test Results

**Layer:** 0.core
**Generated:** {datetime.now().strftime("%d-%b-%Y %H:%M:%S")}
**Status:** {'PASSED' if exit_code == 0 else 'FAILED'}

---

## Test Execution

**Command:** `python tests/0.core/runner.py`

**Markers:** `xwdata_core`

**Options:**
- Verbose output (`-v`)
- Short traceback (`--tb=short`)
- Stop on first failure (`-x`)

---

## Result

{status}

**Exit Code:** {exit_code}

---

*Generated by eXonware test runner - Production Excellence Edition*
"""
    
    output_file.write_text(markdown_content, encoding='utf-8')
    print(f"üìù Results saved to: {output_file}")
    
    sys.exit(exit_code)


if __name__ == "__main__":
    main()

