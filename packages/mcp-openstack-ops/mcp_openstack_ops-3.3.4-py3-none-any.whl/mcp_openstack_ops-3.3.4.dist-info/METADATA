Metadata-Version: 2.4
Name: mcp-openstack-ops
Version: 3.3.4
Summary: OpenStack operations automation MCP server
Author-email: JungJungIn <call518@gmail.com>
Requires-Python: >=3.12
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fastmcp>=2.12.3
Requires-Dist: openstacksdk<=4.8.0,>=4.1.0
Requires-Dist: python-dotenv>=1.1.1
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Dynamic: license-file

# MCP-OpenStack-Ops

> **MCP OpenStack Operations Server**: A comprehensive MCP (Model Context Protocol) server providing OpenStack project management and monitoring capabilities with built-in safety controls and single-project scope.

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
![Python](https://img.shields.io/badge/Python-3776AB?style=flat&logo=python&logoColor=white)
![Docker Pulls](https://img.shields.io/docker/pulls/call518/mcp-server-openstack-ops)
[![smithery badge](https://smithery.ai/badge/@call518/mcp-openstack-ops)](https://smithery.ai/server/@call518/mcp-openstack-ops)
[![BuyMeACoffee](https://raw.githubusercontent.com/pachadotdev/buymeacoffee-badges/main/bmc-donate-yellow.svg)](https://www.buymeacoffee.com/call518)

[![Deploy to PyPI with tag](https://github.com/call518/MCP-OpenStack-Ops/actions/workflows/pypi-publish.yml/badge.svg)](https://github.com/call518/MCP-OpenStack-Ops/actions/workflows/pypi-publish.yml)
![PyPI](https://img.shields.io/pypi/v/MCP-OpenStack-Ops?label=pypi%20package)
![PyPI - Downloads](https://img.shields.io/pypi/dm/MCP-OpenStack-Ops)

---

## Architecture & Internal (DeepWiki)

[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/call518/MCP-OpenStack-Ops)

---

## Features

- âœ… **Project-Scoped Operations**: Every tool enforces the configured `OS_PROJECT_NAME`, validating resource ownership so actions stay inside a single tenant.
- âœ… **Safety-Gated Writes**: Modify (`set_*`) tooling only registers when `ALLOW_MODIFY_OPERATIONS=true`, keeping default deployments read-only and auditable.
- âœ… **90+ Purpose-Built Tools**: Broad coverage across compute, networking, storage, images, identity, Heat, and Octavia load balancing tasksâ€”all constrained to the current project.
- âœ… **Bulk & Filtered Actions**: Instance, volume, network, image, snapshot, and keypair managers accept comma-delimited targets or filter criteria to orchestrate bulk changes intentionally.
- âœ… **Post-Action Feedback & Async Guidance**: Mutating tools reuse a shared result handler that adds emoji status checks, asynchronous timing notes, and follow-up verification commands.
- âœ… **Monitoring & Usage Insights**: `get_service_status`, `get_resource_monitoring`, `get_usage_statistics`, and quota tools surface service availability, utilization, and capacity for the active project.
- âœ… **Unified Instance Queries**: The `get_instance` tool consolidates name, ID, status, and free-form search paths with pagination plus summary/detailed modes.
- âœ… **Server Insight & Audit Trail**: Dedicated tools expose server events, hypervisor details, availability zones, quotas, and resource ownership to speed diagnostics.
- âœ… **Load Balancer Management**: Octavia tools cover listeners, pools, members, health monitors, flavors, quotas, and amphora operations with the same safety gates.
- âœ… **Connection & Deployment Flexibility**: Connection caching, configurable service endpoints, Docker packaging, and both `stdio`/`streamable-http` transports support proxy/bastion and multi-project setups.

> âš ï¸ **Compatibility Notice**: This MCP server is developed and optimized for **OpenStack Epoxy (2025.1)** as the primary target environment. However, it is compatible with most modern OpenStack releases (Dalmatian, Caracal, Bobcat, etc.) as the majority of APIs remain consistent across versions. Only a few specific API endpoints may require adaptation for full compatibility with older releases.
> 
> ðŸš§ **Coming Soon**: Dynamic multi-version OpenStack API compatibility is actively under development and will be available in upcoming releases, providing seamless support for all major OpenStack deployments automatically.

### ðŸ”§ OpenStackSDK Version Customization for Older Releases

**Officially Supported Releases:**
- âœ… OpenStack **Epoxy (2025.1)** - Fully tested
- âœ… OpenStack **Dalmatian (2024.2)** - Fully tested

**For older OpenStack releases** (Wallaby, Caracal, Bobcat, etc.), you may need to customize the OpenStackSDK version to match your environment. The SDK version must be changed in **BOTH files**:

**Step 1: Modify `Dockerfile.MCP-Server`**
```dockerfile
RUN pip install \
        'uv>=0.8.5' \
        'mcpo>=0.0.17' \
        'fastmcp>=2.12.3' \
        'aiohttp>=3.12.0' \
        'openstacksdk==3.1.1' \  # â† Change to your required version (e.g., 3.1.1 for Wallaby)
        'python-dotenv>=1.0.0'
```

**Step 2: Modify `pyproject.toml`**
```toml
dependencies = [
    "fastmcp>=2.12.3",
    "openstacksdk==3.1.1",  # â† Must match Dockerfile version
    "python-dotenv>=1.1.1",
    # ... other dependencies
]
```

**Step 3: Rebuild Docker Image**
```bash
docker-compose build --no-cache mcp-server
docker-compose up -d
```

**OpenStackSDK Version Reference:**
| OpenStack Release | Recommended SDK Version | Notes |
|-------------------|------------------------|-------|
| Epoxy (2025.1) | `>=3.3.0` | Current default |
| Dalmatian (2024.2) | `>=3.2.0` | Fully compatible |
| Caracal (2024.1) | `>=3.1.0` | May require testing |
| Bobcat (2023.2) | `>=3.0.0` | May require testing |
| Wallaby (2021.1) | `==3.1.1` | Downgrade required |

> âš ï¸ **Important**: Both `Dockerfile.MCP-Server` and `pyproject.toml` must have the **same version** to avoid dependency conflicts during container runtime.

---

### Screenshots

**OpenStack Dashboard (Epoxy 2025.1)**

![OpenStack Dashboard (Epoxy 2025.1)](img/screenshot-openstack-dashboard.png)

**MCP Query Example - Cluster Status**

![Example Cluster Status](img/screenshot-claude-desktop.png)

---

## ðŸ†• Latest Enhancements (v1.x)

### **Bulk Operations & Filter-based Targeting**
Revolutionary approach to resource management enabling one-step operations:

```bash
# Traditional approach (multiple steps):
1. search_instances("test") â†’ get list
2. set_instance("vm1", "stop") â†’ stop individually  
3. set_instance("vm2", "stop") â†’ stop individually

# NEW enhanced approach (single step):
set_instance(action="stop", name_contains="test")  # âœ¨ Stops ALL instances containing "test"
```

**Supported Tools with Enhanced Capabilities:**
- **`set_instance`**: Bulk lifecycle management with filtering (name_contains, status, flavor_contains, image_contains)
- **`set_volume`**: Bulk volume operations with filtering (name_contains, status, size filtering)
- **`set_image`**: Bulk image management with filtering (name_contains, status)
- **`set_networks`**: Bulk network operations with filtering (name_contains, status)
- **`set_keypair`**: Bulk keypair management with filtering (name_contains)
- **`set_snapshot`**: Bulk snapshot operations with filtering (name_contains, status)

**Input Format Flexibility:**
```python
# Single resource
resource_names="vm1"

# Multiple resources (comma-separated)
resource_names="vm1,vm2,vm3"

# JSON array format
resource_names='["vm1", "vm2", "vm3"]'

# Filter-based (automatic target identification)
name_contains="test", status="ACTIVE"
```

### **Post-Action Status Verification**
Every operation now provides immediate feedback with visual indicators:

```bash
âœ… Bulk Instance Management - Action: stop
ðŸ“Š Total instances: 3
âœ… Successes: 2
âŒ Failures: 1

Post-Action Status:
ðŸŸ¢ test-vm-1: SHUTOFF  
ðŸŸ¢ test-vm-2: SHUTOFF
ðŸ”´ test-vm-3: ERROR
```

### **Unified Resource Queries**
New consolidated `get_instance` tool replaces multiple separate tools:
- âŒ Old: `get_instance_details`, `get_instance_info`, `get_instance_status`, `get_instance_network_info`
- âœ… New: `get_instance(instance_names="vm1,vm2")` - Single tool, comprehensive information

---

## ðŸ“Š OpenStack CLI vs MCP Tools Mapping

**Detailed Mapping by Category**

### 1. ðŸ–¥ï¸ **Compute (Nova)**

| OpenStack CLI Command | MCP Tool | Status | Notes |
|---------------------|---------|------|------|
| `openstack server list` | `get_instance` | âœ… | **NEW UNIFIED** - Pagination, filtering support |
| `openstack server show` | `get_instance` | âœ… | **ENHANCED** - Replaces get_instance_by_name, get_instance_by_id |
| `openstack server create` | `set_instance` (action="create") | âœ… | **ENHANCED** - Bulk creation support |
| `openstack server start/stop/reboot` | `set_instance` | âœ… | **ENHANCED** - Bulk operations with filtering |
| `openstack server delete` | `set_instance` (action="delete") | âœ… | **ENHANCED** - Bulk deletion with name_contains filtering |
| `openstack server backup create` | `set_server_backup` | âœ… | Backup creation with rotation |
| `openstack server image create` | `set_instance` (action="snapshot") | âœ… | Image/snapshot creation |
| `openstack server shelve/unshelve` | `set_instance` | âœ… | Instance shelving |
| `openstack server lock/unlock` | `set_instance` | âœ… | Instance locking |
| `openstack server pause/unpause` | `set_instance` | âœ… | Instance pausing |
| `openstack server suspend/resume` | `set_instance` | âœ… | Instance suspension |
| `openstack server resize` | `set_instance` (action="resize") | âœ… | Instance resizing |
| `openstack server resize confirm` | `set_instance` (action="confirm_resize") | âœ… | Resize confirmation |
| `openstack server resize revert` | `set_instance` (action="revert_resize") | âœ… | Resize revert |
| `openstack server rebuild` | `set_instance` (action="rebuild") | âœ… | Instance rebuilding |
| `openstack server rescue/unrescue` | `set_instance` | âœ… | Recovery mode |
| `openstack server migrate` | `set_server_migration` (action="migrate") | âœ… | Live migration |
| `openstack server evacuate` | `set_server_migration` (action="evacuate") | âœ… | Server evacuation |
| `openstack server migration list` | `set_server_migration` (action="list") | âœ… | Migration listing |
| `openstack server migration show` | `set_server_migration` (action="show") | âœ… | Migration details |
| `openstack server migration abort` | `set_server_migration` (action="abort") | âœ… | Migration abort |
| `openstack server migration confirm` | `set_server_migration` (action="confirm") | âœ… | Migration confirmation |
| `openstack server migration force complete` | `set_server_migration` (action="force_complete") | âœ… | Force migration completion |
| `openstack server add network` | `set_server_network` (action="add_network") | âœ… | Network attachment |
| `openstack server remove network` | `set_server_network` (action="remove_network") | âœ… | Network detachment |
| `openstack server add port` | `set_server_network` (action="add_port") | âœ… | Port attachment |
| `openstack server remove port` | `set_server_network` (action="remove_port") | âœ… | Port detachment |
| `openstack server add floating ip` | `set_server_floating_ip` (action="add") | âœ… | Floating IP association |
| `openstack server remove floating ip` | `set_server_floating_ip` (action="remove") | âœ… | Floating IP disassociation |
| `openstack server add fixed ip` | `set_server_fixed_ip` (action="add") | âœ… | Fixed IP addition |
| `openstack server remove fixed ip` | `set_server_fixed_ip` (action="remove") | âœ… | Fixed IP removal |
| `openstack server add security group` | `set_server_security_group` (action="add") | âœ… | Security group addition |
| `openstack server remove security group` | `set_server_security_group` (action="remove") | âœ… | Security group removal |
| `openstack server add volume` | `set_server_volume` (action="attach") | âœ… | Volume attachment |
| `openstack server remove volume` | `set_server_volume` (action="detach") | âœ… | Volume detachment |
| `openstack server set` | `set_server_properties` (action="set") | âœ… | Server property setting |
| `openstack server unset` | `set_server_properties` (action="unset") | âœ… | Server property unsetting |
| `openstack server dump create` | `set_server_dump` | âœ… | Server dump creation |
| `openstack server event list` | `get_server_events` | âœ… | Server event tracking |
| `openstack server group list` | `get_server_groups` | âœ… | Server group listing |
| `openstack server group create/delete` | `set_server_group` | âœ… | Server group management |
| `openstack flavor list` | `get_flavor_list` (via cluster_status) | âœ… | Flavor listing |
| `openstack flavor create/delete` | `set_flavor` | âœ… | Flavor management |
| `openstack keypair list` | `get_keypair_list` | âœ… | Keypair listing |
| `openstack keypair create/delete` | `set_keypair` | âœ… | Keypair management |
| `openstack hypervisor list` | `get_hypervisor_details` | âœ… | Hypervisor querying |
| `openstack availability zone list` | `get_availability_zones` | âœ… | Availability zone listing |

### 2. ðŸŒ **Network (Neutron)**

| OpenStack CLI Command | MCP Tool | Status | Notes |
|---------------------|---------|------|------|
| `openstack network list` | `get_network_details` | âœ… | Detailed network information |
| `openstack network show` | `get_network_details` (name param) | âœ… | Specific network query |
| `openstack network create` | `set_networks` (action="create") | âœ… | **ENHANCED** - Bulk network creation |
| `openstack network delete` | `set_networks` (action="delete") | âœ… | **ENHANCED** - Bulk deletion with filtering |
| `openstack network set` | `set_networks` (action="update") | âœ… | **ENHANCED** - Bulk updates |
| `openstack subnet list` | `get_network_details` (includes subnets) | âœ… | Subnet information included |
| `openstack subnet create/delete` | `set_subnets` | âœ… | Subnet management |
| `openstack router list` | `get_routers` | âœ… | Router listing |
| `openstack router create/delete` | (Not yet implemented) | ðŸš§ | Router management |
| `openstack floating ip list` | `get_floating_ips` | âœ… | Floating IP listing |
| `openstack floating ip create` | `set_floating_ip` (action="create") | âœ… | Floating IP creation |
| `openstack floating ip delete` | `set_floating_ip` (action="delete") | âœ… | Floating IP deletion |
| `openstack floating ip set` | `set_floating_ip` (action="set") | âœ… | Floating IP property setting |
| `openstack floating ip show` | `set_floating_ip` (action="show") | âœ… | Floating IP details |
| `openstack floating ip unset` | `set_floating_ip` (action="unset") | âœ… | Floating IP property clearing |
| `openstack floating ip pool list` | `get_floating_ip_pools` | âœ… | Floating IP pool listing |
| `openstack floating ip port forwarding create` | `set_floating_ip_port_forwarding` (action="create") | âœ… | Port forwarding creation |
| `openstack floating ip port forwarding delete` | `set_floating_ip_port_forwarding` (action="delete") | âœ… | Port forwarding deletion |
| `openstack floating ip port forwarding list` | `set_floating_ip_port_forwarding` (action="list") | âœ… | Port forwarding listing |
| `openstack floating ip port forwarding set` | `set_floating_ip_port_forwarding` (action="set") | âœ… | Port forwarding updates |
| `openstack floating ip port forwarding show` | `set_floating_ip_port_forwarding` (action="show") | âœ… | Port forwarding details |
| `openstack security group list` | `get_security_groups` | âœ… | Security group listing |
| `openstack security group create/delete` | (Not yet implemented) | ðŸš§ | Security group management |
| `openstack port list` | `get_network_details` (includes ports) | âœ… | Port information included |
| `openstack port create/delete` | `set_network_ports` | âœ… | Port management |
| `openstack network qos policy list` | (Not yet implemented) | ðŸš§ | QoS policy listing |
| `openstack network qos policy create` | `set_network_qos_policies` | âœ… | QoS policy management |
| `openstack network agent list` | `get_service_status` (includes agents) | âœ… | Network agents |
| `openstack network agent set` | `set_network_agents` | âœ… | Network agent management |

### 3. ðŸ’¾ **Storage (Cinder)**

| OpenStack CLI Command | MCP Tool | Status | Notes |
|---------------------|---------|------|------|
| `openstack volume list` | `get_volume_list` | âœ… | Volume listing |
| `openstack volume show` | `get_volume_list` (filtering) | âœ… | Specific volume query |
| `openstack volume create/delete` | `set_volume` | âœ… | Volume creation/deletion |
| `openstack volume set` | `set_volume` (action="modify") | âœ… | Volume property modification |
| `openstack volume type list` | `get_volume_types` | âœ… | Volume type listing |
| `openstack volume type create/delete` | (Not yet implemented) | ðŸš§ | Volume type management |
| `openstack volume snapshot list` | `get_volume_snapshots` | âœ… | Snapshot listing |
| `openstack volume snapshot create/delete` | `set_snapshot` | âœ… | Snapshot management |
| `openstack backup list` | (Not yet implemented) | ðŸš§ | Backup listing |
| `openstack backup create/delete` | `set_volume_backups` | âœ… | Volume backup management |
| `openstack volume transfer request list` | (Not yet implemented) | ðŸš§ | Volume transfer |
| `openstack server volume list` | `get_server_volumes` | âœ… | Server volume listing |
| `openstack server add/remove volume` | `set_server_volume` | âœ… | Server volume attach/detach |
| `openstack volume group list` | (Not yet implemented) | ðŸš§ | Volume group listing |
| `openstack volume group create` | `set_volume_groups` | âœ… | Volume group management |
| `openstack volume qos list` | (Not yet implemented) | ðŸš§ | QoS listing |
| `openstack volume qos create` | `set_volume_qos` | âœ… | QoS management |

### 4. ðŸ–¼ï¸ **Image (Glance)**

| OpenStack CLI Command | MCP Tool | Status | Notes |
|---------------------|---------|------|------|
| `openstack image list` | `get_image_detail_list` | âœ… | Image listing |
| `openstack image show` | `get_image_detail_list` (filtering) | âœ… | Specific image query |
| `openstack image create` | `set_image` (action="create") | âœ… | Enhanced image creation with min_disk, min_ram, properties |
| `openstack image delete` | `set_image` (action="delete") | âœ… | Image deletion |
| `openstack image set` | `set_image` (action="update") | âœ… | Image property modification |
| `openstack image save` | `set_image` (action="save") | âœ… | Image download |
| `openstack image add project` | (Not yet implemented) | ðŸš§ | Project sharing |
| `openstack image member list` | (Not yet implemented) | ðŸš§ | Member listing |
| `openstack image member create` | `set_image_members` | âœ… | Image member management |
| `openstack image set --property` | `set_image_metadata` | âœ… | Image metadata |
| `openstack image set --public/private` | `set_image_visibility` | âœ… | Image visibility setting |

### 5. ðŸ‘¥ **Identity (Keystone)**

| OpenStack CLI Command | MCP Tool | Status | Notes |
|---------------------|---------|------|------|
| `openstack user list` | `get_user_list` | âœ… | User listing |
| `openstack user show` | `get_user_list` (filtering) | âœ… | Specific user query |
| `openstack user create/delete` | (Not yet implemented) | ðŸš§ | User management |
| `openstack project list` | `get_project_details` | âœ… | Project listing |
| `openstack project show` | `get_project_details` (name param) | âœ… | Specific project query |
| `openstack project create/delete` | `set_project` | âœ… | Project management |
| `openstack role list` | `get_role_assignments` | âœ… | Role listing |
| `openstack role assignment list` | `get_role_assignments` | âœ… | Role assignment listing |
| `openstack role create/delete` | `set_roles` | âœ… | Role management |
| `openstack domain list` | (Not yet implemented) | ðŸš§ | Domain listing |
| `openstack domain create/delete` | `set_domains` | âœ… | Domain management |
| `openstack group list` | (Not yet implemented) | ðŸš§ | Group listing |
| `openstack group create/delete` | `set_identity_groups` | âœ… | Group management |
| `openstack service list` | `get_service_status` | âœ… | Service listing |
| `openstack service create/delete` | `set_services` | âœ… | Service management |
| `openstack endpoint list` | `get_service_status` (includes endpoints) | âœ… | Endpoint information |

### 6. ðŸ”¥ **Orchestration (Heat)**

| OpenStack CLI Command | MCP Tool | Status | Notes |
|---------------------|---------|------|------|
| `openstack stack list` | `get_heat_stacks` | âœ… | Stack listing |
| `openstack stack show` | `get_heat_stacks` (filtering) | âœ… | Specific stack query |
| `openstack stack create` | `set_heat_stack` (action="create") | âœ… | Stack creation |
| `openstack stack delete` | `set_heat_stack` (action="delete") | âœ… | Stack deletion |
| `openstack stack update` | `set_heat_stack` (action="update") | âœ… | Stack update |
| `openstack stack suspend/resume` | `set_heat_stack` | âœ… | Stack suspend/resume |
| `openstack stack resource list` | (Not yet implemented) | ðŸš§ | Stack resource listing |
| `openstack stack event list` | (Not yet implemented) | ðŸš§ | Stack event listing |
| `openstack stack template show` | (Not yet implemented) | ðŸš§ | Template query |
| `openstack stack output list` | (Not yet implemented) | ðŸš§ | Stack output listing |

### 7. âš–ï¸ **Load Balancer (Octavia)**

| OpenStack CLI Command | MCP Tool | Status | Notes |
|---------------------|---------|------|------|
| `openstack loadbalancer list` | `get_load_balancer_status` | âœ… | Load balancer listing with pagination |
| `openstack loadbalancer show` | `get_load_balancer_status` | âœ… | Load balancer detailed information |
| `openstack loadbalancer create` | `set_load_balancer` (action="create") | âœ… | Load balancer creation |
| `openstack loadbalancer delete` | `set_load_balancer` (action="delete") | âœ… | Load balancer deletion |
| `openstack loadbalancer set` | `set_load_balancer` (action="update") | âœ… | Load balancer property update |
| `openstack loadbalancer stats show` | `get_load_balancer_status` | âœ… | Load balancer statistics |
| `openstack loadbalancer status show` | `get_load_balancer_status` | âœ… | Load balancer status tree |
| `openstack loadbalancer failover` | `set_load_balancer` (action="failover") | âœ… | Load balancer failover |
| `openstack loadbalancer unset` | `set_load_balancer` (action="unset") | âœ… | Load balancer property unset |
| **Listener Management** | | | |
| `openstack loadbalancer listener list` | `get_load_balancer_listeners` | âœ… | Listener listing for load balancer |
| `openstack loadbalancer listener create` | `set_load_balancer_listener` (action="create") | âœ… | Listener creation (HTTP/HTTPS/TCP/UDP) |
| `openstack loadbalancer listener delete` | `set_load_balancer_listener` (action="delete") | âœ… | Listener deletion |
| `openstack loadbalancer listener show` | `get_load_balancer_listeners` | âœ… | Listener detailed information |
| `openstack loadbalancer listener set` | `set_load_balancer_listener` (action="update") | âœ… | Listener property update |
| `openstack loadbalancer listener stats show` | `get_load_balancer_listeners` | âœ… | Listener statistics |
| `openstack loadbalancer listener unset` | `set_load_balancer_listener` (action="unset") | âœ… | Listener property unset |
| **Pool Management** | | | |
| `openstack loadbalancer pool list` | `get_load_balancer_pools` | âœ… | Pool listing (all or by listener) |
| `openstack loadbalancer pool create` | `set_load_balancer_pool` (action="create") | âœ… | Pool creation with algorithms |
| `openstack loadbalancer pool delete` | `set_load_balancer_pool` (action="delete") | âœ… | Pool deletion |
| `openstack loadbalancer pool set` | `set_load_balancer_pool` (action="update") | âœ… | Pool property update |
| `openstack loadbalancer pool show` | `get_load_balancer_pools` | âœ… | Pool detailed information |
| `openstack loadbalancer pool stats show` | `get_load_balancer_pools` | âœ… | Pool statistics |
| `openstack loadbalancer pool unset` | `set_load_balancer_pool` (action="unset") | âœ… | Pool property unset |
| **Member Management** | | | |
| `openstack loadbalancer member list` | `get_load_balancer_members` | âœ… | Pool member listing |
| `openstack loadbalancer member create` | `set_load_balancer_member` (action="create") | âœ… | Pool member creation |
| `openstack loadbalancer member delete` | `set_load_balancer_member` (action="delete") | âœ… | Pool member deletion |
| `openstack loadbalancer member set` | `set_load_balancer_member` (action="update") | âœ… | Pool member property update |
| `openstack loadbalancer member show` | `get_load_balancer_members` | âœ… | Pool member detailed information |
| `openstack loadbalancer member unset` | `set_load_balancer_member` (action="unset") | âœ… | Pool member property unset |
| **Health Monitor Management** | | | |
| `openstack loadbalancer healthmonitor list` | `get_load_balancer_health_monitors` | âœ… | Health monitor listing |
| `openstack loadbalancer healthmonitor create` | `set_load_balancer_health_monitor` (action="create") | âœ… | Health monitor creation |
| `openstack loadbalancer healthmonitor delete` | `set_load_balancer_health_monitor` (action="delete") | âœ… | Health monitor deletion |
| `openstack loadbalancer healthmonitor set` | `set_load_balancer_health_monitor` (action="update") | âœ… | Health monitor update |
| `openstack loadbalancer healthmonitor show` | `get_load_balancer_health_monitors` | âœ… | Health monitor detailed information |
| `openstack loadbalancer healthmonitor unset` | `set_load_balancer_health_monitor` (action="unset") | âœ… | Health monitor property unset |
| **L7 Policy Management** | | | |
| `openstack loadbalancer l7policy list` | `get_load_balancer_l7_policies` | âœ… | L7 policy listing |
| `openstack loadbalancer l7policy create` | `set_load_balancer_l7_policy` (action="create") | âœ… | L7 policy creation |
| `openstack loadbalancer l7policy delete` | `set_load_balancer_l7_policy` (action="delete") | âœ… | L7 policy deletion |
| `openstack loadbalancer l7policy set` | `set_load_balancer_l7_policy` (action="update") | âœ… | L7 policy update |
| `openstack loadbalancer l7policy show` | `get_load_balancer_l7_policies` | âœ… | L7 policy details |
| `openstack loadbalancer l7policy unset` | `set_load_balancer_l7_policy` (action="unset") | âœ… | L7 policy property unset |
| **L7 Rule Management** ðŸ†• | | | |
| `openstack loadbalancer l7rule list` | `get_load_balancer_l7_rules` | âœ… | L7 rule listing |
| `openstack loadbalancer l7rule create` | `set_load_balancer_l7_rule` (action="create") | âœ… | L7 rule creation |
| `openstack loadbalancer l7rule delete` | `set_load_balancer_l7_rule` (action="delete") | âœ… | L7 rule deletion |
| `openstack loadbalancer l7rule set` | `set_load_balancer_l7_rule` (action="update") | âœ… | L7 rule update |
| `openstack loadbalancer l7rule show` | `get_load_balancer_l7_rules` | âœ… | L7 rule details |
| `openstack loadbalancer l7rule unset` | `set_load_balancer_l7_rule` (action="unset") | âœ… | L7 rule property unset |
| **Amphora Management** ðŸ†• | | | |
| `openstack loadbalancer amphora list` | `get_load_balancer_amphorae` | âœ… | Amphora listing |
| `openstack loadbalancer amphora show` | `set_load_balancer_amphora` (action="show") | âœ… | Amphora details |
| `openstack loadbalancer amphora configure` | `set_load_balancer_amphora` (action="configure") | âœ… | Amphora configuration |
| `openstack loadbalancer amphora failover` | `set_load_balancer_amphora` (action="failover") | âœ… | Amphora failover |
| `openstack loadbalancer amphora delete` | N/A | âŒ | Not supported by OpenStack SDK |
| `openstack loadbalancer amphora stats show` | N/A | âŒ | Not supported by OpenStack SDK |
| **Provider Management** | | | |
| `openstack loadbalancer provider list` | `get_load_balancer_providers` | âœ… | Provider listing |
| `openstack loadbalancer provider capability list` | `get_load_balancer_providers` | âœ… | Provider capability listing |
| **Availability Zone Management** ðŸ†• | | | |
| `openstack loadbalancer availabilityzone list` | `get_load_balancer_availability_zones` | âœ… | Availability zone listing |
| `openstack loadbalancer availabilityzone show` | `get_load_balancer_availability_zones` | âœ… | Availability zone details |
| `openstack loadbalancer availabilityzone create` | `set_load_balancer_availability_zone` (action="create") | âœ… | Availability zone creation |
| `openstack loadbalancer availabilityzone delete` | `set_load_balancer_availability_zone` (action="delete") | âœ… | Availability zone deletion |
| `openstack loadbalancer availabilityzone set` | `set_load_balancer_availability_zone` (action="update") | âœ… | Availability zone update |
| `openstack loadbalancer availabilityzone unset` | `set_load_balancer_availability_zone` (action="unset") | âœ… | Availability zone property unset |
| **Flavor Management** ðŸ†• | | | |
| `openstack loadbalancer flavor list` | `get_load_balancer_flavors` | âœ… | Flavor listing |
| `openstack loadbalancer flavor show` | `get_load_balancer_flavors` | âœ… | Flavor details |
| `openstack loadbalancer flavor create` | `set_load_balancer_flavor` (action="create") | âœ… | Flavor creation |
| `openstack loadbalancer flavor delete` | `set_load_balancer_flavor` (action="delete") | âœ… | Flavor deletion |
| `openstack loadbalancer flavor set` | `set_load_balancer_flavor` (action="update") | âœ… | Flavor update |
| `openstack loadbalancer flavor unset` | `set_load_balancer_flavor` (action="unset") | âœ… | Flavor property unset |
| **Flavor Profile Management** | | | |
| `openstack loadbalancer flavorprofile list` | `get_load_balancer_flavor_profiles` | âœ… | Flavor profile listing |
| `openstack loadbalancer flavorprofile show` | `get_load_balancer_flavor_profiles` | âœ… | Flavor profile details |
| `openstack loadbalancer flavorprofile create` | `set_load_balancer_flavor_profile` (action="create") | âœ… | Flavor profile creation |
| `openstack loadbalancer flavorprofile set` | `set_load_balancer_flavor_profile` (action="update") | âœ… | Flavor profile update |
| `openstack loadbalancer flavorprofile unset` | `set_load_balancer_flavor_profile` (action="unset") | âœ… | Flavor profile property unset |
| `openstack loadbalancer flavorprofile delete` | `set_load_balancer_flavor_profile` (action="delete") | ðŸš§ | Pending implementation |
| **Quota Management** ðŸ†• | | | |
| `openstack loadbalancer quota list` | `get_load_balancer_quotas` | âœ… | Quota listing |
| `openstack loadbalancer quota show` | `get_load_balancer_quotas` | âœ… | Quota details |
| `openstack loadbalancer quota set` | `set_load_balancer_quota` (action="set") | âœ… | Quota setting |
| `openstack loadbalancer quota reset` | `set_load_balancer_quota` (action="reset") | âœ… | Quota reset |

### 8. ðŸ“Š **Monitoring & Logging**

| OpenStack CLI Command | MCP Tool | Status | Notes |
|---------------------|---------|------|------|
| Resource monitoring | `get_resource_monitoring` | âœ… | Resource monitoring |
| Service status | `get_service_status` | âœ… | Service status query |
| Cluster overview | `get_cluster_status` | âœ… | Cluster overview |
| Service logs | `set_service_logs` | âœ… | Service log management |
| System metrics | `set_metrics` | âœ… | Metrics management |
| Alarm management | `set_alarms` | âœ… | Alarm management |
| Compute agents | `set_compute_agents` | âœ… | Compute agent management |
| Usage statistics | `get_usage_statistics` | âœ… | Usage statistics |

### 9. ðŸ“ **Usage & Quota**

| OpenStack CLI Command | MCP Tool | Status | Notes |
|---------------------|---------|------|------|
| `openstack quota show` | `get_quota` | âœ… | Quota query |
| `openstack quota set` | `set_quota` | âœ… | Quota setting |
| `openstack usage show` | `get_usage_statistics` | âœ… | Usage query |
| `openstack limits show` | `get_quota` (includes limits) | âœ… | Limits query |
| Resource utilization | `get_resource_monitoring` | âœ… | Resource utilization |

---

## Quick Start

> ðŸ’¡ **Need an OpenStack Cluster for Testing?**  
> Check out this comprehensive guide: [Tutorial: Install OpenStack Multinode Cluster /w Kolla-Ansible (Epoxy/Dalmatian)](https://medium.com/@call518/tutorial-install-openstack-multinode-cluster-w-kolla-ansible-flamingo-epoxy-dalmatian-19c000cc1645)  
> Perfect for setting up a test environment to explore MCP-OpenStack-Ops capabilities.

![Flow Diagram of Quickstart/Tutorial](img/MCP-Workflow-of-Quickstart-Tutorial.png)

### 1. Environment Setup

```bash
# Clone and navigate to project
cd MCP-OpenStack-Ops

# Install dependencies
uv sync

# Configure environment
cp .env.example .env
# Edit .env with your OpenStack credentials
```

**Environment Configuration**

Configure your `.env` file with OpenStack credentials:

```bash
# OpenStack Authentication (required)
OS_AUTH_HOST=your-openstack-host
OS_AUTH_PORT=5000
OS_AUTH_PROTOCOL=http  # Use 'https' for production with SSL/TLS
# OS_CACERT=/etc/ssl/certs/openstack-ca.pem  # Required for HTTPS (optional for HTTP)
OS_IDENTITY_API_VERSION=3
OS_USERNAME=your-username
OS_PASSWORD=your-password
OS_PROJECT_NAME=your-project
OS_PROJECT_DOMAIN_NAME=default
OS_USER_DOMAIN_NAME=default
OS_REGION_NAME=RegionOne

# OpenStack Service Ports (customizable)
OS_COMPUTE_PORT=8774
OS_NETWORK_PORT=9696
OS_VOLUME_PORT=8776
OS_IMAGE_PORT=9292
OS_PLACEMENT_PORT=8780
OS_HEAT_STACK_PORT=8004
OS_HEAT_STACK_CFN_PORT=8000

# MCP Server Configuration (optional)
MCP_LOG_LEVEL=INFO
ALLOW_MODIFY_OPERATIONS=false
FASTMCP_TYPE=stdio
FASTMCP_HOST=127.0.0.1
FASTMCP_PORT=8080
```

**HTTPS Configuration for Production Environments**

For secure OpenStack deployments with SSL/TLS:

```bash
# Enable HTTPS protocol
OS_AUTH_PROTOCOL=https
OS_AUTH_HOST=your-secure-openstack-host
OS_AUTH_PORT=13000  # Your HTTPS Keystone port

# SSL Certificate Configuration
# Option 1: Use custom CA certificate (recommended for production)
OS_CACERT=/etc/ssl/certs/openstack-ca.pem

# Option 2: Skip CA certificate (SSL verification disabled - insecure)
# Just omit OS_CACERT - the server will warn you about insecure connection

# Docker: Mount CA certificate into container
# Add to docker-compose.yml volumes:
#   - /path/to/your/ca-cert.pem:/etc/ssl/certs/openstack-ca.pem:ro
```

**Protocol Configuration Notes:**
- `OS_AUTH_PROTOCOL=http`: Use for local development or HTTP-only OpenStack deployments
- `OS_AUTH_PROTOCOL=https`: Use for production environments with SSL/TLS enabled
- When `https` is set without `OS_CACERT`, SSL verification is disabled (insecure but functional)
- For secure production deployments, always provide `OS_CACERT` with your CA certificate path

### 2. Run Server

```bash
# Start all services
docker-compose up -d

# Check logs
docker-compose logs mcp-server
docker-compose logs mcpo-proxy
```

**Container Architecture**:
- **mcp-server**: OpenStack MCP server with tools
- **mcpo-proxy**: OpenAPI (REST-API)
- **open-webui**: Web interface for testing and interaction

**Service URLs - Docker Internal**:
- MCP Server: `localhost:8080` (HTTP transport)
- MCPO Proxy: `localhost:8000` (OpenStack API proxy)
- Open WebUI: `localhost:3000` (Web interface)

**Service URLs - Docker External**:
- MCP Server: `host.docker.internal:18005` (HTTP transport)
- MCPO Proxy: `host.docker.internal:8005` (OpenStack API proxy)
- Open WebUI: `host.docker.internal:3005` (Web interface)

#### For Claude Desktop Integration
Add to your Claude Desktop configuration:
```json
{
  "mcpServers": {
    "mcp-openstack-ops": {
      "command": "uvx",
      "args": ["--python", "3.12", "mcp-openstack-ops"],
      "env": {
        "OS_AUTH_HOST": "your-openstack-host",
        "OS_AUTH_PORT": "5000",
        "OS_PROJECT_NAME": "your-project",
        "OS_USERNAME": "your-username",
        "OS_PASSWORD": "your-password",
        "OS_USER_DOMAIN_NAME": "Default",
        "OS_PROJECT_DOMAIN_NAME": "Default",
        "OS_REGION_NAME": "RegionOne",
        "OS_IDENTITY_API_VERSION": "3",
        "OS_INTERFACE": "internal",
        "OS_COMPUTE_PORT": "8774",
        "OS_NETWORK_PORT": "9696",
        "OS_VOLUME_PORT": "8776",
        "OS_IMAGE_PORT": "9292",
        "OS_PLACEMENT_PORT": "8780",
        "OS_HEAT_STACK_PORT": "8004",
        "OS_HEAT_STACK_CFN_PORT": "18888",
        "ALLOW_MODIFY_OPERATIONS": "false",
        "MCP_LOG_LEVEL": "INFO"
      }
    }
  }
}
```

---

## Server Configuration

### Command Line Options

```bash
uv run python -m mcp_openstack_ops --help

Options:
  --log-level {DEBUG,INFO,WARNING,ERROR,CRITICAL}
                        Logging level
  --type {stdio,streamable-http}
                        Transport type (default: stdio)
  --host HOST          Host address for HTTP transport (default: 127.0.0.1)
  --port PORT          Port number for HTTP transport (default: 8080)
  --auth-enable        Enable Bearer token authentication for streamable-http mode
  --secret-key SECRET  Secret key for Bearer token authentication
```

### Environment Variables

| Variable | Description | Default | Usage |
|----------|-------------|---------|--------|
| **OpenStack Authentication** |
| `OS_AUTH_HOST` | OpenStack Identity service host | Required | Authentication host address |
| `OS_AUTH_PORT` | OpenStack Identity service port | Required | Authentication port |
| `OS_AUTH_PROTOCOL` | Connection protocol (http or https) | `http` | Use `https` for production with SSL/TLS |
| `OS_CACERT` | SSL CA certificate path for HTTPS | Optional | Required for secure HTTPS connections (e.g., `/etc/ssl/certs/ca.pem`). If not set with HTTPS, SSL verification is disabled (insecure) |
| `OS_USERNAME` | OpenStack username | Required | User credentials |
| `OS_PASSWORD` | OpenStack password | Required | User credentials |
| `OS_PROJECT_NAME` | OpenStack project name | Required | Project scope |
| `OS_IDENTITY_API_VERSION` | Identity API version | `3` | API version |
| `OS_PROJECT_DOMAIN_NAME` | Project domain name | `default` | Domain scope |
| `OS_USER_DOMAIN_NAME` | User domain name | `default` | Domain scope |
| `OS_REGION_NAME` | OpenStack region | `RegionOne` | Regional scope |
| **OpenStack Service Ports** |
| `OS_COMPUTE_PORT` | Compute service port | `8774` | Nova endpoint |
| `OS_NETWORK_PORT` | Network service port | `9696` | Neutron endpoint |
| `OS_VOLUME_PORT` | Volume service port | `8776` | Cinder endpoint |
| `OS_IMAGE_PORT` | Image service port | `9292` | Glance endpoint |
| `OS_PLACEMENT_PORT` | Placement service port | `8780` | Placement endpoint |
| `OS_HEAT_STACK_PORT` | Heat orchestration service port | `8004` | Heat API endpoint |
| `OS_HEAT_STACK_CFN_PORT` | Heat CloudFormation service port | `18888` | Heat CFN API endpoint (default: 8000, changed to avoid Docker port conflicts) |
| **MCP Server Configuration** |
| `MCP_LOG_LEVEL` | Logging level | `INFO` | Development debugging |
| `ALLOW_MODIFY_OPERATIONS` | Enable modify operations | `false` | Safety control for state modifications |
| `FASTMCP_TYPE` | Transport type | `stdio` | Rarely needed to change |
| `FASTMCP_HOST` | HTTP host address | `127.0.0.1` | For HTTP mode only |
| `FASTMCP_PORT` | HTTP port number | `8080` | For HTTP mode only |
| **Authentication (Optional)** |
| `REMOTE_AUTH_ENABLE` | Enable Bearer token authentication for streamable-http mode | `false` | Production security |
| `REMOTE_SECRET_KEY` | Secret key for Bearer token authentication | Required when auth enabled | Production security |

---

## ðŸ”’ Project Isolation & Security

### Single Project Scope Operation

**MCP-OpenStack-Ops operates within a strictly defined project scope** determined by the `OS_PROJECT_NAME` environment variable. This provides complete tenant isolation and data privacy in multi-tenant OpenStack environments.

**Key Security Features:**

- **100% Complete Resource Isolation**: All operations are restricted to resources within the specified project with enhanced security validation
- **Zero Cross-tenant Data Leakage**: Advanced project ownership validation prevents access to resources from other projects
- **Multi-layer Security Filtering**: Each service implements intelligent resource filtering by current project ID with additional validation
- **Secure Resource Lookup**: All resource searches use project-scoped lookup with ownership verification
- **Shared Resource Access**: Intelligently includes shared/public resources (networks, images) while maintaining strict security boundaries
- **Cross-Project Access Prevention**: Enhanced protection against accidental operations on similarly-named resources in other projects

**Filtered Resources by Project:**

| Service | Project-Scoped Resources | Notes |
|---------|-------------------------|-------|
| **Identity** | Users (via role assignments), Role assignments | Only users with roles in current project |
| **Compute** | Instances, Flavors (embedded data), Keypairs | All instances within project scope |
| **Image** | Private images (owned), Public/Community/Shared images | Smart filtering prevents zero-image issues |
| **Network** | Networks, Subnets, Security Groups, Floating IPs, Routers | Includes shared/external networks for access |
| **Storage** | Volumes, Snapshots, Backups | All storage resources within project |
| **Orchestration** | Heat Stacks, Stack Resources | All orchestration within project |
| **Load Balancer** | Load Balancers, Listeners, Pools | All load balancing within project |
| **Monitoring** | Resource usage, Project quotas | Project-specific monitoring data |

### Security Validation & Testing

**Project Isolation Security Test**

To verify that project isolation is working correctly, run the included security test:

```bash
# Run project isolation security test
python test_project_isolation.py
```

**Expected Test Results:**
```
ðŸ”’ OpenStack Project Isolation Security Test
==================================================
ðŸ“‹ Testing project isolation for: your-project

1ï¸âƒ£ Testing Connection and Project ID...
âœ… Connection successful
âœ… Current project ID: abc123-def456-ghi789
âœ… Project name 'your-project' matches project ID

2ï¸âƒ£ Testing Resource Ownership Validation...
âœ… Found 5 compute instances
   Instance web-server-01: âœ… Owned
   Instance db-server-01: âœ… Owned
âœ… Found 3/8 owned networks
âœ… Found 10/10 owned volumes

3ï¸âƒ£ Testing Service-Level Project Filtering...
âœ… Compute service returned 5 instances
âœ… Network service returned 3 networks  
âœ… Storage service returned 10 volumes

4ï¸âƒ£ Testing Secure Resource Lookup...
â„¹ï¸  Network 'admin' not found or not accessible in current project
â„¹ï¸  Instance 'demo' not found or not accessible in current project

ðŸŽ¯ Project Isolation Test Results
========================================
âœ… All security tests passed!
âœ… Project 'your-project' isolation verified
âœ… Cross-project access prevention confirmed

ðŸ”’ Your OpenStack MCP Server is properly secured!
```

**Security Features Validated:**
- âœ… Project ID verification and matching
- âœ… Resource ownership validation for all services
- âœ… Service-level project filtering
- âœ… Secure resource lookup with cross-project protection
- âœ… Prevention of accidental operations on other projects' resources

For managing multiple OpenStack projects, deploy multiple MCP server instances with different `OS_PROJECT_NAME` values:

**Example: Managing 3 Projects**

```bash
# Project 1: Production Environment
OS_PROJECT_NAME=production
# ... other config
python -m mcp_openstack_ops --type stdio

# Project 2: Development Environment  
OS_PROJECT_NAME=development
# ... other config  
python -m mcp_openstack_ops --type streamable-http --port 8001

# Project 3: Testing Environment
OS_PROJECT_NAME=testing  
# ... other config
python -m mcp_openstack_ops --type streamable-http --port 8002
```

**Claude Desktop Multi-Project Configuration Example:**

```json
{
  "mcpServers": {
    "openstack-production": {
      "command": "python",
      "args": ["-m", "mcp_openstack_ops", "--type", "stdio"],
      "env": {
        "OS_PROJECT_NAME": "production",
        "OS_USERNAME": "admin",
        "OS_PASSWORD": "your-password",
        "OS_AUTH_HOST": "192.168.35.2"
      }
    },
    "openstack-development": {
      "command": "python", 
      "args": ["-m", "mcp_openstack_ops", "--type", "stdio"],
      "env": {
        "OS_PROJECT_NAME": "development",
        "OS_USERNAME": "admin",
        "OS_PASSWORD": "your-password", 
        "OS_AUTH_HOST": "192.168.35.2"
      }
    },
    "openstack-testing": {
      "command": "python",
      "args": ["-m", "mcp_openstack_ops", "--type", "stdio"], 
      "env": {
        "OS_PROJECT_NAME": "testing",
        "OS_USERNAME": "admin",
        "OS_PASSWORD": "your-password",
        "OS_AUTH_HOST": "192.168.35.2"
      }
    }
  }
}
```

This allows Claude to access each project independently with complete isolation between environments.

**ðŸ“ Ready-to-use Configuration File:**

A complete multi-project configuration example is available at `mcp-config.json.multi-project`:
- **Production**: Read-only operations for safety (`ALLOW_MODIFY_OPERATIONS=false`)
- **Development**: Full operations enabled (`ALLOW_MODIFY_OPERATIONS=true`) 
- **Testing**: Debug logging enabled (`MCP_LOG_LEVEL=DEBUG`)

```bash
# Copy and customize the multi-project configuration
cp mcp-config.json.multi-project ~/.config/claude-desktop/mcp_servers.json
# Edit with your OpenStack credentials
```

---

## Safety Controls

### Modification Operations Protection

By default, all operations that can modify or delete OpenStack resources are **disabled** for safety:

```bash
# Default setting - Only read-only operations allowed
ALLOW_MODIFY_OPERATIONS=false
```

**Protected Operations (when `ALLOW_MODIFY_OPERATIONS=false`):**
- Instance management (start, stop, restart, pause, unpause)
- Volume operations (create, delete, attach, detach)
- Keypair management (create, delete, import)
- Floating IP operations (create, delete, associate, disassociate)
- Snapshot management (create, delete)
- Image management (create, delete, update)
- Heat stack operations (create, delete, update)

**Always Available (Read-Only Operations):**
- Cluster status and monitoring
- Resource listings (instances, volumes, networks, etc.)
- Service status checks
- Usage and quota information
- Search and filtering operations

**âš ï¸ To Enable Modify Operations:**
```bash
# Enable all operations (USE WITH CAUTION)
ALLOW_MODIFY_OPERATIONS=true
```

**Tool Registration Behavior:**
- When `ALLOW_MODIFY_OPERATIONS=false`: Only read-only tools are registered with the MCP server
- When `ALLOW_MODIFY_OPERATIONS=true`: All tools (read-only + modify operations) are registered
- Tool availability is determined at server startup - restart required after changing this setting

**Best Practices:**
- Keep `ALLOW_MODIFY_OPERATIONS=false` in production environments
- Enable modify operations only in development/testing environments
- Use separate configurations for different environments
- Review operations before enabling modify capabilities
- Restart the MCP server after changing the `ALLOW_MODIFY_OPERATIONS` setting

---

## ðŸ’¬ Example Queries & Usage Patterns

For comprehensive examples of how to interact with this MCP server, including natural language queries and their corresponding tool mappings, see:

**ðŸ“– [Example Queries & Usage Patterns](src/mcp_openstack_ops/prompt_template.md#7-example-queries--usage-patterns)**

This section includes:
- ðŸŽ¯ Cluster overview and status queries
- ï¿½ï¸ Instance management operations
- ðŸŒ Network configuration tasks
- ï¿½ Storage management workflows
- ðŸ”¥ Heat orchestration examples
- âš–ï¸ Load balancer operations
- ï¿½ Advanced search patterns
- ðŸ“Š Monitoring and troubleshooting
- ðŸ§  Complex multi-tool query combinations

---

## Performance Optimization

### Large-Scale Environment Support

The MCP server is optimized for large OpenStack environments with thousands of instances:

**Pagination Features:**
- Default limits prevent memory overflow (50 instances per request)
- Configurable safety limits (maximum 200 instances per request)
- Offset-based pagination for browsing large datasets
- Performance metrics tracking (processing time, instances per second)

**Search Optimization:**
- 2-phase search process (basic info filtering â†’ detailed info retrieval)
- Intelligent caching with connection reuse
- Selective API calls to minimize overhead
- Case-sensitive search options for precise filtering

**Connection Management:**
- Global connection caching with validity testing
- Automatic retry mechanisms for transient failures
- Connection pooling for high-throughput scenarios

**Usage Examples:**
```bash
# Safe large environment browsing
get_instance_details(limit=50, offset=0)     # First 50 instances
get_instance_details(limit=50, offset=50)    # Next 50 instances

# Emergency override for small environments
get_instance_details(include_all=True)       # All instances (use with caution)

# Optimized search for large datasets
search_instances("web", "name", limit=20)    # Search with reasonable limit
```

---

## Development

### Adding New Tools

Edit `src/mcp_openstack_ops/mcp_main.py` to add new MCP tools:

```python
@mcp.tool()
async def my_openstack_tool(param: str) -> str:
    """
    Brief description of the tool's purpose.
    
    Functions:
    - List specific functions this tool performs
    - Describe the operations it enables
    - Mention when to use this tool
    
    Use when user requests [specific scenarios].
    
    Args:
        param: Description of the parameter
        
    Returns:
        Description of return value format.
    """
    try:
        logger.info(f"Tool called with param: {param}")
        # Implementation using functions.py helpers
        result = my_helper_function(param)
        
        response = {
            "timestamp": datetime.now().isoformat(),
            "result": result
        }
        
        return json.dumps(response, indent=2, ensure_ascii=False)
        
    except Exception as e:
        error_msg = f"Error: Failed to execute tool - {str(e)}"
        logger.error(error_msg)
        return error_msg
```

### Helper Functions

Add utility functions to `src/mcp_openstack_ops/functions.py`:

```python
def my_helper_function(param: str) -> dict:
    """Helper function for OpenStack operations"""
    try:
        conn = get_openstack_connection()
        
        # OpenStack SDK operations
        result = conn.some_service.some_operation(param)
        
        logger.info(f"Operation completed successfully")
        return {"success": True, "data": result}
        
    except Exception as e:
        logger.error(f"Helper function error: {e}")
        raise
```

---

## Testing & Validation

### Local Testing
```bash
# Test with MCP Inspector (recommended)
./scripts/run-mcp-inspector-local.sh

# Test with debug logging
MCP_LOG_LEVEL=DEBUG uv run python -m mcp_openstack_ops

# Validate OpenStack connection
uv run python -c "from src.mcp_openstack_ops.functions import get_openstack_connection; print(get_openstack_connection())"
```

---

## ðŸ” Security & Authentication

### Bearer Token Authentication

For `streamable-http` mode, this MCP server supports Bearer token authentication to secure remote access. This is especially important when running the server in production environments.

#### Configuration

**Enable Authentication:**

```bash
# In .env file
REMOTE_AUTH_ENABLE=true
REMOTE_SECRET_KEY=your-secure-secret-key-here
```

**Or via CLI:**

```bash
uv run python -m mcp_openstack_ops --type streamable-http --auth-enable --secret-key your-secure-secret-key-here
```

#### Security Levels

1. **stdio mode** (Default): Local-only access, no authentication needed
2. **streamable-http + REMOTE_AUTH_ENABLE=false/undefined**: Remote access without authentication âš ï¸ **NOT RECOMMENDED for production**
3. **streamable-http + REMOTE_AUTH_ENABLE=true**: Remote access with Bearer token authentication âœ… **RECOMMENDED for production**

> **ðŸ”’ Default Policy**: `REMOTE_AUTH_ENABLE` defaults to `false` if undefined, empty, or null. This ensures the server starts even without explicit authentication configuration.

#### Client Configuration

When authentication is enabled, MCP clients must include the Bearer token in the Authorization header:

```json
{
  "mcpServers": {
    "mcp-openstack-ops": {
      "type": "streamable-http",
      "url": "http://your-server:8000/mcp",
      "headers": {
        "Authorization": "Bearer your-secure-secret-key-here"
      }
    }
  }
}
```

#### Security Best Practices

- **Always enable authentication** when using streamable-http mode in production
- **Use strong, randomly generated secret keys** (32+ characters recommended)
- **Use HTTPS** when possible (configure reverse proxy with SSL/TLS)
- **Restrict network access** using firewalls or network policies
- **Rotate secret keys regularly** for enhanced security
- **Monitor access logs** for unauthorized access attempts

#### Error Handling

When authentication fails, the server returns:
- **401 Unauthorized** for missing or invalid tokens
- **Detailed error messages** in JSON format for debugging

---

## ðŸŽ¯ Recent Improvements & Enhancements

### **ðŸ”’ Complete Project Isolation Security Implementation** âœ¨

**100% Project Isolation Guarantee:**
- âœ… **Multi-layer Security Validation**: Added comprehensive project ownership validation for all resource operations
- âœ… **Enhanced Delete Operation Security**: All delete operations now use secure project-scoped lookup with ownership verification
- âœ… **Create Operation Security**: Resource references during creation (networks, images, etc.) verified for project ownership
- âœ… **Query Security Enhancement**: All list/get operations include explicit project validation with resource ownership checks
- âœ… **Cross-Project Access Prevention**: Advanced protection against accidental operations on similarly-named resources in other projects
- âœ… **Security Test Suite**: Added `test_project_isolation.py` for comprehensive security validation

**Technical Implementation:**
- âœ… **New Security Utilities**: Added `get_current_project_id()`, `validate_resource_ownership()`, `find_resource_by_name_or_id()` functions
- âœ… **Service-Level Security**: Enhanced all service modules (compute, network, storage, etc.) with project ownership validation
- âœ… **Secure Resource Lookup**: Replaced unsafe name-based loops with secure project-scoped resource lookup
- âœ… **Error Message Enhancement**: Improved error messages to clearly indicate project access restrictions

### **Complete Project Scoping Implementation** 

**Enhanced Security & Tenant Isolation:**
- âœ… **All Services Project-Scoped**: Identity, Compute, Network, Storage, Image, Orchestration, Load Balancer, and Monitoring services now filter resources by current project ID
- âœ… **Zero Cross-Tenant Data Leakage**: Automatic filtering at OpenStack SDK level using `current_project_id`
- âœ… **Smart Resource Access**: Intelligent handling of shared/public resources (networks, images) while maintaining security boundaries

### **Fixed Image Service Issues** ðŸ–¼ï¸

**Resolved Zero-Image Count Problems:**
- âœ… **Enhanced Image Filtering**: Now includes public, community, shared, and project-owned images
- âœ… **Intelligent Visibility Handling**: Proper handling of different image visibility types
- âœ… **Prevented Empty Results**: Fixed filtering logic that was too restrictive

### **Improved vCPU/RAM Calculation** âš¡

**Fixed Instance Resource Display:**
- âœ… **Embedded Flavor Data Usage**: Uses server.flavor attributes directly, avoiding 404 API errors
- âœ… **Accurate Resource Reporting**: Proper vCPU and RAM values in cluster status reports
- âœ… **Eliminated API Failures**: No more flavor lookup failures causing zero resource values

### **Enhanced Documentation** ðŸ“š

**Comprehensive Project Scoping Documentation:**
- âœ… **Multi-Project Management Guide**: Complete setup instructions for managing multiple OpenStack projects
- âœ… **Security & Isolation Details**: Detailed explanation of tenant isolation features
- âœ… **Ready-to-Use Configuration**: Pre-configured `mcp-config.json.multi-project` for quick setup
- âœ… **Updated Environment Variables**: Enhanced `.env.example` with project scoping guidance

---

## ðŸš€ Adding Custom Tools

This MCP server is designed for easy extensibility. Follow these steps to add your own custom tools:

### Step-by-Step Guide

#### 1. **Add Helper Functions (Optional)**

Add reusable data functions to `src/mcp_openstack_ops/functions.py`:

```python
async def get_your_custom_data(target_resource: str = None) -> List[Dict[str, Any]]:
    """Your custom data retrieval function."""
    # Example implementation - adapt to your OpenStack service
    conn = get_openstack_connection()
    results = []
    
    try:
        # Example: Custom query using OpenStack SDK
        resources = conn.your_service.list_resources(
            filters={'name': target_resource} if target_resource else {}
        )
        
        for resource in resources:
            results.append({
                'name': resource.name,
                'id': resource.id,
                'status': resource.status,
                'created_at': resource.created_at,
                # Add your custom fields
            })
            
    except Exception as e:
        logger.error(f"Failed to get custom data: {e}")
        return []
        
    return results
```

#### 2. **Create Your MCP Tool File**

Create a new file `src/mcp_openstack_ops/tools/get_your_custom_analysis.py`:

```python
"""Tool implementation for get_your_custom_analysis."""

import json
from datetime import datetime
from typing import Optional
from ..functions import get_your_custom_data  # Import your helper function
from ..mcp_main import (
    logger,
    mcp,
)

@mcp.tool()
async def get_your_custom_analysis(limit: int = 50, target_name: Optional[str] = None) -> str:
    """
    [Tool Purpose]: Brief description of what your tool does
    
    [Exact Functionality]:
    - Feature 1: Data aggregation and analysis
    - Feature 2: Resource monitoring and insights
    - Feature 3: Performance metrics and reporting
    
    [Required Use Cases]:
    - When user asks "your specific analysis request"
    - Your business-specific monitoring needs
    
    Args:
        limit: Maximum results (1-100)
        target_name: Target resource/service name
    
    Returns:
        Formatted analysis results
    """
    try:
        limit = max(1, min(limit, 100))  # Always validate input
        
        logger.info(f"Getting custom analysis, limit: {limit}, target: {target_name}")
        
        results = await get_your_custom_data(target_resource=target_name)
        
        if not results:
            return f"No custom analysis data found" + (f" for '{target_name}'" if target_name else "")
        
        # Apply limit
        results = results[:limit]
        
        # Format results as table
        table_data = []
        for item in results:
            table_data.append({
                'Name': item.get('name', 'N/A'),
                'ID': item.get('id', 'N/A'),
                'Status': item.get('status', 'N/A'),
                'Created': item.get('created_at', 'N/A'),
            })
        
        # Return formatted JSON
        return json.dumps({
            'title': f'Custom Analysis (Top {len(results)})',
            'data': table_data,
            'total_count': len(results),
            'timestamp': datetime.now().isoformat()
        }, indent=2)
        
    except Exception as e:
        logger.error(f"Failed to get custom analysis: {e}")
        return f"Error: {str(e)}"
```

#### 3. **For Modify Operations (Optional)**

If your tool performs modify operations, use the `@conditional_tool` decorator instead:

```python
"""Tool implementation for set_your_custom_resource."""

from ..mcp_main import (
    conditional_tool,  # Use this instead of @mcp.tool()
    handle_operation_result,
    logger,
)
from ..functions import set_your_custom_resource

@conditional_tool  # Only registers when ALLOW_MODIFY_OPERATIONS=true
async def set_your_custom_resource(resource_name: str, action: str) -> str:
    """
    Manage your custom OpenStack resources.
    
    Use when user requests custom resource management.
    """
    try:
        result = set_your_custom_resource(resource_name, action)
        
        return handle_operation_result(
            result=result,
            operation_name="Custom Resource Management",
            details={
                'Resource': resource_name,
                'Action': action
            }
        )
        
    except Exception as e:
        logger.error(f"Custom resource operation failed: {e}")
        return f"Error: {str(e)}"
```

#### 4. **Update Prompt Template (Recommended)**

Add your tool description to `src/mcp_openstack_ops/prompt_template.md` for better natural language recognition:

```markdown
### **Your Custom Analysis Tool**

### X. **get_your_custom_analysis**
**Purpose**: Brief description of what your tool does
**Usage**: "Show me your custom analysis" or "Get custom analysis for resource_name"
**Features**: Data aggregation, resource monitoring, performance metrics
**Optional**: `target_name` parameter for specific resource analysis
```

#### 5. **Test Your Tool**

```bash
# Local testing
./scripts/run-mcp-inspector-local.sh

# Or with Docker
docker-compose up -d
docker-compose logs -f mcp-server

# Test with natural language:
# "Show me your custom analysis"
# "Get custom analysis for target_name"
```

### Tool Registration System

The MCP server uses automatic tool discovery. When you create a new file in `src/mcp_openstack_ops/tools/`, it's automatically registered through the `register_all_tools()` function in `tools/__init__.py`. No manual import registration needed!

### Safety System

- **Read-only tools**: Use `@mcp.tool()` - always available
- **Modify tools**: Use `@conditional_tool` - only available when `ALLOW_MODIFY_OPERATIONS=true`
- **Connection**: Always use `get_openstack_connection()` for OpenStack API access
- **Project isolation**: All operations are automatically scoped to `OS_PROJECT_NAME`

That's it! Your custom tool is ready to use with natural language queries.

---

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request
