{
  "$defs": {
    "ControlRelationship": {
      "description": "Grouped relationship mapping for a single source control id.\n\nIntended use:\n- A scenario references a (source) control A.\n- A portfolio implements one or more (target) controls B1..Bn.\n- This mapping expresses how each target relates to the source, including quantitative overlap metadata.",
      "properties": {
        "source": {
          "description": "Source control id (often scenario/threat-centric).",
          "maxLength": 256,
          "minLength": 1,
          "not": {
            "pattern": "^attck:"
          },
          "pattern": "^[a-z][a-z0-9_-]{0,31}:[^\\s]{1,223}$",
          "title": "Source",
          "type": "string"
        },
        "targets": {
          "description": "List of target relationship mappings for this source control id.",
          "items": {
            "$ref": "#/$defs/RelationshipTarget"
          },
          "minItems": 1,
          "title": "Targets",
          "type": "array"
        }
      },
      "required": [
        "source",
        "targets"
      ],
      "title": "ControlRelationship",
      "type": "object"
    },
    "ControlRelationshipsPack": {
      "description": "Relationship pack payload.\n\nThis is a standalone, shareable dataset that can be community- or org-authored.",
      "properties": {
        "id": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional identifier for this relationships pack (organization/community-owned).",
          "title": "Id"
        },
        "relationships": {
          "description": "List of grouped source-to-target relationship mappings.",
          "items": {
            "$ref": "#/$defs/ControlRelationship"
          },
          "title": "Relationships",
          "type": "array"
        }
      },
      "required": [
        "relationships"
      ],
      "title": "ControlRelationshipsPack",
      "type": "object"
    },
    "Grouping": {
      "description": "Optional taxonomy/grouping tag.\n\nThis is intentionally framework-agnostic.\n\nExample:\n    {scheme: \"nist_csf_function\", id: \"PR\", label: \"Protect\"}",
      "properties": {
        "scheme": {
          "description": "Grouping scheme identifier (tool/community-defined). Example: 'nist_csf_function'.",
          "title": "Scheme",
          "type": "string"
        },
        "id": {
          "description": "Identifier within the grouping scheme. Example: 'PR'.",
          "title": "Id",
          "type": "string"
        },
        "label": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional human-friendly label for the grouping id.",
          "title": "Label"
        }
      },
      "required": [
        "scheme",
        "id"
      ],
      "title": "Grouping",
      "type": "object"
    },
    "Meta": {
      "properties": {
        "name": {
          "description": "Human-friendly name for this document.",
          "title": "Name",
          "type": "string"
        },
        "version": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional version string for this document.",
          "title": "Version"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional free-form description.",
          "title": "Description"
        },
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional author/owner.",
          "title": "Author"
        },
        "organization": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional organization name.",
          "title": "Organization"
        },
        "industries": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional list of industry tags.",
          "title": "Industries"
        },
        "locale": {
          "additionalProperties": true,
          "description": "Optional locale/region information and arbitrary locale metadata.",
          "title": "Locale",
          "type": "object"
        },
        "company_sizes": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional company size tags.",
          "title": "Company Sizes"
        },
        "regulatory_frameworks": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional list of regulatory frameworks relevant to this document.",
          "title": "Regulatory Frameworks"
        },
        "tags": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional list of user-defined tags.",
          "title": "Tags"
        },
        "attck": {
          "anyOf": [
            {
              "items": {
                "description": "ATT&CK identifier in canonical namespaced form 'namespace:key' (no whitespace). Recommended namespace is 'attck'. Examples: attck:TA0001, attck:T1059, attck:T1059.003",
                "maxLength": 256,
                "minLength": 1,
                "pattern": "^[a-z][a-z0-9_-]{0,31}:[^\\s]{1,223}$",
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional list of ATT&CK tactic/technique/sub-technique identifiers relevant to this document, expressed as namespaced ids (e.g. 'attck:T1059.003').",
          "title": "Attck"
        }
      },
      "required": [
        "name"
      ],
      "title": "Meta",
      "type": "object"
    },
    "Overlap": {
      "description": "Quantitative overlap metadata used for downstream math.\n\nSemantics (recommended):\n- weight: fraction of source coverage provided by the target in [0, 1]",
      "properties": {
        "weight": {
          "description": "Quantitative overlap/coverage weight in [0, 1]. Recommended semantics: the fraction of the source control's mitigation objective that is covered by the target control.",
          "maximum": 1.0,
          "minimum": 0.0,
          "title": "Weight",
          "type": "number"
        },
        "dimensions": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "number"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional multidimensional overlap weights (dimension_name -> weight in [0, 1]). Dimension names are tool/community-defined (e.g. 'coverage', 'intent', 'implementation').",
          "title": "Dimensions"
        },
        "rationale": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional free-form rationale explaining why the overlap weight(s) were chosen. Avoid embedding copyrighted standard text unless you have rights.",
          "title": "Rationale"
        }
      },
      "required": [
        "weight"
      ],
      "title": "Overlap",
      "type": "object"
    },
    "Reference": {
      "description": "Optional reference/citation for a relationship.\n\nKeep this to pointers and provenance. Avoid embedding copyrighted standard text unless you have rights.",
      "properties": {
        "type": {
          "description": "Reference type discriminator (e.g. 'url', 'document', 'ticket', 'evidence').",
          "title": "Type",
          "type": "string"
        },
        "label": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional short label for this reference.",
          "title": "Label"
        },
        "url": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional URL for this reference.",
          "title": "Url"
        },
        "citation": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional citation string (free-form).",
          "title": "Citation"
        }
      },
      "required": [
        "type"
      ],
      "title": "Reference",
      "type": "object"
    },
    "RelationshipTarget": {
      "description": "Target-specific relationship metadata for a given relationship source.\n\nThis keeps per-target quantitative metadata (e.g., overlap weights) while allowing\nrelationship packs to be authored in a grouped 1:N form.",
      "properties": {
        "target": {
          "description": "Target control id (often portfolio/implementation-centric).",
          "maxLength": 256,
          "minLength": 1,
          "not": {
            "pattern": "^attck:"
          },
          "pattern": "^[a-z][a-z0-9_-]{0,31}:[^\\s]{1,223}$",
          "title": "Target",
          "type": "string"
        },
        "relationship_type": {
          "anyOf": [
            {
              "enum": [
                "overlaps_with",
                "mitigates",
                "supports",
                "equivalent_to",
                "parent_of",
                "child_of",
                "backstops"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional relationship type. Values: 'overlaps_with', 'mitigates', 'supports', 'equivalent_to', 'parent_of', 'child_of', 'backstops'.",
          "title": "Relationship Type"
        },
        "overlap": {
          "$ref": "#/$defs/Overlap",
          "description": "Required quantitative overlap metadata for downstream math."
        },
        "confidence": {
          "anyOf": [
            {
              "maximum": 1.0,
              "minimum": 0.0,
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional confidence score in [0, 1] for this mapping/relationship (community/org-defined).",
          "title": "Confidence"
        },
        "groupings": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/Grouping"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional taxonomy/grouping tags for this relationship (framework-agnostic). Example: NIST CSF Function classification.",
          "title": "Groupings"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional description of how/why the target relates to the source. Avoid embedding copyrighted standard text unless you have rights.",
          "title": "Description"
        },
        "references": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/Reference"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional list of references/citations supporting this relationship.",
          "title": "References"
        }
      },
      "required": [
        "target",
        "overlap"
      ],
      "title": "RelationshipTarget",
      "type": "object"
    }
  },
  "properties": {
    "crml_control_relationships": {
      "const": "1.0",
      "description": "Control relationships document version identifier.",
      "title": "Crml Control Relationships",
      "type": "string"
    },
    "meta": {
      "$ref": "#/$defs/Meta",
      "description": "Document metadata (name, description, tags, etc.)."
    },
    "relationships": {
      "$ref": "#/$defs/ControlRelationshipsPack",
      "description": "The control relationships payload."
    }
  },
  "required": [
    "crml_control_relationships",
    "meta",
    "relationships"
  ],
  "title": "CRControlRelationships",
  "type": "object"
}
