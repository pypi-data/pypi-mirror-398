{% extends "base.html" %}

{#
Author List Template

Displays all authors with their profiles and post counts.
Pulls from data/authors.yaml registry and/or content/authors/ pages.

URL Pattern: /authors/

Context variables:
  - page: Current list page (_index.md)
  - site.data.authors: Author registry (from data/authors.yaml)
  - site.indexes.author: Author index for post counts
#}

{% from 'partials/navigation-components.html' import breadcrumbs %}

{% block content %}
{{ breadcrumbs(page) }}

<div class="authors-page">
  <header class="page-header">
    <h1>{{ page.title | default('Authors') }}</h1>
    {% if page.description %}
    <p class="page-description">{{ page.description }}</p>
    {% endif %}
  </header>

  {# Main content from markdown #}
  {% if content %}
  <div class="prose" style="margin-bottom: 2rem;">
    {{ content | safe }}
  </div>
  {% endif %}

  {# Build author list from data registry and/or child pages #}
  {% set authors_list = [] %}

  {# Add authors from data/authors.yaml #}
  {% if site.data.authors %}
    {% for author_key, author_data in site.data.authors.items() %}
      {% set post_count = (site.indexes.author.get(author_key) | default([])) | length %}
      {% set _ = authors_list.append({
        'key': author_key,
        'name': author_data.name | default(author_key),
        'bio': author_data.bio | default(''),
        'avatar': author_data.avatar,
        'company': author_data.company,
        'location': author_data.location,
        'github': author_data.github,
        'post_count': post_count,
        'href': '/authors/' ~ author_key ~ '/'
      }) %}
    {% endfor %}
  {% endif %}

  {# Add authors from child pages (if not already in registry) #}
  {% for child in page.children | default([]) %}
    {% set author_key = child.metadata.get('author_name', child.title) %}
    {% set existing = authors_list | selectattr('key', 'equalto', author_key) | list %}
    {% if not existing %}
      {% set post_count = (site.indexes.author.get(author_key) | default([])) | length %}
      {% set _ = authors_list.append({
        'key': author_key,
        'name': child.title,
        'bio': child.metadata.get('bio', ''),
        'avatar': child.metadata.get('avatar'),
        'company': child.metadata.get('company'),
        'location': child.metadata.get('location'),
        'github': child.metadata.get('social', {}).get('github'),
        'post_count': post_count,
        'href': child.href
      }) %}
    {% endif %}
  {% endfor %}

  {% if authors_list %}
  <div class="authors-grid">
    {% for author in authors_list | sort(attribute='name') %}
    <article class="author-card">
      <a href="{{ author.href }}" class="author-card-link">
        {% if author.avatar %}
        <img src="{{ author.avatar }}"
             alt="{{ author.name }}"
             class="author-card-avatar">
        {% else %}
        <div class="author-card-avatar-placeholder">
          {{ author.name[0] | upper }}
        </div>
        {% endif %}

        <div class="author-card-content">
          <h2 class="author-card-name">{{ author.name }}</h2>

          {% if author.company or author.location %}
          <p class="author-card-meta">
            {% if author.company %}{{ author.company }}{% endif %}
            {% if author.company and author.location %} ¬∑ {% endif %}
            {% if author.location %}{{ author.location }}{% endif %}
          </p>
          {% endif %}

          {% if author.bio %}
          <p class="author-card-bio">{{ author.bio | truncate(120) }}</p>
          {% endif %}

          <div class="author-card-stats">
            <span class="stat">
              üìù {{ author.post_count }} post{{ 's' if author.post_count != 1 }}
            </span>
            {% if author.github %}
            <span class="stat">
              üíª {{ author.github }}
            </span>
            {% endif %}
          </div>
        </div>
      </a>
    </article>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <p>No authors found.</p>
    <p>Add authors to <code>data/authors.yaml</code> or create pages in <code>content/authors/</code>.</p>
  </div>
  {% endif %}
</div>

<style>
.authors-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.authors-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1.5rem;
  margin-top: 2rem;
}

.author-card {
  background: var(--surface-1, #fff);
  border: 1px solid var(--border-color, #e5e7eb);
  border-radius: 12px;
  overflow: hidden;
  transition: transform 0.2s, box-shadow 0.2s;
}

.author-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

.author-card-link {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  padding: 1.5rem;
  text-decoration: none;
  color: inherit;
}

.author-card-avatar,
.author-card-avatar-placeholder {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  flex-shrink: 0;
}

.author-card-avatar {
  object-fit: cover;
}

.author-card-avatar-placeholder {
  background: var(--accent-color, #6366f1);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: 600;
}

.author-card-content {
  flex: 1;
  min-width: 0;
}

.author-card-name {
  font-size: 1.125rem;
  font-weight: 600;
  margin: 0 0 0.25rem;
  color: var(--text-1, #111);
}

.author-card-meta {
  font-size: 0.875rem;
  color: var(--text-2, #6b7280);
  margin: 0 0 0.5rem;
}

.author-card-bio {
  font-size: 0.875rem;
  color: var(--text-2, #6b7280);
  margin: 0 0 0.75rem;
  line-height: 1.5;
}

.author-card-stats {
  display: flex;
  gap: 1rem;
  font-size: 0.75rem;
  color: var(--text-3, #9ca3af);
}

.author-card-stats .stat {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.empty-state {
  text-align: center;
  padding: 3rem;
  color: var(--text-2, #6b7280);
}

.empty-state code {
  background: var(--surface-2, #f3f4f6);
  padding: 0.125rem 0.375rem;
  border-radius: 4px;
  font-size: 0.875rem;
}
</style>
{% endblock %}
