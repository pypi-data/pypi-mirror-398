

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Work with balanced circuits &mdash; SLiCAP 4.0.10 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=b8a5ba81"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Work with analysis results" href="math.html" />
    <link rel="prev" title="Work with feedback circuits" href="feedback.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SLiCAP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/SLiCAPintroduction.html">SLiCAP Version 4.0</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="SLiCAPuserguide.html">SLiCAP User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Download, install, configure and test SLiCAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="circuit.html">Create a SLiCAP circuit object</a></li>
<li class="toctree-l2"><a class="reference internal" href="schematics.html">Schematic capture for SLiCAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="specifications.html">Work with specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Work with parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html">Work with models</a></li>
<li class="toctree-l2"><a class="reference internal" href="subcircuit.html">Work with subcircuits</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html">Perform analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="matrices.html">SLiCAP circuit matrix equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="laplace.html">SLiCAP Laplace analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="pz.html">SLiCAP pole-zero analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="time.html">SLiCAP time-domain analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="noise.html">SLiCAP noise analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="dcvar.html">SLiCAP DC and dcvar analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="feedback.html">Work with feedback circuits</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Work with balanced circuits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#settings-for-cm-and-dm-decompositon">Settings for CM and DM decompositon</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pairing-nodes-branches-and-parameters">Pairing nodes, branches, and parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-balanced-circuits">Create balanced circuits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#balanced-passive-network">Balanced passive network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#balanced-circuit-with-models">Balanced circuit with models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#balanced-circuit-with-sub-circuits">Balanced circuit with sub circuits</a></li>
<li class="toctree-l4"><a class="reference internal" href="#auto-rename-detector">Auto-rename detector</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#balanced-feedback">Balanced feedback</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#differential-amplifier">Differential amplifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="#differential-mode-circuit">Differential-mode circuit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-mode-circuit">Common-mode circuit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#balanced-noise">Balanced noise</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#differential-output-noise">Differential output noise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-mode-ouput-noise">Common-mode ouput noise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output-noise-of-the-differential-mode-equivalent-circuit">Output noise of the differential-mode equivalent circuit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output-noise-of-the-common-mode-equivalent-circuit">Output noise of the common-mode equivalent circuit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#balanced-dcvar">Balanced dcvar</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#differential-output-dc-variance">Differential output dc variance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-mode-ouput-dc-variance">Common-mode ouput dc variance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output-dc-variance-of-the-differential-mode-equivalent-circuit">Output dc variance of the differential-mode equivalent circuit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output-dc-variance-of-the-common-mode-equivalent-circuit">Output dc variance of the common-mode equivalent circuit</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="math.html">Work with analysis results</a></li>
<li class="toctree-l2"><a class="reference internal" href="ngspice.html">Interface with NGspice</a></li>
<li class="toctree-l2"><a class="reference internal" href="plots.html">Create plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="reports.html">Create reports</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/SLiCAPtutorials.html">SLiCAP Examples and Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syntax/SLiCAPnetlistSyntax.html">SLiCAP Netlist Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/SLiCAPreference.html">SLiCAP Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SLiCAP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="SLiCAPuserguide.html">SLiCAP User Guide</a></li>
      <li class="breadcrumb-item active">Work with balanced circuits</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/userguide/balanced.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="work-with-balanced-circuits">
<h1>Work with balanced circuits<a class="headerlink" href="#work-with-balanced-circuits" title="Link to this heading"></a></h1>
<img alt="../_images/colorCode.svg" src="../_images/colorCode.svg" />
<p>Balancing is a powerful design technique. Apply balancing to:</p>
<ol class="arabic simple">
<li><p>Create four-terminal networks from three-terminal networks using <em>anti-series</em> connection</p></li>
<li><p>Create odd transfer characteristics with voltage-limiting or current-limiting characteristics using <em>complementary-parallel</em> connection or <em>anti-series</em> connection of nonlinear devices, respectively.</p></li>
</ol>
<p>The signal transfer of balanced circuits is often decomposed in a differential-mode, and a common-mode transfer. In many applications of balanced networks, the differential-mode voltages and currents are of interest, while common-mode voltages and currents are either zero, or should not affect the differential-mode transfer.</p>
<p>SLiCAP has a built-in method to convert nodal voltages and branch currents into differential voltages, differential currents, common-mode voltages, and common-mode currents (for theory see: <a class="reference external" href="https://books.open.tudelft.nl/home/catalog/book/162">Structured Electronics Design</a>).</p>
<p>In a fully balanced network, differential-mode and common-mode quantities are orthogonal, and balanced circuits are decomposed into two independent network models: one modeling the differential-mode behavior and the other the common-mode behavior.</p>
<p>Using two independent network models helps to design the desired common-mode and differential-mode behavior with minimized network models.</p>
<section id="settings-for-cm-and-dm-decompositon">
<h2>Settings for CM and DM decompositon<a class="headerlink" href="#settings-for-cm-and-dm-decompositon" title="Link to this heading"></a></h2>
<p>SLiCAP balanced network decomposition is based upon pairing nodes, branches and parameters.</p>
<p>The decomposition itself is initiated by setting the argument <code class="docutils literal notranslate"><span class="pre">convtype</span></code> in an <a class="reference external" href="../reference/SLiCAPshell.html#general-instruction-format">instruction</a> to:</p>
<ol class="arabic simple">
<li><p><strong>“all”</strong>: SLiCAP decomposes paired node voltages and paired branch currents into pairs of common-mode and differential-mode voltages and currents. Convertion type <code class="docutils literal notranslate"><span class="pre">all</span></code> can only be used for displaying the matrix equations; performing analysis is not implemented.</p></li>
<li><p><strong>“dd”</strong>: After the above decomposition, SLiCAP can perform all types of analysis using the differential-mode matrix equation.</p></li>
<li><p><strong>“dc”</strong> SLiCAP returns the differential-mode to common-mode matrix equation. Generally this involves a non-square matrix.</p></li>
<li><p><strong>“cd”</strong>: SLiCAP returns the common-mode to differential-mode matrix equation. Generally this involves a non-square matrix.</p></li>
<li><p><strong>“cc”</strong> After the above decomposition, SLiCAP can perform all types of analysis using the common-mode matrix equation.</p></li>
</ol>
</section>
<section id="pairing-nodes-branches-and-parameters">
<h2>Pairing nodes, branches, and parameters<a class="headerlink" href="#pairing-nodes-branches-and-parameters" title="Link to this heading"></a></h2>
<p>The decomposition settings for balanced networks are stored in the file <code class="docutils literal notranslate"><span class="pre">SLiCAP.ini</span></code> in the project directory.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import SLiCAP as sl
&gt;&gt;&gt; sl.ini.dump(&quot;balancing&quot;)

BALANCING
---------
ini.pair_ext               = [&#39;P&#39;, &#39;N&#39;]
ini.update_srcnames        = True
ini.remove_param_pair_ext  = True
</pre></div>
</div>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ini.pair_ext</span></code>: List with two strings. These strings (<em>pair extensions</em>) are the last part of node names, element reference designators, and parameter names of paired nodes, elements, and parameters, respectively. The first part of these names must be equal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ini.update_srcnames</span></code>: True will update the names of noise sources and dcvar sources in the results of noise and dcvar analysis, respectively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ini.remove_param_pair_ext</span></code>: True will remove the pair extensions from the parameter names after pairing. This is useful when using paired sub circuits. Local parameters of paired sub circuits are also paired: they obtain the same name, without pair extension.</p></li>
</ol>
</section>
<section id="create-balanced-circuits">
<h2>Create balanced circuits<a class="headerlink" href="#create-balanced-circuits" title="Link to this heading"></a></h2>
<p>SLiCAP output displayed on this manual page, is generated with the script: <code class="docutils literal notranslate"><span class="pre">balanced.py</span></code>, imported by <code class="docutils literal notranslate"><span class="pre">Manual.py</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env python3</span>
<span class="linenos"> 2</span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 5</span><span class="sd">balanced.py: SLiCAP scripts for the HTML help file</span>
<span class="linenos"> 6</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 7</span><span class="kn">import</span><span class="w"> </span><span class="nn">SLiCAP</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sl</span>
<span class="linenos"> 8</span><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="linenos"> 9</span><span class="n">sl</span><span class="o">.</span><span class="n">initProject</span><span class="p">(</span><span class="s2">&quot;balanced&quot;</span><span class="p">)</span>
<span class="linenos">10</span><span class="c1">###############################################################################</span>
<span class="linenos">11</span><span class="c1"># work with balanced circuits</span>
<span class="linenos">12</span><span class="c1">###############################################################################</span>
</pre></div>
</div>
<section id="balanced-passive-network">
<h3>Balanced passive network<a class="headerlink" href="#balanced-passive-network" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">14</span><span class="n">balancedNetwork</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">makeCircuit</span><span class="p">(</span><span class="s2">&quot;kicad/balancedNetwork/balancedNetwork.kicad_sch&quot;</span><span class="p">)</span>
<span class="linenos">15</span><span class="n">noneM</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doMatrix</span><span class="p">(</span><span class="n">balancedNetwork</span><span class="p">)</span>
<span class="linenos">16</span><span class="n">allM</span>  <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doMatrix</span><span class="p">(</span><span class="n">balancedNetwork</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="linenos">17</span><span class="n">ddM</span>   <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doMatrix</span><span class="p">(</span><span class="n">balancedNetwork</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dd&quot;</span><span class="p">)</span>
<span class="linenos">18</span><span class="n">dcM</span>   <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doMatrix</span><span class="p">(</span><span class="n">balancedNetwork</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dc&quot;</span><span class="p">)</span>
<span class="linenos">19</span><span class="n">cdM</span>   <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doMatrix</span><span class="p">(</span><span class="n">balancedNetwork</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cd&quot;</span><span class="p">)</span>
<span class="linenos">20</span><span class="n">ccM</span>   <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doMatrix</span><span class="p">(</span><span class="n">balancedNetwork</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/balancedNetwork.svg"><img alt="../_images/balancedNetwork.svg" src="../_images/balancedNetwork.svg" style="width: 400px;" />
</a>
<div class="note admonition">
<p class="admonition-title">Important</p>
<ol class="arabic">
<li><p>Notice the orientation of the components in both halves of the balanced circuit:</p>
<p>Components of the two parts of a balanced circuit must have the same orientation in each part! This is particaluarly important for components that have a branch current in their MNA stamp.</p>
</li>
<li><p>Notice the naming of components and nodes:</p>
<p>Paired nodes and components of the two parts of a balanced circuit have the same name plus an individual pair extension! This is particaluarly important for components that have a branch current in their MNA stamp.</p>
</li>
</ol>
</div>
<section id="matrix-equation-convtype-none">
<h4>Matrix equation convtype=None<a class="headerlink" href="#matrix-equation-convtype-none" title="Link to this heading"></a></h4>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{matrix}0\\0\\V_{b}\\V_{a}\\I_{s}\\0\\0\\0\\0\\0\\0\\0\end{matrix}\right]=\left[\begin{array}{cccccccccccc}- L_{a} s &amp; - L_{a} k_{c} s &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\- L_{a} k_{c} s &amp; - L_{a} s &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\0 &amp; 0 &amp; -1 &amp; -1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\-1 &amp; -1 &amp; 0 &amp; 0 &amp; 0 &amp; C_{a} s + \frac{1}{R_{c}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{1}{R_{b}} &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{1}{R_{b}} &amp; 0\\0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{1}{R_{b}} &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{1}{R_{b}}\\0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{1}{R_{a}} &amp; 0 &amp; - \frac{1}{R_{a}} &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{1}{R_{a}} &amp; 0 &amp; - \frac{1}{R_{a}}\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{1}{R_{b}} &amp; 0 &amp; - \frac{1}{R_{a}} &amp; 0 &amp; \frac{R_{a} + R_{b}}{R_{a} R_{b}} &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{1}{R_{b}} &amp; 0 &amp; - \frac{1}{R_{a}} &amp; 0 &amp; \frac{R_{a} + R_{b}}{R_{a} R_{b}}\end{array}\right]\cdot \left[\begin{matrix}I_{L1N}\\I_{L1P}\\I_{V1N}\\I_{V1P}\\V_{1}\\V_{2}\\V_{LN}\\V_{LP}\\V_{inN}\\V_{inP}\\V_{outN}\\V_{outP}\end{matrix}\right]\end{split}\]</div>
</section>
<section id="matrix-equation-convtype-all">
<h4>Matrix equation convtype=’all’<a class="headerlink" href="#matrix-equation-convtype-all" title="Link to this heading"></a></h4>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{matrix}0\\V_{a} - V_{b}\\0\\0\\0\\0\\0.5 V_{a} + 0.5 V_{b}\\0\\0\\0\\I_{s}\\0\end{matrix}\right]=\left[\begin{array}{cccccccccccc}2 L_{a} s \left(k_{c} - 1\right) &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\1 &amp; 0 &amp; \frac{0.5}{R_{b}} &amp; 0 &amp; - \frac{0.5}{R_{b}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 1 &amp; 0 &amp; \frac{0.5}{R_{a}} &amp; - \frac{0.5}{R_{a}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; - \frac{0.5}{R_{b}} &amp; - \frac{0.5}{R_{a}} &amp; \frac{0.5}{R_{b}} + \frac{0.5}{R_{a}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0.5 L_{a} s \left(- k_{c} - 1\right) &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; -1\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; -1 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; \frac{2}{R_{b}} &amp; 0 &amp; - \frac{2}{R_{b}} &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; \frac{2}{R_{a}} &amp; - \frac{2}{R_{a}} &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{2}{R_{b}} &amp; - \frac{2}{R_{a}} &amp; \frac{2}{R_{b}} + \frac{2}{R_{a}} &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; C_{a} s + \frac{1}{R_{c}}\end{array}\right]\cdot \left[\begin{matrix}I_{L1 D}\\I_{V1 D}\\V_{L D}\\V_{in D}\\V_{out D}\\I_{L1 C}\\I_{V1 C}\\V_{L C}\\V_{in C}\\V_{out C}\\V_{1}\\V_{2}\end{matrix}\right]\end{split}\]</div>
<div class="admonition-important admonition">
<p class="admonition-title">Important</p>
<p>After pairing, pair extensions in the vector with nodal voltages and branch currents have been replaced with <code class="docutils literal notranslate"><span class="pre">_D</span></code> and <code class="docutils literal notranslate"><span class="pre">_C</span></code> for differential-mode and common-mode, respectively.</p>
</div>
</section>
<section id="matrix-equation-convtype-dd">
<h4>Matrix equation convtype=’dd’<a class="headerlink" href="#matrix-equation-convtype-dd" title="Link to this heading"></a></h4>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{matrix}0\\V_{a} - V_{b}\\0\\0\\0\end{matrix}\right]=\left[\begin{matrix}2 L_{a} s \left(k_{c} - 1\right) &amp; 0 &amp; 1 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\\1 &amp; 0 &amp; \frac{0.5}{R_{b}} &amp; 0 &amp; - \frac{0.5}{R_{b}}\\0 &amp; 1 &amp; 0 &amp; \frac{0.5}{R_{a}} &amp; - \frac{0.5}{R_{a}}\\0 &amp; 0 &amp; - \frac{0.5}{R_{b}} &amp; - \frac{0.5}{R_{a}} &amp; \frac{0.5}{R_{b}} + \frac{0.5}{R_{a}}\end{matrix}\right]\cdot \left[\begin{matrix}I_{L1 D}\\I_{V1 D}\\V_{L D}\\V_{in D}\\V_{out D}\end{matrix}\right]\end{split}\]</div>
<p><code class="docutils literal notranslate"><span class="pre">convtype='dd'</span></code> gives the uppper-left matrix of the square matrix from <code class="docutils literal notranslate"><span class="pre">convtype='all'</span></code></p>
</section>
<section id="matrix-equation-convtype-dc">
<h4>Matrix equation convtype=’dc’<a class="headerlink" href="#matrix-equation-convtype-dc" title="Link to this heading"></a></h4>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{matrix}0\\V_{a} - V_{b}\\0\\0\\0\end{matrix}\right]=\left[\begin{matrix}0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\end{matrix}\right]\cdot \left[\begin{matrix}I_{L1 C}\\I_{V1 C}\\V_{L C}\\V_{in C}\\V_{out C}\\V_{1}\\V_{2}\end{matrix}\right]\end{split}\]</div>
<p><code class="docutils literal notranslate"><span class="pre">convtype='dc'</span></code> gives the uppper-right matrix of the square matrix from <code class="docutils literal notranslate"><span class="pre">convtype='all'</span></code></p>
</section>
<section id="matrix-equation-convtype-cd">
<h4>Matrix equation convtype=’cd’<a class="headerlink" href="#matrix-equation-convtype-cd" title="Link to this heading"></a></h4>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{matrix}0\\0.5 V_{a} + 0.5 V_{b}\\0\\0\\0\\I_{s}\\0\end{matrix}\right]=\left[\begin{matrix}0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\end{matrix}\right]\cdot \left[\begin{matrix}I_{L1 D}\\I_{V1 D}\\V_{L D}\\V_{in D}\\V_{out D}\end{matrix}\right]\end{split}\]</div>
<p><code class="docutils literal notranslate"><span class="pre">convtype='cd'</span></code> gives the lower-left matrix of the square matrix from <code class="docutils literal notranslate"><span class="pre">convtype='all'</span></code></p>
</section>
<section id="matrix-equation-convtype-cc">
<h4>Matrix equation convtype=’cc’<a class="headerlink" href="#matrix-equation-convtype-cc" title="Link to this heading"></a></h4>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{matrix}0\\0.5 V_{a} + 0.5 V_{b}\\0\\0\\0\\I_{s}\\0\end{matrix}\right]=\left[\begin{matrix}0.5 L_{a} s \left(- k_{c} - 1\right) &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; -1\\0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; -1 &amp; 0\\1 &amp; 0 &amp; \frac{2}{R_{b}} &amp; 0 &amp; - \frac{2}{R_{b}} &amp; 0 &amp; 0\\0 &amp; 1 &amp; 0 &amp; \frac{2}{R_{a}} &amp; - \frac{2}{R_{a}} &amp; 0 &amp; 0\\0 &amp; 0 &amp; - \frac{2}{R_{b}} &amp; - \frac{2}{R_{a}} &amp; \frac{2}{R_{b}} + \frac{2}{R_{a}} &amp; 0 &amp; 0\\0 &amp; -1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\-1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; C_{a} s + \frac{1}{R_{c}}\end{matrix}\right]\cdot \left[\begin{matrix}I_{L1 C}\\I_{V1 C}\\V_{L C}\\V_{in C}\\V_{out C}\\V_{1}\\V_{2}\end{matrix}\right]\end{split}\]</div>
<p><code class="docutils literal notranslate"><span class="pre">convtype='cc'</span></code> gives the lower-right matrix of the square matrix from <code class="docutils literal notranslate"><span class="pre">convtype='all'</span></code></p>
</section>
<section id="check-common-mode-and-differential-mode-orthogonality">
<h4>Check common-mode and differential-mode orthogonality<a class="headerlink" href="#check-common-mode-and-differential-mode-orthogonality" title="Link to this heading"></a></h4>
<p>A circuit is fully balanced if the the matrices obtained with <code class="docutils literal notranslate"><span class="pre">convtype='dc'</span></code> and <code class="docutils literal notranslate"><span class="pre">convtype='cd'</span></code> are zero:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">22</span><span class="k">if</span> <span class="n">cdM</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">is_zero_matrix</span> <span class="ow">and</span> <span class="n">dcM</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">is_zero_matrix</span><span class="p">:</span>
<span class="linenos">23</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The CM-DM decomposition is orthogonal!&quot;</span><span class="p">)</span>
<span class="linenos">24</span><span class="k">else</span><span class="p">:</span>
<span class="linenos">25</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: the CM-DM decomposition is NOT orthogonal!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This yields:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>The CM-DM decomposition is orthogonal!
</pre></div>
</div>
</section>
<section id="get-the-conversion-matrix">
<h4>Get the conversion matrix<a class="headerlink" href="#get-the-conversion-matrix" title="Link to this heading"></a></h4>
<p>The MNA equation (<code class="docutils literal notranslate"><span class="pre">convtype=None</span></code>) has the form:</p>
<div class="math notranslate nohighlight">
\[\mathbf{I_{n,b} = M \cdot D_{n,b}}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{I_{n,b}}\)</span> is the vector with independent nodal currents and branch voltages (independent sources), <span class="math notranslate nohighlight">\(\mathbf{M}\)</span> is the MNA matrix, and <span class="math notranslate nohighlight">\(\mathbf{D_{n,b}}\)</span> is the vector with unknown nodal voltages and branch currents.</p>
<p>The matrix equation for <code class="docutils literal notranslate"><span class="pre">convtype='all'</span></code> is:</p>
<div class="math notranslate nohighlight">
\[\mathbf{I_{d,c}} = \mathbf{M^{\prime} \cdot D_{d,c}}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{I_{d,c}}\)</span> is the vector with independent differential-mode and common-mode voltage and current sources, <span class="math notranslate nohighlight">\(\mathbf{D_{d,c}}\)</span> the vector with unknown differential-mode and common-mode voltages and currents, and math:<cite>mathbf{M^{prime}}</cite> the converted MNA matrix.</p>
<p>The converted matrices are obtained as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\mathbf{I_{d,c}}    &amp;=\mathbf{A^T}\cdot\mathbf{I_{n,b}}\\
\mathbf{M^{\prime}} &amp;=\mathbf{A^T \cdot M \cdot A}\\
\mathbf{D_{d,c}}    &amp;=\mathbf{A^{-1} \cdot D_{n,b}}
\end{align}\end{split}\]</div>
<p>Where <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> is the conversion matrix, constricted such that:</p>
<div class="math notranslate nohighlight">
\[\mathbf{D_{n,b} = A \cdot D_{d,c}}\]</div>
<p>For theory see: <a class="reference external" href="https://books.open.tudelft.nl/home/catalog/book/162">Structured Electronics Design</a>.</p>
<p>for this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">27</span><span class="c1"># Conversion matrix:</span>
<span class="linenos">28</span><span class="nb">print</span><span class="p">(</span><span class="n">allM</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<p>This yields:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Matrix([[-1, 0, 0, 0, 0, 0.500000000000000, 0, 0, 0, 0, 0, 0], [1, 0, 0, 0, 0, 0.500000000000000, 0, 0, 0, 0, 0, 0], [0, -1, 0, 0, 0, 0, 0.500000000000000, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 0, 0.500000000000000, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], [0, 0, -0.500000000000000, 0, 0, 0, 0, 1, 0, 0, 0, 0], [0, 0, 0.500000000000000, 0, 0, 0, 0, 1, 0, 0, 0, 0], [0, 0, 0, -0.500000000000000, 0, 0, 0, 0, 1, 0, 0, 0], [0, 0, 0, 0.500000000000000, 0, 0, 0, 0, 1, 0, 0, 0], [0, 0, 0, 0, -0.500000000000000, 0, 0, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0.500000000000000, 0, 0, 0, 0, 1, 0, 0]])
</pre></div>
</div>
<p>Typesetted:</p>
<div class="math notranslate nohighlight">
\[\begin{split}A = \left[\begin{array}{cccccccccccc}-1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; -1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1\\0 &amp; 0 &amp; -0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; -0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; -0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0.5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\end{array}\right]\end{split}\]</div>
</section>
</section>
<section id="balanced-circuit-with-models">
<h3>Balanced circuit with models<a class="headerlink" href="#balanced-circuit-with-models" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">30</span><span class="c1"># Use models</span>
<span class="linenos">31</span><span class="c1"># OpAmp circuit</span>
<span class="linenos">32</span><span class="n">Vamp</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">makeCircuit</span><span class="p">(</span><span class="s2">&quot;kicad/balancedAmp/balancedAmp.kicad_sch&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/balancedAmp.svg"><img alt="../_images/balancedAmp.svg" src="../_images/balancedAmp.svg" style="width: 550px;" />
</a>
<div class="note admonition">
<p class="admonition-title">Important</p>
<p>The scope of parameters defined in a (sub) circuit <code class="docutils literal notranslate"><span class="pre">.model</span></code> statement is the (sub) circuit in which they are defined.</p>
</div>
<p>n this example model parameters are defined in the main circuit. Hence, no extensions <code class="docutils literal notranslate"><span class="pre">P</span></code> or <code class="docutils literal notranslate"><span class="pre">N</span></code> wil be added to the parameter names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">34</span><span class="nb">print</span><span class="p">(</span><span class="n">Vamp</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s1">&#39;E_O1N&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="linenos">35</span><span class="nb">print</span><span class="p">(</span><span class="n">Vamp</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s1">&#39;E_O1P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&#39;value&#39;: A_0/(1 + s/(2*pi*f_p1)), &#39;zo&#39;: 1000}
{&#39;value&#39;: A_0/(1 + s/(2*pi*f_p1)), &#39;zo&#39;: 1000}
</pre></div>
</div>
<p>The matrix equation with <code class="docutils literal notranslate"><span class="pre">convtype='all'</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">35</span><span class="c1"># Matrix equation</span>
<span class="linenos">36</span><span class="n">VampAll</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doMatrix</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{matrix}0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\end{matrix}\right]=\left[\begin{array}{cccccccccccc}0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; - 6.366 \cdot 10^{17} s - 2.0 \cdot 10^{20} &amp; 1.0 \cdot 10^{17} A_{0} &amp; - 1.0 \cdot 10^{17} A_{0} &amp; 3.183 \cdot 10^{14} s + 1.0 \cdot 10^{17} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 3.0 \cdot 10^{-12} s + 0.01 &amp; - 2.5 \cdot 10^{-12} s &amp; -5.0 \cdot 10^{-6} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; - 2.5 \cdot 10^{-12} s &amp; 3.0 \cdot 10^{-12} s + 0.0005 &amp; 0 &amp; -0.0005 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 1 &amp; -5.0 \cdot 10^{-6} &amp; 0 &amp; 0.005005 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\1 &amp; 0 &amp; 0 &amp; -0.0005 &amp; 0 &amp; 0.0005 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; - 1.592 \cdot 10^{17} s - 5.0 \cdot 10^{19} &amp; 1.0 \cdot 10^{17} A_{0} &amp; - 1.0 \cdot 10^{17} A_{0} &amp; 3.183 \cdot 10^{14} s + 1.0 \cdot 10^{17} &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1.2 \cdot 10^{-11} s + 2.0 \cdot 10^{-5} &amp; - 1.0 \cdot 10^{-11} s &amp; -2.0 \cdot 10^{-5} &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; - 1.0 \cdot 10^{-11} s &amp; 1.2 \cdot 10^{-11} s + 0.002 &amp; 0 &amp; -0.002\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; -2.0 \cdot 10^{-5} &amp; 0 &amp; 2.0 \cdot 10^{-5} &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; -0.002 &amp; 0 &amp; 0.002\end{array}\right]\cdot \left[\begin{matrix}I_{V1 D}\\I_{E O1 D}\\V_{fb D}\\V_{in D}\\V_{out D}\\V_{src D}\\I_{V1 C}\\I_{E O1 C}\\V_{fb C}\\V_{in C}\\V_{out C}\\V_{src C}\end{matrix}\right]\end{split}\]</div>
</section>
<section id="balanced-circuit-with-sub-circuits">
<h3>Balanced circuit with sub circuits<a class="headerlink" href="#balanced-circuit-with-sub-circuits" title="Link to this heading"></a></h3>
<p>Below a balanced circuit built-up from two equal sub circuits.</p>
<a class="reference internal image-reference" href="../_images/BJTdiffAmp.svg"><img alt="../_images/BJTdiffAmp.svg" src="../_images/BJTdiffAmp.svg" style="width: 400px;" />
</a>
<p>The figure below shows the sub circuit diagram.</p>
<a class="reference internal image-reference" href="../_images/myBJTamp.svg"><img alt="../_images/myBJTamp.svg" src="../_images/myBJTamp.svg" style="width: 450px;" />
</a>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">38</span><span class="c1"># Use sub circuits</span>
<span class="linenos">39</span><span class="n">subckt</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">makeCircuit</span><span class="p">(</span><span class="s2">&quot;kicad/myBJTamp/myBJTamp.kicad_sch&quot;</span><span class="p">)</span>
<span class="linenos">40</span><span class="n">BJTdiffAmp</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">makeCircuit</span><span class="p">(</span><span class="s2">&quot;kicad/BJTdiffAmp/BJTdiffAmp.kicad_sch&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The scope of the model parameters is now limited to the sub circuit.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">42</span><span class="c1"># Disable parameter pairing</span>
<span class="linenos">43</span><span class="n">sl</span><span class="o">.</span><span class="n">ini</span><span class="o">.</span><span class="n">remove_param_pair_ext</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">44</span><span class="n">BJTampAllF</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doMatrix</span><span class="p">(</span><span class="n">BJTdiffAmp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Typesetted result:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{matrix}0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\end{matrix}\right]=\left[\begin{array}{cccccccccccccc}0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; -1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; -1 &amp; \frac{0.25 g_{m X1P}}{\beta_{AC X1P}} + \frac{0.25 g_{m X1N}}{\beta_{AC X1N}} &amp; - \frac{0.25 g_{m X1P}}{\beta_{AC X1P}} - \frac{0.25 g_{m X1N}}{\beta_{AC X1N}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{0.5 g_{m X1P}}{\beta_{AC X1P}} - \frac{0.5 g_{m X1N}}{\beta_{AC X1N}} &amp; - \frac{0.5 g_{m X1P}}{\beta_{AC X1P}} + \frac{0.5 g_{m X1N}}{\beta_{AC X1N}} &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; - 0.25 g_{m X1N} - 0.25 g_{m X1P} - \frac{0.25 g_{m X1P}}{\beta_{AC X1P}} - \frac{0.25 g_{m X1N}}{\beta_{AC X1N}} &amp; 0.25 g_{m X1N} + 0.25 g_{m X1P} + 0.25 g_{o X1N} + 0.25 g_{o X1P} + \frac{0.25 g_{m X1P}}{\beta_{AC X1P}} + \frac{0.25 g_{m X1N}}{\beta_{AC X1N}} + \frac{1}{R_{a}} &amp; 0 &amp; - 0.25 g_{o X1N} - 0.25 g_{o X1P} &amp; 0 &amp; 0 &amp; 0 &amp; 0.5 g_{m X1N} - 0.5 g_{m X1P} - \frac{0.5 g_{m X1P}}{\beta_{AC X1P}} + \frac{0.5 g_{m X1N}}{\beta_{AC X1N}} &amp; - 0.5 g_{m X1N} + 0.5 g_{m X1P} - 0.5 g_{o X1N} + 0.5 g_{o X1P} + \frac{0.5 g_{m X1P}}{\beta_{AC X1P}} - \frac{0.5 g_{m X1N}}{\beta_{AC X1N}} &amp; 0 &amp; 0.5 g_{o X1N} - 0.5 g_{o X1P} &amp; 0\\0 &amp; 1 &amp; 0 &amp; 0 &amp; \frac{0.5}{R_{s}} + \frac{0.25}{R_{f X1P}} + \frac{0.25}{R_{f X1N}} &amp; - \frac{0.25}{R_{f X1P}} - \frac{0.25}{R_{f X1N}} &amp; - \frac{0.5}{R_{s}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{0.5}{R_{f X1P}} - \frac{0.5}{R_{f X1N}} &amp; - \frac{0.5}{R_{f X1P}} + \frac{0.5}{R_{f X1N}} &amp; 0\\0 &amp; 0 &amp; 0.25 g_{m X1N} + 0.25 g_{m X1P} &amp; - 0.25 g_{m X1N} - 0.25 g_{m X1P} - 0.25 g_{o X1N} - 0.25 g_{o X1P} &amp; - \frac{0.25}{R_{f X1P}} - \frac{0.25}{R_{f X1N}} &amp; 0.25 g_{o X1N} + 0.25 g_{o X1P} + \frac{0.25}{R_{f X1P}} + \frac{0.25}{R_{f X1N}} &amp; 0 &amp; 0 &amp; 0 &amp; - 0.5 g_{m X1N} + 0.5 g_{m X1P} &amp; 0.5 g_{m X1N} - 0.5 g_{m X1P} + 0.5 g_{o X1N} - 0.5 g_{o X1P} &amp; - \frac{0.5}{R_{f X1P}} + \frac{0.5}{R_{f X1N}} &amp; - 0.5 g_{o X1N} + 0.5 g_{o X1P} + \frac{0.5}{R_{f X1P}} - \frac{0.5}{R_{f X1N}} &amp; 0\\1 &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{0.5}{R_{s}} &amp; 0 &amp; \frac{0.5}{R_{s}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\0 &amp; 0 &amp; \frac{0.5 g_{m X1P}}{\beta_{AC X1P}} - \frac{0.5 g_{m X1N}}{\beta_{AC X1N}} &amp; - \frac{0.5 g_{m X1P}}{\beta_{AC X1P}} + \frac{0.5 g_{m X1N}}{\beta_{AC X1N}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; \frac{g_{m X1P}}{\beta_{AC X1P}} + \frac{g_{m X1N}}{\beta_{AC X1N}} &amp; - \frac{g_{m X1P}}{\beta_{AC X1P}} - \frac{g_{m X1N}}{\beta_{AC X1N}} &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0.5 g_{m X1N} - 0.5 g_{m X1P} - \frac{0.5 g_{m X1P}}{\beta_{AC X1P}} + \frac{0.5 g_{m X1N}}{\beta_{AC X1N}} &amp; - 0.5 g_{m X1N} + 0.5 g_{m X1P} - 0.5 g_{o X1N} + 0.5 g_{o X1P} + \frac{0.5 g_{m X1P}}{\beta_{AC X1P}} - \frac{0.5 g_{m X1N}}{\beta_{AC X1N}} &amp; 0 &amp; 0.5 g_{o X1N} - 0.5 g_{o X1P} &amp; 0 &amp; 0 &amp; 0 &amp; - g_{m X1N} - g_{m X1P} - \frac{g_{m X1P}}{\beta_{AC X1P}} - \frac{g_{m X1N}}{\beta_{AC X1N}} &amp; g_{m X1N} + g_{m X1P} + g_{o X1N} + g_{o X1P} + \frac{g_{m X1P}}{\beta_{AC X1P}} + \frac{g_{m X1N}}{\beta_{AC X1N}} &amp; 0 &amp; - g_{o X1N} - g_{o X1P} &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{0.5}{R_{f X1P}} - \frac{0.5}{R_{f X1N}} &amp; - \frac{0.5}{R_{f X1P}} + \frac{0.5}{R_{f X1N}} &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; \frac{2}{R_{s}} + \frac{1}{R_{f X1P}} + \frac{1}{R_{f X1N}} &amp; - \frac{1}{R_{f X1P}} - \frac{1}{R_{f X1N}} &amp; - \frac{2}{R_{s}}\\0 &amp; 0 &amp; - 0.5 g_{m X1N} + 0.5 g_{m X1P} &amp; 0.5 g_{m X1N} - 0.5 g_{m X1P} + 0.5 g_{o X1N} - 0.5 g_{o X1P} &amp; - \frac{0.5}{R_{f X1P}} + \frac{0.5}{R_{f X1N}} &amp; - 0.5 g_{o X1N} + 0.5 g_{o X1P} + \frac{0.5}{R_{f X1P}} - \frac{0.5}{R_{f X1N}} &amp; 0 &amp; 0 &amp; 0 &amp; g_{m X1N} + g_{m X1P} &amp; - g_{m X1N} - g_{m X1P} - g_{o X1N} - g_{o X1P} &amp; - \frac{1}{R_{f X1P}} - \frac{1}{R_{f X1N}} &amp; g_{o X1N} + g_{o X1P} + \frac{1}{R_{f X1P}} + \frac{1}{R_{f X1N}} &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{2}{R_{s}} &amp; 0 &amp; \frac{2}{R_{s}}\end{array}\right]\cdot \left[\begin{matrix}I_{V1 D}\\I_{Rb Q1 X1 D}\\V_{1 Q1 X1 D}\\V_{fb D}\\V_{in D}\\V_{out D}\\V_{src D}\\I_{V1 C}\\I_{Rb Q1 X1 C}\\V_{1 Q1 X1 C}\\V_{fb C}\\V_{in C}\\V_{out C}\\V_{src C}\end{matrix}\right]\end{split}\]</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">45</span><span class="c1"># The circuit parameters are not altered</span>
<span class="linenos">46</span><span class="nb">print</span><span class="p">(</span><span class="n">BJTdiffAmp</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="linenos">47</span><span class="nb">print</span><span class="p">(</span><span class="n">BJTdiffAmp</span><span class="o">.</span><span class="n">parDefs</span><span class="p">)</span>
<span class="linenos">48</span><span class="c1"># The instruction parameters are not altered</span>
<span class="linenos">49</span><span class="nb">print</span><span class="p">(</span><span class="n">BJTampAllF</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="linenos">50</span><span class="nb">print</span><span class="p">(</span><span class="n">BJTampAllF</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">parDefs</span><span class="p">)</span>
</pre></div>
</div>
<p>This yields:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[g_o_X1P, R_f_X1N, g_o_X1N, R_f_X1P, R_s, g_m_X1N, R_a, beta_AC_X1N, beta_AC_X1P, g_m_X1P]
{}
[g_o_X1P, R_f_X1N, g_o_X1N, R_f_X1P, R_s, g_m_X1N, R_a, beta_AC_X1N, beta_AC_X1P, g_m_X1P]
{}
</pre></div>
</div>
<p>The default value of <code class="docutils literal notranslate"><span class="pre">ini.remove_param_pair_ext</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">51</span><span class="c1"># Enable parameter pairing (default setting)</span>
<span class="linenos">52</span><span class="n">sl</span><span class="o">.</span><span class="n">ini</span><span class="o">.</span><span class="n">remove_param_pair_ext</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">53</span><span class="n">BJTampAllT</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doMatrix</span><span class="p">(</span><span class="n">BJTdiffAmp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="linenos">54</span><span class="c1"># The circuit parameters are not altered</span>
<span class="linenos">55</span><span class="nb">print</span><span class="p">(</span><span class="n">BJTdiffAmp</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="linenos">56</span><span class="nb">print</span><span class="p">(</span><span class="n">BJTdiffAmp</span><span class="o">.</span><span class="n">parDefs</span><span class="p">)</span>
<span class="linenos">57</span><span class="c1"># The instruction parameters are altered</span>
<span class="linenos">58</span><span class="nb">print</span><span class="p">(</span><span class="n">BJTampAllT</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="linenos">59</span><span class="nb">print</span><span class="p">(</span><span class="n">BJTampAllT</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">parDefs</span><span class="p">)</span>
</pre></div>
</div>
<p>This yields:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[g_o_X1P, R_f_X1N, g_o_X1N, R_f_X1P, R_s, g_m_X1N, R_a, beta_AC_X1N, beta_AC_X1P, g_m_X1P]
{}
[g_m_X1, R_s, R_a, g_o_X1, R_f_X1, beta_AC_X1]
{}
</pre></div>
</div>
<p>Typesetted result:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{matrix}0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\end{matrix}\right]=\left[\begin{array}{cccccccccccccc}0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; -1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; -1 &amp; \frac{0.5 g_{m X1}}{\beta_{AC X1}} &amp; - \frac{0.5 g_{m X1}}{\beta_{AC X1}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; - 0.5 g_{m X1} - \frac{0.5 g_{m X1}}{\beta_{AC X1}} &amp; 0.5 g_{m X1} + 0.5 g_{o X1} + \frac{0.5 g_{m X1}}{\beta_{AC X1}} + \frac{1}{R_{a}} &amp; 0 &amp; - 0.5 g_{o X1} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 1 &amp; 0 &amp; 0 &amp; \frac{0.5}{R_{s}} + \frac{0.5}{R_{f X1}} &amp; - \frac{0.5}{R_{f X1}} &amp; - \frac{0.5}{R_{s}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0.5 g_{m X1} &amp; - 0.5 g_{m X1} - 0.5 g_{o X1} &amp; - \frac{0.5}{R_{f X1}} &amp; 0.5 g_{o X1} + \frac{0.5}{R_{f X1}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\1 &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{0.5}{R_{s}} &amp; 0 &amp; \frac{0.5}{R_{s}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; \frac{2 g_{m X1}}{\beta_{AC X1}} &amp; - \frac{2 g_{m X1}}{\beta_{AC X1}} &amp; 0 &amp; 0 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; - 2 g_{m X1} - \frac{2 g_{m X1}}{\beta_{AC X1}} &amp; 2 g_{m X1} + 2 g_{o X1} + \frac{2 g_{m X1}}{\beta_{AC X1}} &amp; 0 &amp; - 2 g_{o X1} &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; \frac{2}{R_{s}} + \frac{2}{R_{f X1}} &amp; - \frac{2}{R_{f X1}} &amp; - \frac{2}{R_{s}}\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 2 g_{m X1} &amp; - 2 g_{m X1} - 2 g_{o X1} &amp; - \frac{2}{R_{f X1}} &amp; 2 g_{o X1} + \frac{2}{R_{f X1}} &amp; 0\\0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{2}{R_{s}} &amp; 0 &amp; \frac{2}{R_{s}}\end{array}\right]\cdot \left[\begin{matrix}I_{V1 D}\\I_{Rb Q1 X1 D}\\V_{1 Q1 X1 D}\\V_{fb D}\\V_{in D}\\V_{out D}\\V_{src D}\\I_{V1 C}\\I_{Rb Q1 X1 C}\\V_{1 Q1 X1 C}\\V_{fb C}\\V_{in C}\\V_{out C}\\V_{src C}\end{matrix}\right]\end{split}\]</div>
</section>
<section id="auto-rename-detector">
<h3>Auto-rename detector<a class="headerlink" href="#auto-rename-detector" title="Link to this heading"></a></h3>
<p>With the conversion type set to <code class="docutils literal notranslate"><span class="pre">dd</span></code>, <code class="docutils literal notranslate"><span class="pre">dc</span></code>, <code class="docutils literal notranslate"><span class="pre">cd</span></code>, or <code class="docutils literal notranslate"><span class="pre">cc</span></code>, SLiCAP automatically redefines the differential voltage or current detector as the corresponding differential-mode or common-mode detector.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">61</span><span class="c1"># Adapt detector</span>
<span class="linenos">62</span><span class="n">BJTampDD</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">BJTdiffAmp</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;V1P&quot;</span><span class="p">,</span> <span class="s2">&quot;V1N&quot;</span><span class="p">],</span> <span class="n">detector</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;V_outP&quot;</span><span class="p">,</span> <span class="s2">&quot;V_outN&quot;</span><span class="p">],</span> <span class="n">convtype</span><span class="o">=</span><span class="s1">&#39;dd&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">laplace</span>
<span class="linenos">63</span><span class="n">numer</span><span class="p">,</span> <span class="n">denom</span> <span class="o">=</span> <span class="n">BJTampDD</span><span class="o">.</span><span class="n">as_numer_denom</span><span class="p">()</span>
<span class="linenos">64</span><span class="n">BJTampDD</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">numer</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">denom</span><span class="p">)</span>
</pre></div>
</div>
<p>This prints:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Detector changed to: V_out_D
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[A_{vdd} = \frac{8 R_{a} R_{f X1} g_{m X1} g_{o X1} + 8 R_{a} \beta_{AC X1} g_{m X1} + 8 R_{a} \beta_{AC X1} g_{o X1} + 8 R_{a} g_{m X1} - 16 R_{f X1} \beta_{AC X1} g_{m X1} + 16 \beta_{AC X1}}{8 R_{a} R_{f X1} g_{m X1} g_{o X1} + 8 R_{a} \beta_{AC X1} g_{m X1} + 8 R_{a} \beta_{AC X1} g_{o X1} + 8 R_{a} g_{m X1} + 16 R_{f X1} R_{s} g_{m X1} g_{o X1} + 16 R_{f X1} \beta_{AC X1} g_{o X1} + 16 R_{s} \beta_{AC X1} g_{m X1} + 16 R_{s} \beta_{AC X1} g_{o X1} + 16 R_{s} g_{m X1} + 16 \beta_{AC X1}}\]</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">65</span><span class="n">BJTampCC</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">BJTdiffAmp</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;V1P&quot;</span><span class="p">,</span> <span class="s2">&quot;V1N&quot;</span><span class="p">],</span> <span class="n">detector</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;V_outP&quot;</span><span class="p">,</span> <span class="s2">&quot;V_outN&quot;</span><span class="p">],</span> <span class="n">convtype</span><span class="o">=</span><span class="s1">&#39;cc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">laplace</span>
</pre></div>
</div>
<p>This prints:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Detector changed to: V_out_C
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[A_{vcc} = 1\]</div>
</section>
</section>
<section id="balanced-feedback">
<h2>Balanced feedback<a class="headerlink" href="#balanced-feedback" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../_images/balancedAmp.svg"><img alt="../_images/balancedAmp.svg" src="../_images/balancedAmp.svg" style="width: 550px;" />
</a>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">67</span><span class="c1"># Balanced Feedback</span>
<span class="linenos">68</span><span class="c1"># Define parameters</span>
<span class="linenos">69</span><span class="n">par_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A_0&quot;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span> <span class="s2">&quot;f_p1&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
<span class="linenos">70</span><span class="n">Vamp</span><span class="o">.</span><span class="n">defPars</span><span class="p">(</span><span class="n">par_dict</span><span class="p">)</span>
</pre></div>
</div>
<section id="differential-amplifier">
<h3>Differential amplifier<a class="headerlink" href="#differential-amplifier" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">72</span><span class="c1"># Poles and zeros</span>
<span class="linenos">73</span><span class="n">poles</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doPoles</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">74</span><span class="n">zeros</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doZeros</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">75</span><span class="n">pz</span>    <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doPZ</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The table below shows all the poles of the circuit.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>#</p></th>
<th class="head"><p>Re [Hz]</p></th>
<th class="head"><p>Im [Hz]</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(f\)</span> [Hz]</p></th>
<th class="head"><p>Q</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-4640.0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(4640.0\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-6.334 \cdot 10^{4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(40.28\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-6.334 \cdot 10^{4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(40.28\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-2.562 \cdot 10^{7}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.562 \cdot 10^{7}\)</span></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-8.754 \cdot 10^{7}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(8.754 \cdot 10^{7}\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.798 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.798 \cdot 10^{9}\)</span></p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The table below shows all the zeros of the differential voltage transfer.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>#</p></th>
<th class="head"><p>Re [Hz]</p></th>
<th class="head"><p>Im [Hz]</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(f\)</span> [Hz]</p></th>
<th class="head"><p>Q</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-6.334 \cdot 10^{4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(40.28\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-6.334 \cdot 10^{4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(40.28\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-8.754 \cdot 10^{7}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(8.754 \cdot 10^{7}\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.0 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.317 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.524 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.262\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.0 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-2.317 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.524 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.262\)</span></p></td>
</tr>
</tbody>
</table>
<p>The table below shows all the observable and controllable poles and zeros of the differential voltage transfer.</p>
<p>DC value of gain: <span class="math notranslate nohighlight">\(1958.0\)</span></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>#</p></th>
<th class="head"><p>Re [Hz]</p></th>
<th class="head"><p>Im [Hz]</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(f\)</span> [Hz]</p></th>
<th class="head"><p>Q</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-4640.0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(4640.0\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-2.562 \cdot 10^{7}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.562 \cdot 10^{7}\)</span></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.798 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.798 \cdot 10^{9}\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.0 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.317 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.524 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.262\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.0 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-2.317 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.524 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.262\)</span></p></td>
</tr>
</tbody>
</table>
</section>
<section id="differential-mode-circuit">
<h3>Differential-mode circuit<a class="headerlink" href="#differential-mode-circuit" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">77</span><span class="c1"># Differential-mode poles and zeros</span>
<span class="linenos">78</span><span class="n">pzdd</span>  <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doPZ</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The observable and controllable poles and zeros of the voltage transfer of the differential-mode equivalent circuit:</p>
<p>DC value of gain: <span class="math notranslate nohighlight">\(1958.0\)</span></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>#</p></th>
<th class="head"><p>Re [Hz]</p></th>
<th class="head"><p>Im [Hz]</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(f\)</span> [Hz]</p></th>
<th class="head"><p>Q</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-4640.0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(4640.0\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-2.562 \cdot 10^{7}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.562 \cdot 10^{7}\)</span></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.798 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.798 \cdot 10^{9}\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.0 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.317 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.524 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.262\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.0 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-2.317 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.524 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.262\)</span></p></td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">80</span><span class="c1"># Differential-mode aysmptotic-gain model Bode plots</span>
<span class="linenos">81</span><span class="n">Add</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dd&quot;</span><span class="p">,</span> 
<span class="linenos">82</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;asymptotic&quot;</span><span class="p">)</span>
<span class="linenos">83</span><span class="n">Ldd</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dd&quot;</span><span class="p">,</span> 
<span class="linenos">84</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;loopgain&quot;</span><span class="p">)</span>
<span class="linenos">85</span><span class="n">Sdd</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dd&quot;</span><span class="p">,</span> 
<span class="linenos">86</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;servo&quot;</span><span class="p">)</span>
<span class="linenos">87</span><span class="n">Ddd</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dd&quot;</span><span class="p">,</span> 
<span class="linenos">88</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;direct&quot;</span><span class="p">)</span>
<span class="linenos">89</span><span class="n">Gdd</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dd&quot;</span><span class="p">,</span> 
<span class="linenos">90</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;gain&quot;</span><span class="p">)</span>
<span class="linenos">91</span><span class="c1"># dB magnitude plots</span>
<span class="linenos">92</span><span class="n">sl</span><span class="o">.</span><span class="n">plotSweep</span><span class="p">(</span><span class="s2">&quot;Vamp_dd_fb_dB&quot;</span><span class="p">,</span> <span class="s2">&quot;Balanced voltage amplifier, differential-mode&quot;</span><span class="p">,</span> 
<span class="linenos">93</span>             <span class="p">[</span><span class="n">Add</span><span class="p">,</span> <span class="n">Ldd</span><span class="p">,</span> <span class="n">Sdd</span><span class="p">,</span> <span class="n">Ddd</span><span class="p">,</span> <span class="n">Gdd</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">sweepScale</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> 
<span class="linenos">94</span>             <span class="n">funcType</span><span class="o">=</span><span class="s2">&quot;dBmag&quot;</span><span class="p">)</span>
<span class="linenos">95</span><span class="c1"># Phase plots</span>
<span class="linenos">96</span><span class="n">sl</span><span class="o">.</span><span class="n">plotSweep</span><span class="p">(</span><span class="s2">&quot;Vamp_dd_fb_phs&quot;</span><span class="p">,</span> <span class="s2">&quot;Balanced voltage amplifier, differential-mode&quot;</span><span class="p">,</span> 
<span class="linenos">97</span>             <span class="p">[</span><span class="n">Add</span><span class="p">,</span> <span class="n">Ldd</span><span class="p">,</span> <span class="n">Sdd</span><span class="p">,</span> <span class="n">Ddd</span><span class="p">,</span> <span class="n">Gdd</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">sweepScale</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> 
<span class="linenos">98</span>             <span class="n">funcType</span><span class="o">=</span><span class="s2">&quot;phase&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Bode plots of the feedback transfers of the differential-mode equivalent circuit.</p>
<a class="reference internal image-reference" href="../_images/Vamp_dd_fb_dB.svg"><img alt="../_images/Vamp_dd_fb_dB.svg" src="../_images/Vamp_dd_fb_dB.svg" style="width: 500px;" />
</a>
<a class="reference internal image-reference" href="../_images/Vamp_dd_fb_phs.svg"><img alt="../_images/Vamp_dd_fb_phs.svg" src="../_images/Vamp_dd_fb_phs.svg" style="width: 500px;" />
</a>
</section>
<section id="common-mode-circuit">
<h3>Common-mode circuit<a class="headerlink" href="#common-mode-circuit" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">100</span><span class="c1"># Common-mode poles and zeros</span>
<span class="linenos">101</span><span class="n">pzcc</span>  <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doPZ</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The observable and controllable poles and zeros of the voltage transfer of the common-mode equivalent circuit:</p>
<p>DC value of gain: <span class="math notranslate nohighlight">\(1\)</span></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>#</p></th>
<th class="head"><p>Re [Hz]</p></th>
<th class="head"><p>Im [Hz]</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(f\)</span> [Hz]</p></th>
<th class="head"><p>Q</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-6.334 \cdot 10^{4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(40.28\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-6.334 \cdot 10^{4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5.103 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(40.28\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-8.754 \cdot 10^{7}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(8.754 \cdot 10^{7}\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.593 \cdot 10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.593 \cdot 10^{6}\)</span></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(z_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-1.998 \cdot 10^{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.998 \cdot 10^{9}\)</span></p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">103</span><span class="c1"># Common-mode aysmptotic-gain model Bode plots</span>
<span class="linenos">104</span><span class="n">Acc</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> 
<span class="linenos">105</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;asymptotic&quot;</span><span class="p">)</span>
<span class="linenos">106</span><span class="n">Lcc</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> 
<span class="linenos">107</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;loopgain&quot;</span><span class="p">)</span>
<span class="linenos">108</span><span class="n">Scc</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> 
<span class="linenos">109</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;servo&quot;</span><span class="p">)</span>
<span class="linenos">110</span><span class="n">Dcc</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> 
<span class="linenos">111</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;direct&quot;</span><span class="p">)</span>
<span class="linenos">112</span><span class="n">Gcc</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doLaplace</span><span class="p">(</span><span class="n">Vamp</span><span class="p">,</span> <span class="n">pardefs</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> 
<span class="linenos">113</span>                   <span class="n">transfer</span><span class="o">=</span><span class="s2">&quot;gain&quot;</span><span class="p">)</span>
<span class="linenos">114</span><span class="c1"># dB magnitude plots</span>
<span class="linenos">115</span><span class="n">sl</span><span class="o">.</span><span class="n">plotSweep</span><span class="p">(</span><span class="s2">&quot;Vamp_cc_fb_dB&quot;</span><span class="p">,</span> <span class="s2">&quot;Balanced voltage amplifier, common-mode&quot;</span><span class="p">,</span> 
<span class="linenos">116</span>             <span class="p">[</span><span class="n">Acc</span><span class="p">,</span> <span class="n">Lcc</span><span class="p">,</span> <span class="n">Scc</span><span class="p">,</span> <span class="n">Dcc</span><span class="p">,</span> <span class="n">Gcc</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">sweepScale</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> 
<span class="linenos">117</span>             <span class="n">funcType</span><span class="o">=</span><span class="s2">&quot;dBmag&quot;</span><span class="p">)</span>
<span class="linenos">118</span><span class="c1"># Phase plots</span>
<span class="linenos">119</span><span class="n">sl</span><span class="o">.</span><span class="n">plotSweep</span><span class="p">(</span><span class="s2">&quot;Vamp_cc_fb_phs&quot;</span><span class="p">,</span> <span class="s2">&quot;Balanced voltage amplifier, common-mode&quot;</span><span class="p">,</span> 
<span class="linenos">120</span>             <span class="p">[</span><span class="n">Acc</span><span class="p">,</span> <span class="n">Lcc</span><span class="p">,</span> <span class="n">Scc</span><span class="p">,</span> <span class="n">Dcc</span><span class="p">,</span> <span class="n">Gcc</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">sweepScale</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> 
<span class="linenos">121</span>             <span class="n">funcType</span><span class="o">=</span><span class="s2">&quot;phase&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Bode plots of the feedback transfers of the common-mode equivalent circuit.</p>
<a class="reference internal image-reference" href="../_images/Vamp_cc_fb_dB.svg"><img alt="../_images/Vamp_cc_fb_dB.svg" src="../_images/Vamp_cc_fb_dB.svg" style="width: 500px;" />
</a>
<a class="reference internal image-reference" href="../_images/Vamp_cc_fb_phs.svg"><img alt="../_images/Vamp_cc_fb_phs.svg" src="../_images/Vamp_cc_fb_phs.svg" style="width: 500px;" />
</a>
</section>
</section>
<section id="balanced-noise">
<h2>Balanced noise<a class="headerlink" href="#balanced-noise" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../_images/balancedNoisyNetwork.svg"><img alt="../_images/balancedNoisyNetwork.svg" src="../_images/balancedNoisyNetwork.svg" style="width: 600px;" />
</a>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">123</span><span class="c1"># Balanced noise</span>
<span class="linenos">124</span><span class="n">noisyCircuit</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">makeCircuit</span><span class="p">(</span><span class="s2">&quot;kicad/balancedNoisyNetwork/balancedNoisyNetwork.kicad_sch&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="differential-output-noise">
<h3>Differential output noise<a class="headerlink" href="#differential-output-noise" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">126</span><span class="c1"># Differential-mode output noise (complete circuit)</span>
<span class="linenos">127</span><span class="n">noiseResultD</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doNoise</span><span class="p">(</span><span class="n">noisyCircuit</span><span class="p">)</span>
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
S_{vD} = &amp; \frac{8 R_{a}^{2} R_{b} T k}{16 \pi^{2} C_{a}^{2} R_{a}^{2} R_{b}^{2} f^{2} + R_{a}^{2} + 2 R_{a} R_{b} + R_{b}^{2}} \nonumber \\
&amp; + \frac{8 R_{a} R_{b}^{2} T k}{16 \pi^{2} C_{a}^{2} R_{a}^{2} R_{b}^{2} f^{2} + R_{a}^{2} + 2 R_{a} R_{b} + R_{b}^{2}} \nonumber \\
&amp; + \frac{R_{b}^{2} S_{va}}{16 \pi^{2} C_{a}^{2} R_{a}^{2} R_{b}^{2} f^{2} + R_{a}^{2} + 2 R_{a} R_{b} + R_{b}^{2}} \nonumber \\
&amp; + \frac{R_{b}^{2} S_{vb}}{16 \pi^{2} C_{a}^{2} R_{a}^{2} R_{b}^{2} f^{2} + R_{a}^{2} + 2 R_{a} R_{b} + R_{b}^{2}}
\,\left[\mathrm{\frac{V^2}{Hz}}\right]
\end{align}\end{split}\]</div>
</section>
<section id="common-mode-ouput-noise">
<h3>Common-mode ouput noise<a class="headerlink" href="#common-mode-ouput-noise" title="Link to this heading"></a></h3>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
S_{vC} = &amp; \frac{2 \pi^{2} C_{b}^{2} R_{a} T f^{2} k \left(R_{b} + 2 R_{c}\right)^{2}}{\pi^{2} C_{b}^{2} R_{a}^{2} f^{2} + 2 \pi^{2} C_{b}^{2} R_{a} R_{b} f^{2} + 4 \pi^{2} C_{b}^{2} R_{a} R_{c} f^{2} + \pi^{2} C_{b}^{2} R_{b}^{2} f^{2} + 4 \pi^{2} C_{b}^{2} R_{b} R_{c} f^{2} + 4 \pi^{2} C_{b}^{2} R_{c}^{2} f^{2} + 1} \nonumber \\
&amp; + \frac{0.25 \pi^{2} C_{b}^{2} S_{va} f^{2} \left(R_{b} + 2 R_{c}\right)^{2}}{\pi^{2} C_{b}^{2} R_{a}^{2} f^{2} + 2 \pi^{2} C_{b}^{2} R_{a} R_{b} f^{2} + 4 \pi^{2} C_{b}^{2} R_{a} R_{c} f^{2} + \pi^{2} C_{b}^{2} R_{b}^{2} f^{2} + 4 \pi^{2} C_{b}^{2} R_{b} R_{c} f^{2} + 4 \pi^{2} C_{b}^{2} R_{c}^{2} f^{2} + 1} \nonumber \\
&amp; + \frac{0.25 \pi^{2} C_{b}^{2} S_{vb} f^{2} \left(R_{b} + 2 R_{c}\right)^{2}}{\pi^{2} C_{b}^{2} R_{a}^{2} f^{2} + 2 \pi^{2} C_{b}^{2} R_{a} R_{b} f^{2} + 4 \pi^{2} C_{b}^{2} R_{a} R_{c} f^{2} + \pi^{2} C_{b}^{2} R_{b}^{2} f^{2} + 4 \pi^{2} C_{b}^{2} R_{b} R_{c} f^{2} + 4 \pi^{2} C_{b}^{2} R_{c}^{2} f^{2} + 1} \nonumber \\
&amp; + \frac{2 R_{b} T k \left(\pi^{2} C_{b}^{2} R_{a}^{2} f^{2} + 1\right)}{\pi^{2} C_{b}^{2} R_{a}^{2} f^{2} + 2 \pi^{2} C_{b}^{2} R_{a} R_{b} f^{2} + 4 \pi^{2} C_{b}^{2} R_{a} R_{c} f^{2} + \pi^{2} C_{b}^{2} R_{b}^{2} f^{2} + 4 \pi^{2} C_{b}^{2} R_{b} R_{c} f^{2} + 4 \pi^{2} C_{b}^{2} R_{c}^{2} f^{2} + 1} \nonumber \\
&amp; + \frac{4 R_{c} T k \left(\pi^{2} C_{b}^{2} R_{a}^{2} f^{2} + 1\right)}{\pi^{2} C_{b}^{2} R_{a}^{2} f^{2} + 2 \pi^{2} C_{b}^{2} R_{a} R_{b} f^{2} + 4 \pi^{2} C_{b}^{2} R_{a} R_{c} f^{2} + \pi^{2} C_{b}^{2} R_{b}^{2} f^{2} + 4 \pi^{2} C_{b}^{2} R_{b} R_{c} f^{2} + 4 \pi^{2} C_{b}^{2} R_{c}^{2} f^{2} + 1} \nonumber \\
&amp; + \frac{0.25 S_{i} \left(R_{b} + 2 R_{c}\right)^{2}}{\pi^{2} C_{b}^{2} R_{a}^{2} f^{2} + 2 \pi^{2} C_{b}^{2} R_{a} R_{b} f^{2} + 4 \pi^{2} C_{b}^{2} R_{a} R_{c} f^{2} + \pi^{2} C_{b}^{2} R_{b}^{2} f^{2} + 4 \pi^{2} C_{b}^{2} R_{b} R_{c} f^{2} + 4 \pi^{2} C_{b}^{2} R_{c}^{2} f^{2} + 1}
\,\left[\mathrm{\frac{V^2}{Hz}}\right]
\end{align}\end{split}\]</div>
</section>
<section id="output-noise-of-the-differential-mode-equivalent-circuit">
<h3>Output noise of the differential-mode equivalent circuit<a class="headerlink" href="#output-noise-of-the-differential-mode-equivalent-circuit" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">132</span><span class="c1"># DM equivalent circuit</span>
<span class="linenos">133</span><span class="n">DnoiseResult</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doNoise</span><span class="p">(</span><span class="n">noisyCircuit</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dd&quot;</span><span class="p">)</span>
<span class="linenos">134</span>
<span class="linenos">135</span><span class="c1"># Show difference (should be zero!)</span>
<span class="linenos">136</span><span class="n">diffD</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">assumePosParams</span><span class="p">(</span><span class="n">noiseResultD</span><span class="o">.</span><span class="n">onoise</span> <span class="o">-</span> <span class="n">DnoiseResult</span><span class="o">.</span><span class="n">onoise</span><span class="p">))</span>
<span class="linenos">137</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference onoise full circuit and DM equivalent network:&quot;</span><span class="p">,</span> <span class="n">diffD</span><span class="p">)</span>
<span class="linenos">138</span><span class="c1"># Display the noise source names</span>
<span class="linenos">139</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Noise sources:&quot;</span><span class="p">)</span>
<span class="linenos">140</span><span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">noiseResultD</span><span class="o">.</span><span class="n">onoiseTerms</span><span class="p">:</span>
<span class="linenos">141</span>    <span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">noiseResultD</span><span class="o">.</span><span class="n">snoiseTerms</span><span class="p">[</span><span class="n">src</span><span class="p">])</span>
<span class="linenos">142</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Differential-mode noise sources contribution to DM onoise:&quot;</span><span class="p">)</span>
<span class="linenos">143</span><span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">DnoiseResult</span><span class="o">.</span><span class="n">onoiseTerms</span><span class="p">:</span>
<span class="linenos">144</span>    <span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">DnoiseResult</span><span class="o">.</span><span class="n">snoiseTerms</span><span class="p">[</span><span class="n">src</span><span class="p">])</span>
</pre></div>
</div>
<p>The console output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Detector changed to: V_out_D
Difference onoise full circuit and DM equivalent network: 0
Noise sources:
I1 : S_i
V1N : S_vb
V1P : S_va
I_noise_R1N : 4*T*k/R_a
I_noise_R1P : 4*T*k/R_a
I_noise_R2N : 4*T*k/R_b
I_noise_R2P : 4*T*k/R_b
I_noise_R3 : 4*T*k/R_c
Differential-mode noise sources contribution to DM onoise:
V1_D : S_va + S_vb
I_noise_R1_D : 2*T*k/R_a
I_noise_R2_D : 2*T*k/R_b
</pre></div>
</div>
</section>
<section id="output-noise-of-the-common-mode-equivalent-circuit">
<h3>Output noise of the common-mode equivalent circuit<a class="headerlink" href="#output-noise-of-the-common-mode-equivalent-circuit" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">146</span><span class="c1"># CM equivalent circuit   </span>
<span class="linenos">147</span><span class="n">CnoiseResult</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doNoise</span><span class="p">(</span><span class="n">noisyCircuit</span><span class="p">,</span> <span class="n">detector</span><span class="o">=</span><span class="s2">&quot;circuit&quot;</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">)</span>
<span class="linenos">148</span>
<span class="linenos">149</span><span class="c1"># Show difference (should be zero!)</span>
<span class="linenos">150</span><span class="n">diffC</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">assumePosParams</span><span class="p">(</span><span class="n">noiseResultC</span><span class="o">.</span><span class="n">onoise</span> <span class="o">-</span> <span class="n">CnoiseResult</span><span class="o">.</span><span class="n">onoise</span><span class="p">))</span>
<span class="linenos">151</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference onoise full circuit and CM equivalent network:&quot;</span><span class="p">,</span> <span class="n">diffC</span><span class="p">)</span>
<span class="linenos">152</span><span class="c1"># Display the noise source names</span>
<span class="linenos">153</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Noise sources:&quot;</span><span class="p">)</span>
<span class="linenos">154</span><span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">noiseResultC</span><span class="o">.</span><span class="n">onoiseTerms</span><span class="p">:</span>
<span class="linenos">155</span>    <span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">noiseResultC</span><span class="o">.</span><span class="n">snoiseTerms</span><span class="p">[</span><span class="n">src</span><span class="p">])</span>
<span class="linenos">156</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Common-mode noise sources contribution to CM onoise:&quot;</span><span class="p">)</span>
<span class="linenos">157</span><span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">CnoiseResult</span><span class="o">.</span><span class="n">onoiseTerms</span><span class="p">:</span>
<span class="linenos">158</span>    <span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">CnoiseResult</span><span class="o">.</span><span class="n">snoiseTerms</span><span class="p">[</span><span class="n">src</span><span class="p">])</span>
</pre></div>
</div>
<p>The console output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Detector changed to: V_out_C
Difference onoise full circuit and CM equivalent network: 0
Noise sources:
I1 : S_i
V1N : S_vb
V1P : S_va
I_noise_R1N : 4*T*k/R_a
I_noise_R1P : 4*T*k/R_a
I_noise_R2N : 4*T*k/R_b
I_noise_R2P : 4*T*k/R_b
I_noise_R3 : 4*T*k/R_c
Common-mode noise sources contribution to CM onoise:
I1 : S_i
V1_C : S_va/4 + S_vb/4
I_noise_R1_C : 8*T*k/R_a
I_noise_R2_C : 8*T*k/R_b
I_noise_R3 : 4*T*k/R_c
</pre></div>
</div>
</section>
</section>
<section id="balanced-dcvar">
<h2>Balanced dcvar<a class="headerlink" href="#balanced-dcvar" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">160</span><span class="c1"># Balanced dc variance analysis</span>
<span class="linenos">161</span><span class="n">dcvarAmp</span>  <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">makeCircuit</span><span class="p">(</span><span class="s2">&quot;kicad/balancedAmpDCvar/balancedAmpDCvar.kicad_sch&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/balancedAmpDCvar.svg"><img alt="../_images/balancedAmpDCvar.svg" src="../_images/balancedAmpDCvar.svg" style="width: 800px;" />
</a>
<section id="differential-output-dc-variance">
<h3>Differential output dc variance<a class="headerlink" href="#differential-output-dc-variance" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">163</span><span class="c1"># Differential-mode output dc variance (complete circuit)</span>
<span class="linenos">164</span><span class="n">dcvarD</span>    <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doDCvar</span><span class="p">(</span><span class="n">dcvarAmp</span><span class="p">)</span>
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
var_{vD} = &amp; 2 I_{b}^{2} R_{a}^{2} \sigma_{R}^{2} \nonumber \\
&amp; + \frac{2 \sigma_{ib}^{2} \left(R_{a} R_{b} - 2 R_{a} R_{s} - R_{b} R_{s}\right)^{2}}{R_{b}^{2}} \nonumber \\
&amp; + \frac{2 \sigma_{io}^{2} \left(R_{a} R_{b} + 2 R_{a} R_{s} + R_{b} R_{s}\right)^{2}}{R_{b}^{2}} \nonumber \\
&amp; + \frac{2 \sigma_{vo}^{2} \left(2 R_{a} + R_{b}\right)^{2}}{R_{b}^{2}}
\,\left[\mathrm{V^2}\right]
\end{align}\end{split}\]</div>
</section>
<section id="common-mode-ouput-dc-variance">
<h3>Common-mode ouput dc variance<a class="headerlink" href="#common-mode-ouput-dc-variance" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">166</span><span class="c1"># Common-mode output dc variance (complete circuit)</span>
<span class="linenos">167</span><span class="n">dcvarC</span>    <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doDCvar</span><span class="p">(</span><span class="n">dcvarAmp</span><span class="p">,</span> <span class="n">detector</span><span class="o">=</span><span class="s2">&quot;V_comm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[var_{vC} = I_{b}^{2} R_{a}^{2} \sigma_{L}^{2} + 0.5 I_{b}^{2} R_{a}^{2} \sigma_{R}^{2} + 0.5 \sigma_{ib}^{2} \left(R_{a} - R_{s}\right)^{2} + 0.5 \sigma_{io}^{2} \left(R_{a} + R_{s}\right)^{2} + 0.5 \sigma_{vo}^{2}\,\,\left[\mathrm{V^2}\right]\]</div>
</section>
<section id="output-dc-variance-of-the-differential-mode-equivalent-circuit">
<h3>Output dc variance of the differential-mode equivalent circuit<a class="headerlink" href="#output-dc-variance-of-the-differential-mode-equivalent-circuit" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">169</span><span class="c1"># DM equivalent circuit</span>
<span class="linenos">170</span><span class="n">Ddcvar</span>    <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doDCvar</span><span class="p">(</span><span class="n">dcvarAmp</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;dd&quot;</span><span class="p">)</span>
<span class="linenos">171</span>
<span class="linenos">172</span><span class="c1"># Show difference (should be zero!)</span>
<span class="linenos">173</span><span class="n">diffOvarD</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">dcvarD</span><span class="o">.</span><span class="n">ovar</span> <span class="o">-</span> <span class="n">Ddcvar</span><span class="o">.</span><span class="n">ovar</span><span class="p">)</span>
<span class="linenos">174</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference ovar full circuit and DM equivalent network:&quot;</span><span class="p">,</span> <span class="n">diffOvarD</span><span class="p">)</span>
<span class="linenos">175</span><span class="c1"># Display the dc variance source names</span>
<span class="linenos">176</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DC variance sources:&quot;</span><span class="p">)</span>
<span class="linenos">177</span><span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">dcvarD</span><span class="o">.</span><span class="n">ovarTerms</span><span class="p">:</span>
<span class="linenos">178</span>    <span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">dcvarD</span><span class="o">.</span><span class="n">ovarTerms</span><span class="p">[</span><span class="n">src</span><span class="p">])</span>
<span class="linenos">179</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Differential-mode dc variance sources contribution to DM dc variance:&quot;</span><span class="p">)</span>
<span class="linenos">180</span><span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">Ddcvar</span><span class="o">.</span><span class="n">ovarTerms</span><span class="p">:</span>
<span class="linenos">181</span>    <span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">Ddcvar</span><span class="o">.</span><span class="n">ovarTerms</span><span class="p">[</span><span class="n">src</span><span class="p">])</span>
</pre></div>
</div>
<p>The console output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Detector changed to: V_out_D
Difference ovar full circuit and DM equivalent network: 0
DCvar sources:
V1N : 0
V1P : 0
Ib_X1N : sigma_ib**2*(R_a*R_b - 2*R_a*R_s - R_b*R_s)**2/R_b**2
Vm_X1N : 0
Io_X1N : sigma_io**2*(R_a*R_b + 2*R_a*R_s + R_b*R_s)**2/R_b**2
Vo_X1N : sigma_vo**2*(2*R_a + R_b)**2/R_b**2
Ib_X1P : sigma_ib**2*(R_a*R_b - 2*R_a*R_s - R_b*R_s)**2/R_b**2
Vm_X1P : 0
Io_X1P : sigma_io**2*(R_a*R_b + 2*R_a*R_s + R_b*R_s)**2/R_b**2
Vo_X1P : sigma_vo**2*(2*R_a + R_b)**2/R_b**2
I_dcvar_R1N : 0
I_dcvar_R1P : 0
I_dcvar_R2N : I_b**2*R_a**2*sigma_R**2
V_dcvar_Lot_1 : 0
I_dcvar_R2P : I_b**2*R_a**2*sigma_R**2
Differential-mode dc variance sources contribution to DM onoise:
V1_D : 0
Ib_X1_D : 2*sigma_ib**2*(R_a*R_b - 2*R_a*R_s - R_b*R_s)**2/R_b**2
Vm_X1_D : 0
Io_X1_D : 2*sigma_io**2*(R_a*R_b + 2*R_a*R_s + R_b*R_s)**2/R_b**2
Vo_X1_D : 2*sigma_vo**2*(2*R_a + R_b)**2/R_b**2
I_dcvar_R1_D : 0
I_dcvar_R2_D : 2*I_b**2*R_a**2*sigma_R**2
</pre></div>
</div>
</section>
<section id="output-dc-variance-of-the-common-mode-equivalent-circuit">
<h3>Output dc variance of the common-mode equivalent circuit<a class="headerlink" href="#output-dc-variance-of-the-common-mode-equivalent-circuit" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">183</span><span class="c1"># CM equivalent circuit</span>
<span class="linenos">184</span><span class="n">Cdcvar</span>    <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">doDCvar</span><span class="p">(</span><span class="n">dcvarAmp</span><span class="p">,</span> <span class="n">convtype</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">)</span>
<span class="linenos">185</span>
<span class="linenos">186</span><span class="c1"># Show difference (should be zero!)</span>
<span class="linenos">187</span><span class="n">diffOvarC</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">dcvarC</span><span class="o">.</span><span class="n">ovar</span> <span class="o">-</span> <span class="n">Cdcvar</span><span class="o">.</span><span class="n">ovar</span><span class="p">)</span>
<span class="linenos">188</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference ovar full circuit and CM equivalent network:&quot;</span><span class="p">,</span> <span class="n">diffOvarC</span><span class="p">)</span>
<span class="linenos">189</span><span class="c1"># Display the dcvariance source names</span>
<span class="linenos">190</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DC variance sources:&quot;</span><span class="p">)</span>
<span class="linenos">191</span><span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">dcvarC</span><span class="o">.</span><span class="n">ovarTerms</span><span class="p">:</span>
<span class="linenos">192</span>    <span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">dcvarC</span><span class="o">.</span><span class="n">ovarTerms</span><span class="p">[</span><span class="n">src</span><span class="p">])</span>
<span class="linenos">193</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Common-mode dc variance sources contribution to CM dc variance:&quot;</span><span class="p">)</span>
<span class="linenos">194</span><span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">Cdcvar</span><span class="o">.</span><span class="n">ovarTerms</span><span class="p">:</span>
<span class="linenos">195</span>    <span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">Cdcvar</span><span class="o">.</span><span class="n">ovarTerms</span><span class="p">[</span><span class="n">src</span><span class="p">])</span>
</pre></div>
</div>
<p>The console output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Detector changed to: V_out_C
Difference ovar full circuit and CM equivalent network: 0
DC variance sources:
V1N : 0
V1P : 0
Ib_X1N : sigma_ib**2*(R_a - R_s)**2/4
Vm_X1N : 0
Io_X1N : sigma_io**2*(R_a + R_s)**2/4
Vo_X1N : sigma_vo**2/4
Ib_X1P : sigma_ib**2*(R_a - R_s)**2/4
Vm_X1P : 0
Io_X1P : sigma_io**2*(R_a + R_s)**2/4
Vo_X1P : sigma_vo**2/4
I_dcvar_R1N : 0
I_dcvar_R1P : 0
I_dcvar_R2N : I_b**2*R_a**2*sigma_R**2/4
V_dcvar_Lot_1 : I_b**2*R_a**2*sigma_L**2
I_dcvar_R2P : I_b**2*R_a**2*sigma_R**2/4
Common-mode dc variance sources contribution to CM dc variance:
V1_C : 0
Ib_X1_C : sigma_ib**2*(R_a - R_s)**2/2
Vm_X1_C : 0
Io_X1_C : sigma_io**2*(R_a + R_s)**2/2
Vo_X1_C : sigma_vo**2/2
I_dcvar_R1_C : 0
I_dcvar_R2_C : I_b**2*R_a**2*sigma_R**2/2
V_dcvar_Lot_1 : I_b**2*R_a**2*sigma_L**2
</pre></div>
</div>
<img alt="../_images/colorCode.svg" src="../_images/colorCode.svg" />
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="feedback.html" class="btn btn-neutral float-left" title="Work with feedback circuits" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="math.html" class="btn btn-neutral float-right" title="Work with analysis results" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, SLiCAP development team.
      <span class="lastupdated">Last updated on 2025, Dec 27.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>