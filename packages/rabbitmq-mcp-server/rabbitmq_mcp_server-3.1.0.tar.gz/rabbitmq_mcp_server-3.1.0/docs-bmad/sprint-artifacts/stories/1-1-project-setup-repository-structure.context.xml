<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1</storyId>
    <title>Project Setup &amp; Repository Structure</title>
    <status>drafted</status>
    <generatedAt>2025-12-26</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs-bmad/sprint-artifacts/1-1-project-setup-repository-structure.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>the project repository initialized with modern Python project structure and dependency management</iWant>
    <soThat>all subsequent development follows consistent patterns and dependencies are properly managed</soThat>
    <tasks>
      - Task 1: Create Repository Directory Structure (AC: #1)
      - Task 2: Configure pyproject.toml (AC: #2, #3, #4, #5)
      - Task 3: Configure .gitignore (AC: #6)
      - Task 4: Create README.md (AC: #7)
      - Task 5: Initialize uv Environment (AC: #2)
      - Task 6: Verify Installation and Test (AC: #2, #3, #4)
      - Task 7: Execute Architecture Initialization (AC: #8)
      - Task 8: Create Placeholder Entry Point (AC: #2)
    </tasks>
  </story>

  <acceptanceCriteria>
    1. Repository Structure Created
       - Directory structure: src/, tests/, scripts/, data/, config/, docs/, .bmad/
       - All Python packages contain __init__.py files
       - Structure follows src-layout pattern per architecture/project-structure.md

    2. Python 3.12+ Configuration
       - Python version constraint: &gt;=3.12,&lt;4.0 in pyproject.toml
       - uv package manager configured
       - Virtual environment created and activated successfully

    3. Core Dependencies Defined
       - mcp&gt;=1.0.0, pydantic&gt;=2.0, pydantic-settings&gt;=2.0
       - httpx&gt;=0.27, structlog&gt;=24.1
       - opentelemetry-api&gt;=1.22, opentelemetry-sdk&gt;=1.22
       - jsonschema&gt;=4.20, pyyaml&gt;=6.0

    4. Development Dependencies Defined
       - pytest&gt;=8.0, pytest-asyncio&gt;=0.23, pytest-cov&gt;=4.1, pytest-mock&gt;=3.12
       - testcontainers&gt;=3.7
       - datamodel-code-generator&gt;=0.25
       - black&gt;=24.1, ruff&gt;=0.2, mypy&gt;=1.8
       - sentence-transformers&gt;=2.6,&lt;3, numpy&gt;=1.26,&lt;2.0
       - Type stubs: types-pyyaml, types-requests, types-tabulate

    5. Project Metadata Complete
       - name: rabbitmq-mcp-server
       - version: 3.0.0
       - license: LGPL-3.0-or-later
       - description, authors present

    6. .gitignore Configuration
       - Excludes: __pycache__/, .pytest_cache/, .mypy_cache/, *.pyc
       - Excludes: .env, logs/, .venv/, venv/, .DS_Store
       - Excludes: data/*.json, data/*.yaml (generated artifacts)
       - Includes: data/.gitkeep, logs/.gitkeep

    7. README.md Documentation
       - Project overview with 3-tool semantic discovery pattern
       - Quick start with uv installation instructions
       - Basic usage examples (MCP server startup)
       - Links to docs/ folder

    8. Architecture Initialization
       - Execute architecture initialization if using template
       - Reference: docs-bmad/architecture/project-initialization.md
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs-bmad/architecture/project-structure.md</path>
        <title>Project Structure</title>
        <section>Full Repository Tree</section>
        <snippet>Complete directory structure with src-layout pattern: src/rabbitmq_mcp_server/ with subdirectories for mcp_server/, config/, logging/, models/, rabbitmq_connection/, schemas/, tools/, utils/, cli/. Tests organized by category: unit/, integration/, contract/, performance/.</snippet>
      </doc>
      <doc>
        <path>docs-bmad/architecture/implementation-patterns.md</path>
        <title>Implementation Patterns</title>
        <section>Naming Conventions</section>
        <snippet>Python modules use snake_case, classes use PascalCase. Package names: rabbitmq_mcp_server (importable) vs rabbitmq-mcp-server (distribution name). Follow PEP-8 conventions.</snippet>
      </doc>
      <doc>
        <path>docs-bmad/architecture/technology-stack-details.md</path>
        <title>Technology Stack Details</title>
        <section>Python Ecosystem and Dependencies</section>
        <snippet>Python 3.12+ required for modern type hints (PEP 695). uv package manager for 10-100x faster dependency resolution. Core dependencies: mcp, pydantic, httpx, structlog, opentelemetry. Dev dependencies: pytest, mypy, black, ruff, testcontainers, sentence-transformers.</snippet>
      </doc>
      <doc>
        <path>docs-bmad/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic 1 Technical Specification</title>
        <section>Overview and Dependencies</section>
        <snippet>Epic establishes foundation with OpenAPI-driven code generation and 3-tool semantic discovery pattern (search-ids, get-id, call-id). Build-time generation pipeline creates Pydantic schemas, operation registries, and semantic embeddings. Complete dependency specifications with version constraints and rationale.</snippet>
      </doc>
      <doc>
        <path>docs-bmad/architecture/consistency-rules.md</path>
        <title>Consistency Rules</title>
        <section>Type Hints and Testing Standards</section>
        <snippet>Strict type checking with mypy (--strict flag). All functions require type hints. pytest with async support (pytest-asyncio). Code coverage target: 80%+. Test organization mirrors source structure.</snippet>
      </doc>
      <doc>
        <path>docs-bmad/architecture/architecture-decision-records-adrs.md</path>
        <title>Architecture Decision Records</title>
        <section>ADR-007: Build-time Generation Pipeline</section>
        <snippet>Src-layout pattern chosen over flat layout for namespace packaging benefits, preventing test code from being packaged, and providing clear separation between source and auxiliary files.</snippet>
      </doc>
    </docs>

    <code>
      <artifact>
        <path>src/rabbitmq_mcp_server/__init__.py</path>
        <kind>package</kind>
        <symbol>__init__</symbol>
        <lines>1-813</lines>
        <reason>VERIFY: Main package __init__.py exists. Note: src/ is the src-layout directory (not importable), src/rabbitmq_mcp_server/ is the actual importable package. Project at version 3.0.0 suggests implementation already exists - verify all required package initialization is present.</reason>
      </artifact>
      <artifact>
        <path>src/rabbitmq_mcp_server/</path>
        <kind>directory</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>VERIFY: Main package directory with required subdirectories per AC #1: cli/, config/, logging/, mcp_server/, models/, rabbitmq_connection/ (note: actual name may be rabbitmq_mcp_connection/), schemas/, tools/, utils/. Check all subdirectories exist and contain __init__.py files. Directory structure must align with docs-bmad/architecture/project-structure.md.</reason>
      </artifact>
      <artifact>
        <path>pyproject.toml</path>
        <kind>config</kind>
        <symbol>project configuration</symbol>
        <lines>1-50</lines>
        <reason>VERIFY: Project configuration against AC #2-5. Project is at version 3.0.0 with LGPL-3.0-or-later license (production state). Verify all dependencies match AC #3-4 requirements: core deps (mcp&gt;=1.0.0, pydantic&gt;=2.0, httpx&gt;=0.27, structlog&gt;=24.1, opentelemetry-api&gt;=1.22, opentelemetry-sdk&gt;=1.22, jsonschema&gt;=4.20, pyyaml&gt;=6.0) and dev deps (pytest&gt;=8.0, pytest-asyncio&gt;=0.23, pytest-cov&gt;=4.1, pytest-mock&gt;=3.12, testcontainers&gt;=3.7, datamodel-code-generator&gt;=0.25, black&gt;=24.1, ruff&gt;=0.2, mypy&gt;=1.8, sentence-transformers&gt;=2.6, numpy&gt;=1.26, type stubs).</reason>
      </artifact>
    </code>

    <dependencies>
      <python version="&gt;=3.12,&lt;4.0">
        <runtime>
          <package>mcp&gt;=1.0.0</package>
          <package>pydantic&gt;=2.0</package>
          <package>pydantic-settings&gt;=2.0</package>
          <package>httpx&gt;=0.27</package>
          <package>structlog&gt;=24.1</package>
          <package>opentelemetry-api&gt;=1.22</package>
          <package>opentelemetry-sdk&gt;=1.22</package>
          <package>jsonschema&gt;=4.20</package>
          <package>pyyaml&gt;=6.0</package>
          <package>pika&gt;=1.3</package>
          <package>aio-pika&gt;=9.5,&lt;11</package>
        </runtime>
        <development>
          <package>pytest&gt;=8.0</package>
          <package>pytest-asyncio&gt;=0.23</package>
          <package>pytest-cov&gt;=4.1</package>
          <package>pytest-mock&gt;=3.12</package>
          <package>testcontainers&gt;=3.7</package>
          <package>datamodel-code-generator&gt;=0.25</package>
          <package>black&gt;=24.1</package>
          <package>ruff&gt;=0.2</package>
          <package>mypy&gt;=1.8</package>
          <package>sentence-transformers&gt;=2.6,&lt;3</package>
          <package>numpy&gt;=1.26,&lt;2.0</package>
          <package>types-pyyaml</package>
          <package>types-requests</package>
          <package>types-tabulate</package>
        </development>
      </python>
      <tools>
        <tool>uv (package manager)</tool>
        <tool>git (version control)</tool>
      </tools>
    </dependencies>
  </artifacts>

  <constraints>
    - Follow src-layout pattern (src/rabbitmq_mcp_server/) per ADR-007 for proper namespace packaging
    - Python 3.12+ required for modern type hints (PEP 695 generic syntax)
    - All functions must have type hints (mypy --strict mode enforced)
    - Package name: rabbitmq_mcp_server (underscores, importable) vs distribution: rabbitmq-mcp-server (hyphens)
    - Use snake_case for modules/functions, PascalCase for classes, UPPER_CASE for constants
    - Pin major versions, allow minor/patch updates (e.g., mcp&gt;=1.0.0 allows 1.x but not 2.0)
    - Separate core dependencies (runtime) from dev dependencies (testing/linting)
    - Directory structure must enable proper Python packaging with clean imports
    - Build artifacts location: data/ for generated files, logs/ for runtime logs
    - .gitignore must exclude build artifacts but include .gitkeep files for empty directories
    - Test organization mirrors source structure: tests/unit/ for fast tests, tests/integration/ for Docker-based tests
    - Code coverage requirement: 80%+ for CI/CD pipeline to pass
    - pytest-asyncio mode="auto" for automatic async test detection
    - Strict separation: src/ (application), tests/ (test suites), scripts/ (build tools), data/ (artifacts)
    - PROJECT STATE: This is a VERIFICATION story - codebase already exists at version 3.0.0 with LGPL-3.0-or-later license
    - VERIFICATION FOCUS: Ensure existing structure matches all architecture requirements rather than creating from scratch
    - License is LGPL-3.0-or-later (confirmed by LICENSE file and git history) - project uses copyleft license for library protection
  </constraints>

  <interfaces>
    <interface>
      <name>uv package manager CLI</name>
      <kind>command-line tool</kind>
      <signature>
        uv init - Initialize uv project
        uv sync - Install dependencies from uv.lock
        uv run [command] - Run command in virtual environment
      </signature>
      <path>External tool (must be installed)</path>
    </interface>
    <interface>
      <name>pyproject.toml [project] section</name>
      <kind>configuration schema</kind>
      <signature>
        name: str (distribution name with hyphens)
        version: str (semantic version)
        requires-python: str (version constraint)
        dependencies: List[str] (runtime dependencies)
        [project.optional-dependencies] dev: List[str] (dev dependencies)
      </signature>
      <path>pyproject.toml</path>
    </interface>
    <interface>
      <name>pytest configuration</name>
      <kind>configuration schema</kind>
      <signature>
        asyncio_mode = "auto" (pytest.ini)
        Test discovery: tests/**/*test_*.py
        Markers: @pytest.mark.unit, @pytest.mark.integration
      </signature>
      <path>pytest.ini</path>
    </interface>
    <interface>
      <name>Python package imports</name>
      <kind>module interface</kind>
      <signature>
        import rabbitmq_mcp_server (top-level package)
        from rabbitmq_mcp_server.config import settings
        from rabbitmq_mcp_server.logging import get_logger
      </signature>
      <path>src/rabbitmq_mcp_server/__init__.py</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Create tests/conftest.py with pytest fixtures for common test setup. Use pytest markers (@pytest.mark.unit, @pytest.mark.integration) for test categorization. Configure pytest-asyncio mode="auto" in pytest.ini for automatic async test detection. Tests mirror source structure: tests/unit/test_module.py for src/module.py. Code coverage target: 80%+. Test each acceptance criterion with specific test cases.
    </standards>

    <locations>
      tests/unit/ - Fast unit tests with no I/O
      tests/integration/ - Docker-based integration tests with RabbitMQ
      tests/contract/ - MCP protocol compliance tests
      tests/performance/ - Performance benchmarks
      tests/conftest.py - Shared fixtures and pytest configuration
    </locations>

    <ideas>
      AC #1 (Repository Structure):
      - test_required_directories_exist: Verify src/, tests/, scripts/, data/, config/, docs/, .bmad/ exist
      - test_package_init_files_present: Check __init__.py in all Python packages
      - test_package_imports: Test imports from src/rabbitmq_mcp_server succeed

      AC #2 (Python Configuration):
      - test_python_version_constraint: Parse pyproject.toml and verify requires-python = "&gt;=3.12,&lt;4.0"
      - test_uv_lock_exists: Verify uv.lock file exists and is valid
      - test_venv_activated: Check virtual environment can be created

      AC #3 (Core Dependencies):
      - test_core_dependency_imports: Import mcp, pydantic, httpx, structlog and verify successful
      - test_dependency_versions: Parse pyproject.toml and verify version constraints match requirements

      AC #4 (Dev Dependencies):
      - test_dev_tools_available: Run pytest --version, mypy --version, black --version to verify installation
      - test_sentence_transformers_import: Verify sentence-transformers can be imported

      AC #5 (Project Metadata):
      - test_project_metadata_complete: Parse pyproject.toml and verify name, version, description, license, authors
      - test_project_name_correct: Assert name == "rabbitmq-mcp-server"
      - test_project_version: Assert version == "3.0.0" (production state)
      - test_project_license: Assert license == "LGPL-3.0-or-later"

      AC #6 (.gitignore):
      - test_gitignore_patterns: Parse .gitignore and verify patterns present (__pycache__/, .env, logs/, etc.)
      - test_gitkeep_preservation: Verify .gitignore includes !data/.gitkeep and !logs/.gitkeep

      AC #7 (README.md):
      - test_readme_exists: Verify README.md exists
      - test_readme_sections: Parse README.md and check for sections (overview, quick start, usage)
      - test_readme_mentions_3tool_pattern: Verify "search-ids", "get-id", "call-id" mentioned

      AC #8 (Architecture Initialization):
      - test_architecture_alignment: Verify directory structure matches architecture/project-structure.md
      - Manual verification: Check docs-bmad/architecture/project-initialization.md for any required init steps
    </ideas>
  </tests>
</story-context>
