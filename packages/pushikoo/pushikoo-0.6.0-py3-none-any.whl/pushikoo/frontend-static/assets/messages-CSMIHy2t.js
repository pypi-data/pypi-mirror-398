import{g as fe,p as he,aO as _e,f as q,t as D,h as xe,u as ye,B as we,c as e,b as n,H as se,z as Z,a0 as ke,d as Ve,n as Pe,a as Se,i as Ce,m as De,J as $e,ac as Te,K as Ie,r as u,ag as Be,N as ee,Q as H,R as a,W as o,X as f,Y as le,aa as Fe,ad as Ne,S as oe}from"./index-BYltkyXg.js";import{u as He,a as Re,s as ze,b as Me,J as Le,K as Ae,c as Ee,m as Ge,d as Oe,L as je,N as Ue,e as We,w as Je,f as qe,i as _,l as R,n as W,p as J,o as ne,q as ie,O as de,_ as Ke}from"./_plugin-vue_export-helper-Bm_z-jXW.js";import{L as Qe}from"./VSelect-CB2R5Zsb.js";import{V as z,a as v}from"./LoadingSpinner.vue_vue_type_style_index_0_scoped_0c8a0411_lang-Dgw-NsT1.js";import{d as te}from"./VTextField-WvAstbP-.js";import{c as Xe,b as Ye,d as Ze,e as et,f as tt,p as at,g as st,i as lt,j as ot,k as nt,l as it,n as dt,o as re,q as me,r as ue,s as ce,t as rt,v as mt,w as ut}from"./VDataTable-CJ6Ivf2w.js";import{V as K}from"./VMenu-BPSB1D_k.js";import{V as ge,a as ct}from"./VContainer-BO4bdQAC.js";import{V as ve}from"./VDialog-BDFq6L1j.js";import{V as ae}from"./VSpacer-C9bLW835.js";import"./forwardRefs-CD-Eo7uh.js";const gt=he({itemsLength:{type:[Number,String],required:!0},...ut(),...mt(),...rt()},"VDataTableServer"),vt=fe()({name:"VDataTableServer",props:gt(),emits:{"update:modelValue":t=>!0,"update:page":t=>!0,"update:itemsPerPage":t=>!0,"update:sortBy":t=>!0,"update:options":t=>!0,"update:expanded":t=>!0,"update:groupBy":t=>!0},setup(t,x){let{attrs:c,slots:d}=x;const{groupBy:h}=Xe(t),{initialSortOrder:w,sortBy:g,multiSort:$,mustSort:V}=Ye(t),{page:p,itemsPerPage:y}=Ze(t),{disableSort:P}=_e(t),T=q(()=>parseInt(t.itemsLength,10)),{columns:k,headers:r}=et(t,{groupBy:h,showSelect:D(()=>t.showSelect),showExpand:D(()=>t.showExpand)}),{items:b}=tt(t,k),{toggleSort:I}=at({initialSortOrder:w,sortBy:g,multiSort:$,mustSort:V,page:p}),{opened:M,isGroupOpen:L,toggleGroup:S,extractRows:A}=st({groupBy:h,sortBy:g,disableSort:P}),{pageCount:E,setItemsPerPage:Q}=lt({page:p,itemsPerPage:y,itemsLength:T}),{flatItems:G}=ot(b,h,M,()=>!!d["group-summary"]),{isSelected:O,select:X,selectAll:Y,toggleSelect:s,someSelected:i,allSelected:l}=nt(t,{allItems:b,currentPage:b}),{isExpanded:C,toggleExpand:j}=it(t),F=q(()=>A(b.value));dt({page:p,itemsPerPage:y,sortBy:g,groupBy:h,search:D(()=>t.search)}),ke("v-data-table",{toggleSort:I,sortBy:g}),xe({VDataTableRows:{hideNoData:D(()=>t.hideNoData),noDataText:D(()=>t.noDataText),loading:D(()=>t.loading),loadingText:D(()=>t.loadingText)}});const m=q(()=>({page:p.value,itemsPerPage:y.value,sortBy:g.value,pageCount:E.value,toggleSort:I,setItemsPerPage:Q,someSelected:i.value,allSelected:l.value,isSelected:O,select:X,selectAll:Y,toggleSelect:s,isExpanded:C,toggleExpand:j,isGroupOpen:L,toggleGroup:S,items:F.value.map(B=>B.raw),internalItems:F.value,groupedItems:G.value,columns:k.value,headers:r.value}));ye(()=>{const B=re.filterProps(t),N=me.filterProps(we(t,["multiSort"])),U=ue.filterProps(t),be=ce.filterProps(t);return e(ce,Z({class:["v-data-table",{"v-data-table--loading":t.loading},t.class],style:t.style},be,{fixedHeader:t.fixedHeader||t.sticky}),{top:()=>d.top?.(m.value),default:()=>d.default?d.default(m.value):n(se,null,[d.colgroup?.(m.value),!t.hideDefaultHeader&&n("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[e(me,Z(N,{multiSort:!!t.multiSort}),d)]),d.thead?.(m.value),!t.hideDefaultBody&&n("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[d["body.prepend"]?.(m.value),d.body?d.body(m.value):e(ue,Z(c,U,{items:G.value}),d),d["body.append"]?.(m.value)]),d.tbody?.(m.value),d.tfoot?.(m.value)]),bottom:()=>d.bottom?d.bottom(m.value):!t.hideDefaultFooter&&n(se,null,[e(K,null,null),e(re,B,{prepend:d["footer.prepend"]})])})})}}),pt=he({color:String,...qe(),...De(),...Je(),...We(),...Ue(),...je(),...Oe(),...Ge(),...Ce()},"VSheet"),pe=fe()({name:"VSheet",props:pt(),setup(t,x){let{slots:c}=x;const{themeClasses:d}=Ve(t),{backgroundColorClasses:h,backgroundColorStyles:w}=He(()=>t.color),{borderClasses:g}=Re(t),{dimensionStyles:$}=ze(t),{elevationClasses:V}=Me(t),{locationStyles:p}=Le(t),{positionClasses:y}=Ae(t),{roundedClasses:P}=Ee(t);return ye(()=>e(t.tag,{class:Se(["v-sheet",d.value,h.value,g.value,V.value,y.value,P.value,t.class]),style:Pe([w.value,$.value,p.value,t.style])},c)),{}}}),ft={class:"d-flex align-center justify-space-between flex-wrap ga-4"},ht={class:"text-h5 text-sm-h4 font-weight-bold mb-1"},yt={class:"text-body-2 text-medium-emphasis mb-0"},bt={class:"d-none d-sm-inline ml-2"},_t={class:"d-flex align-center text-no-wrap"},xt=["title"],wt=["title"],kt={class:"d-flex flex-nowrap text-no-wrap"},Vt={class:"text-center py-8"},Pt={class:"text-h6 text-medium-emphasis"},St={class:"text-body-2 text-medium-emphasis"},Ct={class:"text-caption text-medium-emphasis mb-1"},Dt={class:"text-body-1 font-weight-medium"},$t={class:"text-caption text-medium-emphasis mb-1"},Tt={class:"text-caption text-medium-emphasis mb-1"},It={class:"text-body-1"},Bt={class:"text-caption text-medium-emphasis mb-1"},Ft={class:"text-body-1"},Nt={class:"text-subtitle-2 font-weight-bold mb-2"},Ht={key:0,style:{"white-space":"pre-wrap","word-break":"break-word"}},Rt={key:1,class:"text-medium-emphasis"},zt={class:"d-flex align-center justify-space-between mb-2"},Mt={class:"text-body-2",style:{"white-space":"pre-wrap","word-break":"break-word",margin:"0"}},Lt=$e({__name:"messages",setup(t){const x=Te("showSnackbar",()=>{}),{t:c}=Ie(),d=q(()=>[{title:c("messages.tableHeaderDate"),key:"ts",width:"1%",minWidth:"160px"},{title:c("messages.tableHeaderGetter"),key:"getter_name",width:"1%",minWidth:"100px"},{title:c("messages.tableHeaderIdentifier"),key:"message_identifier",width:"1%",minWidth:"150px"},{title:c("messages.tableHeaderContent"),key:"content",sortable:!1,maxWidth:"0"},{title:c("messages.tableHeaderActions"),key:"actions",sortable:!1,align:"end",width:"1%",minWidth:"80px"}]),h=u([]),w=u(!1),g=u(!0),$=u(0),V=u(10),p=u(""),y=u(""),P=u(""),T=u(!1),k=u(!1),r=u(null),b=u(null),I=u(!1),M=s=>new Date(s*1e3).toLocaleString(),L=async({page:s,itemsPerPage:i,sortBy:l})=>{w.value=!0;try{const C=(s-1)*i;let j="ts_desc";if(l&&l.length>0){const m=l[0],B=m.key,N=m.order==="asc"?"asc":"desc",U={ts:`ts_${N}`,message_identifier:`identifier_${N}`,getter_name:`getter_name_${N}`};U[B]&&(j=U[B])}const F=await de.listMessagesApiV1MessagesGet({limit:i,offset:C,getterName:P.value||void 0,messageIdentifier:y.value||void 0,keywords:p.value||void 0,order:j});h.value=F.items,$.value=F.total}catch(C){console.error("Error loading messages:",C),x("Failed to load messages","error")}finally{w.value=!1,g.value=!1}},S=()=>{L({page:1,itemsPerPage:V.value,sortBy:[]})};Be(()=>{S()});const A=s=>s.content?.content?s.content.content.filter(l=>l.type==="text"||l.type==="title").map(l=>l.text||"").join(" ")||"Media/Mixed Content":"",E=s=>s.content?.content?s.content.content.filter(l=>l.type==="text"||l.type==="title").map(l=>l.text||"").join(`

`):"",Q=async()=>{if(r.value)try{await navigator.clipboard.writeText(JSON.stringify(r.value.content,null,2)),x(c("common.copied"),"success")}catch{x(c("common.copyFailed"),"error")}},G=s=>{r.value=s,T.value=!0},O=()=>{T.value=!1,r.value=null},X=s=>{b.value=s,k.value=!0},Y=async()=>{if(b.value){I.value=!0;try{await de.deleteMessageApiV1MessagesMessageIdDelete({messageId:b.value.id}),k.value=!1,b.value=null,S()}catch(s){console.error(s),x("Failed to delete message","error")}finally{I.value=!1}}};return(s,i)=>(H(),ee(ct,{fluid:""},{default:a(()=>[e(z,{class:"mb-6"},{default:a(()=>[e(v,{cols:"12"},{default:a(()=>[n("div",ft,[n("div",null,[n("h1",ht,o(s.$t("messages.title")),1),n("p",yt,o(s.$t("messages.description")),1)]),e(_,{color:"primary",icon:s.$vuetify.display.xs,onClick:S,loading:w.value},{default:a(()=>[e(R,{icon:"mdi-refresh"}),n("span",bt,o(s.$t("common.refresh")),1)]),_:1},8,["icon","loading"])])]),_:1})]),_:1}),e(z,{class:"mb-4"},{default:a(()=>[e(v,{cols:"12"},{default:a(()=>[e(W,{class:"card-outlined"},{default:a(()=>[e(J,null,{default:a(()=>[e(z,{align:"center"},{default:a(()=>[e(v,{cols:"12",md:"3"},{default:a(()=>[e(te,{modelValue:p.value,"onUpdate:modelValue":i[0]||(i[0]=l=>p.value=l),"prepend-inner-icon":"mdi-magnify",label:s.$t("messages.searchByKeywords"),"hide-details":"",clearable:"","onClick:clear":S},null,8,["modelValue","label"])]),_:1}),e(v,{cols:"12",md:"3"},{default:a(()=>[e(te,{modelValue:y.value,"onUpdate:modelValue":i[1]||(i[1]=l=>y.value=l),"prepend-inner-icon":"mdi-identifier",label:s.$t("messages.searchByIdentifier"),"hide-details":"",clearable:""},null,8,["modelValue","label"])]),_:1}),e(v,{cols:"12",md:"3"},{default:a(()=>[e(te,{modelValue:P.value,"onUpdate:modelValue":i[2]||(i[2]=l=>P.value=l),"prepend-inner-icon":"mdi-filter-variant",label:s.$t("messages.filterByGetter"),"hide-details":"",clearable:""},null,8,["modelValue","label"])]),_:1}),e(v,{cols:"12",md:"3"},{default:a(()=>[e(_,{block:"",color:"primary",variant:"tonal",onClick:S},{default:a(()=>[f(o(s.$t("common.apply")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(z,null,{default:a(()=>[e(v,{cols:"12"},{default:a(()=>[e(W,{class:"card-outlined"},{default:a(()=>[g.value?(H(),ee(J,{key:0,class:"pa-0"},{default:a(()=>[e(Qe,{text:s.$t("messages.loadingMessages")},null,8,["text"])]),_:1})):le("",!0),Fe(e(vt,{"items-per-page":V.value,"onUpdate:itemsPerPage":i[3]||(i[3]=l=>V.value=l),headers:d.value,items:h.value,"items-length":$.value,loading:w.value,"onUpdate:options":L,"items-per-page-text":s.$t("common.itemsPerPage"),"items-per-page-options":[10,25,50,100],class:"elevation-0"},{"item.ts":a(({item:l})=>[n("div",_t,[e(R,{icon:"mdi-clock-outline",size:"small",class:"mr-2 text-medium-emphasis"}),n("span",null,o(M(l.ts)),1)])]),"item.getter_name":a(({item:l})=>[e(ge,{size:"small",color:"secondary",variant:"tonal",label:""},{default:a(()=>[f(o(l.getter_name),1)]),_:2},1024)]),"item.message_identifier":a(({item:l})=>[n("div",{class:"text-truncate text-no-wrap",style:{"max-width":"300px"},title:l.message_identifier},o(l.message_identifier),9,xt)]),"item.content":a(({item:l})=>[n("div",{class:"text-truncate",title:A(l)},o(A(l)),9,wt)]),"item.actions":a(({item:l})=>[n("div",kt,[e(_,{icon:"mdi-eye-outline",variant:"text",size:"small",color:"primary",onClick:C=>G(l)},null,8,["onClick"]),e(_,{icon:"mdi-delete-outline",variant:"text",size:"small",color:"error",onClick:C=>X(l)},null,8,["onClick"])])]),"no-data":a(()=>[n("div",Vt,[e(R,{icon:"mdi-message-text-outline",size:"64",color:"medium-emphasis",class:"mb-4"}),n("div",Pt,o(s.$t("messages.noMessagesFound")),1),n("div",St,o(s.$t("messages.tryAdjustingFilters")),1)])]),_:1},8,["items-per-page","headers","items","items-length","loading","items-per-page-text"]),[[Ne,!g.value]])]),_:1})]),_:1})]),_:1}),e(ve,{modelValue:T.value,"onUpdate:modelValue":i[4]||(i[4]=l=>T.value=l),"max-width":"800px",scrollable:"",fullscreen:s.$vuetify.display.smAndDown},{default:a(()=>[e(W,{rounded:s.$vuetify.display.smAndDown?"0":"xl"},{default:a(()=>[e(ne,{class:"d-flex align-center pa-4"},{default:a(()=>[e(R,{icon:"mdi-message-text",class:"mr-2"}),f(" "+o(s.$t("messages.messageDetails"))+" ",1),e(ae),e(_,{icon:"mdi-close",variant:"text",size:"small",onClick:O})]),_:1}),e(K),r.value?(H(),ee(J,{key:0,class:"pa-4"},{default:a(()=>[e(z,null,{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[n("div",Ct,o(s.$t("messages.messageId")),1),n("div",Dt,o(r.value.id),1)]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[n("div",$t,o(s.$t("messages.source")),1),e(ge,{size:"small",color:"secondary",variant:"tonal",label:""},{default:a(()=>[f(o(r.value.getter_name),1)]),_:1})]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[n("div",Tt,o(s.$t("messages.messageIdentifier")),1),n("div",It,o(r.value.message_identifier),1)]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[n("div",Bt,o(s.$t("messages.timestamp")),1),n("div",Ft,o(M(r.value.ts)),1)]),_:1})]),_:1}),e(K,{class:"my-4"}),n("div",Nt,o(s.$t("messages.content")),1),e(pe,{color:"surface-light",rounded:"lg",class:"pa-4 mb-4"},{default:a(()=>[E(r.value)?(H(),oe("div",Ht,o(E(r.value)),1)):(H(),oe("div",Rt,o(s.$t("messages.noTextContent")),1))]),_:1}),n("div",zt,[i[7]||(i[7]=n("div",{class:"text-subtitle-2 font-weight-bold"},"JSON",-1)),e(_,{size:"small",variant:"tonal","prepend-icon":"mdi-content-copy",onClick:Q},{default:a(()=>[f(o(s.$t("common.copy")),1)]),_:1})]),e(pe,{color:"surface-light",rounded:"lg",class:"pa-4 overflow-auto",style:{"max-height":"300px"}},{default:a(()=>[n("pre",Mt,o(JSON.stringify(r.value.content,null,2)),1)]),_:1})]),_:1})):le("",!0),e(K),e(ie,{class:"pa-2 pa-sm-4"},{default:a(()=>[e(ae),e(_,{variant:"tonal",onClick:O},{default:a(()=>[f(o(s.$t("common.close")),1)]),_:1})]),_:1})]),_:1},8,["rounded"])]),_:1},8,["modelValue","fullscreen"]),e(ve,{modelValue:k.value,"onUpdate:modelValue":i[6]||(i[6]=l=>k.value=l),"max-width":"400px",persistent:""},{default:a(()=>[e(W,{rounded:"xl"},{default:a(()=>[e(ne,{class:"d-flex align-center pa-4"},{default:a(()=>[e(R,{icon:"mdi-alert-circle",color:"error",class:"mr-2"}),f(" "+o(s.$t("messages.confirmDeleteTitle")),1)]),_:1}),e(J,null,{default:a(()=>[f(o(s.$t("messages.confirmDelete")),1)]),_:1}),e(ie,{class:"pa-4"},{default:a(()=>[e(ae),e(_,{variant:"text",onClick:i[5]||(i[5]=l=>k.value=!1)},{default:a(()=>[f(o(s.$t("common.cancel")),1)]),_:1}),e(_,{color:"error",variant:"tonal",onClick:Y,loading:I.value},{default:a(()=>[f(o(s.$t("common.delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Xt=Ke(Lt,[["__scopeId","data-v-35486085"]]);export{Xt as default};
