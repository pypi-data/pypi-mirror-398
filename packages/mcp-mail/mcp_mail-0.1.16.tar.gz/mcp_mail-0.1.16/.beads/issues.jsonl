{"id":"MCP-5h4","content_hash":"058edcab16c474ffe9114edf87e2d2c5ba0993ee2557bd11f5f280506fb4edfa","title":"Slack mirror subject fallback for empty messages","description":"Empty/whitespace Slack messages produce blank subjects (e.g., \"[Slack] \"). Add fallback subject (e.g., \"Empty message\") after trimming whitespace.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-11-28T23:34:52.92299-08:00","updated_at":"2025-11-29T00:08:26.616267-08:00","closed_at":"2025-11-29T00:08:26.616267-08:00","source_repo":"."}
{"id":"MCP-6dw","content_hash":"4d40b8fc0030078fd453c44e9060eeca31502a8d8f927ca37e1735d1c6633d51","title":"BUG: MCP send_message resolves recipients across projects with same name","description":"During REAL_CLAUDE_MULTI_AGENT_TEST via Codex CLI, send_message routed messages to agents with the same name in a different project. SQLite for project /tmp/real_codex_test_project_20251129_005916 (project_id=8) shows recipients with agent_ids 16/17 (from project_id=6) instead of current agents 22/23/24. fetch_inbox for new agents misses messages. Need to fix recipient resolution logic to respect project scoping or clarify the intended global scoping and enforce consistent delivery.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-11-29T01:14:37.492053-08:00","updated_at":"2025-11-29T01:14:37.492053-08:00","source_repo":"."}
{"id":"MCP-6fi","content_hash":"b255ccdbaa54ac2ea18d61e2a97a0ca17cbc964cab5dd0f92092ce0c12f7b3c0","title":"Slack body truncation exceeds limit when adding suffix","description":"When truncating Slack body to 3000 chars, code slices 3000 then appends a 26-char suffix, yielding up to 3026 chars. Slack section text limit can be exceeded. Adjust slice to account for suffix length.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-28T23:34:55.619134-08:00","updated_at":"2025-11-29T00:08:29.723884-08:00","closed_at":"2025-11-29T00:08:29.723884-08:00","source_repo":"."}
{"id":"MCP-b5g","content_hash":"ce7900dd5c6567537258d5e26c50fd51657354c1aa1f79d303362d3bd028b017","title":"Slack integration tests bypass /slack/events webhook path","description":"Current Slack integration tests write directly to .mcp_mail/messages.jsonl rather than POSTing to /slack/events with signatures. They do not exercise webhook verification, DB message creation, thread mapping, or error handling. Add true webhook integration tests (or clearly rename scope) that hit /slack/events with signed payloads and assert DB/archive/thread behavior.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-28T23:34:59.644572-08:00","updated_at":"2025-11-29T00:08:34.271831-08:00","closed_at":"2025-11-29T00:08:34.271831-08:00","source_repo":"."}
{"id":"MCP-b9x","content_hash":"414ca6ed86693d90f81579a19137b85ef0dc714ba128e5e731bb77a7382fb806","title":"Extended MCP tools not registered in app -\u003e ToolError Unknown tool create_file_reservation","description":"E2E workflow tests report fastmcp.exceptions.ToolError: Unknown tool: create_file_reservation (and other extended tools like acquire_build_slot). Regression likely from refactor/cherry-pick: tools exist in _EXTENDED_TOOL_REGISTRY but are not registered on the FastMCP server in src/mcp_agent_mail/app.py. Result: build slots/file reservations unavailable; tests fail (tests/test_e2e_workflows.py). Need to rewire registration/decorators so all extended tools are exposed.","acceptance_criteria":"All extended tools in _EXTENDED_TOOL_REGISTRY are registered and callable via MCP; e2e workflow tests pass without Unknown tool errors; manual invocation of create_file_reservation succeeds.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T22:09:54.114393-08:00","updated_at":"2025-12-17T22:09:54.114393-08:00","source_repo":"."}
{"id":"MCP-e1b","content_hash":"89b49516527c8a29ee0da1d1a35758398a489ea3fe5d50fd3a5737f6c3182ed6","title":"Guard pre-commit hook not blocking violations in e2e Guard lifecycle test","description":"tests/test_e2e_workflows.py::test_e2e_guard_lifecycle now fails because the guard pre-commit hook exits 0 (allows commit) instead of 1 when a violation is present. Likely regression in guard.py handling of WORKTREES_ENABLED/worktree path resolution or staged diff parsing after recent refactors. Need to reproduce under test harness and restore failure behavior when conflicts detected.","acceptance_criteria":"Guard lifecycle e2e test passes; guard pre-commit hook returns non-zero on violations; manual simulation confirms block when staged conflicts exist; no false positives in clean state.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-17T22:10:02.017067-08:00","updated_at":"2025-12-17T22:10:02.017067-08:00","source_repo":"."}
{"id":"MCP-fq5","content_hash":"5c31335d231e5c83beeae07b70e4120c5a1d8cee207a5df85c33421984def7f2","title":"CRITICAL: Database session bug in _ensure_project() blocks agent registration","description":"Location: app.py:674-702 in _ensure_project()\n\nSymptom: InvalidRequestError: Could not refresh instance\n\nRoot Cause: _ensure_project() opens a database session and calls _ensure_global_inbox_agent(project) which opens a NESTED session. The project object becomes detached from the inner session causing SQLAlchemy errors.\n\nImpact: PRODUCTION BLOCKING - Prevents agent registration in multi-agent scenarios\n\nIntroduced: Commit 8ec673f (2025-11-09) 'Add global inbox with TTL auto-deletion'\n\nEvidence: Test 3 Agent 2 failure in /tmp/real_claude_multiagent_20251118_193652/outputs/agent2_output.txt\n\nFix Required:\n1. Pass session to _ensure_global_inbox_agent() OR\n2. Accept project_id instead of project object to avoid detached instance\n\nPriority: URGENT - Blocks Test 3 completion and production use","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-18T20:20:22.634052-08:00","updated_at":"2025-11-18T20:38:11.023347-08:00","closed_at":"2025-11-18T20:38:11.023347-08:00","source_repo":".","labels":["bug","critical","production-blocking"]}
{"id":"MCP-ods","content_hash":"c6dbe0ad14c4640c69a28f652cfffce5e95f7459390fe36296730ed3c326d453","title":"Inbound Slack thread mapping not persisted to SlackClient","description":"Webhook handler creates MCP messages with thread_id like slack_{channel}_{thread_ts} but does not call SlackClient.map_thread(), so outbound replies won’t land in the original Slack thread. Add mapping when processing inbound Slack events.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-28T23:34:49.47293-08:00","updated_at":"2025-11-29T00:08:22.795967-08:00","closed_at":"2025-11-29T00:08:22.795967-08:00","source_repo":"."}
{"id":"MCP-szt","content_hash":"538060f0c47013c56ec4a90cdeb9283af3ea7e75ffb2b0063fdaa1a46b6b9cb1","title":"SlackClient methods unreachable (mis-indented in slack_integration.py)","description":"SlackClient’s core methods (_check_client, _call_api, post_message, upload_file, add_reaction, list_channels, get_channel_info, get_permalink, map_thread, get_slack_thread, get_mcp_thread_id, verify_signature) are currently nested inside mirror_message_to_slack after a return. They’re unreachable at runtime, so Slack API calls will raise AttributeError. Fix by re-indenting methods into the SlackClient class and ensuring imports/usage are correct.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-28T23:34:45.970741-08:00","updated_at":"2025-11-29T00:08:19.552134-08:00","closed_at":"2025-11-29T00:08:19.552134-08:00","source_repo":"."}
{"id":"MCP-w04","content_hash":"62bedcef7352e9785fee426ffde4a2d439acea6d32e470f5e872086424a3036b","title":"Slack webhook ingestion fails when multiple projects receive events (SlackBridge name uniqueness)","description":"Slack Events ingestion now looks up/creates the SlackBridge agent scoped to the resolved project (src/mcp_agent_mail/http.py _ingest_slack_bridge_message). The agents table enforces a global unique index on name (uq_agents_name_ci), so the second project that ingests a Slack event hits IntegrityError UNIQUE constraint failed: index 'uq_agents_name_ci' and the request returns 500. Repro: uv run pytest tests/integration/test_slack_webhook_api.py::test_slack_webhook_records_thread_mapping_for_top_level. Impact: any deployment with Slack enabled for more than one project will break after the first SlackBridge is created; Slack replies never ingested. Likely fixes: revert to global lookup (previous _get_agent_by_name_optional) or use a globally unique sender name (e.g., SlackBridge/\u003cproject.slug\u003e) when creating the bridge agent.","acceptance_criteria":"Slack webhook ingestion succeeds across multiple projects without IntegrityError; automated test covering multiple-project Slack ingestion passes; global uniqueness constraint respected.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T22:09:47.758607-08:00","updated_at":"2025-12-17T22:09:47.758607-08:00","source_repo":"."}
{"id":"MCP-xr3","content_hash":"50116f6a729bd94c4f5d9b4601d319a66b4374e5c209266a745b87003e5d7637","title":"Build Slack bot integration for MCP Mail (bidirectional)","description":"Implement a Slack app (bot) integration for MCP Mail to support Slack -\u003e MCP ingest and MCP -\u003e Slack messaging.\n\nScope:\n- Use Slack Web API + Events API with bot token and signing secret.\n- Verify Slack requests (signing secret) and handle `message.*` events (channels, groups, im, mpim), including threads via `thread_ts`, mapping to MCP `thread_id`.\n- Outbound: use bot token to post messages and thread replies to Slack channels; plan migration away from incoming webhook.\n- Optional slash command `/mcp-mail` to send MCP messages from Slack with project/thread/recipients.\n- Config: env vars `SLACK_BOT_TOKEN`, `SLACK_SIGNING_SECRET`, channel allowlist, event endpoint URL; support public tunnel (ngrok/Cloudflare) or deployed URL.\n- Tests: integration-style tests for Slack event ingestion and outbound posting (mock Slack API).","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-28T21:43:32.388709-08:00","updated_at":"2025-11-28T21:43:32.388709-08:00","source_repo":"."}
