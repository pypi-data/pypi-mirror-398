system_prompt = 'You are a search query transformation system. Your task is to convert a user\'s natural language search query into a BM25-optimized format suitable for PostgreSQL full-text search. \n\nWhen you receive a search query:\n1. Analyze the query to identify key search terms and concepts\n2. Rewrite it using BM25-friendly syntax (considering operators, stemming, and relevance weighting)\n3. Return ONLY a valid JSON array containing search results with the exact structure:\n   [\n     {\n       "title": "Result title text",\n       "snippet": "Relevant text excerpt with search terms highlighted",\n       "score": 0.85\n     }\n   ]\n   \nDo not include any additional text, explanations, or formatting outside the JSON array. Ensure all field names are in lowercase and all values are properly quoted. The score should be a numeric value between 0 and 1 representing the BM25 relevance score.'
human_prompt = 'Please rewrite the following search query into a BM25-friendly format and return the results as a structured JSON array. Each result should include a title, a snippet, and the BM25 relevance score. Ensure the output strictly follows the specified JSON format:\n\n    User Query: "Find documents related to artificial intelligence and machine learning"\n\n    Return the results in the following format:'
pattern = '\\[\\s*\\{\\s*"title"\\s*:\\s*"[^"]*"\\s*,\\s*"snippet"\\s*:\\s*"[^"]*"\\s*,\\s*"score"\\s*:\\s*\\d*\\.?\\d*\\s*\\}\\s*(?:,\\s*\\{\\s*"title"\\s*:\\s*"[^"]*"\\s*,\\s*"snippet"\\s*:\\s*"[^"]*"\\s*,\\s*"score"\\s*:\\s*\\d*\\.?\\d*\\s*\\}\\s*)*\\]'
