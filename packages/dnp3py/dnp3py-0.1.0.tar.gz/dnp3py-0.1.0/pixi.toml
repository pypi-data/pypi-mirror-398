[workspace]
name = "dnp3py"
version = "0.1.0"
description = "Pure Python DNP3 implementation (IEEE 1815-2012)"
channels = ["conda-forge"]
platforms = ["linux-64", "osx-arm64", "win-64"]

[dependencies]
pip = "*"
pytest = ">=8.0"
pytest-asyncio = ">=0.23"
pytest-cov = ">=4.0"
hypothesis = ">=6.0"
mypy = ">=1.8"
ruff = ">=0.8"
nox = ">=2024.0"
pre-commit = ">=4.0"

[tasks]
dev-install = "pip install -e ."
test = "pytest tests/ -v"
test-unit = "pytest tests/unit/ -v"
test-integration = "pytest tests/integration/ -v"
test-cov = "pytest tests/ --cov=src/dnp3 --cov-report=html --cov-fail-under=95"
lint = "ruff check src/ tests/"
format = "ruff format src/ tests/"
format-check = "ruff format --check src/ tests/"
typecheck = "mypy src/"
check = { depends-on = ["lint", "format-check", "typecheck"] }
pre-commit-install = "pre-commit install"
test-all = { depends-on = ["test-py311", "test-py312", "test-py313", "test-py314"] }

# Per-environment test tasks
test-py311 = { cmd = "pytest tests/ -v", depends-on = ["dev-install"] }
test-py312 = { cmd = "pytest tests/ -v", depends-on = ["dev-install"] }
test-py313 = { cmd = "pytest tests/ -v", depends-on = ["dev-install"] }
test-py314 = { cmd = "pytest tests/ -v", depends-on = ["dev-install"] }

# Python version features
[feature.py311.dependencies]
python = "3.11.*"

[feature.py312.dependencies]
python = "3.12.*"

[feature.py313.dependencies]
python = "3.13.*"

[feature.py314.dependencies]
python = "3.14.*"

# Environments
[environments]
default = { features = ["py314"], solve-group = "default" }
py311 = { features = ["py311"], solve-group = "py311" }
py312 = { features = ["py312"], solve-group = "py312" }
py313 = { features = ["py313"], solve-group = "py313" }
py314 = { features = ["py314"], solve-group = "py314" }
