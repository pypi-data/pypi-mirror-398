[tox]
# Note: mutate is excluded from default env_list because mutmut requires
# source files in the working directory (not from installed package).
# Run mutation testing separately with: uv run mutmut run
env_list = py{311,312,313,314}, format, lint, type
isolated_build = true
min_version = 4.0

[testenv]
description = Run tests with pytest
deps =
    pytest>=8.0
    pytest-asyncio>=0.23
    pytest-benchmark>=5.0
    mypy>=1.8
commands =
    pytest {posargs:tests}

[testenv:cov]
description = Run tests with coverage
deps =
    pytest>=8.0
    pytest-asyncio>=0.23
    pytest-cov>=4.1
commands =
    pytest --cov=dioxide --cov-report=term-missing --cov-report=html --cov-report=xml {posargs:tests}

[testenv:format]
description = Run code formatters
skip_install = true
deps =
    ruff>=0.1
    isort>=5.13
commands =
    ruff format python tests
    isort python tests

[testenv:lint]
description = Run linters
skip_install = true
deps =
    ruff>=0.1
    isort>=5.13
commands =
    ruff check python tests
    isort --check-only python tests

[testenv:type]
description = Run type checking
deps =
    mypy>=1.8
    pytest>=8.0
commands =
    mypy python tests

[testenv:mutate]
description = Run mutation testing
deps =
    pytest>=8.0
    pytest-asyncio>=0.23
    mutmut>=3.2
commands =
    mutmut run

[testenv:all]
description = Run all quality checks
deps =
    pytest>=8.0
    pytest-asyncio>=0.23
    pytest-cov>=4.1
    ruff>=0.1
    isort>=5.13
    mypy>=1.8
commands =
    ruff format python tests
    isort python tests
    ruff check python tests
    isort --check-only python tests
    mypy python tests
    pytest --cov=dioxide --cov-report=term-missing {posargs:tests}
