# Typedown Intermediate Representation (IR)

The Typedown IR is a set of structured data models representing the semantic content of a project after parsing and link-resolution. It is the language-neutral representation used between the **Frontend (Parser)** and the **Backend (Spec Runner/Validator)**.

## 1. Node Hierarchy

All IR nodes inherit from a base `Node` class.

### 1.1 Base Node

| Field      | Type                       | Description                                       |
| :--------- | :------------------------- | :------------------------------------------------ |
| `id`       | `Optional[str]`            | The unique identifier for this symbol.            |
| `location` | `Optional[SourceLocation]` | File path and line range for diagnostics and LSP. |

## 2. Semantic Nodes

### 2.1 EntityDef

Represents a data instance.

- **Payload**: `data: Dict[str, Any]` (The YAML-parsed content).
- **Type**: `type_name: str`.

### 2.2 ModelDef

Represents a Pydantic/Python model block.

- **Payload**: `code: str`.

### 2.3 SpecDef

Represents a testing/validation block.

- **Payload**: `code: str` (Python) or `data: Dict` (YAML).
- **Name**: `name: str`.

### 2.4 ImportStmt

Represents a virtual or physical import.

- **Source**: `source: str` (e.g., `@lib.math`).
- **Names**: `List[str]` (Symbols imported).

## 3. Document

A `Document` is the root container for a single physical file.

- **Path**: `Path`.
- **Collections**: `imports`, `models`, `entities`, `specs`, `references`.

## 4. Symbol Table

The **Compiler** maintains a global Symbol Table (Map of `ID -> Node`).

- All `EntityDef`, `ModelDef`, and `SpecDef` nodes with an `id` are registered here.
- The `Evaluator` uses this table to resolve `[[ID]]` queries.
