Metadata-Version: 2.4
Name: rpa-moodle
Version: 2.0.0
Summary: RPA library for Moodle automation with Robot Framework
Author-email: Khanh <khanh@example.com>
License-Expression: MIT
Project-URL: Homepage, https://github.com/khanh/rpa-moodle
Project-URL: Documentation, https://github.com/khanh/rpa-moodle#readme
Project-URL: Repository, https://github.com/khanh/rpa-moodle
Project-URL: Issues, https://github.com/khanh/rpa-moodle/issues
Keywords: robotframework,moodle,automation,rpa,testing,web-services,gemini-ai,auto-grading
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Software Development :: Testing
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Framework :: Robot Framework
Classifier: Framework :: Robot Framework :: Library
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: requests>=2.31.0
Requires-Dist: pandas>=2.0.0
Requires-Dist: openpyxl>=3.1.0
Requires-Dist: robotframework>=6.0.0
Requires-Dist: google-auth>=2.0.0
Requires-Dist: google-auth-oauthlib>=1.0.0
Requires-Dist: google-api-python-client>=2.0.0
Requires-Dist: google-generativeai>=0.3.0
Requires-Dist: pillow>=10.0.0
Requires-Dist: importlib-metadata>=6.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: flake8>=6.0.0; extra == "dev"
Dynamic: license-file

# RPA.Moodle Library

ThÆ° viá»‡n Robot Framework Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a cÃ¡c tÃ¡c vá»¥ Moodle, bao gá»“m quáº£n lÃ½ khÃ³a há»c, ngÆ°á»i dÃ¹ng, vÃ  **cháº¥m Ä‘iá»ƒm tá»± Ä‘á»™ng báº±ng Gemini AI**.

## ğŸš€ TÃ­nh nÄƒng chÃ­nh

### 1. **Quáº£n lÃ½ KhÃ³a há»c & NgÆ°á»i dÃ¹ng**
- Táº¡o categories, courses, users
- Enroll users vÃ o courses
- Bulk enrollment tá»« Excel

### 2. **Quáº£n lÃ½ Quiz & CÃ¢u há»i**
- Táº¡o quiz tá»« Google Docs
- Import cÃ¢u há»i GIFT/XML
- Upload quiz lÃªn Google Drive

### 3. **ğŸ¯ Cháº¥m Ä‘iá»ƒm Tá»± Ä‘á»™ng (Auto Grading)**
- **Cháº¥m Ä‘iá»ƒm tá»« text** - Gemini AI 1.5-flash
- **Cháº¥m Ä‘iá»ƒm tá»« áº£nh** - Gemini Vision API
- **Upload tá»± Ä‘á»™ng lÃªn Moodle** - Táº¡o submissions & grades
- **Export Excel/CSV** - Káº¿t quáº£ chi tiáº¿t

---

## ğŸ“¦ CÃ i Ä‘áº·t

```bash
pip install -e .
```

### Dependencies:
```bash
pip install robotframework requests pandas openpyxl google-api-python-client google-generativeai pillow
```

---

## ğŸ”§ Cáº¥u hÃ¬nh

### 1. Moodle Token
Táº¡o file `moodle_token.json`:
```json
{
    "base_url": "http://your-moodle.com/",
    "token": "your_web_service_token"
}
```

### 2. Google Credentials
Táº¡o file `credentials.json` tá»« Google Cloud Console, sau Ä‘Ã³ cháº¡y:
```bash
python get_google_token.py
```

### 3. Gemini API Key
Láº¥y API key tá»« https://makersuite.google.com/app/apikey

---

## ğŸ“š HÆ°á»›ng dáº«n sá»­ dá»¥ng

### **Auto Grading Workflow (Cháº¥m Ä‘iá»ƒm tá»± Ä‘á»™ng)**

#### **A. Cháº¥m Ä‘iá»ƒm tá»« Text Files**

```robot
*** Settings ***
Library    RPA.Moodle

*** Variables ***
${MOODLE_TOKEN}          moodle_token.json
${GOOGLE_TOKEN}          google_token.json
${GEMINI_API_KEY}        your_gemini_api_key

# Google Drive URLs
${SUBMISSIONS_FOLDER}    https://drive.google.com/drive/folders/YOUR_FOLDER_ID
${QUESTIONS_FILE}        https://docs.google.com/document/d/YOUR_DOC_ID
${ANSWER_KEY_FILE}       https://docs.google.com/document/d/YOUR_DOC_ID

# Moodle settings
${COURSE_ID}             2
${ASSIGNMENT_URL}        http://moodle.com/mod/assign/view.php?id=23
${MAX_SCORE}             10.0

*** Test Cases ***
Complete Auto Grading Workflow
    # Setup connections
    Set Up Moodle Connection    ${MOODLE_TOKEN}
    Setup Google Connection     ${GOOGLE_TOKEN}
    Setup Gemini AI            ${GEMINI_API_KEY}
    
    # Extract IDs from URLs
    ${folder_id}=    Get Google Drive File ID From URL    ${SUBMISSIONS_FOLDER}
    ${questions_id}=    Get Google Drive File ID From URL    ${QUESTIONS_FILE}
    ${answer_id}=    Get Google Drive File ID From URL    ${ANSWER_KEY_FILE}
    ${cmid}=    Get Assignment ID From URL    ${ASSIGNMENT_URL}
    ${assignment_id}=    Get Assignment Instance ID From Course Module ID    ${COURSE_ID}    ${cmid}
    
    # Run complete workflow
    ${result}=    Complete Auto Grading And Upload Workflow
    ...    submissions_folder_id=${folder_id}
    ...    question_file_id=${questions_id}
    ...    answer_key_file_id=${answer_id}
    ...    course_id=${COURSE_ID}
    ...    assignment_id=${assignment_id}
    ...    max_score=${MAX_SCORE}
    
    # Export results
    Export Grading Results To Excel    ${result['grading']['results']}    grading_results.xlsx    ${MAX_SCORE}
    Export Grading Results To CSV      ${result['grading']['results']}    grading_results.csv     ${MAX_SCORE}
    
    Log    âœ… Graded: ${result['summary']['graded']}/${result['summary']['total_submissions']}
    Log    âœ… Uploaded: ${result['summary']['uploaded']}/${result['summary']['total_submissions']}
    Log    ğŸ“Š Average: ${result['summary']['average_score']}/${MAX_SCORE}
```

#### **B. Cháº¥m Ä‘iá»ƒm tá»« Images**

```robot
*** Test Cases ***
Grade Image Submissions
    # Setup
    Set Up Moodle Connection    ${MOODLE_TOKEN}
    Setup Google Connection     ${GOOGLE_TOKEN}
    Setup Gemini AI            ${GEMINI_API_KEY}
    
    # Grade images
    ${result}=    Complete Auto Grading From Images
    ...    submissions_folder_id=${IMAGE_FOLDER_ID}
    ...    question_file_id=${QUESTIONS_ID}
    ...    answer_key_file_id=${ANSWER_KEY_ID}
    ...    max_score=10.0
    
    # Upload to Moodle
    Upload Grades To Moodle    ${COURSE_ID}    ${ASSIGNMENT_ID}    ${result['results']}
```

---

## ğŸ“– Keywords Reference

### **Connection & Setup**

#### `Set Up Moodle Connection`
```robot
Set Up Moodle Connection    moodle_token.json
```

#### `Setup Google Connection`
```robot
Setup Google Connection    google_token.json
```

#### `Setup Gemini AI`
```robot
Setup Gemini AI    ${GEMINI_API_KEY}
```

---

### **Auto Grading Keywords**

#### `Complete Auto Grading Workflow`
Cháº¥m Ä‘iá»ƒm táº¥t cáº£ submissions tá»« Google Drive folder.

**Arguments:**
- `submissions_folder_id` - Google Drive folder ID chá»©a bÃ i lÃ m
- `question_file_id` - File ID cá»§a Ä‘á» bÃ i
- `answer_key_file_id` - File ID cá»§a Ä‘Ã¡p Ã¡n
- `max_score` - Äiá»ƒm tá»‘i Ä‘a (default: 10.0)

**Returns:** Dict vá»›i keys:
- `total_submissions` - Tá»•ng sá»‘ bÃ i ná»™p
- `graded` - Sá»‘ bÃ i Ä‘Ã£ cháº¥m
- `failed` - Sá»‘ bÃ i lá»—i
- `results` - List káº¿t quáº£ chi tiáº¿t
- `summary` - Thá»‘ng kÃª tá»•ng há»£p

#### `Complete Auto Grading From Images`
Cháº¥m Ä‘iá»ƒm tá»« áº£nh bÃ i lÃ m sá»­ dá»¥ng Gemini Vision.

**Arguments:** Giá»‘ng `Complete Auto Grading Workflow`

#### `Upload Grades To Moodle`
Upload grades lÃªn Moodle assignment (tá»± Ä‘á»™ng táº¡o submissions).

**Arguments:**
- `course_id` - Moodle course ID
- `assignment_id` - Assignment instance ID
- `grades` - List of grade dicts

**Returns:** Upload summary

#### `Export Grading Results To Excel`
Export káº¿t quáº£ ra Excel vá»›i 2 sheets (Results + Summary).

**Arguments:**
- `grading_results` - List káº¿t quáº£ cháº¥m Ä‘iá»ƒm
- `output_path` - ÄÆ°á»ng dáº«n file Excel
- `max_score` - Äiá»ƒm tá»‘i Ä‘a

#### `Export Grading Results To CSV`
Export káº¿t quáº£ ra CSV Ä‘á»ƒ import vÃ o Moodle Gradebook.

**Arguments:**
- `grading_results` - List káº¿t quáº£ cháº¥m Ä‘iá»ƒm
- `output_path` - ÄÆ°á»ng dáº«n file CSV
- `max_score` - Äiá»ƒm tá»‘i Ä‘a
- `grade_item_name` - TÃªn cá»™t Ä‘iá»ƒm (default: "Auto Grading")

---

### **Helper Keywords**

#### `Get Assignment ID From URL`
Parse assignment course module ID tá»« URL.

```robot
${cmid}=    Get Assignment ID From URL    http://moodle.com/mod/assign/view.php?id=23
# Returns: 23
```

#### `Get Assignment Instance ID From Course Module ID`
Convert course module ID sang assignment instance ID.

```robot
${instance_id}=    Get Assignment Instance ID From Course Module ID    2    23
# Returns: 1
```

#### `Get Google Drive File ID From URL`
Parse file/folder ID tá»« Google Drive URL.

```robot
${file_id}=    Get Google Drive File ID From URL    https://drive.google.com/file/d/ABC123/view
# Returns: ABC123
```

---

## ğŸ¯ Workflow Examples

### **Example 1: Cháº¥m Ä‘iá»ƒm vÃ  Upload lÃªn Moodle**

```robot
*** Test Cases ***
Auto Grade And Upload
    [Documentation]    Cháº¥m tá»± Ä‘á»™ng vÃ  upload Ä‘iá»ƒm lÃªn Moodle
    
    # Setup
    Set Up Moodle Connection    moodle_token.json
    Setup Google Connection     google_token.json
    Setup Gemini AI            ${GEMINI_KEY}
    
    # Extract IDs
    ${folder}=    Get Google Drive File ID From URL    ${FOLDER_URL}
    ${questions}=    Get Google Drive File ID From URL    ${QUESTIONS_URL}
    ${answers}=    Get Google Drive File ID From URL    ${ANSWERS_URL}
    
    # Grade
    ${result}=    Complete Auto Grading Workflow
    ...    ${folder}    ${questions}    ${answers}    10.0
    
    # Upload
    ${cmid}=    Get Assignment ID From URL    ${ASSIGNMENT_URL}
    ${assign_id}=    Get Assignment Instance ID From Course Module ID    2    ${cmid}
    Upload Grades To Moodle    2    ${assign_id}    ${result['results']}
    
    # Export
    Export Grading Results To Excel    ${result['results']}    grades.xlsx    10.0
```

### **Example 2: Bulk Enrollment**

```robot
*** Test Cases ***
Bulk Enroll Students
    Set Up Moodle Connection    moodle_token.json
    
    Complete Bulk Enrollment Workflow
    ...    students_file=students.xlsx
    ...    courses_file=courses.xlsx
```

---

## ğŸ“Š Output Files

### **Excel Output (`grading_results.xlsx`)**
- **Sheet 1: Grading Results**
  - Student Name
  - Score
  - Max Score
  - Percentage
  - Feedback (chi tiáº¿t tá»« Gemini AI)
  - File ID

- **Sheet 2: Summary**
  - Total Submissions
  - Average Score
  - Highest/Lowest Score
  - Pass Rate
  - Generated At

### **CSV Output (`grading_results.csv`)**
Format Ä‘á»ƒ import vÃ o Moodle Gradebook:
```csv
Email,Full Name,Username,Auto Grading
student001@example.com,Nguyen Van A,student001,10.0
student002@example.com,Tran Thi B,student002,9.0
```

---

## ğŸ”‘ Required Moodle Permissions

Web Service user cáº§n cÃ³ cÃ¡c quyá»n sau:

### **Web Service Functions:**
- `core_course_get_contents`
- `core_user_get_users_by_field`
- `mod_assign_save_grades`
- `mod_assign_save_grade`
- `gradereport_user_get_grade_items`

### **Capabilities:**
- `moodle/course:view`
- `moodle/user:viewdetails`
- `mod/assign:grade`
- `gradereport/user:view`

---

## ğŸ› Troubleshooting

### **Lá»—i: "Access control exception"**
â†’ ThÃªm quyá»n cho Web Service user

### **Lá»—i: "Can't find data record in database table assign"**
â†’ Assignment ID khÃ´ng Ä‘Ãºng, dÃ¹ng `Get Assignment Instance ID From Course Module ID`

### **Lá»—i: "User not found"**
â†’ Kiá»ƒm tra username/email trong Moodle

### **Lá»—i: "models/gemini-pro is not found"**
â†’ Gemini model cÅ©, code Ä‘Ã£ update sang `gemini-1.5-flash`

---

## ğŸ“ License

MIT License

## ğŸ‘¥ Contributors

- Auto Grading Workflow with Gemini AI
- Google Drive Integration
- Moodle Web Services Integration

---

## ğŸ”— Links

- [Moodle Web Services Documentation](https://docs.moodle.org/dev/Web_services)
- [Google Gemini AI](https://ai.google.dev/)
- [Robot Framework](https://robotframework.org/)

---

**Version:** 1.0.7  
**Last Updated:** 2025-12-26
