[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"

[project]
name = "uncms"
version = "0.0.14"
authors = [
    { name="Lewis Collard", email="lewiscollard@gmail.com" },
]
readme = "README.md"
description = "A CMS toolkit for Django emphasising simplicity, speed, and familiarity."
requires-python = ">=3.8"
classifiers = [
    "Development Status :: 3 - Alpha",
    "Framework :: Django :: 5.2",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: BSD License",
]

dependencies = [
    "Pillow",
    "sorl-thumbnail",
    "beautifulsoup4",
    "django>=5.2,<5.3",
    "django-watson",
    "django-reversion",
    "nh3>=0.2.15,<1",
    "python-magic>=0.4.15",
]

[project.optional-dependencies]
dev = [
    "black==25.12.0",
    "build==0.9.0",
    "flake8==7.3.0",
    "factory-boy==3.2.1",
    "isort==7.0.0",
    "Jinja2==3.1.3",
    "psycopg2",
    "pylint==4.0.4",
    "pytest==9.0.2",
    "pytest-cov==7.0.0",
    "pytest-django==4.5.2",
    "twine==5.1.1",
]

jinja2 = [
    "Jinja2>=3.1.3,<4",
]

testhelpers = [
    "factory-boy==3.3.3",
]

[project.urls]
"homepage" = "https://uncms.dev/"
"documentation" = "https://docs.uncms.dev/"
"repository" = "https://github.com/uncms-dev/uncms"

[tool.coverage.run]
omit = ["*/migrations/*"]
branch = true

[tool.coverage.report]
show_missing = true
fail_under = 100

[tool.isort]
profile = "black"

[tool.pytest.ini_options]
addopts = ["--create-db", "--no-migrations"]
# Turn warnings into errors
filterwarnings = [
    "error",
    # except this one from deep within Sorl :(
    "ignore:unclosed file:ResourceWarning",
]

[tool.pylint.main]
load-plugins = [
    "pylint.extensions.bad_builtin",
    "pylint.extensions.check_elif",
    "pylint.extensions.for_any_all",
]
persistent = false
jobs = 0
score = false

[tool.pylint."messages control"]
disable = [
  # You'll have a hard time making Django things with these enabled.
  "invalid-name",
  "unused-argument",
  # Let Black decide about code formatting.
  "line-too-long",
  # These options more often than not just force people to write docstrings
  # for the sake of writing docstrings. Write them when they are necessary.
  # Don't write them when it's self-explanatory.
  "missing-module-docstring",
  "missing-function-docstring",
  "missing-class-docstring",
  # "Class 'Page' has no 'id' member" * math.inf
  "no-member",
  # Use of _meta, _base_manager, etc is common in Django code.
  "protected-access",
  # This has too many false positives on migrations & such.
  "duplicate-code",
  # The following are annoying and arbitrary.
  "too-few-public-methods",
  "too-many-arguments",
  "too-many-ancestors",
  "too-many-instance-attributes",
  # ..and especially too-many-lines; in tests it is better to err on the side
  # of having all the tests of a module in one file, rather than have someone
  # have to guess the file organisation conventions.
  "too-many-lines",
  "too-many-public-methods",
  "too-many-branches",
  "too-many-locals",
  # probably a valid warning, but
  "consider-using-f-string",
  # pylint cannot see through model fields (it would be nice to use
  # pylint-django but it fails at linting Python *packages* which do not have
  # settings modules)
  "invalid-str-returned",
  # isort does this.
  "wrong-import-order",
]
enable = ["useless-suppression"]
defining-attr-methods = [
    # These are the defaults to prevent the "attribute-defined-outside-init"
    # warning.
    "__init__",
    "__new__",
    "setUp",
    "asyncSetUp",
    "__post_init__",
    # But we add this; Django's `dispatch` method is the conventional place to
    # set attributes on class-based views.
    "dispatch"
]

[tool.pylint.typecheck]
ignore-mixin-members = true
generated-members = ["objects"]

[tool.pylint.basic]
bad-functions = ["map", "filter", "apply", "input", "print"]
