# .github/workflows/docs.yml
name: Docs CI

# Run on push to main and on any pull request
on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:
  build-and-test-docs:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # Install the project and its "docs" dependencies
          pip install ".[docs]"

      # ----------------------------------------------------
      # Test 1: Build the docs (strict mode)
      # ----------------------------------------------------
      - name: Build Sphinx docs (with strict warnings)
        run: |
          # -W: Turn all warnings into errors
          # -b html: Build the HTML format
          # docs/ points to your source directory
          # docs/_build/html points to the output (can be anything)
          sphinx-build -W -b html docs/ docs/_build/html

      # ----------------------------------------------------
      # Test 2: Run doctests
      # ----------------------------------------------------
      - name: Run doctests
        run: |
          # This runs the doctest builder in Sphinx
          sphinx-build -b doctest docs/ docs/_build/doctest

      # ----------------------------------------------------
      # Test 3: Check links
      # ----------------------------------------------------
      - name: Check for broken links
        run: |
          # This runs the linkcheck builder in Sphinx
          # It will output a report of any broken links
          sphinx-build -b linkcheck docs/ docs/_build/linkcheck
