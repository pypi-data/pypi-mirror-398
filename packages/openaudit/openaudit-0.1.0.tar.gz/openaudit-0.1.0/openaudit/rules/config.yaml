rules:
  # .env Rules
  - id: "CONF_DEBUG_ENABLED"
    description: "Debug mode enabled in configuration"
    regex: "(?i)^\\s*DEBUG\\s*=\\s*(true|1|yes)"
    severity: "high"
    confidence: "high"
    category: "config"
    remediation: "Set DEBUG=False in production environments."

  - id: "CONF_DATABASE_URL_UNENCRYPTED"
    description: "Plaintext database URL detected"
    regex: "^\\s*DATABASE_URL\\s*=\\s*(postgres|mysql|mongodb)://"
    severity: "high"
    confidence: "high"
    category: "config"
    remediation: "Use encrypted secrets management or mask credentials."

  - id: "CONF_ENV_DEV_IN_PROD"
    description: "Development environment setting detected"
    regex: "(?i)^\\s*ENV\\s*=\\s*(dev|development)"
    severity: "medium"
    confidence: "high"
    category: "config"
    remediation: "Ensure this is not a production environment."

  # Dockerfile Rules
  - id: "DOCKER_USER_ROOT"
    description: "Container running as root"
    regex: "^\\s*USER\\s+root"
    severity: "high"
    confidence: "high"
    category: "infrastructure"
    remediation: "Create and switch to a non-root user."

  - id: "DOCKER_EXPOSE_ALL"
    description: "Exposing service on all interfaces (0.0.0.0)"
    regex: "^\\s*EXPOSE\\s+.*0\\.0\\.0\\.0"
    severity: "medium"
    confidence: "high"
    category: "infrastructure"
    remediation: "Bind to specific interfaces if possible."

  - id: "DOCKER_ADD_COPY_ALL"
    description: "Broad COPY instruction (COPY . /)"
    regex: "^\\s*COPY\\s+\\.\\s+/"
    severity: "low"
    confidence: "medium"
    category: "infrastructure"
    remediation: "Use .dockerignore and copy only necessary files."

  # Docker Compose Rules (Regex approximation for simple detection, can be refined with yaml parsing)
  - id: "COMPOSE_RESTART_ALWAYS"
    description: "Restart policy set to always"
    regex: "restart:\\s*always"
    severity: "low"
    confidence: "high"
    category: "infrastructure"
    remediation: "Consider 'on-failure' or specific restart policies."

  - id: "COMPOSE_PORT_EXPOSURE"
    description: "Port exposed to host (broad range)"
    regex: "\\s*-\\s*[\"']?0\\.0\\.0\\.0:"
    severity: "medium"
    confidence: "high"
    category: "infrastructure"
    remediation: "Bind ports to localhost (127.0.0.1) if external access is not required."
