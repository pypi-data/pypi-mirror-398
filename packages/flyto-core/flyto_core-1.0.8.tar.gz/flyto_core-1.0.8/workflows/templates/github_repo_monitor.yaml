# Level 1 Workflow Template: GitHub Repository Monitor
# Ready-to-use workflow for beginners
#
# Usage:
#   python -m cli.main workflows/templates/github_repo_monitor.yaml \
#     --param.owner=facebook \
#     --param.repo=react
#
# Required Environment Variables:
#   - GITHUB_TOKEN: GitHub personal access token (optional for public repos)
#   - SLACK_WEBHOOK_URL: Slack webhook URL for notifications

id: github_repo_monitor
name: GitHub Repository Monitor
version: 1.0.0
description: Monitor a GitHub repository and send daily digest to Slack
author: Flyto Core Team
license: MIT
level: 1  # Beginner-friendly template

tags:
  - github
  - monitor
  - digest
  - slack
  - developer

params:
  - name: owner
    type: string
    required: true
    label: Repository Owner
    description: GitHub username or organization
    placeholder: facebook

  - name: repo
    type: string
    required: true
    label: Repository Name
    description: GitHub repository name
    placeholder: react

  - name: include_issues
    type: boolean
    required: false
    default: true
    label: Include Open Issues
    description: Include recent open issues in the digest

steps:
  - id: get_repo_info
    module: api.github.get_repo
    params:
      owner: ${params.owner}
      repo: ${params.repo}

  - id: get_issues
    module: api.github.list_issues
    params:
      owner: ${params.owner}
      repo: ${params.repo}
      state: open
      per_page: 5
    when: ${params.include_issues}

  - id: format_digest
    module: data.text.template
    params:
      template: |
        üìä *GitHub Repository Digest*

        *Repository:* ${get_repo_info.full_name}
        *Description:* ${get_repo_info.description}

        üìà *Statistics:*
        ‚Ä¢ ‚≠ê Stars: ${get_repo_info.stargazers_count}
        ‚Ä¢ üç¥ Forks: ${get_repo_info.forks_count}
        ‚Ä¢ üëÄ Watchers: ${get_repo_info.watchers_count}
        ‚Ä¢ üêõ Open Issues: ${get_repo_info.open_issues_count}

        üîó URL: ${get_repo_info.html_url}

        _Generated by Flyto Core_

  - id: notify_slack
    module: notification.slack.send_message
    params:
      text: ${format_digest.result}
    on_error: continue

output:
  repository:
    name: ${get_repo_info.full_name}
    stars: ${get_repo_info.stargazers_count}
    forks: ${get_repo_info.forks_count}
    issues: ${get_repo_info.open_issues_count}
  notification_sent: ${notify_slack.sent}
