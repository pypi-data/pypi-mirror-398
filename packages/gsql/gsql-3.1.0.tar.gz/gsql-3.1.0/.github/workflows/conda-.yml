
name: ğŸ“¦ Publication Anaconda

on:
  push:
    branches: [main]

jobs:
  publish-conda:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash -el {0}  # Active Conda pour TOUTES les Ã©tapes

    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ Setup Miniconda
        uses: conda-incubator/setup-miniconda@v3
        with:
          auto-activate-base: true
          miniconda-version: "latest"
          # 'activate-environment' est laissÃ© vide pour utiliser 'base'
          activate-environment: ""

      - name: ğŸ“¦ Installer outils
        run: |
          conda install -y conda-build anaconda-client

      - name: ğŸ—ï¸ Construire le package
        run: |
          conda build conda.recipe/ --output-folder ./output

      - name: ğŸš€ Publier sur Anaconda
        run: |
          PKG=$(find ./output -name "*.conda" -o -name "*.tar.bz2" | head -1)
          anaconda -t ${{ secrets.ANACONDA_TOKEN }} upload --user gopu-inc "$PKG"
