---
# sing-box 安装模式: [mixed, local, gateway]
# mixed: 仅安装并启用 mixed port, 不配置透明代理, 需要额外配置 system proxy
# local: 本地透明代理, 不代理内网中其它主机的流量
# gateway: 用作透明代理网关, 这也是目前的默认行为
sing_box_mode: gateway

# 基于模式自动计算的特性开关 (内部使用, 不要手动修改)
_sing_box_enable_tproxy: "{{ sing_box_mode in ['local', 'gateway'] }}"
_sing_box_enable_nftables: "{{ sing_box_mode in ['local', 'gateway'] }}"
_sing_box_enable_ip_forward: "{{ sing_box_mode == 'gateway' }}"
_sing_box_enable_netplan_routing: "{{ sing_box_mode in ['local', 'gateway'] }}"

# https://wiki.debian.org/SystemGroups#Groups_with_an_associated_user
# proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
proxy_user:
  name: proxy
  uid: 13
  home: /bin
  shell: /usr/sbin/nologin
proxy_group:
  name: proxy
  gid: 13

# 对应 sing-box 中 type = mixed 的 inbounds
sing_box_mixed_port: 7890

# 对应 sing-box 中 type = tproxy 的 inbounds
sing_box_tproxy_port: 7895

# ip -f inet rule add fwmark $PROXY_MARK lookup $PROXY_ROUTE_TABLE
# ip -f inet route add local default dev $INTERFACE table $PROXY_ROUTE_TABLE
# echo "224 sing_box_tproxy" | sudo tee /etc/iproute2/rt_tables.d/sing_box_tproxy.conf >/dev/null
sing_box_proxy_route_table: 224
sing_box_proxy_mark: 224

# 对应 sing-box 配置项 route.default_mark
sing_box_route_default_mark: 225

sing_box_etc_dir: /etc/sing-box
sing_box_log_dir: /var/log/sing-box
sing_box_state_dir: /var/lib/sing-box
sing_box_venv_dir: "{{ sing_box_state_dir }}/.venv"
sing_box_config_dir: "{{ sing_box_state_dir }}/config"

# 覆盖 sing-box-config-updater 的 systemd timer 与 systemd service 状态
# 用于应对当前大多数"服务商"开始订阅链接强制"阅后即焚"
# choices: [reloaded, restarted, started, stopped]
sing_box_config_updater_timer_enabled: true
sing_box_config_updater_timer_interval: 1d
sing_box_config_updater_timer_state: started
sing_box_config_updater_service_state: started

# ansible.builtin.systemd_service active state
sing_box_config_updater_service_active_state: ['started', 'restarted']
