name: audit
format: plain
pattern: |
  type=$type msg=audit($epoch:$serial): $fields

fields:
  type:
    type: choice
    values: ["SYSCALL", "EXECVE", "PATH", "CWD", "PROCTITLE", "USER_AUTH", "USER_ACCT", "CRED_ACQ", "USER_START", "USER_END", "USER_LOGIN", "USER_CMD", "SERVICE_START", "SERVICE_STOP", "AVC", "NETFILTER_CFG"]
    weights: [0.20, 0.12, 0.15, 0.08, 0.10, 0.06, 0.04, 0.04, 0.03, 0.03, 0.03, 0.02, 0.03, 0.03, 0.02, 0.02]

  epoch:
    type: timestamp
    step: 100ms
    jitter: 50ms
    format: "%s"
    tz: UTC

  serial:
    type: int
    min: 1
    max: 9999

  fields:
    type: choice
    values:
      - "arch=c000003e syscall=59 success=yes exit=0 a0=55b8c7f8d6e0 a1=55b8c7f8d7a0 a2=55b8c7f91470 a3=7ffd8e3c2e40 items=2 ppid=12846 pid=12847 auid=1000 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=1234 comm=\"sudo\" exe=\"/usr/bin/sudo\" key=\"privileged\""
      - "arch=c000003e syscall=59 success=yes exit=0 a0=7f8a4b6c8d90 a1=7f8a4b6c8e50 a2=7f8a4b6d0200 a3=0 items=2 ppid=1 pid=12848 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=\"nginx\" exe=\"/usr/sbin/nginx\" key=\"services\""
      - "argc=3 a0=\"/usr/bin/cat\" a1=\"/etc/shadow\" a2=\"(null)\""
      - "argc=2 a0=\"/bin/bash\" a1=\"-c\""
      - "item=0 name=\"/etc/passwd\" inode=1234567 dev=fd:00 mode=0100644 ouid=0 ogid=0 rdev=00:00 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0"
      - "item=0 name=\"/etc/shadow\" inode=1234568 dev=fd:00 mode=0100640 ouid=0 ogid=42 rdev=00:00 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0"
      - "cwd=\"/home/admin\""
      - "cwd=\"/root\""
      - "proctitle=7375646F00636174002F6574632F736861646F77"
      - "pid=12847 uid=1000 auid=1000 ses=1234 subj=unconfined msg='op=PAM:authentication grantors=pam_unix acct=\"root\" exe=\"/usr/bin/sudo\" hostname=? addr=? terminal=/dev/pts/0 res=success'"
      - "pid=12847 uid=1000 auid=1000 ses=1234 subj=unconfined msg='op=PAM:authentication grantors=? acct=\"root\" exe=\"/usr/bin/sudo\" hostname=? addr=? terminal=/dev/pts/0 res=failed'"
      - "pid=12847 uid=1000 auid=1000 ses=1234 subj=unconfined msg='op=PAM:accounting grantors=pam_unix acct=\"admin\" exe=\"/usr/bin/sudo\" hostname=? addr=? terminal=/dev/pts/0 res=success'"
      - "pid=12847 uid=0 auid=1000 ses=1234 subj=unconfined msg='op=PAM:credential_acq grantors=pam_unix acct=\"root\" exe=\"/usr/bin/sudo\" hostname=? addr=? terminal=/dev/pts/0 res=success'"
      - "pid=12847 uid=0 auid=1000 ses=1234 subj=unconfined msg='op=PAM:session_open grantors=pam_unix acct=\"root\" exe=\"/usr/bin/sudo\" hostname=? addr=? terminal=/dev/pts/0 res=success'"
      - "pid=12847 uid=0 auid=1000 ses=1234 subj=unconfined msg='op=PAM:session_close grantors=pam_unix acct=\"root\" exe=\"/usr/bin/sudo\" hostname=? addr=? terminal=/dev/pts/0 res=success'"
      - "pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg='unit=nginx comm=\"systemd\" exe=\"/usr/lib/systemd/systemd\" hostname=? addr=? terminal=? res=success'"
      - "pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg='unit=sshd comm=\"systemd\" exe=\"/usr/lib/systemd/systemd\" hostname=? addr=? terminal=? res=success'"
      - "avc:  denied  { read } for  pid=12847 comm=\"httpd\" name=\"index.html\" dev=\"dm-0\" ino=1234567 scontext=system_u:system_r:httpd_t:s0 tcontext=unconfined_u:object_r:user_home_t:s0 tclass=file permissive=0"
      - "table=filter family=2 entries=100 op=nft_register_chain"
