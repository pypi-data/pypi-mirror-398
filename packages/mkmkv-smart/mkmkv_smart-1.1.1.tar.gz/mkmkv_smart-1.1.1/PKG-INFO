Metadata-Version: 2.4
Name: mkmkv-smart
Version: 1.1.1
Summary: æ™ºèƒ½è§†é¢‘å­—å¹•åˆå¹¶å·¥å…·
Author-email: Sunn Yao <sunyour@gmail.com>
License-Expression: MIT
Project-URL: Homepage, https://github.com/cnsunyour/mkmkv-smart
Project-URL: Repository, https://github.com/cnsunyour/mkmkv-smart
Project-URL: Issues, https://github.com/cnsunyour/mkmkv-smart/issues
Project-URL: Changelog, https://github.com/cnsunyour/mkmkv-smart/blob/main/CHANGELOG.md
Keywords: mkvmerge,subtitle,video,mkv,fuzzy-matching
Classifier: Development Status :: 5 - Production/Stable
Classifier: Intended Audience :: End Users/Desktop
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Topic :: Multimedia :: Video
Classifier: Topic :: Utilities
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: rapidfuzz>=3.0.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: rich>=13.0.0
Requires-Dist: langdetect>=1.0.9
Requires-Dist: scipy>=1.9.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Provides-Extra: audio
Requires-Dist: faster-whisper>=1.0.0; extra == "audio"

# mkmkv-smart

æ™ºèƒ½è§†é¢‘å­—å¹•åˆå¹¶å·¥å…· - åŸºäºå…ˆè¿›çš„æ¨¡ç³ŠåŒ¹é…ç®—æ³•,è‡ªåŠ¨åŒ¹é…è§†é¢‘å’Œå­—å¹•æ–‡ä»¶å¹¶åˆå¹¶ä¸º MKV å®¹å™¨ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ¯ **æ™ºèƒ½åŒ¹é…**: ä½¿ç”¨ rapidfuzz å¤šç®—æ³•æ··åˆç­–ç•¥,å‡†ç¡®åŒ¹é…è§†é¢‘å’Œå­—å¹•
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ**: è‡ªåŠ¨è¯†åˆ«å’Œå¤„ç†å¤šè¯­è¨€å­—å¹•,æ”¯æŒè¯­è¨€ä¼˜å…ˆçº§
  - æ”¯æŒæ ‡å‡†è¯­è¨€ä»£ç  (zh-hans, zh-hant, en, ja, ko ç­‰)
  - å…¼å®¹å¸¸è§åˆ«å (CHS/CHT, GB/Big5 ç­‰)
- ğŸ” **è¯­è¨€è‡ªåŠ¨æ£€æµ‹**: æ™ºèƒ½æ£€æµ‹å­—å¹•è¯­è¨€,æ”¯æŒç®€ç¹ä½“ä¸­æ–‡åŒºåˆ†
  - æ”¯æŒ SRTã€ASSã€VTT å­—å¹•æ ¼å¼
  - è‡ªåŠ¨å¤„ç†å¤šç§æ–‡ä»¶ç¼–ç  (UTF-8, GBK, Big5 ç­‰)
  - å¯é€‰è‡ªåŠ¨é‡å‘½ååŠŸèƒ½
- ğŸµ **éŸ³é¢‘è¯­è¨€æ£€æµ‹** (å¯é€‰): ä½¿ç”¨ AI æ¨¡å‹æ£€æµ‹éŸ³è½¨è¯­è¨€
  - åŸºäº Faster-Whisper é«˜ç²¾åº¦æ¨¡å‹
  - æ”¯æŒ 99+ ç§è¯­è¨€
  - éœ€è¦å•ç‹¬å®‰è£…ï¼š`pip install mkmkv-smart[audio]`
- âš™ï¸ **çµæ´»é…ç½®**: æ”¯æŒ YAML é…ç½®æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°
- ğŸ¨ **ç¾è§‚è¾“å‡º**: ä½¿ç”¨ Rich åº“æä¾›å½©è‰²è¡¨æ ¼å’Œè¿›åº¦æ˜¾ç¤º
- ğŸ” **å¹²è¿è¡Œæ¨¡å¼**: é¢„è§ˆåŒ¹é…ç»“æœ,æ— éœ€å®é™…æ‰§è¡Œ
- ğŸ“¦ **æ‰¹é‡å¤„ç†**: ä¸€æ¬¡å¤„ç†æ•´ä¸ªç›®å½•çš„è§†é¢‘å’Œå­—å¹•

## ğŸ“‹ éœ€æ±‚

### Python ç‰ˆæœ¬
- **åŸºç¡€åŠŸèƒ½**: Python 3.8+ (åŒ…æ‹¬ 3.14) âœ…
  - æ™ºèƒ½åŒ¹é…ã€å­—å¹•æ£€æµ‹ã€æ‰¹é‡å¤„ç†ç­‰æ ¸å¿ƒåŠŸèƒ½
- **éŸ³é¢‘æ£€æµ‹åŠŸèƒ½**: Python 3.8 - 3.13 âš ï¸
  - **Python 3.14 æš‚ä¸æ”¯æŒ**: ä¾èµ– `onnxruntime` å°šæœªå‘å¸ƒ Python 3.14 æ”¯æŒ
  - **æ¨èç‰ˆæœ¬**: Python 3.11 æˆ– 3.12ï¼ˆML ç”Ÿæ€ç³»ç»Ÿæ”¯æŒæœ€å¥½ï¼‰

### ç³»ç»Ÿä¾èµ–
- mkvtoolnix (æä¾› `mkvmerge` å‘½ä»¤)

### å®‰è£… mkvtoolnix

**macOS:**
```bash
brew install mkvtoolnix
```

**Ubuntu/Debian:**
```bash
sudo apt install mkvtoolnix
```

**Windows:**
ä» [MKVToolNix å®˜ç½‘](https://mkvtoolnix.download/) ä¸‹è½½å®‰è£…

## ğŸš€ å®‰è£…

### æ–¹æ³• 1: ä»æºç å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/cnsunyour/mkmkv-smart.git
cd mkmkv-smart

# å®‰è£…åŸºç¡€åŠŸèƒ½ï¼ˆæ”¯æŒæ‰€æœ‰ Python ç‰ˆæœ¬ 3.8+ï¼‰
pip install -e .

# æˆ–å®‰è£…å¼€å‘ä¾èµ–
pip install -e ".[dev]"

# å¯é€‰ï¼šå®‰è£…éŸ³é¢‘æ£€æµ‹åŠŸèƒ½ï¼ˆéœ€è¦ ~500MBï¼ŒåŒ…æ‹¬ PyTorchï¼‰
# âš ï¸ æ³¨æ„ï¼šPython 3.14 æš‚ä¸æ”¯æŒï¼Œå»ºè®®ä½¿ç”¨ Python 3.11-3.13
pip install -e ".[audio]"
```

### æ–¹æ³• 2: ä½¿ç”¨ pip (å‘å¸ƒå)

```bash
# åŸºç¡€å®‰è£…ï¼ˆæ”¯æŒæ‰€æœ‰ Python ç‰ˆæœ¬ï¼‰
pip install mkmkv-smart

# åŒ…å«éŸ³é¢‘æ£€æµ‹åŠŸèƒ½ï¼ˆPython 3.8-3.13ï¼‰
pip install mkmkv-smart[audio]
```

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# é¢„è§ˆåŒ¹é…ç»“æœ(å¹²è¿è¡Œ)
mkmkv-smart --dry-run ~/Downloads

# æ‰§è¡Œåˆå¹¶(è¾“å‡ºåˆ°æºç›®å½•)
mkmkv-smart ~/Downloads

# æŒ‡å®šè¾“å‡ºç›®å½•
mkmkv-smart ~/Downloads ~/Movies
```

### é«˜çº§ç”¨æ³•

```bash
# è‡ªå®šä¹‰ç›¸ä¼¼åº¦é˜ˆå€¼
mkmkv-smart --threshold 40 ~/Downloads

# æŒ‡å®šåŒ¹é…æ–¹æ³•
mkmkv-smart --method token_set ~/Downloads

# ä½¿ç”¨é…ç½®æ–‡ä»¶
mkmkv-smart --config config.yaml ~/Downloads

# æ£€æµ‹è§†é¢‘éŸ³è½¨è¯­è¨€ï¼ˆéœ€è¦å®‰è£… audio åŠŸèƒ½ï¼‰
mkmkv-smart --detect-audio-language ~/Downloads

# æŒ‡å®šéŸ³é¢‘æ£€æµ‹æ¨¡å‹
mkmkv-smart --detect-audio-language --audio-model medium ~/Downloads

# ç»„åˆä½¿ç”¨
mkmkv-smart --dry-run --threshold 35 --config config.yaml ~/Downloads ~/Movies
```

### å‘½ä»¤è¡Œå‚æ•°

```
ä½ç½®å‚æ•°:
  source                æºç›®å½•(åŒ…å«è§†é¢‘å’Œå­—å¹•æ–‡ä»¶)
  output                è¾“å‡ºç›®å½•(å¯é€‰,é»˜è®¤ä¸ºæºç›®å½•)

å¯é€‰å‚æ•°:
  -h, --help            æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -n, --dry-run         å¹²è¿è¡Œæ¨¡å¼:åªæ˜¾ç¤ºåŒ¹é…ç»“æœ,ä¸å®é™…æ‰§è¡Œ
  -t, --threshold       ç›¸ä¼¼åº¦é˜ˆå€¼(0-100,é»˜è®¤: 30)
  -m, --method          åŒ¹é…æ–¹æ³•(é»˜è®¤: hybrid)
                        å¯é€‰: token_set, token_sort, partial, hybrid
  -c, --config          é…ç½®æ–‡ä»¶è·¯å¾„
  --detect-audio-language
                        è‡ªåŠ¨æ£€æµ‹è§†é¢‘éŸ³è½¨è¯­è¨€(éœ€è¦å®‰è£…: pip install mkmkv-smart[audio])
  --audio-model {tiny,base,small,medium,large}
                        éŸ³é¢‘æ£€æµ‹æ¨¡å‹å¤§å°(é»˜è®¤ä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œé…ç½®é»˜è®¤: small)
  --set-audio-language  å°†æ£€æµ‹åˆ°çš„éŸ³è½¨è¯­è¨€ä¿¡æ¯å†™å…¥ MKV æ–‡ä»¶
  --keep-embedded-subtitles
                        åˆå¹¶å¤–éƒ¨å­—å¹•æ—¶ä¿ç•™è§†é¢‘ä¸­çš„åµŒå…¥å­—å¹•
  --track-order         æŒ‡å®šè½¨é“é¡ºåº(æ ¼å¼: 0:0,0:1,1:0)
                        0 = è§†é¢‘æ–‡ä»¶, 1+ = å­—å¹•æ–‡ä»¶
                        ç¤ºä¾‹: 0:0,0:1,1:0,2:0 (è§†é¢‘è½¨0, éŸ³è½¨1, å­—å¹•1, å­—å¹•2)
  -v, --version         æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

## âš™ï¸ é…ç½®æ–‡ä»¶

åˆ›å»º `config.yaml`:

```yaml
# åŒ¹é…é…ç½®
match:
  threshold: 30.0        # ç›¸ä¼¼åº¦é˜ˆå€¼
  method: hybrid         # åŒ¹é…æ–¹æ³•
  keep_year: true        # ä¿ç•™å¹´ä»½
  keep_episode: true     # ä¿ç•™å‰§é›†ç¼–å·

# è¯­è¨€é…ç½®
language:
  priority:              # è¯­è¨€ä¼˜å…ˆçº§
    - zh-hans            # ç®€ä½“ä¸­æ–‡
    - zh-hant            # ç¹ä½“ä¸­æ–‡
    - zh                 # ä¸­æ–‡
    - en                 # è‹±æ–‡
    - ja                 # æ—¥æ–‡
    - ko                 # éŸ©æ–‡

# è¾“å‡ºé…ç½®
output:
  default_charset: UTF-8 # é»˜è®¤å­—å¹•ç¼–ç 

# è¯­è¨€æ£€æµ‹é…ç½®
language_detection:
  enabled: true          # æ˜¯å¦å¯ç”¨è‡ªåŠ¨è¯­è¨€æ£€æµ‹ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
  min_confidence: 0.8    # æœ€å°ç½®ä¿¡åº¦é˜ˆå€¼
  min_chars: 100         # æœ€å°æ–‡æœ¬é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰

# éŸ³é¢‘æ£€æµ‹é…ç½®ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
audio_detection:
  enabled: false         # æ˜¯å¦å¯ç”¨éŸ³é¢‘æ£€æµ‹
  model_size: small      # æ¨¡å‹å¤§å°: tiny, base, small, medium, large
  device: cpu            # è®¾å¤‡: cpu, cuda
  compute_type: int8     # è®¡ç®—ç±»å‹: int8, float16, float32
  min_confidence: 0.7    # æœ€å°ç½®ä¿¡åº¦é˜ˆå€¼
  max_duration: 30       # æå–éŸ³é¢‘çš„æœ€å¤§é•¿åº¦ï¼ˆç§’ï¼‰
  smart_sampling: true   # æ™ºèƒ½å¤šç‚¹é‡‡æ ·
  max_attempts: 3        # éæ™ºèƒ½æ¨¡å¼ä¸‹çš„æœ€å¤§é‡è¯•æ¬¡æ•°
```

ç”Ÿæˆé»˜è®¤é…ç½®:

```bash
python -m mkmkv_smart.config
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç”µå½±åŒ¹é…

**æ–‡ä»¶ç»“æ„:**
```
Downloads/
â”œâ”€â”€ The.Matrix.1999.1080p.BluRay.x264.mp4
â”œâ”€â”€ The.Matrix.1999.zh-hans.srt
â”œâ”€â”€ The.Matrix.1999.zh-hant.srt
â””â”€â”€ The.Matrix.1999.en.srt
```

**å‘½ä»¤:**
```bash
mkmkv-smart --dry-run ~/Downloads
```

**è¾“å‡º:**
```
æ™ºèƒ½åŒ¹é…æ¨¡å¼
[ å¹²è¿è¡Œ - ä¸ä¼šå®é™…æ‰§è¡Œ ]
æºç›®å½•: /Users/xxx/Downloads
æ‰¾åˆ° 1 ä¸ªè§†é¢‘æ–‡ä»¶
æ‰¾åˆ° 3 ä¸ªå­—å¹•æ–‡ä»¶

åŒ¹é…ç»“æœ:
======================================================================

è§†é¢‘: The.Matrix.1999.1080p.BluRay.x264.mp4
  è§„èŒƒåŒ–: the matrix 1999

è¯­è¨€     å­—å¹•æ–‡ä»¶                              ç›¸ä¼¼åº¦
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
zh-hans  The.Matrix.1999.zh-hans.srt          100.0%
zh-hant  The.Matrix.1999.zh-hant.srt          100.0%
en       The.Matrix.1999.en.srt               100.0%

======================================================================
æ€»è®¡: 1 ä¸ªæ–‡ä»¶
å¯å¤„ç†: 1 ä¸ªæ–‡ä»¶
```

### ç¤ºä¾‹ 2: å‰§é›†åŒ¹é…

**æ–‡ä»¶ç»“æ„:**
```
Series/
â”œâ”€â”€ Breaking.Bad.S01E01.720p.WEB-DL.mp4
â”œâ”€â”€ Breaking.Bad.S01E02.720p.WEB-DL.mp4
â”œâ”€â”€ Breaking.Bad.S01E01.zh.srt
â”œâ”€â”€ Breaking.Bad.S01E01.en.srt
â”œâ”€â”€ Breaking.Bad.S01E02.zh.srt
â””â”€â”€ Breaking.Bad.S01E02.en.srt
```

**å‘½ä»¤:**
```bash
mkmkv-smart ~/Series ~/Series/Output
```

**ç»“æœ:**
æ¯é›†è§†é¢‘ä¼šè‡ªåŠ¨åŒ¹é…å¯¹åº”çš„å­—å¹•,è¾“å‡ºåˆ°æŒ‡å®šç›®å½•ã€‚

### ç¤ºä¾‹ 3: ä¸åŒå‘å¸ƒç»„åŒ¹é…

å³ä½¿è§†é¢‘å’Œå­—å¹•æ¥è‡ªä¸åŒå‘å¸ƒç»„,ä¹Ÿèƒ½æ­£ç¡®åŒ¹é…:

```
Movie.2024.1080p.BluRay.x264-GROUP1.mp4
Movie.2024.1080p.WEB-DL.H264-GROUP2.zh.srt
```

å› ä¸ºè§„èŒƒåŒ–ä¼šå»é™¤å‘å¸ƒç»„æ ‡ç­¾,æ‰€ä»¥å¯ä»¥æˆåŠŸåŒ¹é…ã€‚

### ç¤ºä¾‹ 4: CHS/CHT è¯­è¨€ä»£ç æ”¯æŒ

**æ”¯æŒå¸¸è§çš„ä¸­æ–‡å­—å¹•å‘½åæ–¹å¼:**

```
Movie.2024.1080p.mp4
Movie.2024.CHS.srt       # ç®€ä½“ä¸­æ–‡ (è‡ªåŠ¨è¯†åˆ«ä¸º zh-hans)
Movie.2024.CHT.srt       # ç¹ä½“ä¸­æ–‡ (è‡ªåŠ¨è¯†åˆ«ä¸º zh-hant)
Movie.2024.GB.srt        # å›½æ ‡ç®€ä½“ (è‡ªåŠ¨è¯†åˆ«ä¸º zh-hans)
Movie.2024.Big5.srt      # Big5 ç¹ä½“ (è‡ªåŠ¨è¯†åˆ«ä¸º zh-hant)
```

**å‘½ä»¤:**
```bash
mkmkv-smart --dry-run ~/Downloads
```

**è¾“å‡º:**
```
è§†é¢‘: Movie.2024.1080p.mp4

è¯­è¨€     å­—å¹•æ–‡ä»¶                   ç›¸ä¼¼åº¦
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
zh-hans  Movie.2024.CHS.srt        100.0%
zh-hant  Movie.2024.CHT.srt        100.0%
```

æ‰€æœ‰è¿™äº›åˆ«åä¼šè‡ªåŠ¨æ˜ å°„åˆ°æ ‡å‡†çš„è¯­è¨€ä»£ç :
- `CHS`, `GB` â†’ `zh-hans` (ç®€ä½“ä¸­æ–‡)
- `CHT`, `Big5` â†’ `zh-hant` (ç¹ä½“ä¸­æ–‡)

**æŸ¥çœ‹å®Œæ•´ç¤ºä¾‹:**
```bash
python examples/chs_cht_example.py
```

### ç¤ºä¾‹ 5: è‡ªåŠ¨è¯­è¨€æ£€æµ‹

å½“å­—å¹•æ–‡ä»¶åä¸­**æ²¡æœ‰è¯­è¨€ä»£ç **æ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é‡å‘½åå­—å¹•æ–‡ä»¶ï¼ˆé€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ `language_detection.enabled` æ§åˆ¶ï¼Œé»˜è®¤å¯ç”¨ï¼‰ï¼š

**æ–‡ä»¶ç»“æ„:**
```
Downloads/
â”œâ”€â”€ Movie.2024.1080p.mp4
â”œâ”€â”€ Movie.2024.subtitle1.srt     # æ— è¯­è¨€æ ‡è¯†
â”œâ”€â”€ Movie.2024.subtitle2.srt     # æ— è¯­è¨€æ ‡è¯†
â””â”€â”€ Movie.2024.en.srt             # å·²æœ‰è¯­è¨€æ ‡è¯†
```

**å‘½ä»¤ (å¹²è¿è¡Œé¢„è§ˆ):**
```bash
mkmkv-smart --dry-run ~/Downloads
```

**è¾“å‡º:**
```
å°†é‡å‘½å: Movie.2024.subtitle1.srt â†’ Movie.2024.subtitle1.zh-hans.srt (zh-hans, 99.21%)
å°†é‡å‘½å: Movie.2024.subtitle2.srt â†’ Movie.2024.subtitle2.zh-hant.srt (zh-hant, 98.75%)
å°†è‡ªåŠ¨è¯†åˆ«å¹¶é‡å‘½å 2 ä¸ªå­—å¹•æ–‡ä»¶
```

**è‡ªåŠ¨é‡å‘½åå¹¶åˆå¹¶:**
```bash
mkmkv-smart ~/Downloads
```

**ç»“æœ:**
```
âœ“ Movie.2024.subtitle1.srt â†’ Movie.2024.subtitle1.zh-hans.srt (zh-hans, 99.21%)
âœ“ Movie.2024.subtitle2.srt â†’ Movie.2024.subtitle2.zh-hant.srt (zh-hant, 98.75%)

å·²è‡ªåŠ¨è¯†åˆ«å¹¶é‡å‘½å 2 ä¸ªå­—å¹•æ–‡ä»¶
```

é‡å‘½ååçš„å­—å¹•ä¼šè‡ªåŠ¨åŒ¹é…åˆ°è§†é¢‘æ–‡ä»¶è¿›è¡Œåˆå¹¶ã€‚

**æ”¯æŒçš„è¯­è¨€æ£€æµ‹:**
- âœ… ç®€ä½“ä¸­æ–‡ (zh-hans)
- âœ… ç¹ä½“ä¸­æ–‡ (zh-hant) - åŒ…å«ç®€ç¹ä½“åŒºåˆ†
- âœ… è‹±æ–‡ (en)
- âœ… æ—¥æ–‡ (ja)
- âœ… éŸ©æ–‡ (ko)
- âœ… ç­‰ 50+ ç§è¯­è¨€

**æ”¯æŒçš„å­—å¹•æ ¼å¼:**
- âœ… SRT (.srt)
- âœ… ASS (.ass)
- âœ… VTT (.vtt)

**æ”¯æŒçš„æ–‡ä»¶ç¼–ç :**
- UTF-8, GBK, Big5, UTF-16 ç­‰

### ç¤ºä¾‹ 6: éŸ³é¢‘è¯­è¨€æ£€æµ‹

å½“è§†é¢‘æ–‡ä»¶çš„éŸ³è½¨**æ²¡æœ‰è¯­è¨€æ ‡ç­¾**æ—¶ï¼Œå¯ä»¥ä½¿ç”¨éŸ³é¢‘è¯­è¨€æ£€æµ‹åŠŸèƒ½ï¼š

**å‰ç½®æ¡ä»¶:**
```bash
# å®‰è£…éŸ³é¢‘æ£€æµ‹åŠŸèƒ½
pip install mkmkv-smart[audio]
```

**æ–‡ä»¶ç»“æ„:**
```
Downloads/
â”œâ”€â”€ Movie.2024.1080p.mkv      # éŸ³è½¨æ— è¯­è¨€æ ‡ç­¾
â””â”€â”€ Movie.2024.zh-hans.srt
```

**å‘½ä»¤:**
```bash
mkmkv-smart --detect-audio-language ~/Downloads
```

**è¾“å‡º:**
```
éŸ³é¢‘è¯­è¨€æ£€æµ‹æ¨¡å¼
ä½¿ç”¨æ¨¡å‹: small
æ³¨æ„: é¦–æ¬¡ä½¿ç”¨ä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ

æ£€æµ‹: Movie.2024.1080p.mkv
  éŸ³è½¨ 0: ja (ç½®ä¿¡åº¦: 98.75%)

æˆåŠŸæ£€æµ‹ 1 ä¸ªè§†é¢‘çš„éŸ³è½¨è¯­è¨€
```

**æ”¯æŒçš„æ¨¡å‹:**
| æ¨¡å‹ | å¤§å° | å‡†ç¡®ç‡ | é€Ÿåº¦ï¼ˆCPUï¼‰ | æ¨èåœºæ™¯ |
|------|------|--------|------------|----------|
| tiny | 39MB | â­â­â­ | å¿«é€Ÿ | å¿«é€Ÿæ£€æµ‹ |
| base | 142MB | â­â­â­â­ | ä¸­ç­‰ | å¹³è¡¡é€‰æ‹© |
| **small** | 466MB | â­â­â­â­â­ | ä¸­ç­‰ | **é»˜è®¤æ¨è** |
| medium | 1.5GB | â­â­â­â­â­ | è¾ƒæ…¢ | é«˜ç²¾åº¦éœ€æ±‚ |
| large | 2.9GB | â­â­â­â­â­ | æ…¢ | æœ€é«˜ç²¾åº¦ |

**æ”¯æŒçš„è¯­è¨€:**
- âœ… ä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡
- âœ… ç­‰ 99+ ç§è¯­è¨€

**æ€§èƒ½è¯´æ˜:**
- CPU: 30ç§’éŸ³é¢‘çº¦éœ€ 3-5 ç§’å¤„ç†ï¼ˆsmall æ¨¡å‹ï¼‰
- GPU: 30ç§’éŸ³é¢‘çº¦éœ€ 2-3 ç§’å¤„ç†ï¼ˆéœ€è¦ CUDAï¼‰
- åªæå–å‰ 30 ç§’éŸ³é¢‘è¿›è¡Œæ£€æµ‹

## ğŸ§ª åŒ¹é…ç®—æ³•

mkmkv-smart ä½¿ç”¨å¤šç§æ¨¡ç³ŠåŒ¹é…ç®—æ³•:

### 1. Token Set Ratio
æœ€é€‚åˆå¤„ç†åŒ…å«ä¸åŒæ ‡ç­¾çš„æ–‡ä»¶å:
```
Video: "Movie 2024 1080p BluRay x264"
Sub:   "Movie 2024 zh-hans"
â†’ æå–å…±åŒè¯: {Movie, 2024}
â†’ ç›¸ä¼¼åº¦: 100%
```

### 2. Token Sort Ratio
é€‚åˆè¯åºä¸åŒçš„æƒ…å†µ:
```
Video: "2024 Movie Name"
Sub:   "Movie Name 2024"
â†’ æ’åºåæ¯”è¾ƒ
â†’ ç›¸ä¼¼åº¦: 100%
```

### 3. Partial Ratio
é€‚åˆéƒ¨åˆ†åŒ¹é…:
```
Video: "Movie Complete Edition 2024"
Sub:   "Movie 2024"
â†’ éƒ¨åˆ†å­—ç¬¦ä¸²åŒ¹é…
â†’ ç›¸ä¼¼åº¦: 90%
```

### 4. Ratio
æ ‡å‡†ç¼–è¾‘è·ç¦»ç®—æ³•:
```
Video: "Movie 2024 BluRay"
Sub:   "Movie 2024 WEB-DL"
â†’ Levenshtein è·ç¦»è®¡ç®—
â†’ é€‚åˆç›¸ä¼¼ä½†ä¸å®Œå…¨ç›¸åŒçš„æ–‡ä»¶å
```

### 5. WRatio
åŠ æƒæ¯”ç‡ç®—æ³•ï¼ˆè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥ï¼‰:
```
ç»¼åˆè€ƒè™‘å¤šç§å› ç´ ï¼š
- å­—ç¬¦ä¸²é•¿åº¦å·®å¼‚
- è¯åºé‡è¦æ€§
- éƒ¨åˆ†åŒ¹é…æƒé‡
â†’ è‡ªé€‚åº”é€‰æ‹©æœ€ä½³ç®—æ³•
```

### 6. Hybrid (é»˜è®¤)
ç»¼åˆä»¥ä¸Šç®—æ³•,å–æœ€é«˜åˆ†:
```python
score = max([
    token_set_ratio(v, s),
    token_sort_ratio(v, s),
    partial_ratio(v, s) * 0.9
])
```

### 7. å…¨å±€æœ€ä¼˜åˆ†é…ç®—æ³•

mkmkv-smart ä½¿ç”¨**åŒˆç‰™åˆ©ç®—æ³•ï¼ˆHungarian Algorithmï¼‰**å®ç°å…¨å±€æœ€ä¼˜å­—å¹•åˆ†é…:

**é—®é¢˜**: å½“å¤šä¸ªè§†é¢‘å’Œå¤šä¸ªå­—å¹•åŒ¹é…æ—¶ï¼Œå¦‚ä½•ç¡®ä¿æ€»ä½“åŒ¹é…è´¨é‡æœ€é«˜ï¼Ÿ

**ä¼ ç»Ÿè´ªå¿ƒç®—æ³•çš„é—®é¢˜**:
```
è§†é¢‘A â†â†’ å­—å¹•1: 90%
è§†é¢‘A â†â†’ å­—å¹•2: 85%
è§†é¢‘B â†â†’ å­—å¹•1: 88%
è§†é¢‘B â†â†’ å­—å¹•2: 70%

è´ªå¿ƒ: Aâ†’å­—å¹•1 (90%), B æ— åŒ¹é…
æ€»åˆ†: 90%
```

**å…¨å±€æœ€ä¼˜åˆ†é…**:
```
ä½¿ç”¨åŒˆç‰™åˆ©ç®—æ³•æ±‚è§£:
Aâ†’å­—å¹•2 (85%) + Bâ†’å­—å¹•1 (88%)
æ€»åˆ†: 173% âœ… æ›´ä¼˜
```

**ç®—æ³•ç‰¹ç‚¹**:
- âœ… ç¡®ä¿æ€»ä½“ç›¸ä¼¼åº¦æœ€å¤§åŒ–ï¼Œé¿å…å±€éƒ¨æ¬¡ä¼˜
- âœ… æ¯ä¸ªå­—å¹•æœ€å¤šåˆ†é…ä¸€æ¬¡ï¼Œé¿å…å†²çª
- âœ… æŒ‰è¯­è¨€åˆ†ç»„ç‹¬ç«‹æ±‚è§£ï¼Œæé«˜åŒ¹é…ç²¾åº¦
- âœ… ä½äºé˜ˆå€¼çš„åŒ¹é…è‡ªåŠ¨è¿‡æ»¤

## ğŸ”§ å¼€å‘

### è®¾ç½®å¼€å‘ç¯å¢ƒ

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ–
venv\Scripts\activate     # Windows

# å®‰è£…å¼€å‘ä¾èµ–
pip install -e ".[dev]"
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œå¹¶æ˜¾ç¤ºè¦†ç›–ç‡
pytest --cov=src/mkmkv_smart --cov-report=term-missing

# ç”Ÿæˆ HTML è¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=src/mkmkv_smart --cov-report=html
open htmlcov/index.html

# æˆ–ä½¿ç”¨è„šæœ¬
./run_tests.sh
```

### ä»£ç æ ¼å¼åŒ–

```bash
# æ ¼å¼åŒ–ä»£ç 
black src/ tests/

# ç±»å‹æ£€æŸ¥
mypy src/
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

ä¸åŸ Bash ç‰ˆæœ¬å¯¹æ¯”:

| ç‰¹æ€§ | Bash ç‰ˆæœ¬ | Python ç‰ˆæœ¬ |
|------|-----------|-------------|
| åŒ¹é…ç®—æ³• | Jaccard ç›¸ä¼¼åº¦ | Hybrid (å¤šç®—æ³•) |
| åŒ¹é…å‡†ç¡®åº¦ | ~50% | ~95% |
| å¤šè¯­è¨€æ”¯æŒ | âŒ | âœ… |
| é…ç½®æ–‡ä»¶ | âŒ | âœ… |
| å¹²è¿è¡Œæ¨¡å¼ | âŒ | âœ… |
| è¿›åº¦æ˜¾ç¤º | ç®€å• | Rich ç¾åŒ– |
| æ‰¹é‡å¤„ç† | âœ… | âœ… |

## ğŸ†š ä¸ Bash è„šæœ¬å¯¹æ¯”

æœ¬é¡¹ç›®æ˜¯åŸ Bash è„šæœ¬å·¥å…·é›†çš„ Python é‡å†™ç‰ˆæœ¬ï¼Œä¸“æ³¨äº**å¤–éƒ¨å­—å¹•æ–‡ä»¶åŒ¹é…**åŠŸèƒ½ã€‚

### åŠŸèƒ½è¦†ç›–æƒ…å†µ

| åŠŸèƒ½ç±»å‹ | Bash è„šæœ¬ | Python å®ç° | è¯´æ˜ |
|---------|---------|-----------|------|
| å¤–éƒ¨å­—å¹•åŒ¹é… | `mkmkv.sh`, `mkmkv_smart.sh` | âœ… **å·²å®ç°** | Python ç‰ˆæœ¬åŠŸèƒ½æ›´å¼º |
| å†…éƒ¨å­—å¹•é‡æ’ | `mkmkv_ç¹ç®€è‹±.sh` ç­‰ 4 ä¸ªè„šæœ¬ | âœ… **å·²å®ç°** | ä½¿ç”¨ `--track-order` å‚æ•°é‡æ’å†…éƒ¨è½¨é“ |
| éŸ³è½¨è°ƒæ•´ | `mkmkv_è°ƒæ•´éŸ³è½¨.sh` | âœ… **å·²å®ç°** | ä½¿ç”¨ `--track-order` å‚æ•°é‡æ’éŸ³è½¨é¡ºåº |

### ä½¿ç”¨åœºæ™¯åŒºåˆ†

**ä½¿ç”¨ Python ç‰ˆæœ¬** (mkmkv-smart) å½“ï¼š
- âœ… ä½ æœ‰ç‹¬ç«‹çš„ `.srt` / `.ass` å­—å¹•æ–‡ä»¶éœ€è¦åˆå¹¶
- âœ… æ–‡ä»¶åä¸è§„èŒƒï¼Œéœ€è¦æ™ºèƒ½åŒ¹é…
- âœ… éœ€è¦æ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘
- âœ… éœ€è¦é…ç½®æ–‡ä»¶ç®¡ç†å¤æ‚è§„åˆ™
- âœ… éœ€è¦è‡ªå®šä¹‰è½¨é“é¡ºåºï¼ˆ`--track-order` å‚æ•°ï¼‰
- âœ… éœ€è¦è‡ªåŠ¨è¯­è¨€æ£€æµ‹å’Œä¼˜å…ˆçº§æ’åº

**ç»§ç»­ä½¿ç”¨ Bash è„šæœ¬** å½“ï¼š
- âœ… éœ€è¦å¿«é€Ÿçš„ä¸€æ¬¡æ€§æ“ä½œ
- âœ… ä¸æƒ³å®‰è£… Python ä¾èµ–

è¯¦ç»†åŠŸèƒ½å¯¹æ¯”è¯·æŸ¥çœ‹ï¼š[FEATURE_COMPARISON.md](docs/FEATURE_COMPARISON.md)

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request!

### å¼€å‘æµç¨‹

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ Black æ ¼å¼åŒ–ä»£ç 
- æ·»åŠ ç±»å‹æ³¨è§£
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [rapidfuzz](https://github.com/maxbachmann/RapidFuzz) - é«˜æ€§èƒ½æ¨¡ç³ŠåŒ¹é…åº“
- [SciPy](https://scipy.org/) - ç§‘å­¦è®¡ç®—åº“ï¼ˆåŒˆç‰™åˆ©ç®—æ³•å®ç°ï¼‰
- [Rich](https://github.com/Textualize/rich) - ç¾åŒ–ç»ˆç«¯è¾“å‡º
- [MKVToolNix](https://mkvtoolnix.download/) - MKV å®¹å™¨å·¥å…·
- [langdetect](https://github.com/Mimino666/langdetect) - è¯­è¨€æ£€æµ‹åº“
- [Faster-Whisper](https://github.com/SYSTRAN/faster-whisper) - é«˜æ€§èƒ½éŸ³é¢‘è¯­è¨€æ£€æµ‹

## ğŸ“® è”ç³»

é¡¹ç›®é“¾æ¥: https://github.com/cnsunyour/mkmkv-smart

---

**æ³¨æ„**: æ­¤å·¥å…·ä»…ç”¨äºåˆæ³•æ‹¥æœ‰çš„è§†é¢‘å’Œå­—å¹•æ–‡ä»¶ã€‚è¯·éµå®ˆç‰ˆæƒæ³•å¾‹ã€‚
