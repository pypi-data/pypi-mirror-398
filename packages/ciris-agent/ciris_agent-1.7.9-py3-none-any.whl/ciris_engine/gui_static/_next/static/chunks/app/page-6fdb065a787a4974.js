(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{127:(e,s,a)=>{Promise.resolve().then(a.bind(a,4898))},4898:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>y});var t=a(4568),n=a(4275),r=a.n(n),l=a(7620),c=a(9484),i=a(3835),d=a(7606),o=a(3297),x=a(6258),m=a(2987),u=a(3237),g=a(6264);function f(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:17;return(1.5*e*1e3+a/70*.4*s)/2}function h(e){return e<1?"".concat(e.toFixed(2)," ml"):e<1e3?"".concat(e.toFixed(1)," ml"):"".concat((e/1e3).toFixed(2)," L")}function p(e){return e<1?"".concat(e.toFixed(2)," g CO₂e"):e<1e3?"".concat(e.toFixed(1)," g CO₂e"):"".concat((e/1e3).toFixed(2)," kg CO₂e")}var b=a(2012),j=a.n(b);function y(){let{user:e,hasRole:s}=(0,c.A)(),{currentAgent:a}=(0,i.f)(),[n,b]=(0,l.useState)(""),y=(0,d.jE)(),N=(0,l.useRef)(null),[v,_]=(0,l.useState)("detailed"),[w,k]=(0,l.useState)(new Set),S=(0,l.useRef)(new Set),[E,D]=(0,l.useState)(new Map),A=(0,l.useRef)(new Map),[C,T]=(0,l.useState)(new Map),I=["bg-blue-500","bg-green-500","bg-purple-500","bg-orange-500","bg-red-500","bg-pink-500"],M=(0,l.useRef)(0),{data:R,isLoading:O}=(0,o.I)({queryKey:["conversation-history"],queryFn:async()=>await m.AQ.agent.getHistory({channel_id:"api_0.0.0.0_8080",limit:20}),refetchInterval:5e3,structuralSharing:!0,enabled:!!a&&!!e}),L=(0,l.useRef)([]),F=(0,l.useMemo)(()=>{if(!(null==R?void 0:R.messages))return L.current;let e=[...R.messages].sort((e,s)=>new Date(e.timestamp).getTime()-new Date(s.timestamp).getTime()).slice(-20);return j()(e,L.current)?L.current:(L.current=e,e)},[null==R?void 0:R.messages]);(0,l.useEffect)(()=>{let e=m.AQ.auth.getAccessToken();if(!e)return void console.log("⚠️ No auth token, skipping SSE connection");if(!a)return void console.log("⚠️ No current agent, skipping SSE connection");let s=m.AQ.getBaseURL(),t="".concat(s,"/v1/system/runtime/reasoning-stream");console.log("\uD83D\uDD0C Connecting to SSE stream:",t);let n=new AbortController,r=(e,s)=>{if("step_update"===e){var a;let t=JSON.parse(s);console.log("\uD83D\uDCE1 Received SSE event:",e,"with",(null==(a=t.events)?void 0:a.length)||0,"events"),t.events&&Array.isArray(t.events)&&t.events.forEach(e=>{let{event_type:s,thought_id:a,task_id:t}=e;a&&t&&T(n=>{let r=new Map(n),l=r.get(t);if(!l){let s=S.current.has(t);console.log("\uD83E\uDDE0 Creating task ".concat(t.slice(-8),", isOurs: ").concat(s)),console.log("\uD83E\uDDE0 Task description:",e.task_description),l={taskId:t,description:e.task_description||"",color:I[M.current%I.length],completed:!1,firstTimestamp:e.timestamp||new Date().toISOString(),isOurs:s,thoughts:[]},M.current++,r.set(t,l)}console.log("\uD83C\uDFA8 Processing ".concat(s," for task ").concat(t.slice(-8),", thought ").concat(a.slice(-8)));let c=l.thoughts.find(e=>e.thoughtId===a);return c||(c={thoughtId:a,stages:new Map},l.thoughts.push(c)),c.stages.set(s,{event_type:s,completed:!0,data:e}),"action_result"===s&&("task_complete"===e.action_executed||"task_reject"===e.action_executed)&&(l.completed=!0),r})})}};return(async()=>{try{var s;let a=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),Accept:"text/event-stream"},signal:n.signal});if(!a.ok)throw Error("HTTP ".concat(a.status));console.log("✅ SSE stream connected");let l=null==(s=a.body)?void 0:s.getReader();if(!l)throw Error("Response body is not readable");let c=new TextDecoder,i="",d="",o="";for(;;){let{done:e,value:s}=await l.read();if(e)break;let a=(i+=c.decode(s,{stream:!0})).split("\n");for(let e of(i=a.pop()||"",a))if(e.startsWith("event:"))d&&o&&r(d,o),d=e.slice(6).trim(),o="";else if(e.startsWith("data:")){let s=e.slice(5).trim();o=o?o+"\n"+s:s}else""===e&&d&&o&&(r(d,o),d="",o="")}}catch(e){"AbortError"!==e.name&&console.error("Stream error:",e)}})(),()=>n.abort()},[a]);let P=(0,x.n)({mutationFn:async e=>await m.AQ.agent.submitMessage(e,{channel_id:"api_0.0.0.0_8080"}),onSuccess:e=>{e.accepted&&e.task_id&&e.message_id?(k(s=>new Set(s).add(e.task_id)),S.current.add(e.task_id),D(s=>new Map(s).set(e.message_id,e.task_id)),A.current.set(e.message_id,e.task_id),console.log("\uD83C\uDFAF Tracking our task_id:",e.task_id,"for message_id:",e.message_id),console.log("\uD83C\uDFAF ourTaskIdsRef now contains:",Array.from(S.current)),u.Ay.success("Message accepted (task: ".concat(e.task_id.slice(-8),")"),{duration:2e3})):(u.Ay.error("Message rejected: ".concat(e.rejection_reason),{duration:4e3}),e.rejection_detail&&console.error("Rejection detail:",e.rejection_detail)),setTimeout(()=>{y.invalidateQueries({queryKey:["conversation-history"]})},500)},onError:e=>{u.Ay.error("Error: ".concat(e.message))}}),U=["thought_start","snapshot_and_context","dma_results","aspdma_result","conscience_result","action_result"],W=e=>{let s=U.indexOf(e);return s>=0?"".concat(s+1):"?"},B=e=>{let s=e;return(null==s?void 0:s.includes("."))&&(s=s.split(".").pop()||s),s.toUpperCase()},V=e=>{let s=e;return(null==s?void 0:s.includes("."))&&(s=s.split(".").pop()||s),["TASK_COMPLETE","DEFER","REJECT","OBSERVE","RECALL"].includes(s.toUpperCase())},H=(e,s)=>V(s)?"EXEMPT":e?"PASSED":"FAILED",q=e=>{let s=0,a=0,t=0,n=0;if(e.forEach(e=>{let r=e.stages.get("action_result");if(null==r?void 0:r.data){let e=r.data;null!=e.carbon_grams&&(s+=e.carbon_grams,n++),null!=e.energy_mwh&&(a+=e.energy_mwh),null!=e.tokens_total&&(t+=e.tokens_total)}}),0===n)return null;let r=f(a/1e6,t);return{carbonGrams:s,waterMl:r,tokens:t}},z=e=>{var s;let{data:a,renderExpandableData:n,initialSelected:r="csdma"}=e,[c,i]=(0,l.useState)(r),d=[{key:"csdma",label:"Common Sense",icon:"CS",field:"csdma"},{key:"dsdma",label:"Domain Specific",icon:"DS",field:"dsdma"},{key:"pdma",label:"Ethical",icon:"E",field:"pdma"}],o=Object.keys(a).filter(e=>!["csdma","dsdma","pdma","dma_outputs"].includes(e));return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"flex gap-2",children:d.map(e=>(0,t.jsxs)("button",{onClick:()=>i(e.key),className:"flex-1 flex flex-col items-center justify-center p-3 rounded-lg border-2 transition-all ".concat(c===e.key?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400 bg-white"),children:[(0,t.jsx)("div",{className:"text-xl font-bold mb-1 text-blue-600",children:e.icon}),(0,t.jsx)("div",{className:"text-xs font-medium text-center",children:e.label})]},e.key))}),(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"text-blue-600 font-semibold mb-2",children:[null==(s=d.find(e=>e.key===c))?void 0:s.label," Output:"]}),(0,t.jsx)("div",{className:"ml-2",children:(()=>{var e;let s=a[(null==(e=d.find(e=>e.key===c))?void 0:e.field)||""];return s&&"object"==typeof s&&!Array.isArray(s)?(0,t.jsx)("div",{className:"space-y-1 border-l-2 border-gray-300 pl-2",children:Object.entries(s).map(e=>{let[s,a]=e;return(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("span",{className:"text-blue-600 font-medium text-xs mr-2",children:[s,":"]}),n(a,2)]},s)})}):n(s,1)})()})]}),o.length>0&&(0,t.jsxs)("details",{children:[(0,t.jsxs)("summary",{className:"cursor-pointer text-gray-600 hover:bg-gray-100 px-2 py-1 rounded text-xs",children:["\uD83D\uDCCB View details (",o.length," more fields)"]}),(0,t.jsx)("div",{className:"ml-2 mt-2 space-y-1 border-l-2 border-gray-300 pl-2",children:o.map(e=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("span",{className:"text-blue-600 font-medium text-xs mr-2",children:[e,":"]}),n(a[e],2)]},e))})]})]})},X=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null==e)return(0,t.jsx)("span",{className:"text-gray-500 italic",children:"null"});if("string"==typeof e)return e.length>200?(0,t.jsxs)("details",{className:"inline",children:[(0,t.jsxs)("summary",{className:"cursor-pointer text-blue-600 hover:underline",children:['"',e.substring(0,100),'..." (',e.length," chars)"]}),(0,t.jsx)("div",{className:"ml-4 mt-1 text-xs whitespace-pre-wrap break-words",children:e})]}):(0,t.jsxs)("span",{className:"text-green-700",children:['"',e,'"']});if("number"==typeof e)return(0,t.jsx)("span",{className:"text-purple-600",children:e});if("boolean"==typeof e)return(0,t.jsx)("span",{className:"text-orange-600",children:e.toString()});if(Array.isArray(e))return 0===e.length?(0,t.jsx)("span",{className:"text-gray-500",children:"[]"}):(0,t.jsxs)("details",{className:"ml-4",open:s<1,children:[(0,t.jsxs)("summary",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded",children:["Array (",e.length," items)"]}),(0,t.jsx)("div",{className:"ml-4 border-l-2 border-gray-300 pl-2",children:e.map((e,a)=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("span",{className:"text-gray-500 mr-2",children:["[",a,"]:"]}),X(e,s+1)]},a))})]});if("object"==typeof e){let a=Object.entries(e);return 0===a.length?(0,t.jsx)("span",{className:"text-gray-500",children:"{}"}):(0,t.jsxs)("details",{className:"ml-4",open:s<1,children:[(0,t.jsxs)("summary",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded",children:["Object (",a.length," fields)"]}),(0,t.jsx)("div",{className:"ml-4 border-l-2 border-gray-300 pl-2",children:a.map(e=>{let[a,n]=e;return(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("span",{className:"text-blue-600 font-medium mr-2",children:[a,":"]}),X(n,s+1)]},a)})})]})}return(0,t.jsx)("span",{children:String(e)})},[G,K]=(0,l.useState)({}),Q=(e,s,a)=>{var n,r,l,c,i,d,o,x,m,u;if("dma_results"===e){let e=a?G[a]:void 0;return(0,t.jsx)(z,{data:s,renderExpandableData:X,initialSelected:e})}if("aspdma_result"===e){let e=s.selected_action||"UNKNOWN";e.includes(".")&&(e=e.split(".").pop()||e);let a=B(e),n=s.action_rationale||s.action_reasoning||"",r=Object.keys(s).filter(e=>!["selected_action","action_rationale","action_reasoning"].includes(e));return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-3 bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,t.jsx)("div",{className:"text-blue-900 font-bold text-2xl",children:a})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-blue-600 font-semibold mb-2",children:"Reasoning:"}),(0,t.jsx)("div",{className:"ml-2 text-gray-700 whitespace-pre-wrap",children:n})]}),r.length>0&&(0,t.jsxs)("details",{children:[(0,t.jsxs)("summary",{className:"cursor-pointer text-gray-600 hover:bg-gray-100 px-2 py-1 rounded text-xs",children:["\uD83D\uDCCB View details (",r.length," more fields)"]}),(0,t.jsx)("div",{className:"ml-2 mt-2 space-y-1 border-l-2 border-gray-300 pl-2",children:r.map(e=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("span",{className:"text-blue-600 font-medium text-xs mr-2",children:[e,":"]}),X(s[e],2)]},e))})]})]})}if("conscience_result"===e){let e=s.conscience_passed,a=s.epistemic_data||{},i=s.conscience_override_reason,d=s.selected_action||"",o=d?H(e,d):e?"PASSED":"FAILED",x="EXEMPT"===o,m="PASSED"===o,u=null!=(n=a.entropy_level)?n:null,g=null!=(r=a.coherence_level)?r:null,f=null!=(l=a.uncertainty_acknowledged)?l:null,h=null!=(c=a.reasoning_transparency)?c:null,p=null!==u&&u<.4,b=null!==g&&g>.6,j=!0===f,y=1===h,N=Object.keys(s).filter(e=>!["conscience_passed","epistemic_data","conscience_override_reason","selected_action"].includes(e));return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-3 border rounded-lg p-3 ".concat(x?"bg-gray-50 border-gray-300":m?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-bold text-2xl ".concat(x?"text-gray-700":m?"text-green-900":"text-red-900"),children:o}),i&&(0,t.jsxs)("div",{className:"text-sm text-gray-700 mt-1",children:["Override: ",i]})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-blue-600 font-semibold mb-2",children:"Epistemic Values:"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{className:"p-2 rounded border ".concat(p?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[(0,t.jsx)("div",{className:"text-xs font-medium text-gray-600",children:"Entropy Level"}),(0,t.jsx)("div",{className:"text-lg font-bold",children:null!==u?u.toFixed(2):"N/A"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:p?"✓ < 0.4":"⚠ Must be < 0.4"})]}),(0,t.jsxs)("div",{className:"p-2 rounded border ".concat(b?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[(0,t.jsx)("div",{className:"text-xs font-medium text-gray-600",children:"Coherence Level"}),(0,t.jsx)("div",{className:"text-lg font-bold",children:null!==g?g.toFixed(2):"N/A"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:b?"✓ > 0.6":"⚠ Must be > 0.6"})]}),(0,t.jsxs)("div",{className:"p-2 rounded border ".concat(j?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[(0,t.jsx)("div",{className:"text-xs font-medium text-gray-600",children:"Uncertainty Acknowledged"}),(0,t.jsx)("div",{className:"text-lg font-bold",children:null!==f?f?"Yes":"No":"N/A"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:j?"✓ Acknowledged":"⚠ Must acknowledge"})]}),(0,t.jsxs)("div",{className:"p-2 rounded border ".concat(y?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[(0,t.jsx)("div",{className:"text-xs font-medium text-gray-600",children:"Reasoning Transparency"}),(0,t.jsx)("div",{className:"text-lg font-bold",children:null!==h?h.toFixed(2):"N/A"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:y?"✓ Maintained":"⚠ Must maintain"})]})]})]}),N.length>0&&(0,t.jsxs)("details",{children:[(0,t.jsxs)("summary",{className:"cursor-pointer text-gray-600 hover:bg-gray-100 px-2 py-1 rounded text-xs",children:["\uD83D\uDCCB View details (",N.length," more fields)"]}),(0,t.jsx)("div",{className:"ml-2 mt-2 space-y-1 border-l-2 border-gray-300 pl-2",children:N.map(e=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("span",{className:"text-blue-600 font-medium text-xs mr-2",children:[e,":"]}),X(s[e],2)]},e))})]})]})}if("action_result"===e){let e=s.action_executed||"UNKNOWN";e.includes(".")&&(e=e.split(".").pop()||e);let a=B(e),n=null!=(i=s.execution_success)?i:null,r=s.audit_entry_hash||"",l=r?r.slice(-8):"",c=null!=(d=s.tokens_total)?d:null,g=null!=(o=s.tokens_input)?o:null,b=null!=(x=s.tokens_output)?x:null,j=null!=(m=s.carbon_grams)?m:null,y=null!=(u=s.energy_mwh)?u:null,N=null;null!==y&&null!==c&&(N=f(y/1e6,c));let v=null!==j||null!==N,_=Object.keys(s).filter(e=>!["action_executed","execution_success","audit_entry_hash","tokens_total","tokens_input","tokens_output","carbon_grams","energy_mwh","cost_cents"].includes(e));return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-3 border rounded-lg p-3 ".concat(n?"bg-green-50 border-green-200":!1===n?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"),children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-bold text-2xl ".concat(n?"text-green-900":!1===n?"text-red-900":"text-gray-900"),children:a}),null!==n&&(0,t.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:n?"✓ Executed successfully":"✗ Execution failed"})]})}),v&&(0,t.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-green-700 font-semibold text-sm mb-2",children:"Environmental Impact"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[null!==j&&(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Carbon:"}),(0,t.jsx)("span",{className:"font-mono font-medium",children:p(j)})]}),null!==N&&(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Water:"}),(0,t.jsx)("span",{className:"font-mono font-medium",children:h(N)})]})]}),null!==c&&(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t border-green-200 text-xs text-gray-600",children:[null!==g&&null!==b&&(0,t.jsxs)("span",{children:[c.toLocaleString()," tokens (",g.toLocaleString()," in,"," ",b.toLocaleString()," out)"]}),(null===g||null===b)&&(0,t.jsxs)("span",{children:[c.toLocaleString()," tokens"]})]})]}),r&&(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"text-blue-600 font-semibold text-sm",children:"HASH TABLE ENTRY"}),(0,t.jsxs)("div",{className:"font-mono text-xs text-blue-900",children:["...",l]})]})}),_.length>0&&(0,t.jsxs)("details",{children:[(0,t.jsxs)("summary",{className:"cursor-pointer text-gray-600 hover:bg-gray-100 px-2 py-1 rounded text-xs",children:["View details (",_.length," more fields)"]}),(0,t.jsx)("div",{className:"ml-2 mt-2 space-y-1 border-l-2 border-gray-300 pl-2",children:_.map(e=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("span",{className:"text-blue-600 font-medium text-xs mr-2",children:[e,":"]}),X(s[e],2)]},e))})]})]})}let g={thought_start:["task_description","thought_content"],snapshot_and_context:["context","system_snapshot"]}[e]||[],b=Object.keys(s).filter(e=>!g.includes(e));return(0,t.jsxs)("div",{className:"space-y-2",children:[g.map(e=>{if(!s[e])return null;let a=s[e];return(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("div",{className:"text-blue-600 font-semibold mb-1",children:[e.replace(/_/g," "),":"]}),(0,t.jsx)("div",{className:"ml-2",children:"system_snapshot"===e&&"object"==typeof a?(0,t.jsx)("div",{className:"space-y-1 border-l-2 border-gray-300 pl-2",children:Object.entries(a).map(e=>{let[s,a]=e;return(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("span",{className:"text-blue-600 font-medium text-xs mr-2",children:[s,":"]}),X(a,2)]},s)})}):"string"==typeof a&&a.length>200?(0,t.jsxs)("details",{children:[(0,t.jsxs)("summary",{className:"cursor-pointer text-gray-700 hover:underline",children:[a.substring(0,100),"... (",a.length," chars)"]}),(0,t.jsx)("div",{className:"mt-1 text-xs whitespace-pre-wrap break-words bg-gray-50 p-2 rounded",children:a})]}):X(a,1)})]},e)}),b.length>0&&(0,t.jsxs)("details",{className:"mt-2",children:[(0,t.jsxs)("summary",{className:"cursor-pointer text-gray-600 hover:bg-gray-100 px-2 py-1 rounded text-xs",children:["\uD83D\uDCCB View details (",b.length," more fields)"]}),(0,t.jsx)("div",{className:"ml-2 mt-2 space-y-1 border-l-2 border-gray-300 pl-2",children:b.map(e=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("span",{className:"text-blue-600 font-medium text-xs mr-2",children:[e,":"]}),X(s[e],2)]},e))})]})]})},[J,Y]=(0,l.useState)("");(0,l.useEffect)(()=>{fetch("/pipeline-visualization.svg").then(e=>e.text()).then(e=>Y(e)).catch(e=>console.error("Failed to load SVG:",e))},[]);let Z=(0,l.useMemo)(()=>{let e=[];F.forEach(s=>{let a;if(!s.is_agent&&s.id){let e=E.get(s.id);e?(a=C.get(e),console.log("\uD83D\uDD17 Matched message",s.id,"to task",e)):console.log("⚠️ No task mapping for message",s.id)}e.push({type:"message",timestamp:s.timestamp,data:s,relatedTask:a})});let s=new Set(e.filter(e=>e.relatedTask).map(e=>e.relatedTask.taskId));return Array.from(C.values()).forEach(a=>{s.has(a.taskId)||e.push({type:"task",timestamp:a.firstTimestamp,data:a})}),e.sort((e,s)=>new Date(e.timestamp).getTime()-new Date(s.timestamp).getTime())},[F,C,E]),$=(0,l.useRef)(0),ee=(0,l.useRef)([]);return(0,l.useEffect)(()=>{let e=Z.length>$.current||!j()(Z,ee.current);N.current&&e&&(setTimeout(()=>{N.current&&(N.current.scrollTop=N.current.scrollHeight)},100),$.current=Z.length,ee.current=Z)},[Z]),(0,t.jsxs)(g.O,{children:[(0,t.jsx)(r(),{id:"4ba9c439904a7ffe",children:"svg{max-width:100%;height:auto}"}),(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe mb-6 max-w-7xl mx-auto",children:(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex items-start justify-between gap-4",children:[(0,t.jsx)("p",{className:"jsx-4ba9c439904a7ffe text-sm text-gray-600 max-w-3xl",children:"DATUM is a CIRIS Agent demonstrating an ethical AI agent's decision making process. Ask Datum a question about CIRIS or an ethical dilemma, and see the reasoning below. Note the agent may choose not to answer, and your data IS NOT PRIVATE as this is a BETA interface for demonstration and research purposes only."}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe flex-shrink-0",children:(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex items-center gap-2 bg-gray-100 rounded-lg p-1",children:[(0,t.jsx)("button",{onClick:()=>_("basic"),className:"jsx-4ba9c439904a7ffe "+"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat("basic"===v?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Basic"}),(0,t.jsx)("button",{onClick:()=>_("detailed"),className:"jsx-4ba9c439904a7ffe "+"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat("detailed"===v?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Detailed"})]})})]})}),a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe max-w-4xl mx-auto mb-6",children:(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe bg-white shadow rounded-lg",children:(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe px-4 py-5 sm:p-6",children:[(0,t.jsx)("div",{ref:N,className:"jsx-4ba9c439904a7ffe border rounded-lg bg-gray-50 h-96 overflow-y-auto p-4 mb-4",children:O?(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe text-center text-gray-500",children:"Loading conversation..."}):0===Z.length?(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe text-center text-gray-500",children:"No messages yet. Start a conversation!"}):(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe space-y-3",children:Z.map((e,s)=>{if("message"===e.type){let a=e.data,n=e.relatedTask;return(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe mb-3",children:[(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe "+"".concat(a.is_agent?"text-left":"text-right"),children:[(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe "+"inline-block px-4 py-2 rounded ".concat(a.is_agent?"bg-gray-200":"bg-blue-500 text-white"),children:a.content}),!a.is_agent&&n&&(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe text-xs text-gray-500 mt-1",children:["✓ Task: ",n.taskId.slice(-8)]})]}),n&&!a.is_agent&&(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe mt-2 ml-4",children:(0,t.jsxs)("details",{open:"detailed"===v&&!n.completed,className:"jsx-4ba9c439904a7ffe border rounded-lg",children:[(0,t.jsx)("summary",{className:"jsx-4ba9c439904a7ffe "+"cursor-pointer p-3 ".concat(n.color," text-white rounded-t-lg ").concat(n.completed?"opacity-60":""),children:(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe space-y-2",children:[(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex justify-between items-center",children:[(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe font-medium text-sm",children:["\uD83E\uDDE0 ",n.description||n.taskId.slice(-8),(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe ml-2 text-xs opacity-75",children:["[Task: ",n.taskId,"]"]})]}),(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe text-xs",children:[n.thoughts.length," thought(s)"]})]}),(()=>{let e=q(n.thoughts);return e?(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex gap-4 text-xs opacity-90",children:[(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex items-center gap-1",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe",children:"Carbon:"}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe font-mono",children:p(e.carbonGrams)})]}),(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex items-center gap-1",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe",children:"Water:"}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe font-mono",children:h(e.waterMl)})]}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe flex items-center gap-1",children:(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe",children:[e.tokens.toLocaleString()," tokens"]})})]}):null})()]})}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe p-3 space-y-2 bg-gray-50",children:n.thoughts.map(e=>{var s,a,n,r,l,c,i;let d=e.stages.get("thought_start"),o=(null==d||null==(s=d.data)?void 0:s.thought_content)||"Processing thought...",x=o.length>80?o.substring(0,80)+"...":o;if("basic"===v){let s=e.stages.get("dma_results"),d=e.stages.get("aspdma_result"),o=e.stages.get("conscience_result"),m=e.stages.get("action_result"),u=(null==d||null==(a=d.data)?void 0:a.is_recursive)||(null==o||null==(n=o.data)?void 0:n.is_recursive);return(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe border border-gray-200 rounded p-2 bg-white space-y-1",children:[(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe text-sm font-medium mb-2",children:x}),(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex flex-wrap gap-1 items-center text-xs",children:[s&&(0,t.jsx)("span",{title:"DMAs",className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-gray-100 rounded font-bold",children:"CS\xb7DS\xb7E"}),(null==d||null==(r=d.data)?void 0:r.selected_action)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-blue-100 text-blue-800 rounded font-bold",children:B(d.data.selected_action)})]}),o&&(null==d||null==(l=d.data)?void 0:l.selected_action)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe "+"px-1.5 py-0.5 rounded font-bold ".concat("EXEMPT"===H(o.data.conscience_passed,d.data.selected_action)?"bg-gray-100 text-gray-700":o.data.conscience_passed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:H(o.data.conscience_passed,d.data.selected_action)})]}),u&&(null==d||null==(c=d.data)?void 0:c.selected_action)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{title:"Recursive",className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-blue-100 text-blue-800 rounded font-bold opacity-75",children:B(d.data.selected_action)}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{title:"Recursive",className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-green-100 text-green-800 rounded font-bold opacity-75",children:"PASSED"})]}),(null==m||null==(i=m.data)?void 0:i.action_executed)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{title:"Executed",className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-purple-100 text-purple-800 rounded font-bold",children:B(m.data.action_executed)})]})]})]},e.thoughtId)}return(0,t.jsxs)("details",{className:"jsx-4ba9c439904a7ffe border border-gray-200 rounded",children:[(0,t.jsxs)("summary",{className:"jsx-4ba9c439904a7ffe cursor-pointer p-2 bg-white hover:bg-gray-50",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-sm font-medium",children:x}),(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe text-xs text-gray-500 ml-2",children:["(",e.stages.size,"/6 stages)"]})]}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe p-2 bg-gray-100 space-y-1",children:U.map(s=>{let a=e.stages.get(s);if(!a)return(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex items-center p-2 rounded text-xs bg-gray-200",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe mr-2 font-bold text-gray-600",children:W(s)}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-500",children:s.replace(/_/g," ").toUpperCase()})]},s);let n=a.data.timestamp?new Date(a.data.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}):"";return(0,t.jsxs)("details",{className:"jsx-4ba9c439904a7ffe bg-green-50 border border-green-200 rounded",children:[(0,t.jsxs)("summary",{className:"jsx-4ba9c439904a7ffe flex items-center p-2 cursor-pointer hover:bg-green-100 rounded text-xs",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe mr-2 font-bold text-green-700",children:W(s)}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe font-medium flex-1",children:s.replace(/_/g," ").toUpperCase()}),n&&(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-500 text-xs mr-2",children:n}),"dma_results"===s&&(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe flex gap-1 mr-2",children:[(0,t.jsx)("span",{title:"Common Sense DMA",onClick:s=>{let a=s.currentTarget.closest("details");(null==a?void 0:a.open)&&s.stopPropagation(),K(s=>({...s,["thought-".concat(e.thoughtId,"-dma")]:"csdma"}))},className:"jsx-4ba9c439904a7ffe cursor-pointer hover:bg-green-200 transition-colors px-1.5 py-0.5 rounded text-xs font-bold",children:"CS"}),(0,t.jsx)("span",{title:"Domain Specific DMA",onClick:s=>{let a=s.currentTarget.closest("details");(null==a?void 0:a.open)&&s.stopPropagation(),K(s=>({...s,["thought-".concat(e.thoughtId,"-dma")]:"dsdma"}))},className:"jsx-4ba9c439904a7ffe cursor-pointer hover:bg-green-200 transition-colors px-1.5 py-0.5 rounded text-xs font-bold",children:"DS"}),(0,t.jsx)("span",{title:"Ethical DMA",onClick:s=>{let a=s.currentTarget.closest("details");(null==a?void 0:a.open)&&s.stopPropagation(),K(s=>({...s,["thought-".concat(e.thoughtId,"-dma")]:"pdma"}))},className:"jsx-4ba9c439904a7ffe cursor-pointer hover:bg-green-200 transition-colors px-1.5 py-0.5 rounded text-xs font-bold",children:"E"})]}),"aspdma_result"===s&&a.data.selected_action&&(0,t.jsxs)("span",{title:"Action: ".concat(a.data.selected_action),className:"jsx-4ba9c439904a7ffe mr-2 px-1.5 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-bold",children:[B(a.data.selected_action),a.data.is_recursive&&(0,t.jsx)("span",{title:"Recursive",className:"jsx-4ba9c439904a7ffe ml-1",children:"\uD83D\uDD01"})]}),"conscience_result"===s&&(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe "+"mr-2 px-1.5 py-0.5 rounded text-xs font-bold ".concat("EXEMPT"===H(a.data.conscience_passed,a.data.selected_action||"")?"bg-gray-100 text-gray-700":a.data.conscience_passed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[H(a.data.conscience_passed,a.data.selected_action||""),a.data.is_recursive&&(0,t.jsx)("span",{title:"Recursive",className:"jsx-4ba9c439904a7ffe ml-1",children:"\uD83D\uDD01"})]}),"action_result"===s&&a.data.action_executed&&(0,t.jsx)("span",{title:"Executed: ".concat(a.data.action_executed),className:"jsx-4ba9c439904a7ffe mr-2 px-1.5 py-0.5 bg-purple-100 text-purple-800 rounded text-xs font-bold",children:B(a.data.action_executed)}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-green-600",children:"✓"})]}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe p-2 bg-white border-t border-green-200 text-xs",children:Q(s,a.data,"thought-".concat(e.thoughtId,"-dma"))})]},s)})})]},e.thoughtId)})})]})})]},"msg-".concat(a.id||s))}{let s=e.data;return(0,t.jsxs)("details",{className:"jsx-4ba9c439904a7ffe border rounded-lg",children:[(0,t.jsx)("summary",{className:"jsx-4ba9c439904a7ffe "+"cursor-pointer p-3 ".concat(s.color," text-white rounded-t-lg ").concat(s.completed?"opacity-60":""),children:(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe space-y-2",children:[(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex justify-between items-center",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe font-medium",children:s.description||s.taskId.slice(-8)}),(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe text-xs",children:[s.thoughts.length," thought(s)"]})]}),(()=>{let e=q(s.thoughts);return e?(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex gap-4 text-xs opacity-90",children:[(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex items-center gap-1",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe",children:"Carbon:"}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe font-mono",children:p(e.carbonGrams)})]}),(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex items-center gap-1",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe",children:"Water:"}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe font-mono",children:h(e.waterMl)})]}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe flex items-center gap-1",children:(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe",children:[e.tokens.toLocaleString()," tokens"]})})]}):null})()]})}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe p-3 space-y-2 bg-gray-50",children:s.thoughts.map(e=>{var s,a,n,r,l,c,i;let d=e.stages.get("thought_start"),o=(null==d||null==(s=d.data)?void 0:s.thought_content)||"Processing thought...",x=o.length>80?o.substring(0,80)+"...":o;if("basic"===v){let s=e.stages.get("dma_results"),d=e.stages.get("aspdma_result"),o=e.stages.get("conscience_result"),m=e.stages.get("action_result"),u=(null==d||null==(a=d.data)?void 0:a.is_recursive)||(null==o||null==(n=o.data)?void 0:n.is_recursive);return(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe border border-gray-200 rounded p-2 bg-white space-y-1",children:[(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe text-sm font-medium mb-2",children:x}),(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex flex-wrap gap-1 items-center text-xs",children:[s&&(0,t.jsx)("span",{title:"DMAs",className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-gray-100 rounded font-bold",children:"CS\xb7DS\xb7E"}),(null==d||null==(r=d.data)?void 0:r.selected_action)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-blue-100 text-blue-800 rounded font-bold",children:B(d.data.selected_action)})]}),o&&(null==d||null==(l=d.data)?void 0:l.selected_action)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe "+"px-1.5 py-0.5 rounded font-bold ".concat("EXEMPT"===H(o.data.conscience_passed,d.data.selected_action)?"bg-gray-100 text-gray-700":o.data.conscience_passed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:H(o.data.conscience_passed,d.data.selected_action)})]}),u&&(null==d||null==(c=d.data)?void 0:c.selected_action)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{title:"Recursive",className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-blue-100 text-blue-800 rounded font-bold opacity-75",children:B(d.data.selected_action)}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{title:"Recursive",className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-green-100 text-green-800 rounded font-bold opacity-75",children:"PASSED"})]}),(null==m||null==(i=m.data)?void 0:i.action_executed)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-400",children:"→"}),(0,t.jsx)("span",{title:"Executed",className:"jsx-4ba9c439904a7ffe px-1.5 py-0.5 bg-purple-100 text-purple-800 rounded font-bold",children:B(m.data.action_executed)})]})]})]},e.thoughtId)}return(0,t.jsxs)("details",{className:"jsx-4ba9c439904a7ffe border border-gray-200 rounded",children:[(0,t.jsxs)("summary",{className:"jsx-4ba9c439904a7ffe cursor-pointer p-2 bg-white hover:bg-gray-50",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-sm font-medium",children:x}),(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe text-xs text-gray-500 ml-2",children:["(",e.stages.size,"/6 stages)"]})]}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe p-2 bg-gray-100 space-y-1",children:U.map(s=>{let a=e.stages.get(s);if(!a)return(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe flex items-center p-2 rounded text-xs bg-gray-200",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe mr-2 font-bold text-gray-600",children:W(s)}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-500",children:s.replace(/_/g," ").toUpperCase()})]},s);let n=a.data.timestamp?new Date(a.data.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}):"";return(0,t.jsxs)("details",{className:"jsx-4ba9c439904a7ffe bg-green-50 border border-green-200 rounded",children:[(0,t.jsxs)("summary",{className:"jsx-4ba9c439904a7ffe flex items-center p-2 cursor-pointer hover:bg-green-100 rounded text-xs",children:[(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe mr-2 font-bold text-green-700",children:W(s)}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe font-medium flex-1",children:s.replace(/_/g," ").toUpperCase()}),n&&(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-gray-500 text-xs mr-2",children:n}),"dma_results"===s&&(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe flex gap-1 mr-2",children:[(0,t.jsx)("span",{title:"Common Sense DMA",onClick:s=>{let a=s.currentTarget.closest("details");(null==a?void 0:a.open)&&s.stopPropagation(),K(s=>({...s,["thought-".concat(e.thoughtId,"-dma")]:"csdma"}))},className:"jsx-4ba9c439904a7ffe cursor-pointer hover:bg-green-200 transition-colors px-1.5 py-0.5 rounded text-xs font-bold",children:"CS"}),(0,t.jsx)("span",{title:"Domain Specific DMA",onClick:s=>{let a=s.currentTarget.closest("details");(null==a?void 0:a.open)&&s.stopPropagation(),K(s=>({...s,["thought-".concat(e.thoughtId,"-dma")]:"dsdma"}))},className:"jsx-4ba9c439904a7ffe cursor-pointer hover:bg-green-200 transition-colors px-1.5 py-0.5 rounded text-xs font-bold",children:"DS"}),(0,t.jsx)("span",{title:"Ethical DMA",onClick:s=>{let a=s.currentTarget.closest("details");(null==a?void 0:a.open)&&s.stopPropagation(),K(s=>({...s,["thought-".concat(e.thoughtId,"-dma")]:"pdma"}))},className:"jsx-4ba9c439904a7ffe cursor-pointer hover:bg-green-200 transition-colors px-1.5 py-0.5 rounded text-xs font-bold",children:"E"})]}),"aspdma_result"===s&&a.data.selected_action&&(0,t.jsxs)("span",{title:"Action: ".concat(a.data.selected_action),className:"jsx-4ba9c439904a7ffe mr-2 px-1.5 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-bold",children:[B(a.data.selected_action),a.data.is_recursive&&(0,t.jsx)("span",{title:"Recursive",className:"jsx-4ba9c439904a7ffe ml-1",children:"\uD83D\uDD01"})]}),"conscience_result"===s&&(0,t.jsxs)("span",{className:"jsx-4ba9c439904a7ffe "+"mr-2 px-1.5 py-0.5 rounded text-xs font-bold ".concat("EXEMPT"===H(a.data.conscience_passed,a.data.selected_action||"")?"bg-gray-100 text-gray-700":a.data.conscience_passed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[H(a.data.conscience_passed,a.data.selected_action||""),a.data.is_recursive&&(0,t.jsx)("span",{title:"Recursive",className:"jsx-4ba9c439904a7ffe ml-1",children:"\uD83D\uDD01"})]}),"action_result"===s&&a.data.action_executed&&(0,t.jsx)("span",{title:"Executed: ".concat(a.data.action_executed),className:"jsx-4ba9c439904a7ffe mr-2 px-1.5 py-0.5 bg-purple-100 text-purple-800 rounded text-xs font-bold",children:B(a.data.action_executed)}),(0,t.jsx)("span",{className:"jsx-4ba9c439904a7ffe text-green-600",children:"✓"})]}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe p-2 bg-white border-t border-green-200 text-xs",children:Q(s,a.data,"thought-".concat(e.thoughtId,"-dma"))})]},s)})})]},e.thoughtId)})})]},"task-".concat(s.taskId))}})})}),(0,t.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!n.trim())return;let s=n.trim();b(""),P.mutate(s)},className:"jsx-4ba9c439904a7ffe flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:n,onChange:e=>b(e.target.value),placeholder:"Type your message...",className:"jsx-4ba9c439904a7ffe flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),(0,t.jsx)("button",{type:"submit",disabled:P.isPending,className:"jsx-4ba9c439904a7ffe px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Send"})]})]})})}),(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe max-w-7xl mx-auto space-y-6",children:[(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe bg-white shadow rounded-lg",children:(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe px-4 py-5 sm:p-6",children:[(0,t.jsx)("h3",{className:"jsx-4ba9c439904a7ffe text-lg font-medium text-gray-900 mb-2",children:"Detailed view of the CIRIS reasoning and machine conscience pipeline"}),(0,t.jsx)("p",{className:"jsx-4ba9c439904a7ffe text-sm text-gray-600 mb-4",children:"This diagram shows the complete CIRIS Agent pipeline that processes each thought through context gathering and then multiple stages of analysis, including what COULD and SHOULD be done from 3 different perspectives simultaneously, principled action selection from 10 verbs, and conscience evaluation of whether this action aligns with CIRIS principles and the agents own identity and past actions."}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe w-full bg-gray-50 rounded-lg p-4",children:J?(0,t.jsx)("div",{style:{maxWidth:"100%",overflow:"visible"},className:"jsx-4ba9c439904a7ffe w-full",children:(0,t.jsx)("div",{dangerouslySetInnerHTML:{__html:J},style:{width:"100%",height:"auto"},className:"jsx-4ba9c439904a7ffe"})}):(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe flex items-center justify-center h-[150px] text-gray-500",children:"Loading pipeline visualization..."})})]})}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe bg-white shadow rounded-lg",children:(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe px-4 py-5 sm:p-6",children:[(0,t.jsx)("h3",{className:"jsx-4ba9c439904a7ffe text-lg font-medium text-gray-900 mb-2",children:"Environmental Impact Calculation"}),(0,t.jsxs)("div",{className:"jsx-4ba9c439904a7ffe text-sm text-gray-600 space-y-3 prose prose-sm max-w-none",children:[(0,t.jsx)("p",{className:"jsx-4ba9c439904a7ffe",children:"Water consumption is estimated using a hybrid approach combining two peer-reviewed methodologies:"}),(0,t.jsxs)("ol",{className:"jsx-4ba9c439904a7ffe list-decimal list-inside space-y-2 ml-2",children:[(0,t.jsxs)("li",{className:"jsx-4ba9c439904a7ffe",children:[(0,t.jsx)("strong",{className:"jsx-4ba9c439904a7ffe",children:"WUE-Based Calculation:"})," Uses Water Usage Effectiveness (WUE) metrics for Illinois-hosted data centers. We assume 1.5 L/kWh based on Midwest climate conditions and evaporative cooling systems (between industry average of 1.8 L/kWh and best-in-class of 0.3 L/kWh)."]}),(0,t.jsxs)("li",{className:"jsx-4ba9c439904a7ffe",children:[(0,t.jsx)("strong",{className:"jsx-4ba9c439904a7ffe",children:"Per-Token Estimation:"})," Based on a November 2024 study published in ",(0,t.jsx)("em",{className:"jsx-4ba9c439904a7ffe",children:"Nature Scientific Reports"})," examining Meta's Llama-3-70B model, which found approximately 0.4 ml of water consumption per token (including both operational and embodied environmental footprints). This is adjusted proportionally for the Llama-4-Maverick-17B model (17B/70B = ~0.097 ml/token)."]})]}),(0,t.jsx)("p",{className:"jsx-4ba9c439904a7ffe",children:"The final estimate is the average of both methods to provide a defensible, conservative estimate. Water usage includes both direct cooling water consumption and indirect water footprint from electricity generation."}),(0,t.jsxs)("p",{className:"jsx-4ba9c439904a7ffe",children:[(0,t.jsx)("strong",{className:"jsx-4ba9c439904a7ffe",children:"Carbon Emissions:"})," Calculated based on the energy consumption of the inference request and the carbon intensity of the electrical grid serving the data center."]}),(0,t.jsx)("div",{className:"jsx-4ba9c439904a7ffe mt-4 pt-4 border-t border-gray-200",children:(0,t.jsxs)("p",{className:"jsx-4ba9c439904a7ffe text-xs text-gray-500",children:[(0,t.jsx)("strong",{className:"jsx-4ba9c439904a7ffe",children:"Data Sources:"}),' Nature Scientific Reports (2024): "Reconciling the contrasting narratives on the environmental impact of large language models"; ISO/IEC 30134-9 WUE Standard; Regional data center efficiency benchmarks (AWS, Microsoft, Equinix)']})})]})]})})]})]})]})]})}},6264:(e,s,a)=>{"use strict";a.d(s,{O:()=>c});var t=a(4568),n=a(7620),r=a(2942),l=a(9484);function c(e){let{children:s,requiredRole:a,requiredPermission:c}=e,{user:i,loading:d,hasRole:o,hasPermission:x}=(0,l.A)(),m=(0,r.useRouter)();return((0,n.useEffect)(()=>{if(!d){if(!i)return void m.push("/login");if(a&&!o(a)||c&&!x(c))return void m.push("/unauthorized")}},[i,d,a,c,o,x,m]),d)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"text-lg",children:"Loading..."})}):i&&(!a||o(a))&&(!c||x(c))?(0,t.jsx)(t.Fragment,{children:s}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[4534,8903,3297,9090,704,3835,587,8315,7358],()=>s(127)),_N_E=e.O()}]);