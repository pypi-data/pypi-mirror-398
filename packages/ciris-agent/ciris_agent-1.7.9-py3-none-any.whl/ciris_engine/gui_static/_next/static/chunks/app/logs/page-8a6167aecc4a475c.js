(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1524],{2463:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var o=r(4568),n=r(7620),i=r(3297),l=r(704),a=r(9484),s=r(6264),d=r(3237),c=r(4541);let u={ERROR:{color:"#ef4444",bgColor:"#fee2e2",label:"ERROR"},WARN:{color:"#f59e0b",bgColor:"#fef3c7",label:"WARN"},INFO:{color:"#3b82f6",bgColor:"#dbeafe",label:"INFO"},DEBUG:{color:"#6b7280",bgColor:"#f3f4f6",label:"DEBUG"}},g=["ALL","ERROR","WARN","INFO","DEBUG"];function h(){let{user:e}=(0,a.A)(),[t,r]=(0,n.useState)("ALL"),[h,f]=(0,n.useState)("ALL"),[m,p]=(0,n.useState)(""),[x,b]=(0,n.useState)(!0),[y,v]=(0,n.useState)(new Set),[C,j]=(0,n.useState)(!0),[S,A]=(0,n.useState)(5e3),[R,w]=(0,n.useState)(100),k=(0,n.useRef)(null),L=(0,n.useRef)(null),{data:I,refetch:N}=(0,i.I)({queryKey:["logs",t,h,R],queryFn:()=>l.AQ.telemetry.getLogs("ALL"===t?void 0:t,"ALL"===h?void 0:h,R),refetchInterval:S,refetchIntervalInBackground:!1}),{data:O,refetch:_}=(0,i.I)({queryKey:["incidents"],queryFn:()=>l.AQ.telemetry.getIncidents({limit:50}),refetchInterval:2*S,enabled:C}),E=n.useMemo(()=>{if(!I)return["ALL"];let e=new Set(["ALL"]);return I.forEach(t=>{t.service&&e.add(t.service)}),Array.from(e).sort()},[I]),T=n.useMemo(()=>I?I.filter(e=>("ALL"===t||e.level===t)&&("ALL"===h||e.service===h)&&(!m||!!e.message.toLowerCase().includes(m.toLowerCase()))):[],[I,t,h,m]);(0,n.useEffect)(()=>{x&&k.current&&k.current.scrollIntoView({behavior:"smooth"})},[T,x]);let U=e=>{v(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},D=e=>{let t="[".concat(e.timestamp,"] [").concat(e.level,"] [").concat(e.service,"] ").concat(e.message).concat(e.metadata?"\nMetadata: "+JSON.stringify(e.metadata,null,2):"");navigator.clipboard.writeText(t),d.Ay.success("Copied to clipboard")};return(0,o.jsx)(s.O,{children:(0,o.jsxs)("div",{style:{height:"calc(100vh - 2rem)",display:"flex",flexDirection:"column"},children:[(0,o.jsx)("h1",{style:{margin:"0 0 1rem 0"},children:"System Logs"}),(0,o.jsxs)("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem",flexWrap:"wrap",padding:"1rem",backgroundColor:"#f5f5f5",borderRadius:"8px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:{marginRight:"0.5rem"},children:"Level:"}),(0,o.jsx)("select",{value:t,onChange:e=>r(e.target.value),style:{padding:"0.25rem 0.5rem",borderRadius:"4px",border:"1px solid #ddd"},children:g.map(e=>(0,o.jsx)("option",{value:e,children:e},e))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:{marginRight:"0.5rem"},children:"Service:"}),(0,o.jsx)("select",{value:h,onChange:e=>f(e.target.value),style:{padding:"0.25rem 0.5rem",borderRadius:"4px",border:"1px solid #ddd"},children:E.map(e=>(0,o.jsx)("option",{value:e,children:e},e))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:{marginRight:"0.5rem"},children:"Limit:"}),(0,o.jsxs)("select",{value:R,onChange:e=>w(Number(e.target.value)),style:{padding:"0.25rem 0.5rem",borderRadius:"4px",border:"1px solid #ddd"},children:[(0,o.jsx)("option",{value:"50",children:"50"}),(0,o.jsx)("option",{value:"100",children:"100"}),(0,o.jsx)("option",{value:"200",children:"200"}),(0,o.jsx)("option",{value:"500",children:"500"})]})]}),(0,o.jsx)("div",{style:{flex:1},children:(0,o.jsx)("input",{type:"text",placeholder:"Search logs...",value:m,onChange:e=>p(e.target.value),style:{width:"100%",padding:"0.25rem 0.5rem",borderRadius:"4px",border:"1px solid #ddd"}})}),(0,o.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",checked:x,onChange:e=>b(e.target.checked),style:{marginRight:"0.25rem"}}),"Auto-scroll"]}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",checked:C,onChange:e=>j(e.target.checked),style:{marginRight:"0.25rem"}}),"Show Incidents"]}),(0,o.jsx)("button",{onClick:()=>{N(),C&&_(),d.Ay.success("Logs refreshed")},style:{padding:"0.25rem 1rem",borderRadius:"4px",border:"none",backgroundColor:"#3b82f6",color:"white",cursor:"pointer"},children:"Refresh"}),(0,o.jsx)("button",{onClick:()=>{let e=new Blob([JSON.stringify(T.map(e=>({timestamp:e.timestamp,level:e.level,service:e.service,message:e.message,metadata:e.metadata})),null,2)],{type:"application/json"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="ciris-logs-".concat((0,c.A)(new Date,"yyyy-MM-dd-HHmmss"),".json"),r.click(),URL.revokeObjectURL(t),d.Ay.success("Logs exported")},style:{padding:"0.25rem 1rem",borderRadius:"4px",border:"none",backgroundColor:"#10b981",color:"white",cursor:"pointer"},children:"Export"})]})]}),(0,o.jsxs)("div",{style:{flex:1,display:"flex",gap:"1rem",minHeight:0},children:[(0,o.jsxs)("div",{style:{flex:C?2:1,display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{style:{padding:"0.5rem 1rem",backgroundColor:"#f5f5f5",borderRadius:"8px 8px 0 0",fontWeight:"bold"},children:["Logs (",T.length," entries)"]}),(0,o.jsxs)("div",{ref:L,onScroll:()=>{if(!L.current)return;let{scrollTop:e,scrollHeight:t,clientHeight:r}=L.current,o=t-e-r<10;!o&&x?b(!1):o&&!x&&b(!0)},style:{flex:1,backgroundColor:"#1a1a1a",color:"#e5e5e5",padding:"1rem",overflowY:"auto",fontFamily:'Consolas, Monaco, "Courier New", monospace',fontSize:"13px",lineHeight:"1.5",borderRadius:"0 0 8px 8px"},children:[0===T.length?(0,o.jsx)("div",{style:{color:"#666",textAlign:"center",padding:"2rem"},children:"No logs matching current filters"}):T.map(e=>{let t=u[e.level]||u.INFO,r=y.has(e.id),n=e.metadata&&Object.keys(e.metadata).length>0;return(0,o.jsxs)("div",{style:{marginBottom:"0.5rem",padding:"0.5rem",backgroundColor:"#2a2a2a",borderRadius:"4px",borderLeft:"4px solid ".concat(t.color),position:"relative"},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.5rem",width:"100%"},children:[(0,o.jsx)("span",{style:{color:"#888",fontSize:"11px",whiteSpace:"nowrap",flexShrink:0},children:(0,c.A)(new Date(e.timestamp),"HH:mm:ss.SSS")}),(0,o.jsxs)("span",{style:{color:t.color,fontWeight:"bold",fontSize:"11px",minWidth:"50px",flexShrink:0},children:["[",e.level,"]"]}),(0,o.jsxs)("span",{style:{color:"#66d9ef",fontSize:"11px",minWidth:"100px",flexShrink:0},children:["[",e.service,"]"]}),(0,o.jsx)("span",{style:{flex:1,wordBreak:"break-word",cursor:n?"pointer":"default",minWidth:0,overflow:"hidden"},onClick:()=>n&&U(e.id),children:e.message}),(0,o.jsx)("button",{onClick:()=>D(e),style:{padding:"2px 6px",fontSize:"11px",backgroundColor:"#444",color:"#aaa",border:"none",borderRadius:"3px",cursor:"pointer"},title:"Copy to clipboard",children:"Copy"})]}),n&&r&&(0,o.jsx)("div",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:"#1a1a1a",borderRadius:"4px",fontSize:"12px",color:"#999"},children:(0,o.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap"},children:JSON.stringify(e.metadata,null,2)})})]},e.id)}),(0,o.jsx)("div",{ref:k})]})]}),C&&(0,o.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column",maxWidth:"400px"},children:[(0,o.jsxs)("div",{style:{padding:"0.5rem 1rem",backgroundColor:"#fee2e2",borderRadius:"8px 8px 0 0",fontWeight:"bold",color:"#991b1b"},children:["Incidents (",(null==O?void 0:O.length)||0,")"]}),(0,o.jsx)("div",{style:{flex:1,backgroundColor:"#fef2f2",padding:"1rem",overflowY:"auto",borderRadius:"0 0 8px 8px"},children:O&&0!==O.length?O.map(e=>(0,o.jsxs)("div",{style:{marginBottom:"0.75rem",padding:"0.75rem",backgroundColor:"white",borderRadius:"6px",border:"1px solid #fecaca",fontSize:"14px"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,o.jsx)("span",{style:{fontWeight:"bold",color:"CRITICAL"===e.severity?"#dc2626":"#f59e0b"},children:e.severity}),(0,o.jsx)("span",{style:{fontSize:"12px",color:"#666"},children:(0,c.A)(new Date(e.timestamp),"HH:mm:ss")})]}),(0,o.jsx)("div",{style:{fontSize:"12px",color:"#4b5563",marginBottom:"0.25rem"},children:e.service}),(0,o.jsx)("div",{style:{color:"#1f2937"},children:e.message}),e.resolved&&(0,o.jsx)("div",{style:{marginTop:"0.5rem",fontSize:"12px",color:"#10b981"},children:"âœ“ Resolved"})]},e.id)):(0,o.jsx)("div",{style:{color:"#666",textAlign:"center",padding:"2rem"},children:"No recent incidents"})})]})]}),(0,o.jsx)("div",{style:{marginTop:"0.5rem",fontSize:"12px",color:"#666",textAlign:"right"},children:S>0?"Auto-refreshing every ".concat(S/1e3,"s"):"Auto-refresh disabled"})]})})}},2942:(e,t,r)=>{"use strict";var o=r(2418);r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},3120:(e,t,r)=>{"use strict";r.d(t,{_:()=>a});var o=r(704);function n(){let e=window.location.hostname,t=window.location.pathname,r=t.startsWith("/agent/");if("agents.ciris.ai"!==e&&!r)return{mode:"standalone",agentId:"default",apiBase:"/v1"};{let e="default";e=r?t.split("/")[2]||"default":localStorage.getItem("selectedAgentId")||"default";let o="/api/".concat(e,"/v1");return{mode:"managed",agentId:e,apiBase:o}}}var i=r(5950);class l{configure(e,t){let r,{mode:o}=n();if("managed"===o)r="".concat(window.location.origin,"/api/").concat(e);else{let t=localStorage.getItem("agent_".concat(e,"_api_url"));r=t||window.location.origin}t||(t=i.a.getAccessToken()||void 0);let l={baseURL:r,authToken:t,agentId:e,mode:o};return this.hasConfigChanged(l)&&this.applyConfiguration(l),l}configureForOAuthCallback(e,t){let r,{mode:o}=n(),i={baseURL:"managed"===o?"".concat(window.location.origin,"/api/").concat(e):window.location.origin,authToken:t,agentId:e,mode:o};return this.applyConfiguration(i),this.storeConfiguration(i),i}getCurrentConfig(){return this.currentConfig}isConfiguredFor(e){return!!this.currentConfig&&this.currentConfig.agentId===e&&!!this.currentConfig.authToken}clear(){this.currentConfig=null,localStorage.removeItem("sdk_config"),this.log("SDK configuration cleared")}applyConfiguration(e){this.log("Applying SDK configuration:",e),o.AQ.setConfig({baseURL:e.baseURL,authToken:e.authToken}),this.currentConfig=e,this.log("SDK configured successfully")}hasConfigChanged(e){return!this.currentConfig||this.currentConfig.baseURL!==e.baseURL||this.currentConfig.authToken!==e.authToken||this.currentConfig.agentId!==e.agentId||this.currentConfig.mode!==e.mode}storeConfiguration(e){let t={baseURL:e.baseURL,agentId:e.agentId,mode:e.mode};localStorage.setItem("sdk_config",JSON.stringify(t)),"standalone"===e.mode&&e.baseURL!==window.location.origin&&localStorage.setItem("agent_".concat(e.agentId,"_api_url"),e.baseURL)}restoreConfiguration(){let e=localStorage.getItem("sdk_config");if(!e)return null;try{let t=JSON.parse(e),r=i.a.getAccessToken()||void 0;return{...t,authToken:r}}catch(e){return null}}log(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.debugMode&&console.log("[SDKConfigManager]",...t)}constructor(){this.currentConfig=null,this.debugMode=!1}}let a=new l},4169:(e,t,r)=>{Promise.resolve().then(r.bind(r,2463))},6264:(e,t,r)=>{"use strict";r.d(t,{O:()=>a});var o=r(4568),n=r(7620),i=r(2942),l=r(9484);function a(e){let{children:t,requiredRole:r,requiredPermission:a}=e,{user:s,loading:d,hasRole:c,hasPermission:u}=(0,l.A)(),g=(0,i.useRouter)();return((0,n.useEffect)(()=>{if(!d){if(!s)return void g.push("/login");if(r&&!c(r)||a&&!u(a))return void g.push("/unauthorized")}},[s,d,r,a,c,u,g]),d)?(0,o.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,o.jsx)("div",{className:"text-lg",children:"Loading..."})}):s&&(!r||c(r))&&(!a||u(a))?(0,o.jsx)(o.Fragment,{children:t}):null}},9484:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,O:()=>c});var o=r(4568),n=r(7620),i=r(2942),l=r(3237),a=r(704),s=r(3120);let d=(0,n.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,n.useState)(null),[u,g]=(0,n.useState)(!0),[h,f]=(0,n.useState)(null),m=(0,i.useRouter)();(0,n.useEffect)(()=>{let e=window.location.pathname;"/login"===e||e.startsWith("/manager")?g(!1):p();let t=localStorage.getItem("manager_token");t&&f(t)},[]);let p=async()=>{try{if(a.AQ.isAuthenticated()){let e=await a.AQ.auth.getMe();c(e)}}catch(e){console.error("Auth check failed:",e)}finally{g(!1)}},x=(0,n.useCallback)(async(e,t)=>{try{let r=localStorage.getItem("selectedAgentId");if(!r)throw Error("No agent selected");s._.configure(r);let o=await a.AQ.login(e,t),n=a.AQ.auth.getAccessToken();n&&s._.configure(r,n),c(o),l.Ay.success("Welcome, ".concat(o.username||o.user_id,"!")),m.push("/")}catch(e){throw l.Ay.error(e.message||"Login failed"),e}},[m]),b=(0,n.useCallback)(async()=>{try{await a.AQ.logout(),c(null),l.Ay.success("Logged out successfully"),m.push("/login")}catch(e){console.error("Logout failed:",e),l.Ay.error("Logout failed")}},[m]),y=(0,n.useCallback)(e=>!!r&&(r.permissions.includes(e)||"SYSTEM_ADMIN"===r.role),[r]),v=(0,n.useCallback)(e=>{if(!r)return!1;let t=["OBSERVER","ADMIN","AUTHORITY","SYSTEM_ADMIN"];return t.indexOf(r.role)>=t.indexOf(e)},[r]),C=(0,n.useCallback)(e=>{a.AQ.setConfig({authToken:e})},[]),j=(0,n.useCallback)(()=>!!h,[h]);return(0,o.jsx)(d.Provider,{value:{user:r,loading:u,login:x,logout:b,hasPermission:y,hasRole:v,setUser:c,setToken:C,managerToken:h,setManagerToken:f,isManagerAuthenticated:j},children:t})}function u(){let e=(0,n.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[4534,8903,3297,4541,704,587,8315,7358],()=>t(4169)),_N_E=e.O()}]);