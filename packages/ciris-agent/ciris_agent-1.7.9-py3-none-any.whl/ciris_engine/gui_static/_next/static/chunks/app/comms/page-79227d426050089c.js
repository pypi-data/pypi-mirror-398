(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9652],{589:(e,t,s)=>{"use strict";s.d(t,{$:()=>o,s:()=>a});var i=s(494),r=s(6759),n=s(1279),a=class extends r.k{#e;#t;#s;constructor(e){super(),this.mutationId=e.mutationId,this.#t=e.mutationCache,this.#e=[],this.state=e.state||o(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#e.includes(e)||(this.#e.push(e),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#e=this.#e.filter(t=>t!==e),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#e.length||("pending"===this.state.status?this.scheduleGc():this.#t.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){let t=()=>{this.#i({type:"continue"})};this.#s=(0,n.II)({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(Error("No mutationFn found")),onFail:(e,t)=>{this.#i({type:"failed",failureCount:e,error:t})},onPause:()=>{this.#i({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});let s="pending"===this.state.status,i=!this.#s.canStart();try{if(s)t();else{this.#i({type:"pending",variables:e,isPaused:i}),await this.#t.config.onMutate?.(e,this);let t=await this.options.onMutate?.(e);t!==this.state.context&&this.#i({type:"pending",context:t,variables:e,isPaused:i})}let r=await this.#s.start();return await this.#t.config.onSuccess?.(r,e,this.state.context,this),await this.options.onSuccess?.(r,e,this.state.context),await this.#t.config.onSettled?.(r,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(r,null,e,this.state.context),this.#i({type:"success",data:r}),r}catch(t){try{throw await this.#t.config.onError?.(t,e,this.state.context,this),await this.options.onError?.(t,e,this.state.context),await this.#t.config.onSettled?.(void 0,t,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,t,e,this.state.context),t}finally{this.#i({type:"error",error:t})}}finally{this.#t.runNext(this)}}#i(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),i.jG.batch(()=>{this.#e.forEach(t=>{t.onMutationUpdate(e)}),this.#t.notify({mutation:this,type:"updated",action:e})})}};function o(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}},3389:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var i=s(4568),r=s(7620),n=s(7606),a=s(3297),o=s(6258),c=s(704),d=s(3237),l=s(4893),u=s(9484),h=s(3835),m=s(7261),x=s.n(m);function g(){return(0,i.jsx)("div",{className:"min-h-[400px] flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"mb-4",children:(0,i.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})})}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Agents Available"}),(0,i.jsx)("p",{className:"text-sm text-gray-500 mb-6 max-w-md mx-auto",children:"No CIRIS agents are currently running. Please create an agent using the Manager interface to get started."}),(0,i.jsx)(x(),{href:"/manager",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Go to Manager"})]})})}var f=s(7192),p=s(8924);function b(){let{user:e}=(0,u.A)(),{currentAgent:t,isLoadingAgents:s}=(0,h.f)(),[m,x]=(0,r.useState)(""),[b,y]=(0,r.useState)(!1),[v,w]=(0,r.useState)(!1),[j,N]=(0,r.useState)("User requested graceful shutdown"),[E,C]=(0,r.useState)("EMERGENCY: Immediate shutdown required"),[S,M]=(0,r.useState)({isOpen:!1,message:"",details:void 0}),R=(0,r.useRef)(null),O=(0,n.jE)(),{data:I,isLoading:k}=(0,a.I)({queryKey:["conversation-history"],queryFn:async()=>await c.AQ.agent.getHistory({channel_id:"api_0.0.0.0_8080",limit:20}),refetchInterval:2e3,enabled:!!t}),{data:A,isError:T}=(0,a.I)({queryKey:["agent-status"],queryFn:()=>c.AQ.agent.getStatus(),refetchInterval:5e3,enabled:!!t}),P=(0,o.n)({mutationFn:async e=>await c.AQ.agent.interact(e,{channel_id:"api_0.0.0.0_8080"}),onSuccess:e=>{x(""),O.invalidateQueries({queryKey:["conversation-history"]}),e.response&&d.Ay.success("Agent: ".concat(e.response),{duration:5e3})},onError:e=>{var t;console.error("Send message error:",e),M({isOpen:!0,message:(0,f.PE)(e),details:(null==(t=e.response)?void 0:t.data)||e.details})}}),D=(0,o.n)({mutationFn:async()=>await c.AQ.system.shutdown(j,!0,!1),onSuccess:e=>{d.Ay.success("Shutdown initiated: ".concat(e.message),{duration:1e4}),y(!1),O.invalidateQueries({queryKey:["agent-status"]})},onError:e=>{console.error("Shutdown error:",e);let t=(0,f.PE)(e);d.Ay.error(t)}}),G=(0,o.n)({mutationFn:async()=>await c.AQ.system.shutdown(E,!0,!0),onSuccess:e=>{d.Ay.success("EMERGENCY SHUTDOWN INITIATED: ".concat(e.message),{duration:1e4,style:{background:"#dc2626",color:"white"}}),w(!1)},onError:e=>{console.error("Emergency shutdown error:",e);let t=(0,f.PE)(e);d.Ay.error(t)}});(0,r.useEffect)(()=>{var e;null==(e=R.current)||e.scrollIntoView({behavior:"smooth"})},[I]);let _=(0,r.useMemo)(()=>(null==I?void 0:I.messages)?[...I.messages].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()).slice(-20):[],[I]);return s||t?(0,i.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,i.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,i.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Agent Communications"}),(0,i.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[(0,i.jsxs)("span",{className:"flex items-center ".concat(!T&&A?"text-green-600":"text-red-600"),children:[(0,i.jsx)(l.md,{status:!T&&A?"green":"red",className:"mr-2"}),!T&&A?"Connected":"Disconnected"]}),A&&(0,i.jsxs)("span",{className:"text-gray-600",children:["State: ",(0,i.jsx)("span",{className:"font-medium",children:A.cognitive_state})]}),(0,i.jsx)("button",{onClick:()=>y(!0),className:"ml-4 px-3 py-1 text-xs font-medium text-red-600 border border-red-600 rounded-md hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Shutdown"}),(0,i.jsx)("button",{onClick:()=>{(null==e?void 0:e.role)==="OBSERVER"?d.Ay.error("WISE AUTHORITY OR SYSTEM AUTHORITY REQUIRED",{duration:5e3,style:{background:"#dc2626",color:"white"}}):w(!0)},className:"ml-2 px-3 py-1 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"EMERGENCY STOP"})]})]}),(0,i.jsx)("div",{className:"border rounded-lg bg-gray-50 h-96 overflow-y-auto p-4 mb-4",children:k?(0,i.jsx)("div",{className:"text-center text-gray-500",children:"Loading conversation..."}):0===_.length?(0,i.jsx)("div",{className:"text-center text-gray-500",children:"No messages yet. Start a conversation!"}):(0,i.jsxs)("div",{className:"space-y-3",children:[_.map((e,t)=>(0===t&&console.log("Message structure:",e),(0,i.jsx)("div",{className:"flex ".concat(e.is_agent?"justify-start":"justify-end"),children:(0,i.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(e.is_agent?"bg-white border border-gray-200":"bg-blue-600 text-white"),children:[(0,i.jsxs)("div",{className:"text-xs mb-1 ".concat(e.is_agent?"text-gray-500":"text-blue-100"),children:[e.author||(e.is_agent?"CIRIS":"You")," • ",new Date(e.timestamp).toLocaleTimeString()]}),(0,i.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:e.content})]})},e.id||t))),(0,i.jsx)("div",{ref:R})]})}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mb-2",children:"Showing last 20 messages"}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),m.trim()&&P.mutate(m.trim())},className:"flex space-x-3",children:[(0,i.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),placeholder:"Type your message...",disabled:P.isPending,className:"flex-1 min-w-0 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:opacity-50"}),(0,i.jsx)("button",{type:"submit",disabled:P.isPending||!m.trim(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:P.isPending?"Sending...":"Send"})]}),!1]})}),!1,b&&(0,i.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Initiate Graceful Shutdown"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"This will initiate a graceful shutdown of the CIRIS agent. The agent will:"}),(0,i.jsxs)("ul",{className:"list-disc list-inside text-sm text-gray-600 mb-4 space-y-1",children:[(0,i.jsx)("li",{children:"Transition to SHUTDOWN cognitive state"}),(0,i.jsx)("li",{children:"Complete any critical tasks"}),(0,i.jsx)("li",{children:"May send final messages to channels"}),(0,i.jsx)("li",{children:"Perform clean shutdown procedures"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{htmlFor:"shutdown-reason",className:"block text-sm font-medium text-gray-700 mb-2",children:"Shutdown Reason"}),(0,i.jsx)("textarea",{id:"shutdown-reason",rows:3,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:j,onChange:e=>N(e.target.value),placeholder:"Enter reason for shutdown..."})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,i.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),(0,i.jsx)("button",{onClick:()=>D.mutate(),disabled:D.isPending||!j.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:D.isPending?"Initiating...":"Confirm Shutdown"})]})]})}),v&&(0,i.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full border-4 border-red-600",children:[(0,i.jsxs)("h3",{className:"text-lg font-bold text-red-600 mb-4 flex items-center",children:[(0,i.jsx)("svg",{className:"w-6 h-6 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"EMERGENCY SHUTDOWN"]}),(0,i.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-4",children:[(0,i.jsx)("p",{className:"text-sm font-semibold text-red-800 mb-2",children:"⚠️ WARNING: This will IMMEDIATELY terminate the agent!"}),(0,i.jsxs)("ul",{className:"list-disc list-inside text-sm text-red-700 space-y-1",children:[(0,i.jsx)("li",{children:"NO graceful shutdown procedures"}),(0,i.jsx)("li",{children:"NO task completion"}),(0,i.jsx)("li",{children:"NO final messages"}),(0,i.jsx)("li",{children:"IMMEDIATE process termination"})]})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{htmlFor:"emergency-reason",className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Reason (Required)"}),(0,i.jsx)("textarea",{id:"emergency-reason",rows:2,className:"block w-full rounded-md border-red-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm",value:E,onChange:e=>C(e.target.value),placeholder:"Describe the emergency..."})]}),(0,i.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:(0,i.jsxs)("p",{className:"text-xs text-yellow-800",children:[(0,i.jsx)("strong",{children:"Authority Required:"})," This action requires ADMIN, AUTHORITY, or SYSTEM_ADMIN role. Your current role: ",(0,i.jsx)("span",{className:"font-semibold",children:(null==e?void 0:e.role)||"Unknown"})]})}),(0,i.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,i.jsx)("button",{onClick:()=>w(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),(0,i.jsx)("button",{onClick:()=>G.mutate(),disabled:G.isPending||!E.trim(),className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:G.isPending?"TERMINATING...":"EXECUTE EMERGENCY STOP"})]})]})}),(0,i.jsx)(p.A,{isOpen:S.isOpen,onClose:()=>M({isOpen:!1,message:"",details:void 0}),title:"Communication Error",message:S.message,details:S.details})]}):(0,i.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,i.jsx)(g,{})})}},4145:(e,t,s)=>{Promise.resolve().then(s.bind(s,3389))},6258:(e,t,s)=>{"use strict";s.d(t,{n:()=>l});var i=s(7620),r=s(589),n=s(494),a=s(2327),o=s(7703),c=class extends a.Q{#r;#n=void 0;#a;#o;constructor(e,t){super(),this.#r=e,this.setOptions(t),this.bindMethods(),this.#c()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#r.defaultMutationOptions(e),(0,o.f8)(this.options,t)||this.#r.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#a,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,o.EN)(t.mutationKey)!==(0,o.EN)(this.options.mutationKey)?this.reset():this.#a?.state.status==="pending"&&this.#a.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#a?.removeObserver(this)}onMutationUpdate(e){this.#c(),this.#d(e)}getCurrentResult(){return this.#n}reset(){this.#a?.removeObserver(this),this.#a=void 0,this.#c(),this.#d()}mutate(e,t){return this.#o=t,this.#a?.removeObserver(this),this.#a=this.#r.getMutationCache().build(this.#r,this.options),this.#a.addObserver(this),this.#a.execute(e)}#c(){let e=this.#a?.state??(0,r.$)();this.#n={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#d(e){n.jG.batch(()=>{if(this.#o&&this.hasListeners()){let t=this.#n.variables,s=this.#n.context;e?.type==="success"?(this.#o.onSuccess?.(e.data,t,s),this.#o.onSettled?.(e.data,null,t,s)):e?.type==="error"&&(this.#o.onError?.(e.error,t,s),this.#o.onSettled?.(void 0,e.error,t,s))}this.listeners.forEach(e=>{e(this.#n)})})}},d=s(7606);function l(e,t){let s=(0,d.jE)(t),[r]=i.useState(()=>new c(s,e));i.useEffect(()=>{r.setOptions(e)},[r,e]);let a=i.useSyncExternalStore(i.useCallback(e=>r.subscribe(n.jG.batchCalls(e)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),l=i.useCallback((e,t)=>{r.mutate(e,t).catch(o.lQ)},[r]);if(a.error&&(0,o.GU)(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:l,mutateAsync:a.mutate}}}},e=>{var t=t=>e(e.s=t);e.O(0,[4534,8903,3297,8072,704,3835,4789,587,8315,7358],()=>t(4145)),_N_E=e.O()}]);