(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2580],{2942:(e,t,a)=>{"use strict";var n=a(2418);a.o(n,"usePathname")&&a.d(t,{usePathname:function(){return n.usePathname}}),a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}}),a.o(n,"useSearchParams")&&a.d(t,{useSearchParams:function(){return n.useSearchParams}})},3120:(e,t,a)=>{"use strict";a.d(t,{_:()=>i});var n=a(704);function s(){let e=window.location.hostname,t=window.location.pathname,a=t.startsWith("/agent/");if("agents.ciris.ai"!==e&&!a)return{mode:"standalone",agentId:"default",apiBase:"/v1"};{let e="default";e=a?t.split("/")[2]||"default":localStorage.getItem("selectedAgentId")||"default";let n="/api/".concat(e,"/v1");return{mode:"managed",agentId:e,apiBase:n}}}var o=a(5950);class r{configure(e,t){let a,{mode:n}=s();if("managed"===n)a="".concat(window.location.origin,"/api/").concat(e);else{let t=localStorage.getItem("agent_".concat(e,"_api_url"));a=t||window.location.origin}t||(t=o.a.getAccessToken()||void 0);let r={baseURL:a,authToken:t,agentId:e,mode:n};return this.hasConfigChanged(r)&&this.applyConfiguration(r),r}configureForOAuthCallback(e,t){let a,{mode:n}=s(),o={baseURL:"managed"===n?"".concat(window.location.origin,"/api/").concat(e):window.location.origin,authToken:t,agentId:e,mode:n};return this.applyConfiguration(o),this.storeConfiguration(o),o}getCurrentConfig(){return this.currentConfig}isConfiguredFor(e){return!!this.currentConfig&&this.currentConfig.agentId===e&&!!this.currentConfig.authToken}clear(){this.currentConfig=null,localStorage.removeItem("sdk_config"),this.log("SDK configuration cleared")}applyConfiguration(e){this.log("Applying SDK configuration:",e),n.AQ.setConfig({baseURL:e.baseURL,authToken:e.authToken}),this.currentConfig=e,this.log("SDK configured successfully")}hasConfigChanged(e){return!this.currentConfig||this.currentConfig.baseURL!==e.baseURL||this.currentConfig.authToken!==e.authToken||this.currentConfig.agentId!==e.agentId||this.currentConfig.mode!==e.mode}storeConfiguration(e){let t={baseURL:e.baseURL,agentId:e.agentId,mode:e.mode};localStorage.setItem("sdk_config",JSON.stringify(t)),"standalone"===e.mode&&e.baseURL!==window.location.origin&&localStorage.setItem("agent_".concat(e.agentId,"_api_url"),e.baseURL)}restoreConfiguration(){let e=localStorage.getItem("sdk_config");if(!e)return null;try{let t=JSON.parse(e),a=o.a.getAccessToken()||void 0;return{...t,authToken:a}}catch(e){return null}}log(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];this.debugMode&&console.log("[SDKConfigManager]",...t)}constructor(){this.currentConfig=null,this.debugMode=!1}}let i=new r},3727:(e,t,a)=>{Promise.resolve().then(a.bind(a,9585))},9484:(e,t,a)=>{"use strict";a.d(t,{A:()=>g,O:()=>u});var n=a(4568),s=a(7620),o=a(2942),r=a(3237),i=a(704),c=a(3120);let l=(0,s.createContext)(void 0);function u(e){let{children:t}=e,[a,u]=(0,s.useState)(null),[g,d]=(0,s.useState)(!0),[h,f]=(0,s.useState)(null),m=(0,o.useRouter)();(0,s.useEffect)(()=>{let e=window.location.pathname;"/login"===e||e.startsWith("/manager")?d(!1):y();let t=localStorage.getItem("manager_token");t&&f(t)},[]);let y=async()=>{try{if(i.AQ.isAuthenticated()){let e=await i.AQ.auth.getMe();u(e)}}catch(e){console.error("Auth check failed:",e)}finally{d(!1)}},C=(0,s.useCallback)(async(e,t)=>{try{let a=localStorage.getItem("selectedAgentId");if(!a)throw Error("No agent selected");c._.configure(a);let n=await i.AQ.login(e,t),s=i.AQ.auth.getAccessToken();s&&c._.configure(a,s),u(n),r.Ay.success("Welcome, ".concat(n.username||n.user_id,"!")),m.push("/")}catch(e){throw r.Ay.error(e.message||"Login failed"),e}},[m]),p=(0,s.useCallback)(async()=>{try{await i.AQ.logout(),u(null),r.Ay.success("Logged out successfully"),m.push("/login")}catch(e){console.error("Logout failed:",e),r.Ay.error("Logout failed")}},[m]),A=(0,s.useCallback)(e=>!!a&&(a.permissions.includes(e)||"SYSTEM_ADMIN"===a.role),[a]),w=(0,s.useCallback)(e=>{if(!a)return!1;let t=["OBSERVER","ADMIN","AUTHORITY","SYSTEM_ADMIN"];return t.indexOf(a.role)>=t.indexOf(e)},[a]),b=(0,s.useCallback)(e=>{i.AQ.setConfig({authToken:e})},[]),S=(0,s.useCallback)(()=>!!h,[h]);return(0,n.jsx)(l.Provider,{value:{user:a,loading:g,login:C,logout:p,hasPermission:A,hasRole:w,setUser:u,setToken:b,managerToken:h,setManagerToken:f,isManagerAuthenticated:S},children:t})}function g(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9585:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var n=a(4568),s=a(7620),o=a(704),r=a(9484);function i(){let{user:e}=(0,r.A)(),[t,a]=(0,s.useState)([]),i=(e,t)=>{a(a=>[...a,{test:e,result:t,timestamp:new Date().toISOString()}])},c=async()=>{a([]),i("Auth Status",{isAuthenticated:o.AQ.isAuthenticated(),user:e,tokenInLocalStorage:!!localStorage.getItem("ciris_auth_token"),tokenInCookie:document.cookie.includes("auth_token")});try{let e=await o.AQ.memory.query("test",{limit:1});i("Memory Query",{success:!0,data:e})}catch(e){i("Memory Query",{success:!1,error:e.message})}try{let e=await o.AQ.config.getAll();i("Config Fetch",{success:!0,data:e})}catch(e){i("Config Fetch",{success:!1,error:e.message})}try{let e=await o.AQ.system.getHealth();i("System Health",{success:!0,data:e})}catch(e){i("System Health",{success:!1,error:e.message})}};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,n.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Auth Debug Page"}),(0,n.jsx)("button",{onClick:c,className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700",children:"Run Tests"})]})}),t.length>0&&(0,n.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,n.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Test Results"}),(0,n.jsx)("div",{className:"space-y-4",children:t.map((e,t)=>(0,n.jsxs)("div",{className:"border-t pt-4",children:[(0,n.jsx)("h3",{className:"font-medium text-gray-900",children:e.test}),(0,n.jsx)("pre",{className:"mt-2 text-xs bg-gray-50 p-2 rounded overflow-auto",children:JSON.stringify(e.result,null,2)})]},t))})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4534,704,587,8315,7358],()=>t(3727)),_N_E=e.O()}]);