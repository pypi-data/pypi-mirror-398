var y=EventTarget,p="https://embed.foxglove.dev/",g="foxglove.default-layout";function c(){let t,e;return{promise:new Promise((s,i)=>{t=s,e=i}),resolve:t,reject:e}}var h=class extends y{#e;#i;#h;#r=!1;#n;#t={dataSource:void 0,selectLayout:void 0,extension:[]};#a;#s=!1;constructor(e){super();let{parent:a,src:s,orgSlug:i,initialDataSource:o,initialLayout:n,initialLayoutParams:r,initialExtensions:l,colorScheme:d="auto"}=e;this.#h=i,this.#n=c();let u=s??p;try{this.#i=new URL(u)}catch{throw new Error(`[FoxgloveViewer] Invalid server URL: ${u}`)}window.addEventListener("message",this.#d),o&&this.setDataSource(o),n!=null&&r==null&&this.setLayoutData(n),r!=null&&this.selectLayout(r),l&&this.installExtensions(l),this.#e=document.createElement("iframe"),this.#e.src=u,this.#e.title="Foxglove",this.#e.allow="cross-origin-isolated",this.#e.style.width="100%",this.#e.style.height="100%",this.#e.style.border="none",this.setColorScheme(d),a.appendChild(this.#e)}setDataSource(e){this.#l({type:"set-data-source",payload:e})}selectLayout(e){this.#l({type:"select-layout",payload:e})}async getLayout(){return this.#a||(this.#a=c(),await this.#n.promise,this.#o({type:"get-layout"})),await this.#a.promise}setLayoutData(e){this.selectLayout({storageKey:g,opaqueLayout:e,force:!0})}installExtensions(e){this.#l({type:"install-extension",payload:e})}isReady(){return this.#r}destroy(){this.#s=!0,this.#e.remove(),window.removeEventListener("message",this.#d)}isDestroyed(){return this.#s}setColorScheme(e){this.#e.style.colorScheme=e==="auto"?"normal":e}#l(e){switch(e.type){case"install-extension":this.#t.extension.push(e);break;case"set-data-source":this.#t.dataSource=e;break;case"select-layout":this.#t.selectLayout=e;break}this.#r&&this.#o(e)}#o(e){if(this.#s){console.warn("[FoxgloveViewer] Unable to post command. Frame has been destroyed.");return}f(this.#e.contentWindow,"Invariant: iframe should be loaded."),this.#e.contentWindow.postMessage(e,this.#i.href)}#d=e=>{let a=new URL(e.origin);if(!(e.source!==this.#e.contentWindow||a.href!==this.#i.href)){if(this.#s){console.warn("[FoxgloveViewer] Unable to handle message. Frame has been destroyed.");return}switch(e.data.type){case"foxglove-origin-request":this.#o({type:"origin-ack"});break;case"foxglove-handshake-request":this.#r=!0,this.#n.resolve(),this.#o({type:"handshake-ack",payload:{orgSlug:this.#h,initialDataSource:this.#t.dataSource?.payload,initialLayoutParams:this.#t.selectLayout?.payload,initialExtensions:this.#t.extension.flatMap(s=>s.payload)}});break;case"foxglove-handshake-complete":this.dispatchEvent(new Event("ready"));break;case"foxglove-error":this.dispatchEvent(new CustomEvent("error",{detail:e.data.payload}));break;case"foxglove-layout-data":this.#a?(this.#a.resolve(e.data.payload),this.#a=void 0):console.warn("[FoxgloveViewer] Received layout but getLayout was not called.");break;default:console.warn("[FoxgloveViewer] Unhandled message type:",e.data);break}}}};function f(t,e="no additional info provided"){if(!t)throw new Error("Assertion Error: "+e)}function w({model:t,el:e}){let a=document.createElement("div"),s=t.get("_layout_params"),i=new h({parent:a,src:t.get("src"),orgSlug:void 0,initialLayoutParams:s?{storageKey:s.storage_key,opaqueLayout:s.opaque_layout,force:s.force}:void 0});i.addEventListener("ready",()=>{t.send({type:"ready"})}),t.on("msg:custom",(o,n)=>{if(o.type==="update-data"){let r=n.map((l,d)=>new File([l.buffer],`data-${d}.mcap`));i.setDataSource({type:"file",file:r})}}),a.style.width=t.get("width")==="full"?"100%":`${t.get("width")}px`,a.style.height=`${t.get("height")}px`,t.on("change:width",()=>{a.style.width=t.get("width")==="full"?"100%":`${t.get("width")}px`}),t.on("change:height",()=>{a.style.height=`${t.get("height")}px`}),t.on("change:_layout_params",()=>{let o=t.get("_layout_params");o&&i.selectLayout({storageKey:o.storage_key,opaqueLayout:o.opaque_layout,force:o.force})}),e.appendChild(a)}var b={render:w};export{b as default};
