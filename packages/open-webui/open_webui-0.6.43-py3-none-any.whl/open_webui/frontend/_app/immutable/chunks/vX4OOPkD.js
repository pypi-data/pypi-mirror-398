import"./CWj6FrbW.js";import"./CN51-NxK.js";import{b as xt,g as Et,q as mt,j as e,v as kt,i as p,d as ve,e as P,a as d,c as v,k as A,r as c,t as B,w as s,s as ne,p as Tt,f as k,m as F,n as Y,o as Ft,aT as Nt,u as be,l as Me,z as it,x as ye,aX as Xt}from"./lUdQH9Xf.js";import{i as C}from"./a8_cTibZ.js";import{k as Yt}from"./DpkLTJmG.js";import{e as Bt,i as Pt}from"./CyDjujdM.js";import{s as Ht}from"./9RuGBeWD.js";import{s as _t,a as ct}from"./AGdekky4.js";import{a as Jt}from"./gZt8HVPH.js";import{b as Vt}from"./uevuQHIQ.js";import{b as Ut}from"./D72e2DEW.js";import{p as Qt}from"./Bfc47y5P.js";import{i as Ct}from"./VsCEtJ32.js";import{p as _}from"./wFFmXPqF.js";import{a as Ke,s as It}from"./CcA7kcll.js";import{t as De}from"./1N3xujas.js";import{h as ea,a as ta,c as aa,b as ra,m as na}from"./B-g4jA4X.js";import{o as oa,a as sa,p as la,q as ia,r as ca,t as da,u as ua,v as va,w as ga,x as fa,y as ma,z as pa}from"./DqlUe4q2.js";import{g as ha}from"./B02cv91p.js";import{u as _a}from"./B4ANdNTO.js";import{a as dt}from"./DSSqs2bl.js";import{C as ya,a as ba,g as wt,b as wa,I as xa}from"./Dq4ZlxTM.js";import"./BAX94-W5.js";import{b as Ea,c as Lt}from"./VjqWeGTs.js";import{f as ka}from"./BjO3HhBo.js";import{D as Ta}from"./0lhZwTI1.js";import{T as ft}from"./BtoSXKKz.js";import{V as Ca,R as Ia}from"./DS88WV_Z.js";import{F as Sa}from"./DwK9aoet.js";import{I as Aa}from"./CVzBuu8t.js";import{F as Ra}from"./DtylYZNe.js";import{H as $a,L as Da}from"./B-RP1E8X.js";import{s as Ma}from"./CBMlGqAz.js";import{S as Ua}from"./CPW-btCN.js";import{X as La}from"./9jNi-Hzr.js";var za=k('<!> <div class="line-clamp-1"> </div>',1),Fa=k('<!> <div class=" line-clamp-1"> </div>',1),Na=k("<!> <!>",1),Ba=k('<div slot="content"><!></div>');function Pa(ut,g){xt(g,!1);const b=()=>Ke(xe,"$i18n",we),[we,f]=It(),xe=Et("i18n");let Ue=_(g,"screenCaptureHandler",8),J=_(g,"uploadFilesHandler",8),Le=_(g,"onClose",8,()=>{}),G=F(!1);const I=async()=>{};mt(()=>e(G),()=>{e(G)&&I()}),kt(),Ct(),Ta(ut,{get show(){return e(G)},set show(R){p(G,R)},$$events:{change:R=>{R.detail===!1&&Le()()}},children:(R,ze)=>{{let oe=Y(()=>(b(),s(()=>b().t("More"))));ft(R,{get content(){return e(oe)},children:(Ge,Ee)=>{var ge=ve(),se=P(ge);Ht(se,g,"default",{},null),d(Ge,ge)},$$slots:{default:!0}})}},$$slots:{default:!0,content:(R,ze)=>{var oe=Ba(),Ge=v(oe);Ea(Ge,{class:"w-full max-w-[200px] rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-999 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition",sideOffset:4,alignOffset:-6,side:"bottom",align:"start",get transition(){return ka},children:(Ee,ge)=>{var se=Na(),qe=P(se);Lt(qe,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl",$$events:{click:()=>{J()()}},children:(ke,at)=>{var le=za(),W=P(le);ya(W,{});var fe=A(W,2),Ne=v(fe,!0);c(fe),B(Q=>ne(Ne,Q),[()=>(b(),s(()=>b().t("Upload Files")))]),d(ke,le)},$$slots:{default:!0}});var Fe=A(qe,2);Lt(Fe,{class:"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50  rounded-xl",$$events:{click:()=>{Ue()()}},children:(ke,at)=>{var le=Fa(),W=P(le);ba(W,{});var fe=A(W,2),Ne=v(fe,!0);c(fe),B(Q=>ne(Ne,Q),[()=>(b(),s(()=>b().t("Capture")))]),d(ke,le)},$$slots:{default:!0}}),d(Ee,se)},$$slots:{default:!0}}),c(oe),d(R,oe)}},$$legacy:!0}),Tt(),f()}var Ha=k('<div class="px-2 text-xs text-gray-500 py-1"><!></div>'),Va=k('<div class=" size-4 justify-center flex items-center mr-0.5"><!></div>'),Oa=k('<img class="rounded-full size-5 items-center mr-2"/>'),Wa=k('<img class="rounded-full size-5 items-center mr-2"/>'),ja=k('<button type="button"><!> <div class="truncate flex-1 pr-2"> </div> <div class="shrink-0 text-xs text-gray-500"><!></div></button>'),Ka=k("<!> <!>",1),Ga=k('<div class="mention-list text-black dark:text-white rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 flex flex-col bg-white dark:bg-gray-850 w-72 p-1" id="suggestions-container"><div class="overflow-y-auto scrollbar-thin max-h-60"></div></div>');function zt(ut,g){xt(g,!1);const b=()=>Ke(ea,"$channels",xe),we=()=>Ke(ta,"$models",xe),f=()=>Ke(Le,"$i18n",xe),[xe,Ue]=It(),J=F(),Le=Et("i18n");let G=_(g,"query",8,""),I=_(g,"command",8),R=_(g,"selectedIndex",12,0);_(g,"label",8,""),_(g,"triggerChar",8,"@");let ze=_(g,"modelSuggestions",8,!1),oe=_(g,"userSuggestions",8,!1),Ge=_(g,"channelSuggestions",8,!1),Ee=F([]),ge=F([]),se=F([]);const qe=async()=>{const o=await Ma(localStorage.token,G()).catch(n=>null);o&&p(ge,[...o.users.map(n=>({type:"user",id:n.id,label:n.name}))].sort((n,me)=>n.label.localeCompare(me.label)))},Fe=o=>{const n=e(J)[o];n&&n&&I()({id:`${n.type==="user"?"U":n.type==="model"?"M":"C"}:${n.id}|${n.label}`,label:n.label})},ke=o=>{if(!["ArrowUp","ArrowDown","Enter","Tab","Escape"].includes(o.key))return!1;if(o.key==="ArrowUp"){R(Math.max(0,R()-1));const n=document.querySelector('[data-selected="true"]');return n==null||n.scrollIntoView({block:"center",inline:"nearest",behavior:"instant"}),!0}if(o.key==="ArrowDown"){R(Math.min(R()+1,e(J).length-1));const n=document.querySelector('[data-selected="true"]');return n==null||n.scrollIntoView({block:"center",inline:"nearest",behavior:"instant"}),!0}return o.key==="Enter"||o.key==="Tab"?(Fe(R()),o.key==="Enter"&&o.preventDefault(),!0):o.key==="Escape"};function at(o){return ke(o)}const le=o=>{o.key==="Enter"&&(o.preventDefault(),Fe(R()))};Ft(async()=>{window.addEventListener("keydown",le),Ge()?p(se,[...b().filter(o=>(o==null?void 0:o.type)!=="dm").map(o=>({type:"channel",id:o.id,label:o.name,data:o}))]):(oe()&&await qe(),ze()&&p(Ee,[...we().map(o=>({type:"model",id:o.id,label:o.name,data:o}))]))}),Nt(()=>{window.removeEventListener("keydown",le)}),mt(()=>(e(ge),e(Ee),e(se),be(G())),()=>{p(J,[...e(ge),...e(Ee),...e(se)].filter(o=>o.label.toLowerCase().includes(G().toLowerCase())||o.id.toLowerCase().includes(G().toLowerCase())))}),mt(()=>(be(G()),be(oe())),()=>{G()!==null&&oe()&&qe()}),kt();var W={_onKeyDown:at};Ct();var fe=ve(),Ne=P(fe);{var Q=o=>{var n=Ga(),me=v(n);Bt(me,5,()=>e(J),Pt,(Ze,u,Te)=>{var rt=Ka(),nt=P(rt);{var pt=Xe=>{var j=Ha(),Ye=v(j);{var ie=q=>{var ee=it();B(pe=>ne(ee,pe),[()=>(f(),s(()=>f().t("Users")))]),d(q,ee)},Je=q=>{var ee=ve(),pe=P(ee);{var vt=ce=>{var Z=it();B(Pe=>ne(Z,Pe),[()=>(f(),s(()=>f().t("Models")))]),d(ce,Z)},he=ce=>{var Z=ve(),Pe=P(Z);{var U=$=>{var N=it();B(Ce=>ne(N,Ce),[()=>(f(),s(()=>f().t("Channels")))]),d($,N)};C(Pe,$=>{e(u),s(()=>{var N;return((N=e(u))==null?void 0:N.type)==="channel"})&&$(U)},!0)}d(ce,Z)};C(pe,ce=>{e(u),s(()=>{var Z;return((Z=e(u))==null?void 0:Z.type)==="model"})?ce(vt):ce(he,!1)},!0)}d(q,ee)};C(Ye,q=>{e(u),s(()=>{var ee;return((ee=e(u))==null?void 0:ee.type)==="user"})?q(ie):q(Je,!1)})}c(j),d(Xe,j)};C(nt,Xe=>{e(u),e(J),s(()=>{var j,Ye;return Te===0||((j=e(u))==null?void 0:j.type)!==((Ye=e(J)[Te-1])==null?void 0:Ye.type)})&&Xe(pt)})}var ht=A(nt,2);{let Xe=Y(()=>(e(u),s(()=>{var j;return(j=e(u))==null?void 0:j.id})));ft(ht,{get content(){return e(Xe)},placement:"top-start",children:(j,Ye)=>{var ie=ja(),Je=v(ie);{var q=U=>{var $=Va(),N=v($);{var Ce=S=>{$a(S,{className:"size-3",strokeWidth:"2.5"})},He=S=>{Da(S,{className:"size-[15px]",strokeWidth:"2"})};C(N,S=>{e(u),s(()=>{var z,X;return((X=(z=e(u))==null?void 0:z.data)==null?void 0:X.access_control)===null})?S(Ce):S(He,!1)})}c($),d(U,$)},ee=U=>{var $=ve(),N=P($);{var Ce=S=>{var z=Oa();B(()=>{ct(z,"src",(be(dt),e(u),f(),s(()=>`${dt}/models/model/profile/image?id=${e(u).id}&lang=${f().language}`))),ct(z,"alt",(e(u),s(()=>{var X,t;return((t=(X=e(u))==null?void 0:X.data)==null?void 0:t.name)??e(u).id})))}),d(S,z)},He=S=>{var z=ve(),X=P(z);{var t=r=>{var a=Wa();B(()=>{ct(a,"src",(be(dt),e(u),s(()=>`${dt}/users/${e(u).id}/profile/image`))),ct(a,"alt",(e(u),s(()=>{var i;return((i=e(u))==null?void 0:i.label)??e(u).id})))}),d(r,a)};C(X,r=>{e(u),s(()=>e(u).type==="user")&&r(t)},!0)}d(S,z)};C(N,S=>{e(u),s(()=>e(u).type==="model")?S(Ce):S(He,!1)},!0)}d(U,$)};C(Je,U=>{e(u),s(()=>e(u).type==="channel")?U(q):U(ee,!1)})}var pe=A(Je,2),vt=v(pe,!0);c(pe);var he=A(pe,2),ce=v(he);{var Z=U=>{var $=it();B(N=>ne($,N),[()=>(f(),s(()=>f().t("User")))]),d(U,$)},Pe=U=>{var $=ve(),N=P($);{var Ce=S=>{var z=it();B(X=>ne(z,X),[()=>(f(),s(()=>f().t("Model")))]),d(S,z)},He=S=>{var z=ve(),X=P(z);{var t=r=>{var a=it();B(i=>ne(a,i),[()=>(f(),s(()=>f().t("Channel")))]),d(r,a)};C(X,r=>{e(u),s(()=>e(u).type==="channel")&&r(t)},!0)}d(S,z)};C(N,S=>{e(u),s(()=>e(u).type==="model")?S(Ce):S(He,!1)},!0)}d(U,$)};C(ce,U=>{e(u),s(()=>e(u).type==="user")?U(Z):U(Pe,!1)})}c(he),c(ie),B(()=>{_t(ie,1,`flex items-center justify-between px-2.5 py-1.5 rounded-xl w-full text-left ${Te===R()?"bg-gray-50 dark:bg-gray-800 selected-command-option-button":""}`),ct(ie,"data-selected",Te===R()),ne(vt,(e(u),s(()=>e(u).label)))}),Me("click",ie,()=>Fe(Te)),Me("mousemove",ie,()=>{R(Te)}),d(j,ie)},$$slots:{default:!0}})}d(Ze,rt)}),c(me),c(n),d(o,n)};C(Ne,o=>{e(J),s(()=>e(J).length)&&o(Q)})}d(ut,fe),Vt(g,"_onKeyDown",at);var Be=Tt(W);return Ue(),Be}var qa=k('<input type="file" hidden="" multiple/>'),Za=k('<div class=" absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none"><button class=" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg></button></div>'),Xa=k('<div><div class=" text-xs px-1 mt-1.5 flex items-center gap-1.5"><!> <div><span class=" font-normal text-black dark:text-white"> </span> </div></div></div>'),Ya=k('<div class="px-3 pt-3 text-left w-full flex flex-col z-10"><div class="flex items-center justify-between w-full"><div class="pl-[1px] flex items-center gap-2 text-sm"><div class="translate-y-[0.5px]"><span> </span></div></div> <div><button class="flex items-center dark:text-gray-500"><!></button></div></div></div>'),Ja=k('<div class=" relative group"><div class="relative"><!></div> <div class=" absolute -top-1 -right-1"><button class=" bg-white text-black border border-white rounded-full group-hover:visible invisible transition" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg></button></div></div>'),Qa=k('<div class="mx-2 mt-2.5 -mb-1 flex flex-wrap gap-2"></div>'),er=k('<button id="input-menu-button" class="bg-transparent hover:bg-white/80 text-gray-800 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5 outline-hidden focus:outline-hidden" type="button" aria-label="More"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"></path></svg></button>'),tr=k('<button id="voice-input-button" class=" text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 mr-0.5 self-center" type="button" aria-label="Voice Input"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-y-[0.5px]"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"></path></svg></button>'),ar=k('<button class="bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg></button>'),rr=k('<div class=" flex items-center"><!></div>'),nr=k('<button id="send-message-button" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z" clip-rule="evenodd"></path></svg></button>'),or=k('<div class=" flex items-center"><!></div>'),sr=k('<form class="w-full flex gap-1.5"><div id="message-input-container" class="flex-1 flex flex-col relative w-full shadow-lg rounded-3xl border border-gray-50 dark:border-gray-850/30 hover:border-gray-100 focus-within:border-gray-100 hover:dark:border-gray-800 focus-within:dark:border-gray-800 transition px-1 bg-white/90 dark:bg-gray-400/5 dark:text-gray-100"><!> <!> <div class="px-2.5"><div class="scrollbar-hidden rtl:text-right ltr:text-left bg-transparent dark:text-gray-100 outline-hidden w-full pt-2.5 pb-[5px] px-1 resize-none h-fit max-h-96 overflow-auto"><!></div></div> <div class=" flex justify-between mb-2.5 mx-0.5"><div class="ml-1 self-end flex space-x-1 flex-1"><!></div> <div class="self-end flex space-x-1 mr-1"><!> <div class=" flex items-center"><!></div></div></div></div></form>'),lr=k('<!> <!> <!> <div class="bg-transparent"><div class="max-w-full mx-auto inset-x-0 relative"><div class="absolute top-0 left-0 right-0 mx-auto inset-x-0 bg-transparent flex justify-center"><div class="flex flex-col px-3 w-full"><div class="relative"><!></div> <!></div></div> <div><!></div></div></div>',1);function Or(ut,g){xt(g,!1);const b=()=>Ke(Le,"$i18n",Ue),we=()=>Ke(aa,"$config",Ue),f=()=>Ke(ra,"$settings",Ue),xe=()=>Ke(na,"$mobile",Ue),[Ue,J]=It(),Le=Et("i18n");let G=_(g,"placeholder",24,()=>b().t("Type here...")),I=_(g,"chatInputElement",12);_(g,"id",8,null);let R=_(g,"channel",8,null),ze=_(g,"typingUsers",24,()=>[]),oe=_(g,"inputLoading",8,!1),Ge=_(g,"onSubmit",8,t=>{}),Ee=_(g,"onChange",8,t=>{}),ge=_(g,"onStop",8,t=>{}),se=_(g,"scrollEnd",12,!0),qe=_(g,"scrollToBottom",8,()=>{}),Fe=_(g,"disabled",8,!1),ke=_(g,"acceptFiles",8,!0);_(g,"showFormattingToolbar",8,!0);let at=_(g,"userSuggestions",8,!1),le=_(g,"channelSuggestions",8,!1),W=_(g,"replyToMessage",12,null),fe=_(g,"typingUsersClassName",8,"from-white dark:from-gray-900"),Ne=F(!1),Q=F(!1),Be=F(!1),o=F(""),n=F([]),me=F(),Ze=F(),u=F(!1),Te=F(),rt=F({}),nt={};const pt=async t=>(p(rt,oa(t)),Object.keys(e(rt)).length===0?t:(p(u,!0),await new Promise(r=>{p(Te,a=>{nt={...nt,...a},Xe(nt),p(u,!1),r(t)})}))),ht=async t=>{if(t.includes("{{CLIPBOARD}}")){const a=await navigator.clipboard.readText().catch(T=>(De.error(b().t("Failed to read clipboard contents")),"{{CLIPBOARD}}")),i=await navigator.clipboard.read();for(const T of i)for(const H of T.types)if(H.startsWith("image/")){const te=await T.getType(H),ae=new File([te],`clipboard-image.${H.split("/")[1]}`,{type:H});he([ae])}t=t.replaceAll("{{CLIPBOARD}}",a)}if(t.includes("{{USER_LOCATION}}")){let a;try{a=await sa()}catch{De.error(b().t("Location access not allowed")),a="LOCATION_UNKNOWN"}t=t.replaceAll("{{USER_LOCATION}}",String(a))}const r=await ha(localStorage.token);if(t.includes("{{USER_NAME}}")){const a=(r==null?void 0:r.name)||"User";t=t.replaceAll("{{USER_NAME}}",a)}if(t.includes("{{USER_BIO}}")){const a=(r==null?void 0:r.bio)||"";a&&(t=t.replaceAll("{{USER_BIO}}",a))}if(t.includes("{{USER_GENDER}}")){const a=(r==null?void 0:r.gender)||"";a&&(t=t.replaceAll("{{USER_GENDER}}",a))}if(t.includes("{{USER_BIRTH_DATE}}")){const a=(r==null?void 0:r.date_of_birth)||"";a&&(t=t.replaceAll("{{USER_BIRTH_DATE}}",a))}if(t.includes("{{USER_AGE}}")){const a=(r==null?void 0:r.date_of_birth)||"";if(a){const i=la(a);t=t.replaceAll("{{USER_AGE}}",i)}}if(t.includes("{{USER_LANGUAGE}}")){const a=localStorage.getItem("locale")||"en-US";t=t.replaceAll("{{USER_LANGUAGE}}",a)}if(t.includes("{{CURRENT_DATE}}")){const a=ia();t=t.replaceAll("{{CURRENT_DATE}}",a)}if(t.includes("{{CURRENT_TIME}}")){const a=ca();t=t.replaceAll("{{CURRENT_TIME}}",a)}if(t.includes("{{CURRENT_DATETIME}}")){const a=da();t=t.replaceAll("{{CURRENT_DATETIME}}",a)}if(t.includes("{{CURRENT_TIMEZONE}}")){const a=ua();t=t.replaceAll("{{CURRENT_TIMEZONE}}",a)}if(t.includes("{{CURRENT_WEEKDAY}}")){const a=va();t=t.replaceAll("{{CURRENT_WEEKDAY}}",a)}return t},Xe=t=>{document.getElementById("chat-input")&&(I().replaceVariables(t),I().focus())},j=async(t,r)=>{var i,T;document.getElementById("chat-input")&&(t!==""&&(t=await ht(t||"")),(i=I())==null||i.setText(t),(T=I())==null||T.focus(),t!==""&&(t=await pt(t)),await ye(),r&&await r(t))},Ye=()=>{var a;const t=document.getElementById("chat-input");let r="";return t&&(r=(a=I())==null?void 0:a.getWordAtDocPos()),r},ie=t=>{var a;document.getElementById("chat-input")&&((a=I())==null||a.replaceCommandWithText(t))},Je=async t=>{var i;const r=document.getElementById("chat-input");if(!r)return;t=await ht(t),e(q)?ie(t):(i=I())==null||i.insertContent(t),await ye(),t=await pt(t),await ye();const a=document.getElementById("chat-input-container");if(a&&(a.scrollTop=a.scrollHeight),await ye(),r){r.focus(),r.dispatchEvent(new Event("input"));const T=ga(prompt);T.length>0?(T.at(0),await ye()):r.scrollTop=r.scrollHeight}};let q=F(""),ee=_(g,"showCommands",12,!1),pe=F(null);const vt=async()=>{try{const t=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"never"},audio:!1}),r=document.createElement("video");r.srcObject=t,await r.play();const a=document.createElement("canvas");a.width=r.videoWidth,a.height=r.videoHeight,a.getContext("2d").drawImage(r,0,0,a.width,a.height),t.getTracks().forEach(ae=>ae.stop()),window.focus();const T=a.toDataURL("image/png"),H=await(await fetch(T)).blob(),te=new File([H],`screen-capture-${Date.now()}.png`,{type:"image/png"});he([te]),r.srcObject=null}catch(t){}},he=async t=>{t.forEach(async r=>{var a,i,T,H,te,ae,Ie,Ve;if(console.info("Processing file:",{name:r.name,type:r.type,size:r.size,extension:r.name.split(".").at(-1)}),(((i=(a=we())==null?void 0:a.file)==null?void 0:i.max_size)??null)!==null&&r.size>(((H=(T=we())==null?void 0:T.file)==null?void 0:H.max_size)??0)*1024*1024){r.size,(((ae=(te=we())==null?void 0:te.file)==null?void 0:ae.max_size)??0)*1024*1024,De.error(b().t("File size should not exceed {{maxSize}} MB.",{maxSize:(Ve=(Ie=we())==null?void 0:Ie.file)==null?void 0:Ve.max_size}));return}if(r.type.startsWith("image/")){const Oe=async(_e,D={},m={})=>{var x,M,Re,et,$e,ot;const re=(D==null?void 0:D.imageCompression)??!1,Se=((M=(x=m==null?void 0:m.file)==null?void 0:x.image_compression)==null?void 0:M.width)??null,Ae=((et=(Re=m==null?void 0:m.file)==null?void 0:Re.image_compression)==null?void 0:et.height)??null;if(!re&&!Se&&!Ae)return _e;let We=null,w=null;return re&&(We=(($e=D==null?void 0:D.imageCompressionSize)==null?void 0:$e.width)??null,w=((ot=D==null?void 0:D.imageCompressionSize)==null?void 0:ot.height)??null),Se&&(We===null||We>Se)&&(We=Se),Ae&&(w===null||w>Ae)&&(w=Ae),We||w?await pa(_e,We,w):_e};let Qe=new FileReader;Qe.onload=async _e=>{var Se,Ae;let D=_e.target.result;(Se=f())!=null&&Se.imageCompression&&((Ae=f())!=null&&Ae.imageCompressionInChannels)&&(D=await Oe(D,f(),we()));const m=await(await fetch(D)).blob(),re=new File([m],r.name,{type:r.type});ce(re,!1)},Qe.readAsDataURL(r.type==="image/heic"?await fa(r):r)}else ce(r)})},ce=async(t,r=!0)=>{var T,H,te,ae,Ie,Ve,Oe,Qe,_e;const a=ma(),i={type:"file",file:"",id:null,url:"",name:t.name,collection_name:"",status:"uploading",size:t.size,error:"",itemId:a};if(i.size==0)return De.error(b().t("You cannot upload an empty file.")),null;p(n,[...e(n),i]);try{let D={channel_id:R().id,...(t.type.startsWith("audio/")||t.type.startsWith("video/"))&&((te=(H=(T=f())==null?void 0:T.audio)==null?void 0:H.stt)!=null&&te.language)?{language:(Ve=(Ie=(ae=f())==null?void 0:ae.audio)==null?void 0:Ie.stt)==null?void 0:Ve.language}:{}};const m=await _a(localStorage.token,t,D,r);m?(console.info("File upload completed:",{id:m.id,name:i.name,collection:(Oe=m==null?void 0:m.meta)==null?void 0:Oe.collection_name}),m.error&&(m.error,De.warning(m.error)),i.status="uploaded",i.file=m,i.id=m.id,i.collection_name=((Qe=m==null?void 0:m.meta)==null?void 0:Qe.collection_name)||(m==null?void 0:m.collection_name),i.content_type=((_e=m.meta)==null?void 0:_e.content_type)||m.content_type,i.url=`${m.id}`,p(n,e(n))):p(n,e(n).filter(re=>(re==null?void 0:re.itemId)!==a))}catch(D){De.error(`${D}`),p(n,e(n).filter(m=>(m==null?void 0:m.itemId)!==a))}},Z=t=>{t.key==="Escape"&&p(Q,!1)},Pe=t=>{var r,a;t.preventDefault(),(a=(r=t.dataTransfer)==null?void 0:r.types)!=null&&a.includes("Files")?p(Q,!0):p(Q,!1)},U=()=>{p(Q,!1)},$=async t=>{var r,a;if(t.preventDefault(),(r=t.dataTransfer)!=null&&r.files&&ke()){const i=Array.from((a=t.dataTransfer)==null?void 0:a.files);i&&i.length>0&&he(i)}p(Q,!1)},N=async()=>{var t;e(o)===""&&e(n).length===0||(Ge()({content:e(o),data:{files:e(n)}}),p(o,""),p(n,[]),I()&&((t=I())==null||t.setText(""),await ye(),I().focus()))};Ft(async()=>{p(pe,[{char:"@",render:wt(zt,{i18n:Le,triggerChar:"@",modelSuggestions:!0,userSuggestions:at()})},...le()?[{char:"#",render:wt(zt,{i18n:Le,triggerChar:"#",channelSuggestions:le()})}]:[],{char:"/",render:wt(wa,{i18n:Le,onSelect:r=>{var T;const{type:a,data:i}=r;(T=document.getElementById("chat-input"))==null||T.focus()},insertTextHandler:Je,onUpload:r=>{const{type:a,data:i}=r;if(a==="file"){if(e(n).find(T=>T.id===i.id))return;p(n,[...e(n),{...i,status:"processed"}])}}})}]),p(Ne,!0),window.setTimeout(()=>{I()&&I().focus()},100),window.addEventListener("keydown",Z),await ye();const t=document.getElementById("channel-container");t==null||t.addEventListener("dragover",Pe),t==null||t.addEventListener("drop",$),t==null||t.addEventListener("dragleave",U)}),Nt(()=>{window.removeEventListener("keydown",Z);const t=document.getElementById("channel-container");t&&(t==null||t.removeEventListener("dragover",Pe),t==null||t.removeEventListener("drop",$),t==null||t.removeEventListener("dragleave",U))}),mt(()=>e(q),()=>{var t;ee(["/"].includes((t=e(q))==null?void 0:t.charAt(0)))}),mt(()=>(e(o),be(Ee())),()=>{e(o)&&Ee()()}),kt();var Ce={setText:j};Ct();var He=ve(),S=P(He);{var z=t=>{var r=lr(),a=P(r);Ra(a,{get show(){return e(Q)}});var i=A(a,2);{var T=w=>{var x=qa();Ut(x,M=>p(me,M),()=>e(me)),Jt(x,()=>e(Ze),M=>p(Ze,M)),Me("change",x,async()=>{e(Ze)&&e(Ze).length>0?he(Array.from(e(Ze))):De.error(b().t("File not found.")),Xt(me,e(me).value="")}),d(w,x)};C(i,w=>{ke()&&w(T)})}var H=A(i,2);xa(H,{get variables(){return e(rt)},get onSave(){return e(Te)},get show(){return e(u)},set show(w){p(u,w)},$$legacy:!0});var te=A(H,2),ae=v(te),Ie=v(ae),Ve=v(Ie),Oe=v(Ve),Qe=v(Oe);{var _e=w=>{var x=Za(),M=v(x);c(x),Me("click",M,()=>{se(!0),qe()()}),d(w,x)};C(Qe,w=>{se()===!1&&w(_e)})}c(Oe);var D=A(Oe,2);{var m=w=>{var x=Xa(),M=v(x),Re=v(M);Ua(Re,{size:"xs"});var et=A(Re,2),$e=v(et),ot=v($e,!0);c($e);var gt=A($e);c(et),c(M),c(x),B((st,yt)=>{_t(x,1,` -mt-7 pb-2.5 bg-gradient-to-t to-transparent ${fe()??""} pointer-events-none select-none`),ne(ot,st),ne(gt,` ${yt??""}`)},[()=>(be(ze()),s(()=>ze().map(st=>st.name).join(", "))),()=>(b(),s(()=>b().t("is typing...")))]),d(w,x)};C(D,w=>{be(ze()),s(()=>ze().length>0)&&w(m)})}c(Ve),c(Ie);var re=A(Ie,2),Se=v(re);{var Ae=w=>{Ca(w,{onCancel:async()=>{p(Be,!1),await ye(),I()&&I().focus()},onConfirm:async x=>{const{text:M,filename:Re}=x;p(Be,!1),await ye(),Je(M),await ye(),I()&&I().focus()},get recording(){return e(Be)},set recording(x){p(Be,x)},$$legacy:!0})},We=w=>{var x=sr(),M=v(x),Re=v(M);{var et=y=>{var E=Ya(),K=v(E),h=v(K),L=v(h),V=v(L),l=v(V,!0);c(V),c(L),c(h);var O=A(h,2),tt=v(O),de=v(tt);La(de,{}),c(tt),c(O),c(K),c(E),B(ue=>ne(l,ue),[()=>(b(),be(W()),s(()=>{var ue,je;return b().t("Replying to {{NAME}}",{NAME:((je=(ue=W())==null?void 0:ue.meta)==null?void 0:je.model_name)??W().user.name})}))]),Me("click",tt,()=>{W(null)}),d(y,E)};C(Re,y=>{W()!==null&&y(et)})}var $e=A(Re,2);{var ot=y=>{var E=Qa();Bt(E,5,()=>e(n),Pt,(K,h,L)=>{var V=ve(),l=P(V);{var O=de=>{const ue=Y(()=>(e(h),be(dt),s(()=>{var Mt;return e(h).url.startsWith("data")||e(h).url.startsWith("http")?e(h).url:`${dt}/files/${e(h).url}${(Mt=e(h))!=null&&Mt.content_type?"/content":""}`})));var je=Ja(),lt=v(je),qt=v(lt);Aa(qt,{get src(){return e(ue)},alt:"",imageClassName:" size-10 rounded-xl object-cover"}),c(lt);var Dt=A(lt,2),Zt=v(Dt);c(Dt),c(je),Me("click",Zt,()=>{e(n).splice(L,1),p(n,e(n))}),d(de,je)},tt=de=>{{let ue=Y(()=>(e(h),s(()=>{var lt;return(lt=e(h))==null?void 0:lt.size}))),je=Y(()=>(e(h),s(()=>e(h).status==="uploading")));Sa(de,{get item(){return e(h)},get name(){return e(h),s(()=>e(h).name)},get type(){return e(h),s(()=>e(h).type)},get size(){return e(ue)},small:!0,get loading(){return e(je)},dismissible:!0,edit:!0,$$events:{dismiss:()=>{e(n).splice(L,1),p(n,e(n))},click:()=>{e(h)}}})}};C(l,de=>{e(h),s(()=>{var ue;return e(h).type==="image"||(((ue=e(h))==null?void 0:ue.content_type)??"").startsWith("image/")})?de(O):de(tt,!1)})}d(K,V)}),c(E),d(y,E)};C($e,y=>{e(n),s(()=>e(n).length>0)&&y(ot)})}var gt=A($e,2),st=v(gt),yt=v(st);Yt(yt,()=>(f(),s(()=>{var y,E;return((y=f())==null?void 0:y.richTextInput)&&((E=f())==null?void 0:E.showFormattingToolbar)})),y=>{{let E=Y(()=>!Fe()),K=Y(()=>(f(),s(()=>{var l;return((l=f())==null?void 0:l.richTextInput)??!0}))),h=Y(()=>(f(),s(()=>{var l;return((l=f())==null?void 0:l.showFormattingToolbar)??!1}))),L=Y(()=>(f(),xe(),s(()=>{var l;return!(((l=f())==null?void 0:l.ctrlEnterToSend)??!1)&&!xe()&&!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)}))),V=Y(()=>(f(),s(()=>{var l;return((l=f())==null?void 0:l.largeTextAsFile)??!1})));Ut(Ia(y,{id:"chat-input",json:!0,messageInput:!0,get editable(){return e(E)},get placeholder(){return G()},get richText(){return e(K)},get showFormattingToolbar(){return e(h)},get shiftEnter(){return e(L)},get largeTextAsFile(){return e(V)},floatingMenuPlacement:"top-start",get suggestions(){return e(pe)},onChange:l=>{const{md:O}=l;p(o,O),p(q,Ye())},$$events:{keydown:async l=>{l=l.detail.event,l.ctrlKey||l.metaKey,document.getElementById("suggestions-container")||(!xe()||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))&&(l.keyCode===13&&!l.shiftKey&&l.preventDefault(),e(o)!==""&&l.keyCode===13&&!l.shiftKey&&N()),l.key==="Escape"&&(console.info("Escape"),W(null))},paste:async l=>{l=l.detail.event;const O=l.clipboardData||window.clipboardData;if(O&&O.items)for(const tt of O.items){const de=tt.getAsFile();de&&(await he([de]),l.preventDefault())}}},$$legacy:!0}),l=>I(l),()=>I())}}),c(st),c(gt);var St=A(gt,2),bt=v(St),Ot=v(bt);Ht(Ot,g,"menu",{},y=>{var E=ve(),K=P(E);{var h=L=>{Pa(L,{screenCaptureHandler:vt,uploadFilesHandler:()=>{e(me).click()},children:(V,l)=>{var O=er();d(V,O)},$$slots:{default:!0}})};C(K,L=>{ke()&&L(h)})}d(y,E)}),c(bt);var At=A(bt,2),Rt=v(At);{var Wt=y=>{{let E=Y(()=>(b(),s(()=>b().t("Record voice"))));ft(y,{get content(){return e(E)},children:(K,h)=>{var L=tr();Me("click",L,async()=>{try{let V=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(l){return De.error(b().t("Permission denied when accessing microphone: {{error}}",{error:l})),null});V&&(p(Be,!0),V.getTracks().forEach(O=>O.stop())),V=null}catch{De.error(b().t("Permission denied when accessing microphone"))}}),d(K,L)},$$slots:{default:!0}})}};C(Rt,y=>{e(o)===""&&y(Wt)})}var $t=A(Rt,2),jt=v($t);{var Kt=y=>{var E=rr(),K=v(E);{let h=Y(()=>(b(),s(()=>b().t("Stop"))));ft(K,{get content(){return e(h)},children:(L,V)=>{var l=ar();Me("click",l,()=>{ge()()}),d(L,l)},$$slots:{default:!0}})}c(E),d(y,E)},Gt=y=>{var E=or(),K=v(E);{let h=Y(()=>(b(),s(()=>b().t("Send message"))));ft(K,{get content(){return e(h)},children:(L,V)=>{var l=nr();B(()=>{_t(l,1,`${e(o),e(n),s(()=>e(o)!==""||e(n).length!==0?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")??""} transition rounded-full p-1.5 self-center`),l.disabled=(e(o),e(n),s(()=>e(o)===""&&e(n).length===0))}),d(L,l)},$$slots:{default:!0}})}c(E),d(y,E)};C(jt,y=>{oe()&&ge()?y(Kt):y(Gt,!1)})}c($t),c(At),c(St),c(M),c(x),B(()=>{ct(M,"dir",(f(),s(()=>{var y;return((y=f())==null?void 0:y.chatDirection)??"auto"}))),M.dir=M.dir}),Me("submit",x,Qt(()=>{N()})),d(w,x)};C(Se,w=>{e(Be)?w(Ae):w(We,!1)})}c(re),c(ae),c(te),B(()=>_t(re,1,`${Fe()?"opacity-50 pointer-events-none cursor-not-allowed":""} relative z-20`)),d(t,r)};C(S,t=>{e(Ne)&&t(z)})}d(ut,He),Vt(g,"setText",j);var X=Tt(Ce);return J(),X}export{Or as M};
//# sourceMappingURL=vX4OOPkD.js.map
