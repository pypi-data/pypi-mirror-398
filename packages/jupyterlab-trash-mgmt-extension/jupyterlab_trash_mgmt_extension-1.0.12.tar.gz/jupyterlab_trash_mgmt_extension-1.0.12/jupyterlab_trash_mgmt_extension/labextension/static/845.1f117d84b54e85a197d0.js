"use strict";(self.webpackChunkjupyterlab_trash_mgmt_extension=self.webpackChunkjupyterlab_trash_mgmt_extension||[]).push([[845],{845(e,t,s){s.r(t),s.d(t,{default:()=>w});var a=s(584),n=s(292),r=s(907);async function o(e="",t={}){const s=r.ServerConnection.makeSettings(),a=n.URLExt.join(s.baseUrl,"jupyterlab-trash-mgmt-extension",e);let o;try{o=await r.ServerConnection.makeRequest(a,t,s)}catch(e){throw new r.ServerConnection.NetworkError(e)}let i=await o.text();if(i.length>0)try{i=JSON.parse(i)}catch(e){console.log("Not a JSON response body.",o)}if(!o.ok)throw new r.ServerConnection.ResponseError(o,i.message||i);return i}var i=s(247),l=s(827),h=s(167),d=s(409);const c=new d.LabIcon({name:"trash-mgmt:trash",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">\n  <path class="jp-icon3" fill="#616161" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"/>\n</svg>'}),m=new d.LabIcon({name:"trash-mgmt:folder",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">\n  <path class="jp-icon3" fill="#616161" d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>\n</svg>'}),p=new d.LabIcon({name:"trash-mgmt:file",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">\n  <path class="jp-icon3" fill="#616161" d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>\n</svg>'}),u=(new d.LabIcon({name:"trash-mgmt:restore",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">\n  <path class="jp-icon3" fill="#616161" d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9z"/>\n</svg>'}),new d.LabIcon({name:"trash-mgmt:delete",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">\n  <path class="jp-icon3" fill="#616161" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n</svg>'}),new d.LabIcon({name:"trash-mgmt:refresh",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">\n  <path class="jp-icon3" fill="#616161" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>\n</svg>'}));class _ extends i.Widget{constructor(){super(),this._selectedItem=null,this._selectedElement=null,this._items=[],this._sortColumn="modified",this._sortDirection="desc",this._refreshIntervalId=null,this.id="jp-trash-panel",this.title.icon=c,this.title.caption="Trash",this.addClass("jp-TrashPanel"),this._commands=new h.CommandRegistry,this._setupCommands(),this._contextMenu=new i.Menu({commands:this._commands}),this._contextMenu.addItem({command:"trash:restore"}),this._contextMenu.addItem({command:"trash:delete"}),this._contextMenu.aboutToClose.connect(()=>{this.node.classList.remove("jp-mod-contextMenuOpen"),this._selectedElement&&(this._selectedElement.classList.remove("jp-mod-selected"),this._selectedElement=null)}),this._header=document.createElement("div"),this._header.className="jp-TrashPanel-header",this.node.appendChild(this._header),this._columnHeader=document.createElement("div"),this._columnHeader.className="jp-TrashPanel-columnHeader",this.node.appendChild(this._columnHeader),this._list=document.createElement("div"),this._list.className="jp-TrashPanel-list",this.node.appendChild(this._list),this._emptyMessage=document.createElement("div"),this._emptyMessage.className="jp-TrashPanel-empty",this._emptyMessage.textContent="Trash is empty",this._emptyMessage.style.display="none",this.node.appendChild(this._emptyMessage)}_setupCommands(){this._commands.addCommand("trash:restore",{label:"Restore",execute:()=>{this._selectedItem&&this._restoreItem(this._selectedItem)}}),this._commands.addCommand("trash:delete",{label:"Delete Permanently",execute:()=>{this._selectedItem&&this._deleteItem(this._selectedItem)}})}async refresh(){try{const e=await o("list");this._items=e.items,this._renderHeader(e),this._renderColumnHeader(),this._renderItems()}catch(e){console.error("Failed to load trash:",e),(0,l.showErrorMessage)("Trash Error","Failed to load trash contents")}}_renderHeader(e){this._header.innerHTML="";const t=document.createElement("span");t.className="jp-TrashPanel-header-info",t.textContent=`${e.item_count} items (${e.total_size_formatted})`,this._header.appendChild(t);const s=document.createElement("div");s.className="jp-TrashPanel-header-actions";const a=document.createElement("button");if(a.className="jp-TrashPanel-header-button",a.title="Refresh",u.element({container:a}),a.addEventListener("click",()=>this.refresh()),s.appendChild(a),e.item_count>0){const e=document.createElement("button");e.className="jp-TrashPanel-header-button jp-TrashPanel-header-button-danger",e.title="Empty Trash",c.element({container:e}),e.addEventListener("click",()=>this._emptyTrash()),s.appendChild(e)}this._header.appendChild(s)}_renderColumnHeader(){this._columnHeader.innerHTML="";const e=(e,t,s)=>{const a=document.createElement("span");if(a.className=`${s} jp-TrashPanel-sortable`,a.textContent=e,this._sortColumn===t){const e=document.createElement("span");e.className="jp-TrashPanel-sortArrow",e.textContent="asc"===this._sortDirection?" ▲":" ▼",a.appendChild(e)}return a.addEventListener("click",()=>this._handleSort(t)),a};this._columnHeader.appendChild(e("Name","name","jp-TrashPanel-col-name")),this._columnHeader.appendChild(e("Modified","modified","jp-TrashPanel-col-modified")),this._columnHeader.appendChild(e("Size","size","jp-TrashPanel-col-size"))}_handleSort(e){this._sortColumn===e?this._sortDirection="asc"===this._sortDirection?"desc":"asc":(this._sortColumn=e,this._sortDirection="name"===e?"asc":"desc"),this._renderColumnHeader(),this._renderItems()}_getSortedItems(){const e=[...this._items],t="asc"===this._sortDirection?1:-1;return e.sort((e,s)=>{switch(this._sortColumn){case"name":return t*e.name.localeCompare(s.name);case"modified":return t*e.deletion_date.localeCompare(s.deletion_date);case"size":return t*(e.size-s.size);default:return 0}}),e}_renderItems(){if(this._list.innerHTML="",0===this._items.length)return this._emptyMessage.style.display="flex",this._columnHeader.style.display="none",void(this._list.style.display="none");this._emptyMessage.style.display="none",this._columnHeader.style.display="flex",this._list.style.display="block";const e=this._getSortedItems();for(const t of e){const e=this._createItemElement(t);this._list.appendChild(e)}}_createItemElement(e){const t=document.createElement("div");t.className="jp-TrashPanel-item",t.title=[`Original: ${e.original_path}`,"Type: "+(e.is_dir?"Folder":"File"),`Size: ${e.size_formatted}`,`Deleted: ${this._formatDate(e.deletion_date)}`].join("\n");const s=document.createElement("span");s.className="jp-TrashPanel-col-name";const a=document.createElement("span");a.className="jp-TrashPanel-item-icon",e.is_dir?m.element({container:a}):p.element({container:a}),s.appendChild(a);const n=document.createElement("span");n.className="jp-TrashPanel-item-name",n.textContent=e.name,s.appendChild(n),t.appendChild(s);const r=document.createElement("span");r.className="jp-TrashPanel-col-modified",r.textContent=this._formatRelativeTime(e.deletion_date),r.title=this._formatDate(e.deletion_date),t.appendChild(r);const o=document.createElement("span");return o.className="jp-TrashPanel-col-size",o.textContent=e.size_formatted,t.appendChild(o),t.addEventListener("contextmenu",s=>{s.preventDefault(),s.stopPropagation(),this._selectedElement&&this._selectedElement.classList.remove("jp-mod-selected"),this._selectedItem=e,this._selectedElement=t,t.classList.add("jp-mod-selected"),this.node.classList.add("jp-mod-contextMenuOpen"),this._contextMenu.open(s.clientX,s.clientY)}),t}_formatRelativeTime(e){if(!e)return"";try{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/1e3),n=Math.floor(a/60),r=Math.floor(n/60),o=Math.floor(r/24),i=Math.floor(o/7),l=Math.floor(o/30),h=Math.floor(o/365);return a<60?"just now":n<60?1===n?"1 minute ago":`${n} minutes ago`:r<24?1===r?"1 hour ago":`${r} hours ago`:o<7?1===o?"yesterday":`${o} days ago`:i<4?1===i?"1 week ago":`${i} weeks ago`:l<12?1===l?"1 month ago":`${l} months ago`:1===h?"1 year ago":`${h} years ago`}catch(e){return""}}_formatDate(e){if(!e)return"Unknown date";try{return new Date(e).toLocaleString()}catch(t){return e}}async _restoreItem(e){try{await o("restore",{method:"POST",body:JSON.stringify({trash_path:e.trash_path})}),await this.refresh()}catch(e){const t=(null==e?void 0:e.message)||"Failed to restore item";(0,l.showErrorMessage)("Restore Failed",t)}}async _deleteItem(e){if((await(0,l.showDialog)({title:"Delete Permanently",body:`Are you sure you want to permanently delete "${e.name}"? This cannot be undone.`,buttons:[l.Dialog.cancelButton(),l.Dialog.warnButton({label:"Delete"})]})).button.accept)try{await o("delete",{method:"POST",body:JSON.stringify({trash_path:e.trash_path})}),await this.refresh()}catch(e){const t=(null==e?void 0:e.message)||"Failed to delete item";(0,l.showErrorMessage)("Delete Failed",t)}}async _emptyTrash(){if((await(0,l.showDialog)({title:"Empty Trash",body:"Are you sure you want to permanently delete all items in the trash? This cannot be undone.",buttons:[l.Dialog.cancelButton(),l.Dialog.warnButton({label:"Empty Trash"})]})).button.accept)try{await o("empty",{method:"POST"}),await this.refresh()}catch(e){const t=(null==e?void 0:e.message)||"Failed to empty trash";(0,l.showErrorMessage)("Empty Trash Failed",t)}}_startAutoRefresh(){this._stopAutoRefresh(),this._refreshIntervalId=setInterval(()=>{this.refresh()},1e4)}_stopAutoRefresh(){null!==this._refreshIntervalId&&(clearInterval(this._refreshIntervalId),this._refreshIntervalId=null)}onAfterShow(e){super.onAfterShow(e),this.refresh(),this._startAutoRefresh()}onBeforeHide(e){this._stopAutoRefresh(),super.onBeforeHide(e)}dispose(){this._stopAutoRefresh(),super.dispose()}}var g;!function(e){e.refresh="trash:refresh",e.empty="trash:empty"}(g||(g={}));const w={id:"jupyterlab_trash_mgmt_extension:plugin",description:"JupyterLab extension for trash management with a dedicated sidebar panel",autoStart:!0,requires:[a.ILabShell],activate:async(e,t)=>{if(console.log("JupyterLab extension jupyterlab_trash_mgmt_extension is activated!"),!await async function(){try{return(await o("status")).trash_enabled}catch(e){return console.warn("Failed to check trash status:",e),!0}}())return void console.log("Trash functionality is disabled (delete_to_trash=False). Trash panel will not be shown.");const{commands:s}=e,a=new _;t.add(a,"left",{rank:600}),s.addCommand(g.refresh,{label:"Refresh Trash",caption:"Refresh the trash panel contents",execute:()=>{a.refresh()}}),s.addCommand(g.empty,{label:"Empty Trash",caption:"Permanently delete all items in trash",execute:()=>{a._emptyTrash()}})}}}}]);