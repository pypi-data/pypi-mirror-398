[tool.poetry]
name = "depchk"
version = "0.9.0"
description = "Dependency version checker that analyzes pyproject.toml files and get upgrade recommendations"
authors = ["Robin Schulz <bulletinmybeard@gmail.com>"]
readme = "README.md"
license = "MIT"
homepage = "https://github.com/bulletinmybeard/depchk"
repository = "https://github.com/bulletinmybeard/depchk"
documentation = "https://github.com/bulletinmybeard/depchk"
keywords = [
    "python",
    "dependencies",
    "pypi",
    "poetry",
    "dependency-management",
    "devtools",
    "version-checker",
    "upgrade-checker",
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Environment :: Console",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Operating System :: MacOS",
    "Operating System :: POSIX :: Linux",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Topic :: Software Development :: Quality Assurance",
    "Topic :: System :: Software Distribution",
    "Typing :: Typed",
]
packages = [{ include = "src" }]
include = [
    "CHANGELOG.md",
    { path = "config.example.yaml", format = ["sdist", "wheel"] },
    "src/py.typed",
]

[tool.poetry.dependencies]
python = "^3.12"
chalkbox = "^2.3.5"
aiohttp = "^3.13.2"
packaging = ">=21.0"
pyyaml = "^6.0.3"
tomlkit = "^0.13.3"

[tool.poetry.dependencies.pydantic]
version = "^2.12.5"
python = ">=3.12.0,<3.15"
[tool.poetry.group.dev.dependencies]
mypy = "^1.19.1"
pytest = "^9.0.2"
pytest-asyncio = "^1.3.0"
ruff = "^0.14.10"
bandit = "^1.9.2"
# mdformat/mdformat-gfm pinned: mdformat-tables 1.0.0 requires mdformat <0.8.0
mdformat = "^0.7.22"
mdformat-gfm = "^0.4.1"
mdformat-tables = "^1.0.0"
types-pyyaml = "^6.0.12.20250915"
pytest-cov = "^7.0.0"

[tool.poetry.scripts]
depchk = "src.__main__:main_sync"

[build-system]
requires = ["poetry-core>=2.2.1,<3.0.0"]
build-backend = "poetry.core.masonry.api"

[tool.black]
line-length = 100
target-version = ['py312']
include = '\.pyi?$'

[tool.mypy]
python_version = "3.12"
warn_return_any = false
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = false
check_untyped_defs = true
warn_unused_ignores = true
warn_redundant_casts = true
exclude = [".venv/", "venv/", "build/", "dist/"]

[[tool.mypy.overrides]]
module = ["aiohttp.*", "yaml.*"]
ignore_missing_imports = true

[tool.ruff]
line-length = 100
target-version = "py312"
exclude = [
    ".git",
    ".venv",
    "venv",
    "build",
    "dist",
    "__pycache__",
    ".mypy_cache",
    ".pytest_cache",
    ".ruff_cache",
]

[tool.ruff.lint]
select = [
    "E",    # pycodestyle errors
    "W",    # pycodestyle warnings
    "F",    # pyflakes
    "I",    # isort
    "N",    # pep8-naming
    "UP",   # pyupgrade
    "B",    # flake8-bugbear
    "C4",   # flake8-comprehensions
    "SIM",  # flake8-simplify
    "RUF",  # Ruff-specific rules
    "S",    # flake8-bandit (security)
    "E402", # Module level import not at top of file
    "I001", # Import block is un-sorted or un-formatted (already covered by "I")
]
ignore = [
    "E501",   # Line too long (handled by formatter)
    "SIM108", # Prefer explicit if-else over ternary for readability
    "SIM117", # Nested with statements are fine for clarity
    "S112",   # try-except-continue is intentional for robustness
]

[tool.ruff.lint.per-file-ignores]
"tests/*" = [
    "S101",
    "S108",
    "S603",
    "S607",
] # Allow assert, temp files, subprocess in tests

[tool.ruff.lint.isort]
combine-as-imports = true
force-sort-within-sections = true
known-first-party = ["src"]
known-third-party = ["chalkbox", "aiohttp", "yaml", "pydantic"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
line-ending = "auto"
docstring-code-format = true

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = [
    "-v",
    "--strict-markers",
    "--tb=short",
    # Coverage disabled by default - run manually with: pytest --cov=depchk --cov-report=term-missing
    # "--cov=depchk",
    # "--cov-report=term-missing",
]
markers = [
    "unit: Unit tests",
    "integration: Integration tests requiring network",
]

[tool.mdformat]
wrap = 120
number = false
end_of_line = "lf"
