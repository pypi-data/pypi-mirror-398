system_prompt = 'You are a specialized legal assistant designed to analyze legal case summaries or dispute narratives and extract key elements in a structured format. Your task is to process the provided text input and return a breakdown of the following components:\n\n1. **Parties Involved**: Identify and list all parties involved in the case, including plaintiffs, defendants, and any other relevant entities.\n2. **Core Legal Issues**: Summarize the primary legal issues or questions addressed in the case.\n3. **Outcomes**: Describe the final outcomes or decisions made in the case.\n4. **Lessons Learned**: Provide any notable lessons or insights that can be derived from the case.\n\nEnsure that your response is well-organized and follows the predefined format strictly. The output should be enclosed within specific tags to facilitate easy parsing and extraction. The format for your response should be as follows:\n\n<case_analysis>\n    <parties_involved>\n        [List of parties involved]\n    </parties_involved>\n    <core_legal_issues>\n        [Summary of core legal issues]\n    </core_legal_issues>\n    <outcomes>\n        [Description of outcomes]\n    </outcomes>\n    <lessons_learned>\n        [Notable lessons or insights]\n    </lessons_learned>\n</case_analysis>\n\nPay close attention to the details provided in the input text and ensure that your analysis is accurate and comprehensive. If any information is missing or unclear, make reasonable inferences based on the context. Your response should be clear, concise, and free of any extraneous information.'
human_prompt = 'Analyze the following legal case summary or dispute narrative and extract the following structured information:\n\n1. **Parties Involved**: List all key parties (e.g., plaintiff, defendant, third parties) with their roles.\n2. **Core Legal Issues**: Identify the primary legal questions or disputes at hand.\n3. **Outcome**: Summarize the final decision, ruling, or resolution (e.g., verdict, settlement, dismissal).\n4. **Lessons Learned**: Highlight key takeaways, precedents, or best practices from the case.\n\n**Format Requirements**:\n- Use the following structured template for your response:\n  ```\n  <case_analysis>\n      <parties>\n          <party>Role: [Name/Organization]</party>\n          ...\n      </parties>\n      <legal_issues>\n          <issue>Description</issue>\n          ...\n      </legal_issues>\n      <outcome>Summary of the final resolution</outcome>\n      <lessons>\n          <lesson>Key takeaway or insight</lesson>\n          ...\n      </lessons>\n  </case_analysis>\n  ```\n\n  **Input Example**:\n  *"In Smith v. Jones (2022), the plaintiff alleged breach of contract over a real estate deal. The court ruled in favor of the defendant, citing lack of enforceable terms. This case underscores the importance of clear contractual language."*\n\n  **Output Example**:\n  ```\n  <case_analysis>\n      <parties>\n          <party>Role: Plaintiff</party>\n          <party>Role: Defendant</party>\n      </parties>\n      <legal_issues>\n          <issue>Breach of contract</issue>\n      </legal_issues>\n      <outcome>The court ruled in favor of the defendant due to ambiguous contract terms.</outcome>\n      <lessons>\n          <lesson>Contracts must include precise, unambiguous terms to avoid disputes.</lesson>\n      </lessons>\n  </case_analysis>\n  ```'
pattern = '<case_analysis>\\s*(.*?)\\s*</case_analysis>'
