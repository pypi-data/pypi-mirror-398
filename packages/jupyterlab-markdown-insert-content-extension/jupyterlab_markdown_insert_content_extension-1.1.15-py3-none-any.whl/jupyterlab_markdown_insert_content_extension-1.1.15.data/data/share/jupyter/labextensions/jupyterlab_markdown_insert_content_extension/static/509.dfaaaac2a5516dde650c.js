"use strict";(self.webpackChunkjupyterlab_markdown_insert_content_extension=self.webpackChunkjupyterlab_markdown_insert_content_extension||[]).push([[509],{509:(e,n,t)=>{t.r(n),t.d(n,{default:()=>O});var o,r=t(23),i=t(389),c=t(223),d=t(247);!function(e){e.insertTOC="markdown-insert:insert-toc",e.updateTOC="markdown-insert:update-toc",e.toggleTOCIgnore="markdown-insert:toggle-toc-ignore",e.addNumbering="markdown-insert:add-numbering",e.removeNumbering="markdown-insert:remove-numbering",e.updateNumbering="markdown-insert:update-numbering"}(o||(o={}));const s=/<!-- TOC:BEGIN(?:\s+DEPTH=(\d+))?\s*-->/,l="\x3c!-- TOC:END --\x3e",a=/^(\d+\.)+\s*/;function u(e){return e.replace(a,"")}function m(e){return e.replace(/Â¶+$/,"").trim().replace(/\s+/g,"-")}function g(e,n,t){const o=e.slice(0,n).join(".");return t?o+".":o}function f(e,n,t){const o=e.split("\n"),r=[0,0,0,0,0,0];let i=!1;const c=[],d=[];for(const e of o){if(e.match(/^```/)||e.match(/^~~~/)){i=!i,c.push(e);continue}if(i){c.push(e);continue}const o=e.match(/^(#{1,6})\s+(.+)$/);if(o){const i=o[1].length,s=o[2].trim();if(i<=n){const e=u(s);r[i-1]++;for(let e=i;e<6;e++)r[e]=0;const n=`${g(r,i,t)} ${e}`;d.push({original:e,numbered:n,originalId:m(e),numberedId:m(n)}),c.push(`${o[1]} ${n}`)}else c.push(e)}else c.push(e)}let s=c.join("\n");for(const e of d){const n=new RegExp(`\\[${h(e.original)}\\]\\(#${h(e.originalId)}\\)`,"g"),t=`[${e.numbered}](#${e.numberedId})`;s=s.replace(n,t);const o=new RegExp(`\\[\\d+(?:\\.\\d+)*\\.?\\s*${h(e.original)}\\]\\(#[^)]+\\)`,"g");s=s.replace(o,t)}return s}function h(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function p(e){const n=e.split("\n");let t=!1;const o=[],r=[];for(const e of n){if(e.match(/^```/)||e.match(/^~~~/)){t=!t,o.push(e);continue}if(t){o.push(e);continue}const n=e.match(/^(#{1,6})\s+(.+)$/);if(n){const t=n[1],i=n[2].trim();if(a.test(i)){const e=u(i);r.push({original:e,numbered:i,originalId:m(e),numberedId:m(i)}),o.push(`${t} ${e}`)}else o.push(e)}else o.push(e)}let i=o.join("\n");for(const e of r){const n=new RegExp(`\\[${h(e.numbered)}\\]\\(#${h(e.numberedId)}\\)`,"g"),t=`[${e.original}](#${e.originalId})`;i=i.replace(n,t);const o=new RegExp(`\\[\\d+(?:\\.\\d+)*\\.?\\s*${h(e.original)}\\]\\(#[^)]+\\)`,"g");i=i.replace(o,t)}return i}const v="\x3c!-- TOC:IGNORE --\x3e";function b(e,n){const t=[],o=e.split("\n");let r=!1;for(let e=0;e<o.length;e++){const i=o[e];if(i.match(/^```/)||i.match(/^~~~/)){r=!r;continue}if(r)continue;const c=i.match(/^(#{1,6})\s+(.+)$/);if(c){const r=c[1].length;if(r>n)continue;let i=c[2].trim();const d=i.includes(v),s=(e+1<o.length?o[e+1]:"").trim()===v;if(d||s){s&&e++;continue}i=i.replace(/<!--.*?-->/g,"").trim();const l=m(i);t.push({text:i,level:r,id:l})}}return t}function W(e,n,t){const o=[];for(const n of e){const e=`${"  ".repeat(Math.max(0,n.level-1))}- [${n.text}](#${n.id})`;o.push(e)}const r=n?`${n}\n\n`:"",i=function(e){return void 0!==e?`\x3c!-- TOC:BEGIN DEPTH=${e} --\x3e`:"\x3c!-- TOC:BEGIN --\x3e"}(t);return`${i}\n${r}${o.join("\n")}\n${l}\n\n`}function w(e){const n=e.match(s);if(!n)return null;const t=e.search(s),o=e.indexOf(l);return-1===t||-1===o||o<t?null:{beginIndex:t,endIndex:o,depth:n[1]?parseInt(n[1],10):void 0}}function k(e,n){const t=w(e);if(!t)return null;if(!e.match(s))return null;const o=e.slice(0,t.beginIndex),r=e.slice(t.endIndex+16);return o+n.replace(/\n+$/,"")+r}function x(e,n){const t=e.currentWidget;if(!t)return void console.warn("No active file editor");const o=t.content.model,r=f(o.sharedModel.getSource(),n.numberingMaxLevel,n.numberingTrailingDot);o.sharedModel.setSource(r)}function C(e){const n=e.currentWidget;if(!n)return void console.warn("No active file editor");const t=n.content.model,o=p(t.sharedModel.getSource());t.sharedModel.setSource(o)}function M(e,n){const t=e.currentWidget;if(!t)return void console.warn("No active notebook");const o=t.content,r=[];for(let e=0;e<o.model.cells.length;e++){const n=o.model.cells.get(e);"markdown"===n.type&&r.push({index:e,source:n.sharedModel.getSource()})}const i=f(r.map(e=>e.source).join("\n\n"),n.numberingMaxLevel,n.numberingTrailingDot).split("\n\n");let c=0;for(const e of r){const n=o.model.cells.get(e.index),t=e.source.split("\n\n").length,r=i.slice(c,c+t);n.sharedModel.setSource(r.join("\n\n")),c+=t}}function N(e){const n=e.currentWidget;if(!n)return void console.warn("No active notebook");const t=n.content;for(let e=0;e<t.model.cells.length;e++){const n=t.model.cells.get(e);if("markdown"===n.type){const e=p(n.sharedModel.getSource());n.sharedModel.setSource(e)}}}function T(e,n){var t;const o=e.currentWidget;if(!o)return console.warn("No active file editor"),!1;const r=o.content.model,i=r.sharedModel.getSource(),c=w(i);if(!c)return console.warn("No TOC markers found in document - use Insert TOC first"),!1;const d=null!==(t=c.depth)&&void 0!==t?t:n.tocMaxLevel,s=b(i,d);if(0===s.length)return console.warn("No headings found in document"),!1;const l=k(i,W(s,n.tocCaption,d));return l?(r.sharedModel.setSource(l),!0):(console.warn("No TOC markers found in document - use Insert TOC first"),!1)}function I(e,n){var t;const o=e.currentWidget;if(!o)return console.warn("No active notebook"),!1;const r=o.content;let i=-1,c=n.tocMaxLevel;for(let e=0;e<r.model.cells.length;e++){const o=r.model.cells.get(e);if("markdown"===o.type){const r=w(o.sharedModel.getSource());if(r){i=e,c=null!==(t=r.depth)&&void 0!==t?t:n.tocMaxLevel;break}}}if(-1===i)return console.warn("No TOC markers found in notebook - use Insert TOC first"),!1;let d="";for(let e=0;e<r.model.cells.length;e++){const n=r.model.cells.get(e);"markdown"===n.type&&(d+=n.sharedModel.getSource()+"\n\n")}const s=b(d,c);if(0===s.length)return console.warn("No headings found in notebook"),!1;const l=W(s,n.tocCaption,c),a=r.model.cells.get(i),u=k(a.sharedModel.getSource(),l);return u?(a.sharedModel.setSource(u),!0):(console.warn("Failed to update TOC in notebook"),!1)}const $={id:"jupyterlab_markdown_insert_content_extension:plugin",description:"Jupyterlab extension to automatically insert content into markdown - such as TOC, bibliography, list of figures etc.",autoStart:!0,optional:[r.IEditorTracker,i.INotebookTracker,c.ISettingRegistry],activate:(e,n,t,r)=>{console.log("JupyterLab extension jupyterlab_markdown_insert_content_extension is activated!");const i={tocCaption:"**Table of Contents**",tocMaxLevel:3,numberingMaxLevel:5,numberingTrailingDot:!1};r&&r.load($.id).then(e=>{const n=()=>{i.tocCaption=e.get("tocCaption").composite,i.tocMaxLevel=e.get("tocMaxLevel").composite,i.numberingMaxLevel=e.get("numberingMaxLevel").composite,i.numberingTrailingDot=e.get("numberingTrailingDot").composite};n(),e.changed.connect(n)}).catch(e=>{console.error("Failed to load settings for markdown-insert-content:",e)}),e.commands.addCommand(o.insertTOC,{label:"Insert Table of Contents",caption:"Insert a table of contents at the cursor position",isVisible:()=>{if(null==n?void 0:n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return!0}return!!(null==t?void 0:t.currentWidget)},execute:()=>{const o=e.shell.currentWidget;if((null==t?void 0:t.currentWidget)&&o===t.currentWidget){const e=t.currentWidget.content.activeCell;if(e&&"markdown"===e.model.type)return void function(e,n){const t=e.currentWidget;if(!t)return void console.warn("No active notebook");const o=t.content,r=o.activeCell;if(!r||"markdown"!==r.model.type)return void console.warn("Active cell is not a markdown cell");const i=r.editor,c=r.model;if(!i)return void console.warn("No editor available - cell may not be in edit mode");let d="";for(let e=0;e<o.model.cells.length;e++){const n=o.model.cells.get(e);"markdown"===n.type&&(d+=n.sharedModel.getSource()+"\n\n")}const s=b(d,n.tocMaxLevel);if(0===s.length)return void console.warn("No headings found in notebook");const l=W(s,n.tocCaption,n.tocMaxLevel),a=i.getCursorPosition(),u=i.getOffsetAt(a),m=c.sharedModel.getSource();c.sharedModel.setSource(m.slice(0,u)+l+m.slice(u))}(t,i)}if((null==n?void 0:n.currentWidget)&&o===n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return void function(e,n){const t=e.currentWidget;if(!t)return void console.warn("No active file editor");const o=t.content.editor,r=t.content.model,i=b(r.sharedModel.getSource(),n.tocMaxLevel);if(0===i.length)return void console.warn("No headings found in document");const c=W(i,n.tocCaption,n.tocMaxLevel),d=o.getCursorPosition(),s=o.getOffsetAt(d);r.sharedModel.updateSource(s,s,c)}(n,i)}console.warn("No active markdown editor or notebook cell in edit mode")}}),e.commands.addCommand(o.updateTOC,{label:"Update Table of Contents",caption:"Update an existing table of contents (requires TOC markers)",isVisible:()=>{if(null==n?void 0:n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return!0}return!!(null==t?void 0:t.currentWidget)},execute:()=>{const o=e.shell.currentWidget;if((null==t?void 0:t.currentWidget)&&o===t.currentWidget)I(t,i);else{if((null==n?void 0:n.currentWidget)&&o===n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return void T(n,i)}console.warn("No active markdown editor or notebook")}}}),e.commands.addCommand(o.toggleTOCIgnore,{label:"Toggle Exclude from TOC",caption:"Toggle TOC:IGNORE marker on the heading at cursor position",isVisible:()=>{if(null==n?void 0:n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return!0}return!!(null==t?void 0:t.currentWidget)},execute:()=>{const o=e.shell.currentWidget;if((null==t?void 0:t.currentWidget)&&o===t.currentWidget)!function(e){const n=e.currentWidget;if(!n)return void console.warn("No active notebook");const t=n.content.activeCell;if(!t||"markdown"!==t.model.type)return void console.warn("Active cell is not a markdown cell");const o=t.editor,r=t.model;if(!o)return void console.warn("No editor available");const i=o.getCursorPosition(),c=r.sharedModel.getSource().split("\n"),d=i.line;if(d>=c.length)return;const s=c[d];s.match(/^#{1,6}\s+/)?(s.includes(v)?c[d]=s.replace(` ${v}`,"").replace(v,""):c[d]=`${s} ${v}`,r.sharedModel.setSource(c.join("\n"))):console.warn("Current line is not a heading")}(t);else{if((null==n?void 0:n.currentWidget)&&o===n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return void function(e){const n=e.currentWidget;if(!n)return void console.warn("No active file editor");const t=n.content.editor,o=n.content.model,r=t.getCursorPosition(),i=o.sharedModel.getSource().split("\n"),c=r.line;if(c>=i.length)return;const d=i[c];d.match(/^#{1,6}\s+/)?(d.includes(v)?i[c]=d.replace(` ${v}`,"").replace(v,""):i[c]=`${d} ${v}`,o.sharedModel.setSource(i.join("\n"))):console.warn("Current line is not a heading")}(n)}console.warn("No active markdown editor or notebook")}}}),e.commands.addCommand(o.addNumbering,{label:"Add Heading Numbering",caption:"Add hierarchical numbering to headings (1., 1.1., etc.)",isVisible:()=>{if(null==n?void 0:n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return!0}return!!(null==t?void 0:t.currentWidget)},execute:()=>{const o=e.shell.currentWidget;if((null==t?void 0:t.currentWidget)&&o===t.currentWidget)M(t,i);else{if((null==n?void 0:n.currentWidget)&&o===n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return void x(n,i)}console.warn("No active markdown editor or notebook")}}}),e.commands.addCommand(o.removeNumbering,{label:"Remove Heading Numbering",caption:"Remove hierarchical numbering from headings",isVisible:()=>{if(null==n?void 0:n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return!0}return!!(null==t?void 0:t.currentWidget)},execute:()=>{const o=e.shell.currentWidget;if((null==t?void 0:t.currentWidget)&&o===t.currentWidget)N(t);else{if((null==n?void 0:n.currentWidget)&&o===n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return void C(n)}console.warn("No active markdown editor or notebook")}}}),e.commands.addCommand(o.updateNumbering,{label:"Update Heading Numbering",caption:"Update hierarchical numbering on headings",isVisible:()=>{if(null==n?void 0:n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return!0}return!!(null==t?void 0:t.currentWidget)},execute:()=>{const o=e.shell.currentWidget;if((null==t?void 0:t.currentWidget)&&o===t.currentWidget)return N(t),M(t,i),void I(t,i);if((null==n?void 0:n.currentWidget)&&o===n.currentWidget){const e=n.currentWidget.context.path;if(e.endsWith(".md")||e.endsWith(".markdown"))return C(n),x(n,i),void T(n,i)}console.warn("No active markdown editor or notebook")}});const c=new d.Menu({commands:e.commands});c.id="markdown-insert-submenu",c.title.label="Markdown Tools",c.addItem({command:o.insertTOC}),c.addItem({command:o.updateTOC}),c.addItem({command:o.toggleTOCIgnore}),c.addItem({type:"separator"}),c.addItem({command:o.addNumbering}),c.addItem({command:o.removeNumbering}),c.addItem({command:o.updateNumbering}),n&&e.contextMenu.addItem({type:"submenu",submenu:c,selector:".jp-FileEditor",rank:10}),t&&e.contextMenu.addItem({type:"submenu",submenu:c,selector:".jp-MarkdownCell .jp-InputArea-editor",rank:10})}},O=$}}]);