import{p as Wt,F as ce,g as t,e as r,v as At,l as V,H as pe,b as ue,i as Zt,f as J,_ as mt,t as S,n as f,k as i,w as U,Q as vt,Y as z,c as Gt,m as h,G as Q,S as C,r as p,z as ht,J as bt,I as _t,Z as fe,N as K,h as Dt,M as me,K as Ht,$ as Rt,a0 as ve,O as he,C as be,X as qt,a1 as _e}from"../chunks/Cjo0f8hx.js";import{_ as ge}from"../chunks/PPVm8Dsz.js";import{B as gt}from"../chunks/CHHNy2JR.js";import{D as ye}from"../chunks/D4wk-9zb.js";import{w as Lt,f as we}from"../chunks/CZmdasm_.js";import{P as xe}from"../chunks/CNqIdfOw.js";var Fe=J("<div> </div>"),ke=J('<tr><td> </td><td><input type="number" step="0.01" class="w-full px-2 py-1 border border-border rounded"/></td><td><input type="number" step="0.01" class="w-full px-2 py-1 border border-border rounded"/></td><td> </td></tr>'),$e=J('<div class="font-semibold mb-2">Fitted Parameters</div> <div class="text-sm text-muted-foreground mb-3">Edit a and b parameters to update the fitted curves.</div> <div class="bg-surface rounded p-3"><table class="w-full text-sm"><thead><tr><th>Rock Flag</th><th>a</th><th>b</th><th>RMSE</th></tr></thead><tbody></tbody></table></div>',1),Pe=J('<div class="text-sm text-blue-600 mb-3">Loading data...</div>'),je=J('<div class="text-sm text-red-600 mb-3"> </div>'),Se=J('<div class="ws-shf"><div class="mb-2"><div class="font-semibold">Saturation Height Function (Multi-Well)</div> <div class="text-sm text-muted-foreground">Estimate SHF parameters across multiple wells for the project.</div></div> <!> <div class="bg-panel rounded p-3"><div><label for="cutoffs" class="text-sm">FZI Cutoffs</label> <input id="cutoffs" type="text" class="input mt-1" placeholder="0.1, 1.0, 3.0, 6.0"/></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3"><div><label for="fwl" class="text-sm">FWL (m)</label> <input id="fwl" type="number" step="0.1" class="input mt-1"/></div> <div><label for="ift" class="text-sm">IFT (dynes/cm)</label> <input id="ift" type="number" step="0.1" class="input mt-1"/></div> <div><label for="theta" class="text-sm">Theta (deg)</label> <input id="theta" type="number" step="0.1" class="input mt-1"/></div> <div><label for="gw" class="text-sm">GW (g/cc)</label> <input id="gw" type="number" step="0.01" class="input mt-1"/></div> <div><label for="ghc" class="text-sm">GHC (g/cc)</label> <input id="ghc" type="number" step="0.01" class="input mt-1"/></div> <div class="col-span-2 flex items-end"><!> <!> <!></div></div> <!> <div class="font-semibold mb-2">Pore-Perm Crossplot</div> <div class="text-sm text-muted-foreground mb-3">Plot porosity vs permeability with FZI cutoff lines and rock type coloring.</div> <div class="bg-surface rounded p-3 min-h-[220px]"><div class="w-full max-w-[600px] h-[400px] mx-auto"></div></div> <!> <div class="grid grid-cols-1 gap-3"><div class="bg-surface rounded p-3 min-h-[400px]"><div class="font-medium mb-2">J Plot</div> <div class="text-sm text-muted-foreground">J vs SW with fitted curves per rock flag.</div> <!> <div class="mt-4 min-h-[300px] bg-white/5 rounded border border-border/30"></div></div> <div class="bg-surface rounded p-3 min-h-[220px]"><div class="font-medium mb-2">SHF Plot</div> <div class="text-sm text-muted-foreground">SHF vs depth.</div> <div class="mt-4 h-[300px] bg-white/5 rounded border border-border/30"></div></div></div></div></div>');function Ee(X,A){Wt(A,!1);let y=ce(A,"projectId",8,null),j=h(!1),g=h(null),O=h(!1),E=h(null),F=h(null),v=h(null),m=h(null),M=h(null),Y=h(5e3),D=h(30),H=h(30),tt=h(1.05),et=h(.8),R=h("0.1, 1.0, 3.0, 6.0"),q=h({enabled:!1,zones:[]});const Bt=Lt.subscribe(e=>{e?.zoneFilter&&(t(q).enabled!==e.zoneFilter.enabled||JSON.stringify(t(q).zones)!==JSON.stringify(e.zoneFilter.zones))&&r(q,{...e.zoneFilter})});At(()=>Bt());let Z=null,G=h(null),L=h(null),B=h(null);const W="http://localhost:6312";async function at(){if(Z)return Z;const e=await ge(()=>import("../chunks/BJMC0GYJ.js").then(a=>a.p),[],import.meta.url);return Z=e.default||e,Z}function Vt(){if(!t(F))return null;const e=t(F).phit.map((o,n)=>({phit:o,perm:t(F).perm[n],zone:t(F).zones[n],rock_flag:t(F).rock_flags[n],well_name:t(F).well_names[n],depth:t(F).tvdss?.[n]??t(F).tvd?.[n]??t(F).depths[n]})),a=we(e,t(q));return{phit:a.map(o=>o.phit),perm:a.map(o=>o.perm),zones:a.map(o=>o.zone),rock_flags:a.map(o=>o.rock_flag),well_names:a.map(o=>o.well_name),depths:a.map(o=>o.depth)}}async function Ut(){if(y()){r(O,!0),r(E,null);try{const e=`${W}/quick_pp/database/projects/${y()}/fzi_data`,a=await fetch(e);if(!a.ok)throw new Error(await a.text());r(F,await a.json())}catch(e){r(E,e.message||"Failed to load well data"),r(F,null)}finally{r(O,!1)}}}async function yt(){if(y()){r(O,!0),r(E,null);try{const e=`${W}/quick_pp/database/projects/${y()}/j_data?cutoffs=${encodeURIComponent(t(R))}`,a=await fetch(e);if(!a.ok)throw new Error(await a.text());r(v,await a.json())}catch(e){r(E,e.message||"Failed to load J data"),r(v,null)}finally{r(O,!1)}}}async function Kt(){if(await yt(),!t(v)||!t(B))return;const{phit:e,perm:a}=t(v),o=e.map((s,c)=>.0314*Math.sqrt(a[c]/s)),n=e.map(s=>s/(1-s)),u=o.map((s,c)=>s/n[c]),b=t(R).split(",").map(s=>parseFloat(s.trim())).filter(s=>!isNaN(s)&&s>0),k=u.map(s=>{if(isNaN(s)||!isFinite(s))return null;let c=b.length+1;for(let x=b.length-1;x>=0;x--)if(s>=b[x]){c=b.length-1-x+1;break}return c}),w=new Array,_={};k.forEach((s,c)=>{s!==null&&(_[s]||(_[s]={phit:[],perm:[]}),_[s].phit.push(e[c]),_[s].perm.push(a[c]))});const $=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Object.keys(_).sort((s,c)=>parseInt(s)-parseInt(c)).forEach(s=>{const c=_[parseInt(s)];w.push({x:c.phit,y:c.perm,mode:"markers",type:"scatter",name:`Rock Type ${s}`,marker:{color:$[(parseInt(s)-1)%$.length],size:4,symbol:"circle"}})});const d=new Array;for(let s=0;s<=50;s++)d.push(s*.01);b.forEach((s,c)=>{const x=d.map(N=>N<=0||N>=1?null:N*Math.pow(N*s/(.0314*(1-N)),2));w.push({x:d,y:x,mode:"lines",type:"scatter",name:`FZI=${s.toFixed(1)}`,line:{dash:"dash",color:"red"}});const T=b.length-c,P=Math.floor(d.length*.7);let I=x[P];I!==null&&I>0?I=I*2.5:I=1,w.push({x:[d[P]],y:[I],mode:"text",type:"scatter",name:`PRT ${T}`,text:[`PRT ${T}`],textposition:"middle right",showlegend:!1,textfont:{size:10,color:"red"}})});const l={title:"Pore-Perm Crossplot",xaxis:{title:"Porosity (fraction)",range:[-.05,.5],autorange:!1},yaxis:{title:"Permeability (mD)",type:"log",autorange:!0},showlegend:!0,margin:{l:60,r:60,t:60,b:60}};at().then(s=>{s.newPlot(t(B),w,l,{responsive:!0})})}function Qt(){if(!t(v)||!t(m)||!t(G))return;const{sw:e,pc:a,perm:o,phit:n,rock_flags:u}=t(v),b=a.map((d,l)=>{const s=o[l],c=n[l];return .21665*d/(t(D)*Math.abs(Math.cos(t(H)*Math.PI/180)))*Math.sqrt(s/c)}),k=new Array,w={};u.forEach((d,l)=>{if(d===null)return;const s=d.toString();w[s]||(w[s]={sw:[],j:[]}),w[s].sw.push(e[l]),w[s].j.push(b[l])});const _=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd"];Object.keys(w).sort((d,l)=>parseFloat(d)-parseFloat(l)).forEach(d=>{const l=w[Number(d)];if(k.push({x:l.sw,y:l.j,mode:"markers",type:"scatter",name:`Rock Flag ${d}`,marker:{color:_[(parseInt(d)-1)%_.length],size:4}}),t(m)&&t(m)[Number(d)]){const{a:s,b:c}=t(m)[Number(d)],x=[];for(let P=.01;P<=1;P+=.01)x.push(P);const T=x.map(P=>s*Math.pow(P,-c));k.push({x,y:T,mode:"lines",type:"scatter",name:`Fit RF ${d}`,line:{color:_[(parseInt(d)-1)%_.length]}})}});const $={title:"J vs SW with Fitted Curves",xaxis:{title:"SW (fraction)"},yaxis:{title:"J",range:[0,20]},height:450,showlegend:!0,margin:{l:60,r:60,t:60,b:60}};at().then(d=>{d.newPlot(t(G),k,$,{responsive:!0})})}function wt(e){if(!t(m)||!t(v)||!t(v))return;const a=t(v).rock_flags.map((l,s)=>l!==null&&l.toString()===e?s:-1).filter(l=>l!==-1);if(a.length===0){qt(m,t(m)[e].rmse=0);return}const o=t(m)[e].a,n=t(m)[e].b,u=a.map(l=>t(v)?.sw[l]),b=a.map(l=>t(v)?.pc[l]),k=a.map(l=>t(v)?.perm[l]),w=a.map(l=>t(v)?.phit[l]),_=b.map((l,s)=>.21665*(l??0)/(t(D)*Math.abs(Math.cos(t(H)*Math.PI/180)))*Math.sqrt((k[s]??0)/(w[s]??1))),$=u.map(l=>o*Math.pow(l??0,-n)),d=_.reduce((l,s,c)=>l+Math.pow(s-$[c],2),0)/_.length;qt(m,t(m)[e].rmse=Math.sqrt(d).toFixed(3))}function Xt(){if(!t(M)||!t(L))return;const e=new Array,a={};t(M).forEach(u=>{a[u.well]||(a[u.well]={depth:[],shf:[]}),a[u.well].depth.push(u.depth),a[u.well].shf.push(u.shf)});const o=["#1f77b4","#ff7f0e","#2ca02c"];Object.keys(a).forEach((u,b)=>{const k=a[u];e.push({x:k.depth,y:k.shf,mode:"lines",type:"scatter",name:u,line:{color:o[b%o.length]}})});const n={title:"SHF vs Depth",xaxis:{title:"Depth (ft)"},yaxis:{title:"SHF (fraction)",range:[0,1.1]},height:200,showlegend:!0,margin:{l:60,r:60,t:60,b:60}};at().then(u=>{u.newPlot(t(L),e,n,{responsive:!0})})}async function Yt(){if(y()){r(j,!0),r(g,null);try{if(await yt(),!t(v))throw new Error("No data loaded for fitting");const e=`${W}/quick_pp/database/projects/${y()}/compute_j_fits`,a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t(v),ift:t(D),theta:t(H)})});if(!a.ok)throw new Error(await a.text());r(m,await a.json()),r(g,"J fits computed")}catch(e){r(g,`Error: ${e.message}`)}finally{r(j,!1)}}}async function te(){if(!(!t(v)||!t(m)||!y())){r(j,!0),r(g,null);try{const e=Vt();if(!e)return;const a=`${W}/quick_pp/database/projects/${y()}/compute_shf`,o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e,fits:t(m),fwl:t(Y),ift:t(D),theta:t(H),gw:t(tt),ghc:t(et)})});if(!o.ok)throw new Error(await o.text());const n=await o.json();r(M,n.shf_data),r(g,"SHF computed")}catch(e){r(g,`Error: ${e.message}`)}finally{r(j,!1)}}}async function ee(){if(!(!t(M)||!y())){r(j,!0),r(g,null);try{const e=`${W}/quick_pp/database/projects/${y()}/save_shf`,a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shf_data:t(M)})});if(!a.ok)throw new Error(await a.text());r(g,"SHF saved")}catch(e){r(g,`Error: ${e.message}`)}finally{r(j,!1)}}}V(()=>pe(y()),()=>{y()&&Ut()}),V(()=>(t(R),t(q)),()=>{t(R)&&t(q)&&Kt()}),V(()=>(t(v),t(m)),()=>{(t(v)||t(m))&&Qt()}),V(()=>t(M),()=>{t(M)&&Xt()}),ue(),Zt();var st=Se(),xt=i(f(st),2);ye(xt,{});var Ft=i(xt,2),rt=f(Ft),kt=i(f(rt),2);C(kt),p(rt);var ot=i(rt,2),lt=f(ot),$t=i(f(lt),2);C($t),p(lt);var nt=i(lt,2),Pt=i(f(nt),2);C(Pt),p(nt);var it=i(nt,2),jt=i(f(it),2);C(jt),p(it);var dt=i(it,2),St=i(f(dt),2);C(St),p(dt);var ct=i(dt,2),Et=i(f(ct),2);C(Et),p(ct);var It=i(ct,2),Mt=f(It);{let e=Q(()=>t(j)||!t(F));gt(Mt,{class:"btn btn-primary",onclick:Yt,get disabled(){return t(e)},children:(a,o)=>{ht();var n=mt("Compute Fits");S(a,n)},$$slots:{default:!0}})}var Tt=i(Mt,2);{let e=Q(()=>t(j)||!t(m));gt(Tt,{class:"btn ml-2",onclick:te,get disabled(){return t(e)},children:(a,o)=>{ht();var n=mt("Compute SHF");S(a,n)},$$slots:{default:!0}})}var ae=i(Tt,2);{let e=Q(()=>t(j)||!t(M));gt(ae,{class:"btn ml-2",onclick:ee,get disabled(){return t(e)},children:(a,o)=>{ht();var n=mt("Save SHF");S(a,n)},$$slots:{default:!0}})}p(It),p(ot);var zt=i(ot,2);{var se=e=>{var a=Fe(),o=f(a,!0);p(a),bt(n=>{fe(a,1,`text-sm ${n??""} mb-3`),K(o,t(g))},[()=>(t(g),_t(()=>t(g).startsWith("Error")?"text-red-600":"text-green-600"))]),S(e,a)};U(zt,e=>{t(g)&&e(se)})}var pt=i(zt,6),re=f(pt);vt(re,e=>r(B,e),()=>t(B)),p(pt);var Ct=i(pt,2);{var oe=e=>{var a=$e(),o=i(Dt(a),4),n=f(o),u=i(f(n));me(u,5,()=>(t(m),_t(()=>Object.entries(t(m)))),he,(b,k)=>{var w=ve(()=>_e(t(k),2));let _=()=>t(w)[0],$=()=>t(w)[1];var d=ke(),l=f(d),s=f(l,!0);p(l);var c=i(l),x=f(c);C(x),p(c);var T=i(c),P=f(T);C(P),p(T);var I=i(T),N=f(I,!0);p(I),p(d),bt(()=>{K(s,_()),K(N,($(),_t(()=>$().rmse)))}),z(x,()=>$().a,ft=>($().a=ft,Ht(()=>t(m)))),Rt("change",x,()=>wt(_())),z(P,()=>$().b,ft=>($().b=ft,Ht(()=>t(m)))),Rt("change",P,()=>wt(_())),S(b,d)}),p(u),p(n),p(o),S(e,a)};U(Ct,e=>{t(m)&&e(oe)})}var Nt=i(Ct,2),ut=f(Nt),Jt=i(f(ut),4);{var le=e=>{var a=Pe();S(e,a)},ne=e=>{var a=be(),o=Dt(a);{var n=u=>{var b=je(),k=f(b,!0);p(b),bt(()=>K(k,t(E))),S(u,b)};U(o,u=>{t(E)&&u(n)},!0)}S(e,a)};U(Jt,e=>{t(O)?e(le):e(ne,!1)})}var ie=i(Jt,2);vt(ie,e=>r(G,e),()=>t(G)),p(ut);var Ot=i(ut,2),de=i(f(Ot),4);vt(de,e=>r(L,e),()=>t(L)),p(Ot),p(Nt),p(Ft),p(st),z(kt,()=>t(R),e=>r(R,e)),z($t,()=>t(Y),e=>r(Y,e)),z(Pt,()=>t(D),e=>r(D,e)),z(jt,()=>t(H),e=>r(H,e)),z(St,()=>t(tt),e=>r(tt,e)),z(Et,()=>t(et),e=>r(et,e)),S(X,st),Gt()}var Ie=J('<div slot="left"><!></div>');function Oe(X,A){Wt(A,!1);let y=h(null);const j=Lt.subscribe(g=>{r(y,g?.project??null)});At(()=>j()),Zt(),xe(X,{get project(){return t(y)},$$slots:{left:(g,O)=>{var E=Ie(),F=f(E);{let v=Q(()=>t(y)?.project_id??null);Ee(F,{get projectId(){return t(v)}})}p(E),S(g,E)}}}),Gt()}export{Oe as component};
