import{p as te,F as ye,g as e,m as w,e as p,v as re,l as Q,H as xe,b as we,i as ae,f as P,k as x,n as f,C as U,h as J,w as $,t as g,G as se,r as m,Q as Pe,c as oe,J as N,I as V,Z as ke,N as B,M as Fe,O as je,S as X,Y,X as ee}from"../chunks/Cjo0f8hx.js";import{_ as $e}from"../chunks/PPVm8Dsz.js";import{B as ze}from"../chunks/CHHNy2JR.js";import{D as Ee}from"../chunks/D4wk-9zb.js";import{w as le,f as Ie}from"../chunks/CZmdasm_.js";import{P as Oe}from"../chunks/CNqIdfOw.js";var Se=P("<span>Saving...</span>"),Ce=P("<span>Save Perm Transforms</span>"),De=P("<div> </div>"),Te=P('<tr><td class="border border-border p-2"> </td><td class="border border-border p-2"><input type="number" step="0.01" class="w-full px-2 py-1 border border-border rounded"/></td><td class="border border-border p-2"><input type="number" step="0.01" class="w-full px-2 py-1 border border-border rounded"/></td></tr>'),Ae=P('<div class="font-semibold mb-2">Fitted Parameters</div> <div class="text-sm text-muted-foreground mb-3">Edit a and b parameters to update the fitted curves.</div> <div class="bg-surface rounded p-3"><table class="w-full border-collapse border border-border"><thead><tr class="bg-muted"><th class="border border-border p-2 text-left">Rock Flag</th><th class="border border-border p-2 text-left">a</th><th class="border border-border p-2 text-left">b</th></tr></thead><tbody></tbody></table></div>',1),Re=P('<div class="text-sm text-blue-600 mb-3">Loading data...</div>'),Le=P('<div class="text-sm text-red-600 mb-3"> </div>'),qe=P('<div class="ws-perm-transform"><div class="mb-2"><div class="font-semibold">Permeability Transform</div> <div class="text-sm text-muted-foreground">Fit poro-perm curves per ROCK_FLAG and calculate transformed permeability.</div></div> <!> <div class="bg-panel rounded p-3 mb-3"><div class="flex-1"><div class="flex gap-2 items-end"><!></div> <!> <!></div> <div class="font-semibold mb-2">Poro-Perm Crossplot with Fitted Curves</div> <div class="text-sm text-muted-foreground mb-3">Plot porosity vs permeability with fitted curves per ROCK_FLAG.</div> <!> <div class="bg-surface rounded p-3 min-h-[400px]"><div class="w-full h-[500px] mx-auto"></div></div></div></div>');function Ge(D,z){te(z,!1);let b=ye(z,"projectId",8,null),j=w(!1),_=w(null),E=w(!1),k=w(null),n=w(null),s=w(null),F=w({enabled:!1,zones:[]}),T=w(null);const ne=le.subscribe(t=>{t?.zoneFilter&&(e(F).enabled!==t.zoneFilter.enabled||JSON.stringify(e(F).zones)!==JSON.stringify(t.zoneFilter.zones))&&p(F,{...t.zoneFilter})});re(()=>ne());function ie(){if(!e(n))return null;const t=e(n).phit.map((a,o)=>({phit:a,perm:e(n).perm[o],zone:e(n).zones[o],well_name:e(n).well_names[o],depth:e(n).depths[o],rock_flag:e(n).rock_flags[o]})),r=Ie(t,e(F));return console.log("Applying zone filter:",t.length,e(F),r.length),{phit:r.map(a=>a.phit),perm:r.map(a=>a.perm),zones:r.map(a=>a.zone),well_names:r.map(a=>a.well_name),depths:r.map(a=>a.depth),rock_flags:r.map(a=>a.rock_flag)}}let I=null,O=w(null);const A="http://localhost:6312";async function de(){if(I)return I;const t=await $e(()=>import("../chunks/BJMC0GYJ.js").then(r=>r.p),[],import.meta.url);return I=t.default||t,I}async function ce(){if(b()){p(E,!0),p(k,null);try{const t=`${A}/quick_pp/database/projects/${b()}/fzi_data`,r=await fetch(t);if(!r.ok)throw new Error(await r.text());p(n,await r.json()),console.log("Loaded data:",e(n));const a=`${A}/quick_pp/database/projects/${b()}/poroperm_fits`,o=await fetch(a);if(!o.ok)throw new Error(await o.text());const u=await o.json();p(s,u.fits),console.log("Loaded fits:",e(s))}catch(t){p(k,t.message||"Failed to load data"),p(n,null),p(s,null)}finally{p(E,!1)}}}function pe(){const t=ie();if(!t||!e(O)||!e(s))return;const{phit:r,perm:a,rock_flags:o}=t,u=new Array,i={};o.forEach((l,v)=>{if(l===null)return;const y=l.toFixed(1);i[y]||(i[y]={phit:[],perm:[]}),i[y].phit.push(r[v]),i[y].perm.push(a[v])});const d=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Object.keys(i).sort((l,v)=>parseInt(l)-parseInt(v)).forEach(l=>{const v=i[l];u.push({x:v.phit,y:v.perm,mode:"markers",type:"scatter",name:`Rock Flag ${l}`,marker:{color:d[(parseInt(l)-1)%d.length],size:4,symbol:"circle"}})});const c=new Array;for(let l=0;l<=50;l++)c.push(l*.01);Object.keys(e(s)||{}).forEach(l=>{const{a:v,b:y}=e(s)[l],S=c.map(C=>v*Math.pow(C,y));u.push({x:c,y:S,mode:"lines",type:"scatter",name:`Fit RF ${l} (a=${v.toFixed(2)}, b=${y.toFixed(2)})`,line:{dash:"solid",color:d[(parseInt(l)-1)%d.length]}})});const h={title:"Poro-Perm Crossplot with Fitted Curves",xaxis:{title:"Porosity (fraction)",range:[-.05,.5],autorange:!1},yaxis:{title:"Permeability (mD)",type:"log",autorange:!0},showlegend:!0,margin:{l:60,r:60,t:60,b:60}};de().then(l=>{l.newPlot(e(O),u,h,{responsive:!0})})}async function ue(){if(!(!e(n)||!e(s)||!b())){p(j,!0),p(_,null);try{const t=e(n).phit.map((u,i)=>{const d=e(n).rock_flags[i];let c=null;if(d!==null&&e(s)&&e(s)[d.toFixed(1)]){const{a:h,b:l}=e(s)[d.toFixed(1)];c=h*Math.pow(u,l)}return{well_name:e(n).well_names[i],depth:e(n).depths[i],perm_trans:c}}),r=`${A}/quick_pp/database/projects/${b()}/save_perm_trans`,a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({perm_trans_pairs:t})});if(!a.ok)throw new Error(await a.text());const o=await a.json();p(_,`Success: ${o.message}`)}catch(t){p(_,`Error: ${t.message}`)}finally{p(j,!1)}}}Q(()=>(xe(b()),e(T)),()=>{b()&&b()!==e(T)&&(p(T,b()),ce())}),Q(()=>(e(n),e(s),e(F)),()=>{e(n)&&e(s)&&e(F)&&pe()}),we(),ae();var R=qe(),M=x(f(R),2);Ee(M,{});var W=x(M,2),L=f(W),q=f(L),me=f(q);{let t=se(()=>e(j)||!e(n));ze(me,{onclick:ue,get disabled(){return e(t)},children:(r,a)=>{var o=U(),u=J(o);{var i=c=>{var h=Se();g(c,h)},d=c=>{var h=Ce();g(c,h)};$(u,c=>{e(j)?c(i):c(d,!1)})}g(r,o)},$$slots:{default:!0}})}m(q);var K=x(q,2);{var ve=t=>{var r=De(),a=f(r,!0);m(r),N(o=>{ke(r,1,`text-sm ${o??""}`),B(a,e(_))},[()=>(e(_),V(()=>e(_).startsWith("Error")?"text-red-600":"text-green-600"))]),g(t,r)};$(K,t=>{e(_)&&t(ve)})}var fe=x(K,2);{var be=t=>{var r=Ae(),a=x(J(r),4),o=f(a),u=x(f(o));Fe(u,5,()=>(e(s),V(()=>Object.keys(e(s)).sort((i,d)=>parseInt(i)-parseInt(d)))),je,(i,d)=>{var c=Te(),h=f(c),l=f(h,!0);m(h);var v=x(h),y=f(v);X(y),m(v);var S=x(v),C=f(S);X(C),m(S),m(c),N(()=>B(l,e(d))),Y(y,()=>e(s)[e(d)].a,G=>ee(s,e(s)[e(d)].a=G)),Y(C,()=>e(s)[e(d)].b,G=>ee(s,e(s)[e(d)].b=G)),g(i,c)}),m(u),m(o),m(a),g(t,r)};$(fe,t=>{e(s)&&t(be)})}m(L);var Z=x(L,6);{var _e=t=>{var r=Re();g(t,r)},he=t=>{var r=U(),a=J(r);{var o=u=>{var i=Le(),d=f(i,!0);m(i),N(()=>B(d,e(k))),g(u,i)};$(a,u=>{e(k)&&u(o)},!0)}g(t,r)};$(Z,t=>{e(E)?t(_e):t(he,!1)})}var H=x(Z,2),ge=f(H);Pe(ge,t=>p(O,t),()=>e(O)),m(H),m(W),m(R),g(D,R),oe()}var Je=P('<div slot="left"><!></div>');function He(D,z){te(z,!1);let b=w(null);const j=le.subscribe(_=>{p(b,_?.project??null)});re(()=>j()),ae(),Oe(D,{get project(){return e(b)},$$slots:{left:(_,E)=>{var k=Je(),n=f(k);{let s=se(()=>e(b)?.project_id??null);Ge(n,{get projectId(){return e(s)}})}m(k),g(_,k)}}}),oe()}export{He as component};
