import{p as qt,F as Et,e as r,v as It,l as St,g as t,m as N,H as u,b as pe,i as Ot,f as j,k as _,w as z,t as S,c as Ht,n as g,r as y,J as Y,K as fe,S as Ft,z as he,_ as Tt,G as $,C as Pt,h as Wt,I as c,Q as we,P as Ne,Y as Dt,N as at}from"../chunks/Cjo0f8hx.js";import{_ as _e}from"../chunks/PPVm8Dsz.js";import{B as Ct}from"../chunks/CHHNy2JR.js";import{w as Vt,h as ge,f as ye}from"../chunks/CZmdasm_.js";import{D as be}from"../chunks/D4wk-9zb.js";import{P as xe}from"../chunks/CNqIdfOw.js";const Se=()=>({title:"Water Saturation",subtitle:"Saturation estimations for the selected well"}),Ge=Object.freeze(Object.defineProperty({__proto__:null,load:Se},Symbol.toStringTag,{value:"Module"}));var Te=j('<div class="text-xs text-green-600 ml-3"> </div>'),Pe=j('<div class="text-sm text-red-500 mb-2"> </div>'),We=j('<div class="text-sm"> </div>'),$e=j('<div class="text-sm text-gray-500">No temp gradient computed</div>'),Ae=j('<div class="text-sm"> </div>'),Re=j('<div class="text-sm text-gray-500">No Rw computed</div>'),ke=j("<div><strong>Archie SWT:</strong> </div>"),Me=j("<div><strong>Archie SWT:</strong> No data</div>"),je=j("<div><strong>Waxman-Smits SWT:</strong> </div>"),Ee=j("<div><strong>Waxman-Smits SWT:</strong> No data</div>"),Fe=j('<div class="bg-panel rounded p-3"><div class="grid grid-cols-2 gap-2 mb-3"><div><label class="text-sm" for="meas-system">Measurement system</label> <select id="meas-system" class="input"><option>Metric</option><option>Imperial</option></select></div> <div><label class="text-sm" for="water-salinity">Water salinity</label> <input id="water-salinity" type="number" class="input"/></div> <div><label class="text-sm" for="m-param">Archie/Waxman m parameter</label> <input id="m-param" type="number" class="input"/></div></div> <div class="mb-3 flex gap-2 items-center"><!> <!> <!></div> <!> <div class="space-y-3"><div><div class="font-medium text-sm mb-1">Temp Gradient</div> <!></div> <div><div class="font-medium text-sm mb-1">Estimated Rw</div> <!></div> <div><div class="font-medium text-sm mb-1">Saturation Plot (Archie vs Waxman-Smits)</div> <div class="bg-surface rounded p-2"><div class="h-[220px] w-full overflow-hidden"><div class="w-full h-[220px]"></div></div></div> <div class="text-xs text-muted-foreground-foreground space-y-1 mt-3"><!> <!></div></div></div></div>'),De=j('<div class="text-sm">Select a well to view water saturation tools.</div>'),Ce=j('<div class="ws-saturation"><div class="mb-2"><div class="font-semibold">Water Saturation</div> <div class="text-sm text-muted-foreground">Water saturation calculations and displays.</div></div> <!> <!></div>');function qe(pt,rt){qt(rt,!1);let E=Et(rt,"projectId",8),A=Et(rt,"wellName",8);const O="http://localhost:6312";let J=N({enabled:!1,minDepth:null,maxDepth:null}),ct=N({enabled:!1,zones:[]}),G=N([]),Z=N("metric"),st=N(35e3),ot=N(2),R=N(!1),h=N(null),dt=N(!1),ut=new Map,mt=N(null),vt=N([]),H=N([]),k=N([]),U=N([]),Q=N([]),L=N([]),B=N([]),ft=null,K=N(null),it=N(!1),nt=N(null);async function Jt(){if(!E()||!A())return;const s=`${E()}_${A()}`;if(ut.has(s)){r(vt,ut.get(s)),r(dt,!0);return}r(R,!0),r(h,null);try{const o=await fetch(`${O}/quick_pp/database/projects/${E()}/wells/${encodeURIComponent(String(A()))}/merged`);if(!o.ok)throw new Error(await o.text());const l=await o.json(),p=l&&l.data?l.data:l;if(!Array.isArray(p))throw new Error("Unexpected data format from backend");r(vt,p),ut.set(s,p),r(dt,!0)}catch(o){console.warn("Failed to load well data",o),r(h,String(o?.message??o))}finally{r(R,!1)}}function Lt(){const s=t(G),o=[];for(const l of s){const p=l.tvdss??l.TVDSS??l.tvd??l.TVD??l.depth??l.DEPTH??NaN,a=Number(p);isNaN(a)||o.push({tvdss:a})}return o}async function zt(){const s=Lt();if(!s.length){r(h,"No TVD/DEPTH values found in well data");return}r(R,!0),r(h,null),r(H,[]),r(k,[]);try{const o={meas_system:t(Z),data:s},l=await fetch(`${O}/quick_pp/saturation/temp_grad`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!l.ok)throw new Error(await l.text());const p=await l.json(),a=Array.isArray(p)?p.map(x=>Number(x.TEMP_GRAD??x.temp_grad??x.value??NaN)):[];r(H,a);const d={water_salinity:Number(t(st)),data:a.map(x=>({temp_grad:x}))},b=await fetch(`${O}/quick_pp/saturation/rw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!b.ok)throw new Error(await b.text());const m=await b.json();r(k,Array.isArray(m)?m.map(x=>Number(x.RW??x.rw??NaN)):[])}catch(o){console.warn("TempGrad/Rw error",o),r(h,String(o?.message??o))}finally{r(R,!1)}}async function Gt(){r(H,[]),r(k,[]),r(U,[]),r(Q,[]),r(h,null),r(R,!0);try{if(await zt(),t(h)||(await Bt(),t(h)))return;await Kt()}catch(s){console.warn("Estimate Water Saturation error",s),r(h,String(s?.message??s))}finally{r(R,!1)}}async function Bt(){if(!t(k)||t(k).length===0){r(h,"Please compute Rw first");return}const s=t(G),o=[],l=[];let p=0;for(const a of s){const d=Number(a.depth??a.DEPTH??NaN),b=Number(a.rt??a.RT??a.Rt??a.res??a.RES??NaN),m=Number(a.phit??a.PHIT??a.Phit??NaN);if(isNaN(b)||isNaN(m))continue;const x=t(k)[p++]??NaN;isNaN(x)||(o.push({rt:b,rw:x,phit:m}),l.push(d))}if(!o.length){r(h,"No RT/PHIT rows available for Archie");return}r(R,!0),r(h,null),r(U,[]);try{const a={data:o},d=await fetch(`${O}/quick_pp/saturation/archie`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!d.ok)throw new Error(await d.text());const b=await d.json();r(U,Array.isArray(b)?b.map(m=>Number(m.SWT??m.swt??NaN)):[]),r(L,t(U).map((m,x)=>({depth:l[x],SWT:m})).filter(m=>!isNaN(Number(m.depth))))}catch(a){console.warn("Archie error",a),r(h,String(a?.message??a))}finally{r(R,!1)}}async function Kt(){if(!t(k)||t(k).length===0||!t(H)||t(H).length===0){r(h,"Please compute Temp Grad and Rw first");return}const s=[],o=[],l=[],p=[],a=t(G);for(const i of a){const f=Number(i.nphi??i.NPHI??i.Nphi??NaN),v=Number(i.phit??i.PHIT??i.Phit??NaN),w=Number(i.vclay??i.VCLAY??i.vcld??i.VCLD??NaN);!isNaN(f)&&!isNaN(v)&&o.push({nphi:f,phit:v}),!isNaN(w)&&!isNaN(v)&&s.push({vclay:w,phit:v})}for(let i=0;i<t(H).length;i++){const f=t(H)[i],v=t(k)[i];!isNaN(Number(f))&&!isNaN(Number(v))&&l.push({temp_grad:f,rw:v})}let d=[];if(o.length)try{const i={data:o},f=await fetch(`${O}/quick_pp/porosity/shale_porosity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!f.ok)throw new Error(await f.text());const v=await f.json();d=Array.isArray(v)?v.map(w=>Number(w.PHIT_SH??w.phit_sh??NaN)):[]}catch(i){console.warn("Shale porosity error",i)}let b=[];if(s.length&&d.length)try{const f={data:s.map((F,et)=>({vclay:F.vclay,phit:F.phit,phit_clay:d[et]}))},v=await fetch(`${O}/quick_pp/saturation/estimate_qvn`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(!v.ok)throw new Error(await v.text());const w=await v.json();b=Array.isArray(w)?w.map(F=>Number(F.QVN??F.qvn??NaN)):[]}catch(i){console.warn("Qvn error",i)}let m=[];if(l.length)try{const i={data:l},f=await fetch(`${O}/quick_pp/saturation/b_waxman_smits`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!f.ok)throw new Error(await f.text());const v=await f.json();m=Array.isArray(v)?v.map(w=>Number(w.B??w.b??NaN)):[]}catch(i){console.warn("B estimation error",i)}let x=0,X=0,tt=0;const M=[];for(const i of a){const f=Number(i.depth??i.DEPTH??NaN),v=Number(i.rt??i.RT??i.res??i.RES??NaN),w=Number(i.phit??i.PHIT??i.Phit??NaN);if(isNaN(v)||isNaN(w))continue;const F=t(k)[tt++]??NaN,et=b[x++]??NaN,lt=m[X++]??NaN;isNaN(F)||isNaN(et)||isNaN(lt)||(p.push({rt:v,rw:F,phit:w,qv:et,b:lt,m:Number(t(ot))}),M.push(f))}if(!p.length){r(h,"Insufficient data to run Waxman-Smits (need rt, phit, rw, qvn, b)");return}r(R,!0),r(h,null),r(Q,[]);try{const i={data:p},f=await fetch(`${O}/quick_pp/saturation/waxman_smits`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!f.ok)throw new Error(await f.text());const v=await f.json();r(Q,Array.isArray(v)?v.map(w=>Number(w.SWT??w.swt??NaN)):[]),r(B,t(Q).map((w,F)=>({depth:M[F],SWT:w})).filter(w=>!isNaN(Number(w.depth))))}catch(i){console.warn("Waxman-Smits error",i),r(h,String(i?.message??i))}finally{r(R,!1)}}async function Ut(){if(!ft){const s=await _e(()=>import("../chunks/BJMC0GYJ.js").then(o=>o.p),[],import.meta.url);ft=s?.default??s}return ft}async function Qt(){if(!t(K))return;const s=await Ut(),o=[];if(t(L)&&t(L).length>0&&(o.push({x:t(L).map(a=>Number(a.depth)),y:t(L).map(a=>a.SWT),name:"Archie SWT",mode:"lines",line:{color:"#2563eb"}}),o.push({x:[Math.min(...t(L).map(a=>Number(a.depth))),Math.max(...t(L).map(a=>Number(a.depth)))],y:[1,1],mode:"lines",line:{color:"black",width:1,dash:"dash"},showlegend:!1})),t(B)&&t(B).length>0&&o.push({x:t(B).map(a=>Number(a.depth)),y:t(B).map(a=>a.SWT),name:"Waxman-Smits SWT",mode:"lines",line:{color:"#dc2626"}}),o.length===0){try{s.purge(t(K))}catch{}return}const p={height:220,margin:{l:60,r:20,t:20,b:40},dragmode:"zoom",xaxis:{title:"Depth"},yaxis:{title:"SWT (fraction)",range:[0,1.5],tickformat:".2f",fixedrange:!0},showlegend:!0,legend:{...{x:1,y:1,xanchor:"right",yanchor:"top"},bgcolor:"rgba(255,255,255,0.75)",borderwidth:1}};try{s.react(t(K),o,p,{responsive:!0})}catch{s.newPlot(t(K),o,p,{responsive:!0})}}async function Yt(){if(!E()||!A()){r(h,"Project and well must be selected before saving");return}const s=new Map;for(const a of t(L)){const d=Number(a.depth);isNaN(d)||s.set(d,Number(a.SWT))}const o=new Map;for(const a of t(B)){const d=Number(a.depth);isNaN(d)||o.set(d,Number(a.SWT))}const l=Array.from(new Set([...s.keys(),...o.keys()])).sort((a,d)=>a-d);if(!l.length){r(h,"No saturation results to save");return}const p=l.map(a=>{const d={DEPTH:a};return s.has(a)&&(d.SWT_ARCHIE=s.get(a)),o.has(a)&&(d.SWT=o.get(a)),d});r(it,!0),r(nt,null),r(h,null);try{const a={data:p},d=`${O}/quick_pp/database/projects/${E()}/wells/${encodeURIComponent(String(A()))}/data`,b=await fetch(d,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)throw new Error(await b.text());const m=await b.json().catch(()=>null);r(nt,m&&m.message?String(m.message):"Saturation results saved");try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:E(),wellName:A(),kind:"saturation"}}))}catch{}}catch(a){console.warn("Save saturation error",a),r(nt,null),r(h,String(a?.message??a))}finally{r(it,!1)}}function $t(s){const o=s.filter(M=>!isNaN(M)),l=o.length;if(l===0)return null;const a=o.reduce((M,i)=>M+i,0)/l,d=Math.min(...o),b=Math.max(...o),m=o.slice().sort((M,i)=>M-i),x=(m[Math.floor((l-1)/2)]+m[Math.ceil((l-1)/2)])/2,X=o.reduce((M,i)=>M+Math.pow(i-a,2),0)/l,tt=Math.sqrt(X);return{count:l,mean:a,min:d,max:b,median:x,std:tt}}const Zt=Vt.subscribe(s=>{s?.depthFilter&&r(J,{...s.depthFilter}),s?.zoneFilter&&r(ct,{...s.zoneFilter})});It(()=>{Zt()});let ht=N("");St(()=>(t(K),t(L),t(B),t(J),t(mt)),()=>{t(K)&&(t(L)?.length>0||t(B)?.length>0||t(J))&&(t(mt)&&clearTimeout(t(mt)),r(mt,setTimeout(()=>Qt(),150)))}),St(()=>(t(vt),t(J),t(ct)),()=>{r(G,(()=>{let s=t(vt)||[];return s=ge(s,t(J)),s=ye(s,t(ct)),s})())}),St(()=>(u(E()),u(A()),t(ht),t(dt)),()=>{const s=`${E()}_${A()}`;E()&&A()&&s!==t(ht)&&(r(ht,s),(!t(dt)||!ut.has(s))&&Jt())}),pe(),Ot();var wt=Ce(),At=_(g(wt),2);be(At,{});var Xt=_(At,2);{var te=s=>{var o=Fe(),l=g(o),p=g(l),a=_(g(p),2);Y(()=>{t(Z),fe(()=>{})});var d=g(a);d.value=d.__value="metric";var b=_(d);b.value=b.__value="imperial",y(a),y(p);var m=_(p,2),x=_(g(m),2);Ft(x),y(m);var X=_(m,2),tt=_(g(X),2);Ft(tt),y(X),y(l);var M=_(l,2),i=g(M);{let n=$(()=>t(R)?"opacity:0.5; pointer-events:none;":"");Ct(i,{class:"btn btn-primary",onclick:Gt,get disabled(){return t(R)},get style(){return t(n)},children:(e,T)=>{he();var q=Tt("Estimate Water Saturation");S(e,q)},$$slots:{default:!0}})}var f=_(i,2);{let n=$(()=>t(R)||t(it)),e=$(()=>t(R)||t(it)?"opacity:0.5; pointer-events:none;":"");Ct(f,{class:"btn ml-2 bg-emerald-700",onclick:Yt,get disabled(){return t(n)},get style(){return t(e)},children:(T,q)=>{var I=Pt(),W=Wt(I);{var D=P=>{var V=Tt("Saving...");S(P,V)},C=P=>{var V=Tt("Save Saturation");S(P,V)};z(W,P=>{t(it)?P(D):P(C,!1)})}S(T,I)},$$slots:{default:!0}})}var v=_(f,2);{var w=n=>{var e=Te(),T=g(e,!0);y(e),Y(()=>at(T,t(nt))),S(n,e)};z(v,n=>{t(nt)&&n(w)})}y(M);var F=_(M,2);{var et=n=>{var e=Pe(),T=g(e);y(e),Y(()=>at(T,`Error: ${t(h)??""}`)),S(n,e)};z(F,n=>{t(h)&&n(et)})}var lt=_(F,2),Nt=g(lt),ae=_(g(Nt),2);{var re=n=>{const e=$(()=>(t(H),c(()=>$t(t(H)))));var T=Pt(),q=Wt(T);{var I=W=>{var D=We(),C=g(D);y(D),Y((P,V,yt,bt,xt)=>at(C,`Avg: ${P??""} | Min: ${V??""} | Max: ${yt??""} | Median: ${bt??""} | Std: ${xt??""} | Count: ${u(t(e)),c(()=>t(e).count)??""}`),[()=>(u(t(e)),c(()=>t(e).mean.toFixed(2))),()=>(u(t(e)),c(()=>t(e).min.toFixed(2))),()=>(u(t(e)),c(()=>t(e).max.toFixed(2))),()=>(u(t(e)),c(()=>t(e).median.toFixed(2))),()=>(u(t(e)),c(()=>t(e).std.toFixed(2)))]),S(W,D)};z(q,W=>{t(e)&&W(I)})}S(n,T)},se=n=>{var e=$e();S(n,e)};z(ae,n=>{t(H),c(()=>t(H).length)?n(re):n(se,!1)})}y(Nt);var _t=_(Nt,2),oe=_(g(_t),2);{var ie=n=>{const e=$(()=>(t(k),c(()=>$t(t(k)))));var T=Pt(),q=Wt(T);{var I=W=>{var D=Ae(),C=g(D);y(D),Y((P,V,yt,bt,xt)=>at(C,`Avg: ${P??""} | Min: ${V??""} | Max: ${yt??""} | Median: ${bt??""} | Std: ${xt??""} | Count: ${u(t(e)),c(()=>t(e).count)??""}`),[()=>(u(t(e)),c(()=>t(e).mean.toFixed(3))),()=>(u(t(e)),c(()=>t(e).min.toFixed(3))),()=>(u(t(e)),c(()=>t(e).max.toFixed(3))),()=>(u(t(e)),c(()=>t(e).median.toFixed(3))),()=>(u(t(e)),c(()=>t(e).std.toFixed(3)))]),S(W,D)};z(q,W=>{t(e)&&W(I)})}S(n,T)},ne=n=>{var e=Re();S(n,e)};z(oe,n=>{t(k),c(()=>t(k).length)?n(ie):n(ne,!1)})}y(_t);var Rt=_(_t,2),gt=_(g(Rt),2),kt=g(gt),le=g(kt);we(le,n=>r(K,n),()=>t(K)),y(kt),y(gt);var Mt=_(gt,2),jt=g(Mt);{var ce=n=>{const e=$(()=>t(U)),T=$(()=>(u(t(e)),c(()=>t(e).reduce((C,P)=>C+P,0)/t(e).length))),q=$(()=>(u(t(e)),c(()=>Math.min(...t(e))))),I=$(()=>(u(t(e)),c(()=>Math.max(...t(e)))));var W=ke(),D=_(g(W));y(W),Y((C,P,V)=>at(D,` Avg: ${C??""} | Min: ${P??""} | Max: ${V??""} | Count: ${u(t(e)),c(()=>t(e).length)??""}`),[()=>(u(t(T)),c(()=>t(T).toFixed(2))),()=>(u(t(q)),c(()=>t(q).toFixed(2))),()=>(u(t(I)),c(()=>t(I).toFixed(2)))]),S(n,W)},de=n=>{var e=Me();S(n,e)};z(jt,n=>{t(U),c(()=>t(U).length>0)?n(ce):n(de,!1)})}var ue=_(jt,2);{var me=n=>{const e=$(()=>t(Q)),T=$(()=>(u(t(e)),c(()=>t(e).reduce((C,P)=>C+P,0)/t(e).length))),q=$(()=>(u(t(e)),c(()=>Math.min(...t(e))))),I=$(()=>(u(t(e)),c(()=>Math.max(...t(e)))));var W=je(),D=_(g(W));y(W),Y((C,P,V)=>at(D,` Avg: ${C??""} | Min: ${P??""} | Max: ${V??""} | Count: ${u(t(e)),c(()=>t(e).length)??""}`),[()=>(u(t(T)),c(()=>t(T).toFixed(2))),()=>(u(t(q)),c(()=>t(q).toFixed(2))),()=>(u(t(I)),c(()=>t(I).toFixed(2)))]),S(n,W)},ve=n=>{var e=Ee();S(n,e)};z(ue,n=>{t(Q),c(()=>t(Q).length>0)?n(me):n(ve,!1)})}y(Mt),y(Rt),y(lt),y(o),Ne(a,()=>t(Z),n=>r(Z,n)),Dt(x,()=>t(st),n=>r(st,n)),Dt(tt,()=>t(ot),n=>r(ot,n)),S(s,o)},ee=s=>{var o=De();S(s,o)};z(Xt,s=>{A()?s(te):s(ee,!1)})}y(wt),S(pt,wt),Ht()}var Ie=j('<div slot="left"><!></div>');function Be(pt,rt){qt(rt,!1);let E=N(null),A=N(null);const O=Vt.subscribe(J=>{r(E,J?.project??null),r(A,J?.selectedWell??null)});It(()=>O()),Ot(),xe(pt,{get selectedWell(){return t(A)},get project(){return t(E)},$$slots:{left:(J,ct)=>{var G=Ie(),Z=g(G);{let st=$(()=>t(E)?.project_id??""),ot=$(()=>t(A)?.name??"");qe(Z,{get projectId(){return t(st)},get wellName(){return t(ot)}})}y(G),S(J,G)}}}),Ht()}export{Be as component,Ge as universal};
