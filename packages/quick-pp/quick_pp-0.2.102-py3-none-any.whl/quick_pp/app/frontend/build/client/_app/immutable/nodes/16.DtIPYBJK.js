import{p as Se,F as De,e as s,v as je,l as H,g as e,m,H as y,b as lt,i as Te,f as C,k as f,w as W,t as b,c as Fe,n as u,r as v,J as K,K as st,M as ot,N as se,I as p,O as nt,z as ct,_ as _e,G as E,C as dt,h as ke,S as G,Z as mt,P as vt,R as pt,Y as oe,Q as ut}from"../chunks/Cjo0f8hx.js";import{_ as ft}from"../chunks/PPVm8Dsz.js";import{B as $e}from"../chunks/CHHNy2JR.js";import{w as Ae,h as ht,f as bt}from"../chunks/CZmdasm_.js";import{D as gt}from"../chunks/D4wk-9zb.js";import{P as _t}from"../chunks/CNqIdfOw.js";const xt=()=>({title:"Permeability",subtitle:"Permeability estimations for the selected well"}),Lt=Object.freeze(Object.defineProperty({__proto__:null,load:xt},Symbol.toStringTag,{value:"Module"}));var yt=C("<option> </option>"),wt=C('<div><label class="text-xs" for="swirr-input">Swirr (irreducible water saturation)</label> <input id="swirr-input" class="input w-full" type="number" step="0.01" min="0" max="1"/></div>'),Pt=C('<div class="grid grid-cols-4 gap-2 w-full min-w-0"><div class="flex flex-col col-span-4" style="min-width: 120px; max-width: 180px;"><label class="text-xs" for="choo-A">Choo A</label> <input id="choo-A" class="input font-mono text-right" style="width:100%; min-width:120px; max-width:180px;" type="number" step="any"/></div></div> <div class="grid grid-cols-2 gap-2 w-full min-w-0 mt-2"><div class="min-w-0 flex flex-col"><label class="text-xs" for="choo-B">Choo B</label> <input id="choo-B" class="input w-full min-w-0 max-w-full" style="min-width:0;" type="number" step="any"/></div> <div class="min-w-0 flex flex-col"><label class="text-xs" for="choo-C">Choo C</label> <input id="choo-C" class="input w-full min-w-0 max-w-full" style="min-width:0;" type="number" step="any"/></div></div>',1),Nt=C('<div class="text-sm text-red-500 mb-2"> </div>'),Mt=C('<div class="w-full h-[260px]"></div>'),Ct=C('<div class="flex items-center justify-center h-full text-sm text-gray-500">No permeability data to display. Compute permeability to see the plot.</div>'),Et=C("<div><strong>Calculated Perm:</strong> </div>"),Rt=C("<div><strong>Calculated Perm:</strong> No data</div>"),Dt=C('<div><strong>Core Perm (CPERM):</strong> <span class="inline-block w-2 h-2 bg-red-600 rounded-full"></span> </div>'),kt=C('<div class="text-gray-500">No core permeability data (CPERM) found</div>'),$t=C('<div class="bg-panel rounded p-3"><div class="grid grid-cols-3 gap-2 mb-3"><div class="col-span-1 min-w-0"><label class="text-xs" for="perm-method">Permeability method</label> <select id="perm-method" class="input w-full"></select></div> <div class="col-span-2 min-w-0"><!></div></div> <!> <div class="space-y-3"><div><div class="font-medium text-sm mb-1">Permeability</div> <div class="bg-surface rounded p-2"><!> <!> <div class="flex items-center ml-2"><input type="checkbox" id="depth-matching" class="mr-2"/> <label for="depth-matching">Depth Matching</label></div> <div class="h-[260px] w-full overflow-hidden"><!></div></div></div> <div class="text-xs text-muted-foreground space-y-1"><!> <!></div></div></div>'),St=C('<div class="text-sm">Select a well to view permeability tools.</div>'),jt=C('<div class="ws-permeability"><div class="mb-2"><div class="font-semibold">Permeability</div> <div class="text-sm text-muted-foreground">Permeability estimation tools.</div></div> <!> <!></div>');function Tt(ne,U){Se(U,!1);const S=m(),j=m();let T=De(U,"projectId",8),w=De(U,"wellName",8);const Q="http://localhost:6312";let z=m({enabled:!1,minDepth:null,maxDepth:null}),Y=m({enabled:!1,zones:[]}),B=m([]),R=m(!1),F=m(null),X=m(!1),ee=new Map,te=m(null),J=m(!1),ce=null,A=m("choo"),ae=m(.05),de=m(165e5),me=m(6),ve=m(1.78),O=m(!1),re=m([]),ie=m([]),P=m([]),D=m([]),pe=null,L=m(null);const ue=[{value:"choo",label:"Choo",requires:["vclay","vsilt","phit"],params:["m","A","B","C"]},{value:"timur",label:"Timur",requires:["phit","swirr"]},{value:"tixier",label:"Tixier",requires:["phit","swirr"]},{value:"coates",label:"Coates",requires:["phit","swirr"]},{value:"kozeny_carman",label:"Kozeny-Carman",requires:["phit","swirr"]}];async function Ie(){if(!T()||!w())return;const t=`${T()}_${w()}`;if(ee.has(t)){s(re,ee.get(t)),s(X,!0);return}s(R,!0),s(F,null);try{const i=await fetch(`${Q}/quick_pp/database/projects/${T()}/wells/${encodeURIComponent(String(w()))}/merged`);if(!i.ok)throw new Error(await i.text());const o=await i.json(),a=o&&o.data?o.data:o;if(!Array.isArray(a))throw new Error("Unexpected data format from backend");s(re,a),ee.set(t,a),s(X,!0)}catch(i){console.warn("Failed to load well data",i),s(F,String(i?.message??i))}finally{s(R,!1)}}function qe(){const t=ue.find(a=>a.value===e(A));if(!t)return[];const i=e(B),o=[];for(const a of i){const c={};let _=!0;for(const h of t.requires){let n;if(h==="swirr"?n=e(ae):h==="vclay"?n=Number(a.vclay??a.VCLAY??a.Vclay??NaN):h==="vsilt"?n=Number(a.vsilt??a.VSILT??a.Vsilt??NaN):h==="phit"?n=Number(a.phit??a.PHIT??a.Phit??NaN):n=Number(a[h]??a[h.toUpperCase()]??NaN),isNaN(n)){_=!1;break}c[h]=n}_&&o.push(c)}return o}function ze(){const t=e(B),i=[];for(const o of t){const a=Number(o.depth??o.DEPTH??NaN),c=Number(o.cperm??o.CPERM??o.Cperm??o.KPERM??o.kperm??NaN);!isNaN(a)&&!isNaN(c)&&c>0&&i.push({depth:a,CPERM:c})}return i.sort((o,a)=>o.depth-a.depth)}async function Ve(){const t=qe();if(!t.length){s(F,`No valid data available for ${e(A)} permeability calculation`);return}s(R,!0),s(F,null);try{let i={data:t};e(A)==="choo"&&(i={...i,A:e(de),B:e(me),C:e(ve)});const o=await fetch(`${Q}/quick_pp/permeability/${e(A)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!o.ok)throw new Error(await o.text());s(ie,await o.json()),xe()}catch(i){console.warn(`${e(A)} permeability error`,i),s(F,String(i?.message??i))}finally{s(R,!1)}}async function Be(){if(!T()||!w()){s(F,"Project and well must be selected before saving");return}if(!e(P)||e(P).length===0){s(F,"No permeability results to save");return}s(J,!0),ce=null,s(F,null);try{const t=e(P).map(_=>({DEPTH:_.depth,PERM:Number(_.PERM)}));if(!t.length)throw new Error("No rows prepared for save");const i={data:t},o=`${Q}/quick_pp/database/projects/${T()}/wells/${encodeURIComponent(String(w()))}/data`,a=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok)throw new Error(await a.text());const c=await a.json().catch(()=>null);ce=c&&c.message?String(c.message):"Permeability saved";try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:T(),wellName:w(),kind:"permeability"}}))}catch{}}catch(t){console.warn("Save permeability error",t),ce=null,s(F,String(t?.message??t))}finally{s(J,!1)}}function Le(){const t=[];if(e(P).forEach(I=>{I.PERM&&I.PERM>0&&t.push(I.PERM)}),e(D).forEach(I=>{I.CPERM&&I.CPERM>0&&t.push(I.CPERM)}),t.length===0)return[.001,1e3];const i=Math.min(...t),o=Math.max(...t),a=Math.log10(i),c=Math.log10(o),_=c-a,h=Math.max(.1,_*.1),n=Math.pow(10,a-h),k=Math.pow(10,c+h);return[n,k]}async function We(){if(!pe){const t=await ft(()=>import("../chunks/BJMC0GYJ.js").then(i=>i.p),[],import.meta.url);pe=t?.default??t}return pe}function xe(){const t=e(B),i=[];let o=0;for(const a of t){const c=Number(a.depth??a.DEPTH??NaN);if(isNaN(c))continue;const _=ue.find(n=>n.value===e(A));if(!_)continue;let h=!0;for(const n of _.requires){let k;if(n==="swirr"?k=e(ae):n==="vclay"?k=Number(a.vclay??a.VCLAY??a.Vclay??NaN):n==="vsilt"?k=Number(a.vsilt??a.VSILT??a.Vsilt??NaN):n==="phit"?k=Number(a.phit??a.PHIT??a.Phit??NaN):k=Number(a[n]??a[n.toUpperCase()]??NaN),isNaN(k)){h=!1;break}}if(h){const n=e(ie)[o++]??{PERM:null},k=Math.max(Number(n.PERM??.001),.001);i.push({depth:c,PERM:k})}}i.sort((a,c)=>a.depth-c.depth),s(P,i),s(D,ze())}async function Oe(){if(!e(L))return;const t=await We();if((!e(S)||e(S).length===0)&&(!e(j)||e(j).length===0)){try{t.purge(e(L))}catch{}return}const i=[];e(S)&&e(S).length>0&&i.push({x:e(S).map(n=>n.x),y:e(S).map(n=>n.y),name:"PERM (Log)",mode:"lines",line:{color:"#2563eb",width:2},xaxis:"x",yaxis:"y"}),e(j)&&e(j).length>0&&i.push({x:e(j).map(n=>n.x),y:e(j).map(n=>n.y),name:"CPERM (Core)",mode:"markers",marker:{color:"#dc2626",size:8,line:{color:"white",width:1}},xaxis:e(O)?"x2":"x",yaxis:"y"});const[o,a]=Le(),c=Math.max(o,1e-12),_=Math.max(a,c*10),h={height:260,margin:{l:60,r:20,t:50,b:80},dragmode:"zoom",xaxis:{title:"Log Depth",titlefont:{color:"#2563eb"},tickfont:{color:"#2563eb"},tickformat:",.0f",side:"bottom"},xaxis2:{title:"Core Depth",titlefont:{color:"#dc2626"},tickfont:{color:"#dc2626"},tickformat:",.0f",overlaying:"x",side:"top",fixedrange:e(O)},yaxis:{title:"Permeability (mD)",type:"log",range:[Math.log10(c),Math.log10(_)]},showlegend:!0,legend:{x:0,y:1,bgcolor:"rgba(255,255,255,0.8)",bordercolor:"rgba(0,0,0,0.2)",borderwidth:1}};try{t.react(e(L),i,h,{responsive:!0})}catch{t.newPlot(e(L),i,h,{responsive:!0})}}const He=Ae.subscribe(t=>{t?.depthFilter&&s(z,{...t.depthFilter}),t?.zoneFilter&&s(Y,{...t.zoneFilter})});je(()=>{He()});let fe=m("");H(()=>e(P),()=>{s(S,e(P).map(t=>({x:t.depth,y:t.PERM})))}),H(()=>e(D),()=>{s(j,e(D).map(t=>({x:t.depth,y:t.CPERM})))}),H(()=>(e(re),e(z),e(Y)),()=>{s(B,(()=>{let t=e(re)||[];return t=ht(t,e(z)),t=bt(t,e(Y)),t})())}),H(()=>(e(ie),e(B)),()=>{e(ie)&&e(B)&&xe()}),H(()=>(y(T()),y(w()),e(fe),e(X)),()=>{const t=`${T()}_${w()}`;T()&&w()&&t!==e(fe)&&(s(fe,t),(!e(X)||!ee.has(t))&&Ie())}),H(()=>(e(L),e(P),e(D),e(z),e(O),e(te)),()=>{e(L)&&(e(P)||e(D)||e(z)||e(O)!==void 0)&&(e(te)&&clearTimeout(e(te)),s(te,setTimeout(()=>Oe(),150)))}),lt(),Te();var he=jt(),ye=f(u(he),2);gt(ye,{});var Ke=f(ye,2);{var Ue=t=>{var i=$t(),o=u(i),a=u(o),c=f(u(a),2);K(()=>{e(A),st(()=>{})}),ot(c,5,()=>ue,nt,(l,r)=>{var d=yt(),N=u(d,!0);v(d);var M={};K(()=>{se(N,(e(r),p(()=>e(r).label))),M!==(M=(e(r),p(()=>e(r).value)))&&(d.value=(d.__value=(e(r),p(()=>e(r).value)))??"")}),b(l,d)}),v(c),v(a);var _=f(a,2),h=u(_);{var n=l=>{var r=wt(),d=f(u(r),2);G(d),v(r),oe(d,()=>e(ae),N=>s(ae,N)),b(l,r)},k=l=>{var r=Pt(),d=ke(r),N=u(d),M=f(u(N),2);G(M),v(N),v(d);var $=f(d,2),V=u($),x=f(u(V),2);G(x),v(V);var g=f(V,2),q=f(u(g),2);G(q),v(g),v($),oe(M,()=>e(de),Z=>s(de,Z)),oe(x,()=>e(me),Z=>s(me,Z)),oe(q,()=>e(ve),Z=>s(ve,Z)),b(l,r)};W(h,l=>{e(A)!=="choo"?l(n):l(k,!1)})}v(_),v(o);var I=f(o,2);{var Je=l=>{var r=Nt(),d=u(r);v(r),K(()=>se(d,`Error: ${e(F)??""}`)),b(l,r)};W(I,l=>{e(F)&&l(Je)})}var we=f(I,2),be=u(we),Pe=f(u(be),2),Ne=u(Pe);{let l=E(()=>e(R)?"opacity:0.5; pointer-events:none;":"");$e(Ne,{class:"btn btn-primary",onclick:Ve,get disabled(){return e(R)},get style(){return e(l)},children:(r,d)=>{ct();var N=_e("Estimate Permeability");b(r,N)},$$slots:{default:!0}})}var Me=f(Ne,2);{let l=E(()=>e(R)||e(J)),r=E(()=>e(R)||e(J)?"opacity:0.5; pointer-events:none;":"");$e(Me,{class:"btn ml-2 bg-emerald-700",onclick:Be,get disabled(){return e(l)},get style(){return e(r)},children:(d,N)=>{var M=dt(),$=ke(M);{var V=g=>{var q=_e("Saving...");b(g,q)},x=g=>{var q=_e("Save Permeability");b(g,q)};W($,g=>{e(J)?g(V):g(x,!1)})}b(d,M)},$$slots:{default:!0}})}var ge=f(Me,2),le=u(ge);G(le);var Ze=f(le,2);v(ge);var Ce=f(ge,2),Ge=u(Ce);{var Qe=l=>{var r=Mt();ut(r,d=>s(L,d),()=>e(L)),b(l,r)},Xe=l=>{var r=Ct();b(l,r)};W(Ge,l=>{e(P),e(D),p(()=>e(P).length>0||e(D).length>0)?l(Qe):l(Xe,!1)})}v(Ce),v(Pe),v(be);var Ee=f(be,2),Re=u(Ee);{var et=l=>{const r=E(()=>(e(P),p(()=>e(P).map(x=>x.PERM)))),d=E(()=>(y(e(r)),p(()=>e(r).reduce((x,g)=>x+g,0)/e(r).length))),N=E(()=>(y(e(r)),p(()=>Math.min(...e(r))))),M=E(()=>(y(e(r)),p(()=>Math.max(...e(r)))));var $=Et(),V=f(u($));v($),K((x,g,q)=>se(V,` Avg: ${x??""} mD | Min: ${g??""} mD | Max: ${q??""} mD | Count: ${y(e(r)),p(()=>e(r).length)??""}`),[()=>(y(e(d)),p(()=>e(d).toFixed(2))),()=>(y(e(N)),p(()=>e(N).toFixed(3))),()=>(y(e(M)),p(()=>e(M).toFixed(1)))]),b(l,$)},tt=l=>{var r=Rt();b(l,r)};W(Re,l=>{e(P),p(()=>e(P).length>0)?l(et):l(tt,!1)})}var at=f(Re,2);{var rt=l=>{const r=E(()=>(e(D),p(()=>e(D).map(x=>x.CPERM)))),d=E(()=>(y(e(r)),p(()=>e(r).reduce((x,g)=>x+g,0)/e(r).length))),N=E(()=>(y(e(r)),p(()=>Math.min(...e(r))))),M=E(()=>(y(e(r)),p(()=>Math.max(...e(r)))));var $=Dt(),V=f(u($),3);v($),K((x,g,q)=>se(V,` Avg: ${x??""} mD | Min: ${g??""} mD | Max: ${q??""} mD | Count: ${y(e(r)),p(()=>e(r).length)??""}`),[()=>(y(e(d)),p(()=>e(d).toFixed(2))),()=>(y(e(N)),p(()=>e(N).toFixed(3))),()=>(y(e(M)),p(()=>e(M).toFixed(1)))]),b(l,$)},it=l=>{var r=kt();b(l,r)};W(at,l=>{e(D),p(()=>e(D).length>0)?l(rt):l(it,!1)})}v(Ee),v(we),v(i),K(()=>{le.disabled=e(R),mt(Ze,1,`text-sm cursor-pointer ${e(R)?"opacity-50":""}`)}),vt(c,()=>e(A),l=>s(A,l)),pt(le,()=>e(O),l=>s(O,l)),b(t,i)},Ye=t=>{var i=St();b(t,i)};W(Ke,t=>{w()?t(Ue):t(Ye,!1)})}v(he),b(ne,he),Fe()}var Ft=C('<div slot="left"><!></div>');function Wt(ne,U){Se(U,!1);let S=m(null),j=m(null);const T=Ae.subscribe(w=>{s(S,w?.project??null),s(j,w?.selectedWell??null)});je(()=>T()),Te(),_t(ne,{get selectedWell(){return e(j)},get project(){return e(S)},$$slots:{left:(w,Q)=>{var z=Ft(),Y=u(z);{let B=E(()=>e(S)?.project_id??""),R=E(()=>e(j)?.name??"");Tt(Y,{get projectId(){return e(B)},get wellName(){return e(R)}})}v(z),b(w,z)}}}),Fe()}export{Wt as component,Lt as universal};
