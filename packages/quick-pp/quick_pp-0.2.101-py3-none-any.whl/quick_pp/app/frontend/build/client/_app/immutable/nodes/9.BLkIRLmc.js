import{p as ie,F as Fe,e as d,v as ce,l as se,g as t,H as Ie,b as Ze,i as pe,f as $,C as ae,h as re,w as A,t as w,k as N,Q as oe,Y as je,c as de,m as y,n as P,G as ue,S as Ne,r as F,J as le,I as $e,Z as Te,N as ne}from"../chunks/Cjo0f8hx.js";import{_ as Ee}from"../chunks/PPVm8Dsz.js";import{B as qe}from"../chunks/CHHNy2JR.js";import{D as Re}from"../chunks/D4wk-9zb.js";import{w as fe,f as ze}from"../chunks/CZmdasm_.js";import{P as Me}from"../chunks/CNqIdfOw.js";var Se=$("<span>Saving...</span>"),Ce=$("<span>Save Rock Types</span>"),De=$("<div> </div>"),Ae=$('<div class="text-sm text-blue-600 mb-3">Loading FZI data...</div>'),Le=$('<div class="text-sm text-red-600 mb-3"> </div>'),Oe=$('<div class="ws-rock-typing"><div class="mb-2"><div class="font-semibold">Rock Typing (Multi-Well)</div> <div class="text-sm text-muted-foreground">Cluster wells into rock types across the project.</div></div> <!> <div class="bg-panel rounded p-3 mb-3"><div class="flex-1"><label for="cutoffs" class="block text-sm font-medium mb-1">FZI Cutoffs (comma-separated)</label> <div class="flex gap-2 items-end"><input id="cutoffs" type="text" class="flex-1 px-3 py-2 border border-border rounded-md bg-background text-foreground" placeholder="e.g., 0.5,1.0,2.0"/> <!></div></div> <!> <div class="font-semibold mb-2">FZI Log-Log Plot</div> <div class="text-sm text-muted-foreground mb-3">Plot Flow Zone Indicator (FZI) from porosity and permeability data across all wells.</div> <!> <div class="bg-surface rounded p-3 min-h-[400px]"><div class="w-full max-w-[600px] h-[500px] mx-auto"></div></div> <div class="font-semibold mb-2">Pore-Perm Crossplot</div> <div class="text-sm text-muted-foreground mb-3">Plot porosity vs permeability with FZI cutoff lines and rock type coloring.</div> <div class="bg-surface rounded p-3 min-h-[400px]"><div class="w-full max-w-[600px] h-[500px] mx-auto"></div></div></div></div>');function Ve(L,R){ie(R,!1);let v=Fe(R,"projectId",8,null),T=y(!1),g=y(null),z=y(!1),I=y(null),i=y(null),E=y({enabled:!1,zones:[]}),O=y(null);const me=fe.subscribe(s=>{s?.zoneFilter&&d(E,{...s.zoneFilter})});ce(()=>me());function Q(){if(!t(i))return null;const s=t(i).phit.map((o,c)=>({phit:o,perm:t(i).perm[c],zone:t(i).zones[c],well_name:t(i).well_names[c],depth:t(i).depths[c]})),r=ze(s,t(E));return{phit:r.map(o=>o.phit),perm:r.map(o=>o.perm),zones:r.map(o=>o.zone),well_names:r.map(o=>o.well_name),depths:r.map(o=>o.depth)}}let Z=y("0.1, 1.0, 3.0, 6.0"),M=null,S=y(null),C=y(null);const J="http://localhost:6312";async function H(){if(M)return M;const s=await Ee(()=>import("../chunks/BJMC0GYJ.js").then(r=>r.p),[],import.meta.url);return M=s.default||s,M}async function he(){if(v()){d(z,!0),d(I,null);try{const s=`${J}/quick_pp/database/projects/${v()}/fzi_data`,r=await fetch(s);if(!r.ok)throw new Error(await r.text());d(i,await r.json())}catch(s){d(I,s.message||"Failed to load FZI data"),d(i,null)}finally{d(z,!1)}}}function ve(){const s=Q();if(!s||!t(S))return;const{phit:r,perm:o}=s,c=r.map((e,a)=>.0314*Math.sqrt(o[a]/e)),h=r.map(e=>e<=0||!isFinite(e)?NaN:e/(1-e)),_=c.map((e,a)=>e/h[a]),p=t(Z).split(",").map(e=>parseFloat(e.trim())).filter(e=>!isNaN(e)&&e>0),u=_.map(e=>{if(isNaN(e)||!isFinite(e))return null;let a=p.length+1;for(let l=p.length-1;l>=0;l--)if(e>=p[l]){a=p.length-1-l+1;break}return a}),m=new Array,f={};u.forEach((e,a)=>{e!==null&&(f[e]||(f[e]={phiZ:[],rqi:[]}),f[e].phiZ.push(h[a]),f[e].rqi.push(c[a]))});const x=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Object.keys(f).sort((e,a)=>parseInt(e)-parseInt(a)).forEach(e=>{const a=f[parseInt(e)];m.push({x:a.phiZ,y:a.rqi,mode:"markers",type:"scatter",name:`Rock Type ${e}`,marker:{color:x[(parseInt(e)-1)%x.length],size:4,symbol:"circle"}})});const b=h.filter(e=>e>0&&isFinite(e));if(b.length>0){const e=Math.min(...b),a=Math.max(...b),l=[];for(let k=0;k<20;k++)l.push(e*Math.pow(a/e,k/19));p.forEach(k=>{const D=l.map(j=>k*j);m.push({x:l,y:D,mode:"lines",type:"scatter",name:`FZI=${k.toFixed(1)}`,line:{dash:"dash",color:"red"}})})}const n={title:"FZI Log-Log Plot",xaxis:{title:"Pore to Solid Volume Ratio (phi_z)",type:"log",autorange:!0},yaxis:{title:"Rock Quality Index (RQI)",type:"log",autorange:!0},showlegend:!0,margin:{l:60,r:60,t:60,b:60}};H().then(e=>{e.newPlot(t(S),m,n,{responsive:!0})})}function ge(){const s=Q();if(!s||!t(C))return;const{phit:r,perm:o}=s,c=r.map((e,a)=>.0314*Math.sqrt(o[a]/e)),h=r.map(e=>e/(1-e)),_=c.map((e,a)=>e/h[a]),p=t(Z).split(",").map(e=>parseFloat(e.trim())).filter(e=>!isNaN(e)&&e>0),u=_.map(e=>{if(isNaN(e)||!isFinite(e))return null;let a=p.length+1;for(let l=p.length-1;l>=0;l--)if(e>=p[l]){a=p.length-1-l+1;break}return a}),m=new Array,f={};u.forEach((e,a)=>{e!==null&&(f[e]||(f[e]={phit:[],perm:[]}),f[e].phit.push(r[a]),f[e].perm.push(o[a]))});const x=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Object.keys(f).sort((e,a)=>parseInt(e)-parseInt(a)).forEach(e=>{const a=f[parseInt(e)];m.push({x:a.phit,y:a.perm,mode:"markers",type:"scatter",name:`Rock Type ${e}`,marker:{color:x[(parseInt(e)-1)%x.length],size:4,symbol:"circle"}})});const b=new Array;for(let e=0;e<=50;e++)b.push(e*.01);p.forEach((e,a)=>{const l=b.map(q=>q<=0||q>=1?null:q*Math.pow(q*e/(.0314*(1-q)),2));m.push({x:b,y:l,mode:"lines",type:"scatter",name:`FZI=${e.toFixed(1)}`,line:{dash:"dash",color:"red"}});const k=p.length-a,D=Math.floor(b.length*.7);let j=l[D];j!==null&&j>0?j=j*2.5:j=1,m.push({x:[b[D]],y:[j],mode:"text",type:"scatter",name:`PRT ${k}`,text:[`PRT ${k}`],textposition:"middle right",showlegend:!1,textfont:{size:10,color:"red"}})});const n={title:"Pore-Perm Crossplot",xaxis:{title:"Porosity (fraction)",range:[-.05,.5],autorange:!1},yaxis:{title:"Permeability (mD)",type:"log",autorange:!0},showlegend:!0,margin:{l:60,r:60,t:60,b:60}};H().then(e=>{e.newPlot(t(C),m,n,{responsive:!0})})}async function _e(){if(!(!t(i)||!v())){d(T,!0),d(g,null);try{const s=t(i).phit,r=t(i).perm,o=t(i).well_names,c=t(i).depths,h=s.map((n,e)=>.0314*Math.sqrt(r[e]/n)),_=s.map(n=>n/(1-n)),p=h.map((n,e)=>n/_[e]),u=t(Z).split(",").map(n=>parseFloat(n.trim())).filter(n=>!isNaN(n)&&n>0),m=p.map((n,e)=>{let a=null;if(!isNaN(n)&&isFinite(n)){a=u.length+1;for(let l=u.length-1;l>=0;l--)if(n>=u[l]){a=u.length-1-l+1;break}}return{well_name:o[e],depth:c[e],rock_flag:a}}),f=`${J}/quick_pp/database/projects/${v()}/save_rock_flags`,x=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rock_flag_pairs:m,cutoffs:t(Z)})});if(!x.ok)throw new Error(await x.text());const b=await x.json();d(g,`Success: ${b.message}`)}catch(s){d(g,`Error: ${s.message}`)}finally{d(T,!1)}}}se(()=>(Ie(v()),t(O)),()=>{v()&&v()!==t(O)&&(d(O,v()),he())}),se(()=>(t(i),t(Z),t(E)),()=>{t(i)&&t(Z)&&t(E)&&(ve(),ge())}),Ze(),pe();var V=Oe(),Y=N(P(V),2);Re(Y,{});var K=N(Y,2),W=P(K),U=N(P(W),2),B=P(U);Ne(B);var be=N(B,2);{let s=ue(()=>t(T)||!t(i));qe(be,{onclick:_e,get disabled(){return t(s)},children:(r,o)=>{var c=ae(),h=re(c);{var _=u=>{var m=Se();w(u,m)},p=u=>{var m=Ce();w(u,m)};A(h,u=>{t(T)?u(_):u(p,!1)})}w(r,c)},$$slots:{default:!0}})}F(U),F(W);var X=N(W,2);{var ye=s=>{var r=De(),o=P(r,!0);F(r),le(c=>{Te(r,1,`text-sm ${c??""}`),ne(o,t(g))},[()=>(t(g),$e(()=>t(g).startsWith("Error")?"text-red-600":"text-green-600"))]),w(s,r)};A(X,s=>{t(g)&&s(ye)})}var ee=N(X,6);{var xe=s=>{var r=Ae();w(s,r)},ke=s=>{var r=ae(),o=re(r);{var c=h=>{var _=Le(),p=P(_,!0);F(_),le(()=>ne(p,t(I))),w(h,_)};A(o,h=>{t(I)&&h(c)},!0)}w(s,r)};A(ee,s=>{t(z)?s(xe):s(ke,!1)})}var G=N(ee,2),we=P(G);oe(we,s=>d(S,s),()=>t(S)),F(G);var te=N(G,6),Pe=P(te);oe(Pe,s=>d(C,s),()=>t(C)),F(te),F(K),F(V),je(B,()=>t(Z),s=>d(Z,s)),w(L,V),de()}var We=$('<div slot="left"><!></div>');function Ke(L,R){ie(R,!1);let v=y(null);const T=fe.subscribe(g=>{d(v,g?.project??null)});ce(()=>T()),pe(),Me(L,{get project(){return t(v)},$$slots:{left:(g,z)=>{var I=We(),i=P(I);{let E=ue(()=>t(v)?.project_id??null);Ve(i,{get projectId(){return t(E)}})}F(I),w(g,I)}}}),de()}export{Ke as component};
